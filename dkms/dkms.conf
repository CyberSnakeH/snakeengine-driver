# DKMS Configuration for SnakeEngine Kernel Driver
#
# DKMS (Dynamic Kernel Module Support) automatically rebuilds
# the kernel module when a new kernel is installed.
#
# Installation:
#   sudo cp -r snakeengine-driver /usr/src/snakedrv-1.0.0
#   sudo dkms add -m snakedrv -v 1.0.0
#   sudo dkms build -m snakedrv -v 1.0.0
#   sudo dkms install -m snakedrv -v 1.0.0
#
# Status:
#   dkms status
#
# Removal:
#   sudo dkms remove -m snakedrv -v 1.0.0 --all

PACKAGE_NAME="snakedrv"
PACKAGE_VERSION="1.0.0"
CLEAN="make clean"

# Module definition
BUILT_MODULE_NAME[0]="snakedrv"
BUILT_MODULE_LOCATION[0]="kernel"
DEST_MODULE_LOCATION[0]="/updates"

# Build command
MAKE[0]="make -C kernel KDIR=/lib/modules/${kernelver}/build"

# Autoinstall
AUTOINSTALL="yes"

# Module options
# These can be overridden in /etc/modprobe.d/snakedrv.conf
#
# max_attached_processes - Maximum processes that can be attached (default: 16)
# event_queue_size       - Maximum pending debug events (default: 256)
# debug_level            - Logging verbosity 0-3 (default: 1)

# Rebuild on kernel update triggers
REMAKE_INITRD="no"

# Custom POST_INSTALL script for setting up udev rules
POST_INSTALL="scripts/post-install.sh"
POST_REMOVE="scripts/post-remove.sh"

# Signing (for Secure Boot)
# Sign the module if keys are available
# SIGN_MODULES="yes"
# SIGNING_KEY="/var/lib/dkms/snakedrv/mok.key"
# SIGNING_CERT="/var/lib/dkms/snakedrv/mok.crt"
