divert(-1)










































































































































#
# Directory patterns (dir)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. directory type
#


































#
# Regular file patterns (file)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. file type
#






































#
# Symbolic link patterns (lnk_file)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. file type
#




























#
# (Un)named Pipes/FIFO patterns (fifo_file)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. file type
#




























#
# (Un)named sockets patterns (sock_file)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. file type
#


























#
# Block device node patterns (blk_file)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. file type
#






























#
# Character device node patterns (chr_file)
#
# Parameters:
# 1. domain type
# 2. container (directory) type
# 3. file type
#




























#
# File type_transition patterns
#
# filetrans_add_pattern(domain,dirtype,newtype,class(es),[filename])
#


#
# filetrans_pattern(domain,dirtype,newtype,class(es),[filename])
#



#
# unix domain socket patterns
#



########################################
#
# Macros for switching between source policy
# and loadable policy module support
#

##############################
#
# For adding the module statement
#


##############################
#
# For use in interfaces, to optionally insert a require block
#


# helper function, since m4 wont expand macros
# if a line is a comment (#):

##############################
#
# In the future interfaces should be in loadable modules
#
# template(name,rules)
#


##############################
#
# In the future interfaces should be in loadable modules
#
# interface(name,rules)
#




##############################
#
# Optional policy handling
#


##############################
#
# Determine if we should use the default
# tunable value as specified by the policy
# or if the override value should be used
#


##############################
#
# Extract booleans out of an expression.
# This needs to be reworked so expressions
# with parentheses can work.



##############################
#
# Tunable declaration
#


##############################
#
# Tunable policy handling
#


########################################
#
# Helper macros
#

#
# shiftn(num,list...)
#
# shift the list num times
#


#
# ifndef(expr,true_block,false_block)
#
# m4 does not have this.
#


#
# __endline__
#
# dummy macro to insert a newline.  used for 
# errprint, so the close parentheses can be
# indented correctly.
#


########################################
#
# refpolwarn(message)
#
# print a warning message
#


########################################
#
# refpolerr(message)
#
# print an error message.  does not
# make anything fail.
#


########################################
#
# gen_user(username, prefix, role_set, mls_defaultlevel, mls_range, [mcs_categories])
#


########################################
#
# gen_context(context,mls_sensitivity,[mcs_categories])
#

########################################
#
# can_exec(domain,executable)
#


########################################
#
# gen_bool(name,default_value)
#

#
# Specified domain transition patterns
#


# compatibility:




#
# Automatic domain transition patterns
#


# compatibility:




#
# Dynamic transition pattern
#


#
# Other process permissions
#

########################################
#
# gen_cats(N)
#
# declares categores c0 to c(N-1)
#




########################################
#
# gen_sens(N)
#
# declares sensitivites s0 to s(N-1) with dominance
# in increasing numeric order with s0 lowest, s(N-1) highest
#






########################################
#
# gen_levels(N,M)
#
# levels from s0 to (N-1) with categories c0 to (M-1)
#




########################################
#
# Basic level names for system low and high
#





########################################
# 
# Support macros for sets of object classes and permissions
#
# This file should only have object class and permission set macros - they
# can only reference object classes and/or permissions.

#
# All directory and file classes
#


#
# All non-directory file classes.
#


#
# Non-device file classes.
#


#
# Device file classes.
#


#
# All socket classes.
#


#
# Datagram socket classes.
# 


#
# Stream socket classes.
#


#
# Unprivileged socket classes (exclude rawip, netlink, packet).
#


########################################
# 
# Macros for sets of permissions
#

#
# Permissions to mount and unmount file systems.
#


#
# Permissions for using sockets.
# 


#
# Permissions for creating and using sockets.
# 


#
# Permissions for using stream sockets.
# 


#
# Permissions for creating and using stream sockets.
# 


#
# Permissions for creating and using sockets.
# 


#
# Permissions for creating and using sockets.
# 



#
# Permissions for creating and using netlink sockets.
# 


#
# Permissions for using netlink sockets for operations that modify state.
# 


#
# Permissions for using netlink sockets for operations that observe state.
# 


#
# Permissions for sending all signals.
#


#
# Permissions for sending and receiving network packets.
#


#
# Permissions for using System V IPC
#










########################################
#
# New permission sets
#

#
# Directory (dir)
#




















#
# Regular file (file)
#




























#
# Symbolic link (lnk_file)
#















#
# (Un)named Pipes/FIFOs (fifo_file)
#

















#
# (Un)named Sockets (sock_file)
#















#
# Block device nodes (blk_file)
#

















#
# Character device nodes (chr_file)
#

















#
# Anonymous inode files (anon_inode)
#



########################################
#
# Special permission sets
#

#
# Use (read and write) terminals
#



#
# Sockets
#



#
# Keys
#


#
# Service
#


#
# perf_event
#



## <summary>Policy for the kernel modules, kernel image, and bootloader.</summary>

########################################
## <summary>
##	Execute bootloader in the bootloader domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bootloader_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_domtrans'($*)) dnl
	
	gen_require(`
		type bootloader_t, bootloader_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, bootloader_exec_t, bootloader_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_domtrans'($*)) dnl
	')


######################################
## <summary>
##  Execute bootloader in the caller domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`bootloader_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_exec'($*)) dnl
	
    gen_require(`
        type bootloader_exec_t;
    ')

    can_exec($1, bootloader_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute bootloader interactively and do
##	a domain transition to the bootloader domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bootloader_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_run'($*)) dnl
	
	gen_require(`
		type bootloader_t;
		attribute_role bootloader_roles;
	')

	bootloader_domtrans($1)
	roleattribute $2 bootloader_roles;


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_run'($*)) dnl
	')


########################################
## <summary>
##	Read the bootloader configuration file.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bootloader_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_read_config'($*)) dnl
	
	gen_require(`
		type bootloader_etc_t;
	')

	allow $1 bootloader_etc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_read_config'($*)) dnl
	')


########################################
## <summary>
##	Read and write the bootloader
##	configuration file.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bootloader_rw_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_rw_config'($*)) dnl
	
	gen_require(`
		type bootloader_etc_t;
	')

	allow $1 bootloader_etc_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_rw_config'($*)) dnl
	')


########################################
## <summary>
##	Manage the bootloader
##	configuration file.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bootloader_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_manage_config'($*)) dnl
	
	gen_require(`
		type bootloader_etc_t;
	')

	manage_files_pattern($1, bootloader_etc_t, bootloader_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_manage_config'($*)) dnl
	')


########################################
## <summary>
##	Read and write the bootloader
##	temporary data in /tmp.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bootloader_rw_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_rw_tmp_files'($*)) dnl
	
	gen_require(`
		type bootloader_tmp_t;
	')

	files_search_tmp($1)
	allow $1 bootloader_tmp_t:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_rw_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Read and write the bootloader
##	temporary data in /tmp.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bootloader_create_runtime_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_create_runtime_file'($*)) dnl
	
	gen_require(`
		type boot_runtime_t;
	')

	allow $1 boot_runtime_t:file { create_file_perms rw_file_perms };
	files_boot_filetrans($1, boot_runtime_t, file)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_create_runtime_file'($*)) dnl
	')


########################################
## <summary>
##	Type transition files created in /etc
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bootloader_filetrans_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootloader_filetrans_config'($*)) dnl
	
	gen_require(`
		type bootloader_etc_t;
	')

	files_etc_filetrans($1,bootloader_etc_t,file, "grub")
	files_etc_filetrans($1,bootloader_etc_t,file, "lilo.conf")
	files_etc_filetrans($1,bootloader_etc_t,file, "yaboot.conf")
	files_etc_filetrans($1,bootloader_etc_t,file, "zipl.conf")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootloader_filetrans_config'($*)) dnl
	')

## <summary>
##	Determine of the console connected to the controlling terminal.
## </summary>

########################################
## <summary>
##	Execute consoletype in the consoletype domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`consoletype_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consoletype_domtrans'($*)) dnl
	
	gen_require(`
		type consoletype_t, consoletype_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, consoletype_exec_t, consoletype_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consoletype_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute consoletype in the consoletype domain, and
##	allow the specified role the consoletype domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`consoletype_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consoletype_run'($*)) dnl
	
	gen_require(`
		type consoletype_t;
	')

	consoletype_domtrans($1)
	role $2 types consoletype_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consoletype_run'($*)) dnl
	')


########################################
## <summary>
##	Execute consoletype in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`consoletype_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consoletype_exec'($*)) dnl
	
	gen_require(`
		type consoletype_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, consoletype_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consoletype_exec'($*)) dnl
	')

## <summary>Policy for dmesg.</summary>

########################################
## <summary>
##	Execute dmesg in the dmesg domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dmesg_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dmesg_domtrans'($*)) dnl
	
	gen_require(`
		type dmesg_t, dmesg_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dmesg_exec_t, dmesg_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dmesg_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute dmesg in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dmesg_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dmesg_exec'($*)) dnl
	
	gen_require(`
		type dmesg_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, dmesg_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dmesg_exec'($*)) dnl
	')

## <summary>Network analysis utilities</summary>

########################################
## <summary>
##	Execute network utilities in the netutils domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`netutils_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_domtrans'($*)) dnl
	
	gen_require(`
		type netutils_t, netutils_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, netutils_exec_t, netutils_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute network utilities in the netutils domain, and
##	allow the specified role the netutils domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`netutils_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_run'($*)) dnl
	
	gen_require(`
		type netutils_t;
	')

	netutils_domtrans($1)
	allow $1 netutils_t:process { signal sigkill };
	role $2 types netutils_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_run'($*)) dnl
	')


########################################
## <summary>
##	Execute network utilities in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`netutils_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_exec'($*)) dnl
	
	gen_require(`
		type netutils_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, netutils_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_exec'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to network utilities.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`netutils_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_signal'($*)) dnl
	
	gen_require(`
		type netutils_t;
	')

	allow $1 netutils_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_signal'($*)) dnl
	')


########################################
## <summary>
##	Execute ping in the ping domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`netutils_domtrans_ping',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_domtrans_ping'($*)) dnl
	
	gen_require(`
		type ping_t, ping_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ping_exec_t, ping_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_domtrans_ping'($*)) dnl
	')


########################################
## <summary>
##	Send a kill (SIGKILL) signal to ping.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`netutils_kill_ping',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_kill_ping'($*)) dnl
	
	gen_require(`
		type ping_t;
	')

	allow $1 ping_t:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_kill_ping'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to ping.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`netutils_signal_ping',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_signal_ping'($*)) dnl
	
	gen_require(`
		type ping_t;
	')

	allow $1 ping_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_signal_ping'($*)) dnl
	')


########################################
## <summary>
##	Execute ping in the ping domain, and
##	allow the specified role the ping domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`netutils_run_ping',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_run_ping'($*)) dnl
	
	gen_require(`
		type ping_t;
	')

	netutils_domtrans_ping($1)
	role $2 types ping_t;
	allow $1 ping_t:process { signal sigkill };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_run_ping'($*)) dnl
	')


########################################
## <summary>
##	Conditionally execute ping in the ping domain, and
##	allow the specified role the ping domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`netutils_run_ping_cond',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_run_ping_cond'($*)) dnl
	
	gen_require(`
		type ping_t;
		bool selinuxuser_ping;
	')

	role $2 types ping_t;

	if ( selinuxuser_ping ) {
		netutils_domtrans_ping($1)
		allow $1 ping_t:process { signal sigkill };
	}

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_run_ping_cond'($*)) dnl
	')


########################################
## <summary>
##	Execute ping in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`netutils_exec_ping',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_exec_ping'($*)) dnl
	
	gen_require(`
		type ping_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, ping_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_exec_ping'($*)) dnl
	')


########################################
## <summary>
##	Execute traceroute in the traceroute domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`netutils_domtrans_traceroute',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_domtrans_traceroute'($*)) dnl
	
	gen_require(`
		type traceroute_t, traceroute_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, traceroute_exec_t, traceroute_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_domtrans_traceroute'($*)) dnl
	')


########################################
## <summary>
##	Execute traceroute in the traceroute domain, and
##	allow the specified role the traceroute domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`netutils_run_traceroute',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_run_traceroute'($*)) dnl
	
	gen_require(`
		type traceroute_t;
	')

	netutils_domtrans_traceroute($1)
	allow $1 traceroute_t:process { signal sigkill };
	role $2 types traceroute_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_run_traceroute'($*)) dnl
	')


########################################
## <summary>
##	Conditionally execute traceroute in the traceroute domain, and
##	allow the specified role the traceroute domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`netutils_run_traceroute_cond',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_run_traceroute_cond'($*)) dnl
	
	gen_require(`
		type traceroute_t;
		bool selinuxuser_ping;
	')

	role $2 types traceroute_t;

	if( selinuxuser_ping ) {
		netutils_domtrans_traceroute($1)
		allow $1 traceroute_t:process { signal sigkill };
	}

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_run_traceroute_cond'($*)) dnl
	')


########################################
## <summary>
##	Execute traceroute in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`netutils_exec_traceroute',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `netutils_exec_traceroute'($*)) dnl
	
	gen_require(`
		type traceroute_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, traceroute_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `netutils_exec_traceroute'($*)) dnl
	')

## <summary>Execute a command with a substitute user</summary>

#######################################
## <summary>
##	The role template for the sudo module.
## </summary>
## <desc>
##	<p>
##	This template creates a derived domain which is allowed
##	to change the linux user id, to run commands as a different
##	user.
##	</p>
## </desc>
## <param name="role_prefix">
##	<summary>
##	The prefix of the user role (e.g., user
##	is the prefix for user_r).
##	</summary>
## </param>
## <param name="user_role">
##	<summary>
##	The user role.
##	</summary>
## </param>
## <param name="user_domain">
##	<summary>
##	The user domain associated with the role.
##	</summary>
## </param>
#
 	 	define(`sudo_role_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `sudo_role_template'($*)) dnl
	

	gen_require(`
		type sudo_exec_t;
		type sudo_db_t;
		attribute sudodomain;
	')

	##############################
	#
	# Declarations
	#

	type $1_sudo_t, sudodomain; 
	userdom_user_application_domain($1_sudo_t, sudo_exec_t)
	domain_interactive_fd($1_sudo_t)
	domain_role_change_exemption($1_sudo_t)
	role $2 types $1_sudo_t;
	userdom_home_manager($1_sudo_t)

	type $1_sudo_tmp_t;
	files_tmp_file($1_sudo_tmp_t)

	allow $1_sudo_t $1_sudo_tmp_t:file manage_file_perms;
	files_tmp_filetrans($1_sudo_t, $1_sudo_tmp_t, file)

	allow $1_sudo_t $3:process getpgid;
	allow $1_sudo_t $3:dir search_dir_perms;;
	allow $1_sudo_t $3:file read_file_perms;;
	allow $1_sudo_t $3:key search;

	allow $1_sudo_t $1_t:unix_stream_socket { connectto read write };

	# Enter this derived domain from the user domain
	domtrans_pattern($3, sudo_exec_t, $1_sudo_t)

	# By default, revert to the calling domain when a shell is executed.
	corecmd_shell_domtrans($1_sudo_t, $3)
	corecmd_bin_domtrans($1_sudo_t, $3)
	userdom_domtrans_user_home($1_sudo_t, $3)
	userdom_domtrans_user_tmp($1_sudo_t, $3)
	domain_entry_file($3, sudo_exec_t)
	domain_auto_transition_pattern($1_sudo_t, sudo_exec_t, $3)

	allow $3 $1_sudo_t:fd use;
	allow $3 $1_sudo_t:fifo_file rw_fifo_file_perms;
	allow $3 $1_sudo_t:process signal_perms;

	kernel_read_system_state($1_sudo_t)
	seutil_libselinux_linked($1_sudo_t)

	auth_run_chk_passwd($1_sudo_t, $2)
	auth_use_nsswitch($1_sudo_t)

	logging_send_syslog_msg($1_sudo_t)
    logging_read_syslog_pid($1_sudo_t)

    term_use_generic_ptys($1_sudo_t)
    term_setattr_generic_ptys($1_sudo_t)

	optional_policy(`
		mta_role($2, $1_sudo_t)
	')

    optional_policy(`
	    rpm_run($1_sudo_t, $2)
    ')

	optional_policy(`
		dmidecode_domtrans($1_sudo_t)
	')

	optional_policy(`
		iotop_domtrans($1_sudo_t)
	')

	optional_policy(`
	    	kerberos_manage_host_rcache($1_sudo_t)
		kerberos_read_config($1_sudo_t)
	')

	optional_policy(`
		netutils_domtrans($1_sudo_t)
		netutils_run_traceroute($1_sudo_t, $2)
	')

	optional_policy(`
		systemd_domtrans_systemctl($1_sudo_t, $3)
		systemd_logind_stream_connect($1_sudo_t)
		systemd_systemctl_entrypoint($3)
	')

	optional_policy(`
		userdom_write_user_tmp_sockets($1_sudo_t)
	')

	optional_policy(`
		usermanage_domtrans_passwd($1_sudo_t)
	')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `sudo_role_template'($*)) dnl
	')


########################################
## <summary>
##	Send a SIGCHLD signal to the sudo domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`sudo_sigchld',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `sudo_sigchld'($*)) dnl
	
	gen_require(`
		attribute sudodomain;
	')

	allow $1 sudodomain:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `sudo_sigchld'($*)) dnl
	')


#######################################
## <summary>
##  Allow execute sudo in called domain.
##  This interfaces is added for nova-stack policy.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`sudo_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `sudo_exec'($*)) dnl
	
    gen_require(`
        type sudo_exec_t;
    ')

	can_exec($1, sudo_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `sudo_exec'($*)) dnl
	')


######################################
## <summary>
##  Allow to manage sudo database in called domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`sudo_manage_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `sudo_manage_db'($*)) dnl
	
    gen_require(`
        type sudo_db_t;
    ')
    
    manage_dirs_pattern($1, sudo_db_t, sudo_db_t)
    manage_files_pattern($1, sudo_db_t, sudo_db_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `sudo_manage_db'($*)) dnl
	')


########################################
## <summary>
## 	Transition to sudo log named content
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`sudo_filetrans_named_content_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `sudo_filetrans_named_content_log'($*)) dnl
	
	gen_require(`
		type sudo_log_t;
	')

	logging_log_filetrans($1, sudo_log_t, file, "sudo.log")
	logging_log_filetrans($1, sudo_log_t, dir, "sudo-io")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `sudo_filetrans_named_content_log'($*)) dnl
	')

## <summary>Run shells with substitute user and group</summary>

#######################################
## <summary>
##	Restricted su domain template.
## </summary>
## <desc>
##	<p>
##	This template creates a derived domain which is allowed
##	to change the linux user id, to run shells as a different
##	user.
##	</p>
## </desc>
## <param name="userdomain_prefix">
##	<summary>
##	The prefix of the user domain (e.g., user
##	is the prefix for user_t).
##	</summary>
## </param>
## <param name="user_domain">
##	<summary>
##	The type of the user domain.
##	</summary>
## </param>
## <param name="user_role">
##	<summary>
##	The role associated with the user domain.
##	</summary>
## </param>
#
 	 	define(`su_restricted_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `su_restricted_domain_template'($*)) dnl
	
	gen_require(`
		type su_exec_t;
	')

	type $1_su_t;
	domain_entry_file($1_su_t, su_exec_t)
	domain_type($1_su_t)
	domain_interactive_fd($1_su_t)
	role $3 types $1_su_t;

	allow $2 $1_su_t:process signal;

	allow $1_su_t self:capability { audit_control audit_write setuid setgid net_bind_service chown dac_read_search  fowner sys_nice sys_resource };
	dontaudit $1_su_t self:capability sys_tty_config;
	allow $1_su_t self:key { search write };
	allow $1_su_t self:process { setexec setsched setrlimit };
	allow $1_su_t self:fifo_file rw_fifo_file_perms;
	allow $1_su_t self:netlink_audit_socket { nlmsg_relay create_netlink_socket_perms };
	allow $1_su_t self:unix_stream_socket create_stream_socket_perms;
    allow $1_su_t self:netlink_selinux_socket create_socket_perms;

	# Transition from the user domain to this domain.
	domtrans_pattern($2, su_exec_t, $1_su_t)

	# By default, revert to the calling domain when a shell is executed.
	corecmd_shell_domtrans($1_su_t,$2)
	allow $2 $1_su_t:fd use;
	allow $2 $1_su_t:fifo_file rw_file_perms;
	allow $2 $1_su_t:process sigchld;

    kernel_getattr_core_if($1_su_t)
	kernel_read_system_state($1_su_t)
	kernel_read_kernel_sysctls($1_su_t)
	kernel_search_key($1_su_t)
	kernel_link_key($1_su_t)

	# for SSP
	dev_read_urand($1_su_t)

	files_read_etc_files($1_su_t)
	files_read_etc_runtime_files($1_su_t)
	files_search_var_lib($1_su_t)
	files_dontaudit_getattr_tmp_dirs($1_su_t)

	# for the rootok check
	selinux_compute_access_vector($1_su_t)

	auth_domtrans_chk_passwd($1_su_t)
	auth_dontaudit_read_shadow($1_su_t)
	auth_use_nsswitch($1_su_t)
	auth_rw_faillog($1_su_t)

	domain_use_interactive_fds($1_su_t)

	init_dontaudit_use_fds($1_su_t)
	init_dontaudit_use_script_ptys($1_su_t)
	# Write to utmp.
	init_rw_utmp($1_su_t)
	init_search_script_keys($1_su_t)
    init_getattr_initctl($1_su_t)

	logging_send_syslog_msg($1_su_t)


	ifdef(`distro_redhat',`
		# RHEL5 and possibly newer releases incl. Fedora
		auth_domtrans_upd_passwd($1_su_t)

		optional_policy(`
			locallogin_search_keys($1_su_t)
		')
	')

	ifdef(`distro_rhel4',`
		domain_role_change_exemption($1_su_t)
		domain_subj_id_change_exemption($1_su_t)
		domain_obj_id_change_exemption($1_su_t)

		selinux_get_fs_mount($1_su_t)
		selinux_validate_context($1_su_t)
		selinux_compute_access_vector($1_su_t)
		selinux_compute_create_context($1_su_t)
		selinux_compute_relabel_context($1_su_t)
		selinux_compute_user_contexts($1_su_t)

		seutil_read_config($1_su_t)
		seutil_read_default_contexts($1_su_t)

		# Only allow transitions to unprivileged user domains.
		userdom_spec_domtrans_unpriv_users($1_su_t)
	')

	optional_policy(`
		cron_read_pipes($1_su_t)
	')

	optional_policy(`
		kerberos_use($1_su_t)
	')

	optional_policy(`
		# used when the password has expired
		usermanage_read_crack_db($1_su_t)
	')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `su_restricted_domain_template'($*)) dnl
	')


#######################################
## <summary>
##	The role template for the su module.
## </summary>
## <param name="role_prefix">
##	<summary>
##	The prefix of the user role (e.g., user
##	is the prefix for user_r).
##	</summary>
## </param>
## <param name="user_role">
##	<summary>
##	The role associated with the user domain.
##	</summary>
## </param>
## <param name="user_domain">
##	<summary>
##	The type of the user domain.
##	</summary>
## </param>
#
 	 	define(`su_role_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `su_role_template'($*)) dnl
	
	gen_require(`
		attribute su_domain_type;
		type su_exec_t;
		bool secure_mode;
	')

	type $1_su_t, su_domain_type;
	userdom_user_application_domain($1_su_t, su_exec_t)
	domain_interactive_fd($1_su_t)
	role $2 types $1_su_t;

    allow $1_su_t self:netlink_selinux_socket create_socket_perms;

	allow $3 $1_su_t:process signal;
	allow $1_su_t $3:key search;

	# Transition from the user domain to this domain.
	domtrans_pattern($3, su_exec_t, $1_su_t)

	ps_process_pattern($3, $1_su_t)

	# By default, revert to the calling domain when a shell is executed.
	corecmd_shell_domtrans($1_su_t, $3)
	allow $3 $1_su_t:fd use;
	allow $3 $1_su_t:fifo_file rw_file_perms;
	allow $3 $1_su_t:process sigchld;

	kernel_read_system_state($1_su_t)
	kernel_dontaudit_getattr_core_if($1_su_t)

	auth_use_pam($1_su_t)
	auth_write_login_records($1_su_t)

	init_dontaudit_getattr_initctl($1_su_t)

	mls_file_write_all_levels($1_su_t)

	logging_send_syslog_msg($1_su_t)

 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `su_role_template'($*)) dnl
	')


#######################################
## <summary>
##	Execute su in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`su_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `su_exec'($*)) dnl
	
	gen_require(`
		type su_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, su_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `su_exec'($*)) dnl
	')

## <summary>Policy for managing user accounts.</summary>

########################################
## <summary>
##	Execute chfn in the chfn domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`usermanage_domtrans_chfn',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_domtrans_chfn'($*)) dnl
	
	gen_require(`
		type chfn_t, chfn_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, chfn_exec_t, chfn_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_domtrans_chfn'($*)) dnl
	')


########################################
## <summary>
##	Execute chfn in the chfn domain, and
##	allow the specified role the chfn domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_run_chfn',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_run_chfn'($*)) dnl
	
	gen_require(`
		attribute_role chfn_roles;
		type chfn_t;
	')

	usermanage_domtrans_chfn($1)
	roleattribute $2 chfn_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_run_chfn'($*)) dnl
	')


########################################
## <summary>
##	Execute groupadd in the groupadd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`usermanage_domtrans_groupadd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_domtrans_groupadd'($*)) dnl
	
	gen_require(`
		type groupadd_t, groupadd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, groupadd_exec_t, groupadd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_domtrans_groupadd'($*)) dnl
	')


########################################
## <summary>
##	Check access to the groupadd executable.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_access_check_groupadd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_access_check_groupadd'($*)) dnl
	
	gen_require(`
		type groupadd_exec_t;
	')

	corecmd_search_bin($1)
	allow $1 groupadd_exec_t:file { getattr_file_perms execute };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_access_check_groupadd'($*)) dnl
	')


########################################
## <summary>
##	Execute groupadd in the groupadd domain, and
##	allow the specified role the groupadd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`usermanage_run_groupadd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_run_groupadd'($*)) dnl
	
	gen_require(`
		type groupadd_t;
		attribute_role groupadd_roles;
	')

	usermanage_domtrans_groupadd($1)
	roleattribute $2 groupadd_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_run_groupadd'($*)) dnl
	')


########################################
## <summary>
##	Execute passwd in the passwd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`usermanage_domtrans_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_domtrans_passwd'($*)) dnl
	
	gen_require(`
		type passwd_t, passwd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, passwd_exec_t, passwd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_domtrans_passwd'($*)) dnl
	')


########################################
## <summary>
##	Send sigkills to passwd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_kill_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_kill_passwd'($*)) dnl
	
	gen_require(`
		type passwd_t;
	')

	allow $1 passwd_t:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_kill_passwd'($*)) dnl
	')


########################################
## <summary>
##	Check if the passwd binary is executable.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_check_exec_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_check_exec_passwd'($*)) dnl
	
	gen_require(`
		type passwd_exec_t;
	')

	allow $1 passwd_exec_t:file { execute getattr_file_perms };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_check_exec_passwd'($*)) dnl
	')


########################################
## <summary>
##	Execute passwd in the passwd domain, and
##	allow the specified role the passwd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_run_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_run_passwd'($*)) dnl
	
	gen_require(`
		type passwd_t;
		attribute_role passwd_roles;
	')

	usermanage_domtrans_passwd($1)
	roleattribute $2 passwd_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_run_passwd'($*)) dnl
	')


########################################
## <summary>
##	Check access to the passwd executable
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_access_check_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_access_check_passwd'($*)) dnl
	
	gen_require(`
		type passwd_exec_t;
	')

	corecmd_search_bin($1)
	allow $1 passwd_exec_t:file { getattr_file_perms execute };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_access_check_passwd'($*)) dnl
	')


########################################
## <summary>
##	Execute password admin functions in
##	the admin passwd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`usermanage_domtrans_admin_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_domtrans_admin_passwd'($*)) dnl
	
	gen_require(`
		type sysadm_passwd_t, admin_passwd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, admin_passwd_exec_t, sysadm_passwd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_domtrans_admin_passwd'($*)) dnl
	')


########################################
## <summary>
##	Execute passwd admin functions in the admin
##	passwd domain, and allow the specified role
##	the admin passwd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`usermanage_run_admin_passwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_run_admin_passwd'($*)) dnl
	
	gen_require(`
		type sysadm_passwd_t;
		attribute_role sysadm_passwd_roles;
	')

	usermanage_domtrans_admin_passwd($1)
	roleattribute $2 sysadm_passwd_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_run_admin_passwd'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to use useradd fds.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`usermanage_dontaudit_use_useradd_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_dontaudit_use_useradd_fds'($*)) dnl
	
	gen_require(`
		type useradd_t;
	')

	dontaudit $1 useradd_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_dontaudit_use_useradd_fds'($*)) dnl
	')


########################################
## <summary>
##	Execute useradd in the useradd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`usermanage_domtrans_useradd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_domtrans_useradd'($*)) dnl
	
	gen_require(`
		type useradd_t, useradd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, useradd_exec_t, useradd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_domtrans_useradd'($*)) dnl
	')


########################################
## <summary>
##	Check if the useradd binaries are executable.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_check_exec_useradd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_check_exec_useradd'($*)) dnl
	
	gen_require(`
		type useradd_exec_t;
	')

	allow $1 useradd_exec_t:file { execute getattr_file_perms };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_check_exec_useradd'($*)) dnl
	')


########################################
## <summary>
##	Execute useradd in the useradd domain, and
##	allow the specified role the useradd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`usermanage_run_useradd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_run_useradd'($*)) dnl
	
	gen_require(`
		attribute_role useradd_roles;
		type useradd_t;
	')

	usermanage_domtrans_useradd($1)
	roleattribute $2 useradd_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_run_useradd'($*)) dnl
	')


########################################
## <summary>
##	Check access to the useradd executable.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_access_check_useradd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_access_check_useradd'($*)) dnl
	
	gen_require(`
		type useradd_exec_t;
	')

	corecmd_search_bin($1)
	allow $1 useradd_exec_t:file { getattr_file_perms execute };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_access_check_useradd'($*)) dnl
	')


########################################
## <summary>
##	Read the crack database.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`usermanage_read_crack_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_read_crack_db'($*)) dnl
	
	gen_require(`
		type crack_db_t;
	')

	files_search_var($1)
	read_files_pattern($1, crack_db_t, crack_db_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_read_crack_db'($*)) dnl
	')


########################################
## <summary>
##	Execute crack in the crack domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`usermanage_domtrans_crack',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `usermanage_domtrans_crack'($*)) dnl
	
	gen_require(`
		type crack_t, crack_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, crack_exec_t, crack_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `usermanage_domtrans_crack'($*)) dnl
	')

## <summary>Filesystem namespacing/polyinstantiation application.</summary>

########################################
## <summary>
##	Execute a domain transition to run seunshare.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`seunshare_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `seunshare_domtrans'($*)) dnl
	
	gen_require(`
		type seunshare_t, seunshare_exec_t;
	')

	domtrans_pattern($1, seunshare_exec_t, seunshare_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `seunshare_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute seunshare in the seunshare domain, and
##	allow the specified role the seunshare domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`seunshare_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `seunshare_run'($*)) dnl
	
	gen_require(`
		type seunshare_t;
	')

	seunshare_domtrans($1)
	role $2 types seunshare_t;

	allow $1 seunshare_t:process signal_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `seunshare_run'($*)) dnl
	')


########################################
## <summary>
##	The role template for the seunshare module.
## </summary>
## <param name="role_prefix">
##	<summary>
##	The prefix of the user role (e.g., user
##	is the prefix for user_r).
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role.
##	</summary>
## </param>
#
 	 	define(`seunshare_role_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `seunshare_role_template'($*)) dnl
	
	gen_require(`
		attribute seunshare_domain;
		type seunshare_exec_t;
	')

	type $1_seunshare_t, seunshare_domain;
	application_domain($1_seunshare_t, seunshare_exec_t)
	role $2 types $1_seunshare_t;

	kernel_read_system_state($1_seunshare_t)

    domain_dyntrans_type($1_seunshare_t)

	auth_use_nsswitch($1_seunshare_t)

	logging_send_syslog_msg($1_seunshare_t)

	mls_process_set_level($1_seunshare_t)

	domtrans_pattern($3, seunshare_exec_t, $1_seunshare_t)
	allow $1_seunshare_t $3:unix_stream_socket getattr;

	# part of sandboxX.pp
	optional_policy(`
		sandbox_x_transition($1_seunshare_t, $2)
	')

	# part of sandbox.pp
	optional_policy(`
		sandbox_transition($1_seunshare_t, $2)
	')

	ps_process_pattern($3, $1_seunshare_t)
	dontaudit $1_seunshare_t $3:file read;
	allow $3 $1_seunshare_t:process signal_perms;
	allow $3 $1_seunshare_t:fd use;

	allow $1_seunshare_t $3:process transition;
	dontaudit $1_seunshare_t $3:process { noatsecure siginh rlimitinh };

	corecmd_bin_domtrans($1_seunshare_t, $1_t)
	corecmd_shell_domtrans($1_seunshare_t, $1_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `seunshare_role_template'($*)) dnl
	')

## <summary>ABRT - automated bug-reporting tool</summary>

########################################
## <summary>
##	abrt stub interface.  No access allowed.
## </summary>
## <param name="domain" unused="true">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_stub',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_stub'($*)) dnl
	
	gen_require(`
		type abrt_t;
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_stub'($*)) dnl
	')


######################################
## <summary>
##  Creates types and rules for a basic
##  ABRT daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`abrt_basic_types_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_basic_types_template'($*)) dnl
	
    gen_require(`
        attribute abrt_domain;
    ')

    type $1_t, abrt_domain;
    type $1_exec_t;

	kernel_read_system_state($1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_basic_types_template'($*)) dnl
	')


######################################
## <summary>
##	Execute abrt in the abrt domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`abrt_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_domtrans'($*)) dnl
	
	gen_require(`
		type abrt_t, abrt_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, abrt_exec_t, abrt_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute abrt_dump_oops in the abrt_dump_oops_t domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`abrt_dump_oops_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_dump_oops_domtrans'($*)) dnl
	
	gen_require(`
		type abrt_dump_oops_t, abrt_dump_oops_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, abrt_dump_oops_exec_t, abrt_dump_oops_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_dump_oops_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute abrt in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_exec'($*)) dnl
	
	gen_require(`
		type abrt_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, abrt_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_exec'($*)) dnl
	')


########################################
## <summary>
##	Send a null signal to abrt.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_signull'($*)) dnl
	
	gen_require(`
		type abrt_t;
	')

	allow $1 abrt_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_signull'($*)) dnl
	')


########################################
## <summary>
##	Allow the domain to read abrt state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_state'($*)) dnl
	
	gen_require(`
		type abrt_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, abrt_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_state'($*)) dnl
	')


########################################
## <summary>
##	Connect to abrt over a unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_stream_connect'($*)) dnl
	
	gen_require(`
		type abrt_t, abrt_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, abrt_var_run_t, abrt_var_run_t, abrt_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	abrt over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_dbus_chat'($*)) dnl
	
	gen_require(`
		type abrt_t;
		class dbus send_msg;
	')

	allow $1 abrt_t:dbus send_msg;
	allow abrt_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_dbus_chat'($*)) dnl
	')


#####################################
## <summary>
##	Execute abrt-helper in the abrt-helper domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`abrt_domtrans_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_domtrans_helper'($*)) dnl
	
	gen_require(`
		type abrt_helper_t, abrt_helper_exec_t;
	')

	domtrans_pattern($1, abrt_helper_exec_t, abrt_helper_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_domtrans_helper'($*)) dnl
	')


########################################
## <summary>
##	Execute abrt helper in the abrt_helper domain, and
##	allow the specified role the abrt_helper domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`abrt_run_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_run_helper'($*)) dnl
	
	gen_require(`
		attribute_role abrt_helper_roles;
	')

	abrt_domtrans_helper($1)
	roleattribute $2 abrt_helper_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_run_helper'($*)) dnl
	')


########################################
## <summary>
##	Read abrt cache
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_read_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_cache'($*)) dnl
	
	gen_require(`
		type abrt_var_cache_t;
	')

	read_files_pattern($1, abrt_var_cache_t, abrt_var_cache_t)
	read_lnk_files_pattern($1, abrt_var_cache_t, abrt_var_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_cache'($*)) dnl
	')


########################################
## <summary>
##	Append abrt cache
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_append_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_append_cache'($*)) dnl
	
	gen_require(`
		type abrt_var_cache_t;
	')

	
	allow $1 abrt_var_cache_t:file append_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_append_cache'($*)) dnl
	')


########################################
## <summary>
##	Read/Write inherited abrt cache
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_rw_inherited_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_rw_inherited_cache'($*)) dnl
	
	gen_require(`
		type abrt_var_cache_t;
	')

	
	allow $1 abrt_var_cache_t:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_rw_inherited_cache'($*)) dnl
	')


########################################
## <summary>
##	Manage abrt cache
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_manage_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_manage_cache'($*)) dnl
	
	gen_require(`
		type abrt_var_cache_t;
	')

	manage_files_pattern($1, abrt_var_cache_t, abrt_var_cache_t)
	manage_lnk_files_pattern($1, abrt_var_cache_t, abrt_var_cache_t)
	manage_dirs_pattern($1, abrt_var_cache_t, abrt_var_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_manage_cache'($*)) dnl
	')


########################################
## <summary>
##	Map abrt cache
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_map_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_map_cache'($*)) dnl
	
	gen_require(`
		type abrt_var_cache_t;
	')

allow $1 abrt_var_cache_t:file map;


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_map_cache'($*)) dnl
	')


####################################
## <summary>
##	Read abrt configuration file.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_config'($*)) dnl
	
	gen_require(`
		type abrt_etc_t;
	')

	files_search_etc($1)
	read_files_pattern($1, abrt_etc_t, abrt_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_config'($*)) dnl
	')


####################################
## <summary>
##	Dontaudit read abrt configuration file.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_dontaudit_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_dontaudit_read_config'($*)) dnl
	
	gen_require(`
		type abrt_etc_t;
	')

	files_search_etc($1)
    dontaudit $1 abrt_etc_t:dir list_dir_perms;
    dontaudit $1 abrt_etc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_dontaudit_read_config'($*)) dnl
	')


######################################
## <summary>
##	Read abrt logs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_log'($*)) dnl
	
	gen_require(`
		type abrt_var_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, abrt_var_log_t, abrt_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_log'($*)) dnl
	')


######################################
## <summary>
##	Read abrt PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_pid_files'($*)) dnl
	
	gen_require(`
		type abrt_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, abrt_var_run_t, abrt_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_pid_files'($*)) dnl
	')


######################################
## <summary>
##	Create, read, write, and delete abrt PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_manage_pid_files'($*)) dnl
	
	gen_require(`
		type abrt_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, abrt_var_run_t, abrt_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read and write abrt fifo files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_rw_fifo_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_rw_fifo_file'($*)) dnl
	
	gen_require(`
		type abrt_t;
	')

	allow $1 abrt_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_rw_fifo_file'($*)) dnl
	')


########################################
## <summary>
##	Execute abrt server in the abrt domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`abrt_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_systemctl'($*)) dnl
	
	gen_require(`
		type abrt_t;
		type abrt_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 abrt_unit_file_t:file manage_file_perms;
	allow $1 abrt_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, abrt_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_systemctl'($*)) dnl
	')


#####################################
## <summary>
##	All of the rules required to administrate
##	an abrt environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed to manage the abrt domain.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`abrt_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_admin'($*)) dnl
	
	gen_require(`
		type abrt_t, abrt_etc_t;
		type abrt_var_cache_t, abrt_var_log_t;
		type abrt_var_run_t, abrt_tmp_t;
		type abrt_initrc_exec_t;
		type abrt_unit_file_t;
	')

	allow $1 abrt_t:process { signal_perms };
	ps_process_pattern($1, abrt_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 abrt_t:process ptrace;
	')

	init_labeled_script_domtrans($1, abrt_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 abrt_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, abrt_etc_t)

	logging_list_logs($1)
	admin_pattern($1, abrt_var_log_t)

	files_list_var($1)
	admin_pattern($1, abrt_var_cache_t)

	files_list_pids($1)
	admin_pattern($1, abrt_var_run_t)

	files_list_tmp($1)
	admin_pattern($1, abrt_tmp_t)

	abrt_systemctl($1)
	admin_pattern($1, abrt_unit_file_t)
	allow $1 abrt_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_admin'($*)) dnl
	')


####################################
## <summary>
##  Execute abrt-retrace in the abrt-retrace domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`abrt_domtrans_retrace_worker',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_domtrans_retrace_worker'($*)) dnl
	
    gen_require(`
        type abrt_retrace_worker_t, abrt_retrace_worker_exec_t;
    ')

    corecmd_search_bin($1)
    domtrans_pattern($1, abrt_retrace_worker_exec_t, abrt_retrace_worker_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_domtrans_retrace_worker'($*)) dnl
	')


######################################
## <summary>
##  Manage abrt retrace server cache
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`abrt_manage_spool_retrace',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_manage_spool_retrace'($*)) dnl
	
    gen_require(`
        type abrt_retrace_spool_t;
    ')

	manage_dirs_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)
	manage_files_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)
	manage_lnk_files_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)
    manage_sock_files_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_manage_spool_retrace'($*)) dnl
	')


#####################################
## <summary>
##  Read abrt retrace server cache
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`abrt_read_spool_retrace',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_spool_retrace'($*)) dnl
	
    gen_require(`
        type abrt_retrace_spool_t;
    ')

    list_dirs_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)
    read_files_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)
    read_lnk_files_pattern($1, abrt_retrace_spool_t, abrt_retrace_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_spool_retrace'($*)) dnl
	')



#####################################
## <summary>
##  Read abrt retrace server cache
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`abrt_read_cache_retrace',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_read_cache_retrace'($*)) dnl
	
    gen_require(`
        type abrt_retrace_cache_t;
    ')

    list_dirs_pattern($1, abrt_retrace_cache_t, abrt_retrace_cache_t)
    read_files_pattern($1, abrt_retrace_cache_t, abrt_retrace_cache_t)
    read_lnk_files_pattern($1, abrt_retrace_cache_t, abrt_retrace_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_read_cache_retrace'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to write abrt sock files
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`abrt_dontaudit_write_sock_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_dontaudit_write_sock_file'($*)) dnl
	
	gen_require(`
		type abrt_t;
	')

	dontaudit $1 abrt_t:sock_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_dontaudit_write_sock_file'($*)) dnl
	')


########################################
## <summary>
##	Transition to abrt named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`abrt_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `abrt_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type abrt_tmp_t;
		type abrt_etc_t;
		type abrt_var_cache_t;
		type abrt_var_run_t;
	')

	files_tmp_filetrans($1, abrt_var_cache_t, dir, "abrt")
	files_etc_filetrans($1, abrt_etc_t, dir, "abrt")
	files_var_filetrans($1, abrt_var_cache_t, dir, "abrt")
	files_var_filetrans($1, abrt_var_cache_t, dir, "abrt-dix")
	files_var_filetrans($1, abrt_var_cache_t, dir, "debug")
	files_pid_filetrans($1, abrt_var_run_t, dir, "abrt")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `abrt_filetrans_named_content'($*)) dnl
	')


## <summary>AccountsService and daemon for manipulating user account information via D-Bus.</summary>

########################################
## <summary>
##	Execute a domain transition to
##	run accountsd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`accountsd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_domtrans'($*)) dnl
	
	gen_require(`
		type accountsd_t, accountsd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, accountsd_exec_t, accountsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read accountsd fifo files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`accountsd_read_fifo_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_read_fifo_file'($*)) dnl
	
	gen_require(`
		type accountsd_t;
	')

	allow $1 accountsd_t:fifo_file read_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_read_fifo_file'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and
##	write Accounts Daemon fifo files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`accountsd_dontaudit_rw_fifo_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_dontaudit_rw_fifo_file'($*)) dnl
	
	gen_require(`
		type accountsd_t;
	')

	dontaudit $1 accountsd_t:fifo_file rw_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_dontaudit_rw_fifo_file'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	accountsd over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_dbus_chat'($*)) dnl
	
	gen_require(`
		type accountsd_t;
		class dbus send_msg;
	')

	allow $1 accountsd_t:dbus send_msg;
	allow accountsd_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Search accountsd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_search_lib'($*)) dnl
	
	gen_require(`
		type accountsd_var_lib_t;
	')

	allow $1 accountsd_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Watch accountsd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_watch_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_watch_lib'($*)) dnl
	
	gen_require(`
		type accountsd_var_lib_t;
	')

	files_search_var_lib($1)
	watch_dirs_pattern($1, accountsd_var_lib_t, accountsd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_watch_lib'($*)) dnl
	')


########################################
## <summary>
##	Read accountsd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_read_lib_files'($*)) dnl
	
	gen_require(`
		type accountsd_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 accountsd_var_lib_t:dir list_dir_perms;
	read_files_pattern($1, accountsd_var_lib_t, accountsd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Watch accountsd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_watch_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_watch_lib_files'($*)) dnl
	
	gen_require(`
		type accountsd_var_lib_t;
	')

	files_search_var_lib($1)
	watch_files_pattern($1, accountsd_var_lib_t, accountsd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_watch_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	accountsd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_manage_lib_files'($*)) dnl
	
	gen_require(`
		type accountsd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, accountsd_var_lib_t, accountsd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an accountsd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`accountsd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_systemctl'($*)) dnl
	
	gen_require(`
		type accountsd_t;
		type accountsd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 accountsd_unit_file_t:file read_file_perms;
	allow $1 accountsd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, accountsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an accountsd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`accountsd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `accountsd_admin'($*)) dnl
	
	gen_require(`
		type accountsd_t;
		type accountsd_unit_file_t;
	')

	allow $1 accountsd_t:process signal_perms;
	ps_process_pattern($1, accountsd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 accountsd_t:process ptrace;
	')

	accountsd_manage_lib_files($1)

	accountsd_systemctl($1)
	admin_pattern($1, accountsd_unit_file_t)
	allow $1 accountsd_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `accountsd_admin'($*)) dnl
	')

## <summary>Berkeley process accounting.</summary>

########################################
## <summary>
##	Transition to the accounting
##	management domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`acct_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_domtrans'($*)) dnl
	
	gen_require(`
		type acct_t, acct_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, acct_exec_t, acct_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute accounting management tools
##	in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`acct_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_exec'($*)) dnl
	
	gen_require(`
		type acct_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, acct_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute accounting management data
##	in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`acct_exec_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_exec_data'($*)) dnl
	
	gen_require(`
		type acct_data_t;
	')

	files_search_var($1)
	can_exec($1, acct_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_exec_data'($*)) dnl
	')


########################################
## <summary>
##      Search process accounting data.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`acct_search_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_search_data'($*)) dnl
	
        gen_require(`
                type acct_data_t;
        ')

        search_dirs_pattern($1, acct_data_t, acct_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_search_data'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	process accounting data.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`acct_manage_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_manage_data'($*)) dnl
	
	gen_require(`
		type acct_data_t;
	')

	files_search_var($1)
	manage_files_pattern($1, acct_data_t, acct_data_t)
	manage_lnk_files_pattern($1, acct_data_t, acct_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_manage_data'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit Attempts to list acct_data directory
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`acct_dontaudit_list_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_dontaudit_list_data'($*)) dnl
	
	gen_require(`
		type acct_data_t;
	')

	dontaudit $1 acct_data_t:dir list_dir_perms;	

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_dontaudit_list_data'($*)) dnl
	')


#######################################
## <summary>
##	All of the rules required to
##	administrate an acct environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`acct_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `acct_admin'($*)) dnl
	
	gen_require(`
		type acct_t, acct_initrc_exec_t, acct_data_t;
	')

	allow $1 acct_t:process { signal_perms };
	ps_process_pattern($1, acct_t)

    tunable_policy(`deny_ptrace',`',`
		allow $1 acct_t:process ptrace;
    ')

	init_labeled_script_domtrans($1, acct_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 acct_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, acct_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `acct_admin'($*)) dnl
	')

## <summary>Andrew Filesystem server.</summary>

########################################
## <summary>
##	Execute a domain transition to run the
##	afs client.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`afs_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afs_domtrans'($*)) dnl
	
	gen_require(`
		type afs_t, afs_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, afs_exec_t, afs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afs_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read and write afs client UDP sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`afs_rw_udp_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afs_rw_udp_sockets'($*)) dnl
	
	gen_require(`
		type afs_t;
	')

	allow $1 afs_t:udp_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afs_rw_udp_sockets'($*)) dnl
	')


########################################
## <summary>
##	Read AFS config data
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`afs_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afs_read_config'($*)) dnl
	
	gen_require(`
		type afs_config_t;
	')

	read_files_pattern($1, afs_config_t, afs_config_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afs_read_config'($*)) dnl
	')


########################################
## <summary>
##	Read and write afs cache files.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`afs_rw_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afs_rw_cache'($*)) dnl
	
	gen_require(`
		type afs_cache_t;
	')

	files_search_var($1)
	allow $1 afs_cache_t:file { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afs_rw_cache'($*)) dnl
	')


########################################
## <summary>
##	Execute afs server in the afs domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`afs_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afs_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type afs_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, afs_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afs_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an afs environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`afs_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afs_admin'($*)) dnl
	
	gen_require(`
		attribute afs_domain;
		type afs_t, afs_initrc_exec_t, afs_dbdir_t, afs_pt_db_t;
		type afs_ka_db_t, afs_vl_db_t, afs_config_t;
		type afs_logfile_t, afs_cache_t, afs_files_t;
	')

	allow $1 afs_t:process signal_perms;
	ps_process_pattern($1, afs_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 afs_t:process ptrace;
	')

	afs_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 afs_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, afs_config_t)

	files_search_var($1)
	admin_pattern($1, afs_cache_t)

	files_search_var_lib($1)
	admin_pattern($1, { afs_dbdir_t afs_pt_db_t afs_ka_db_t })
	admin_pattern($1, afs_vl_db_t)

	logging_search_logs($1)
	admin_pattern($1, afs_logfile_t)

	admin_pattern($1, afs_files_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afs_admin'($*)) dnl
	')

## <summary>policy for afterburn</summary>

########################################
## <summary>
##	Execute afterburn in the afterburn domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`afterburn_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afterburn_domtrans'($*)) dnl
	
	gen_require(`
		type afterburn_t, afterburn_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, afterburn_exec_t, afterburn_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afterburn_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute afterburn in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`afterburn_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `afterburn_exec'($*)) dnl
	
	gen_require(`
		type afterburn_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, afterburn_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `afterburn_exec'($*)) dnl
	')

## <summary>Automatic IPv6 Connectivity Client Utility.</summary>

########################################
## <summary>
##	Execute a domain transition to run aiccu.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`aiccu_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aiccu_domtrans'($*)) dnl
	
	gen_require(`
		type aiccu_t, aiccu_exec_t;
	')

	domtrans_pattern($1, aiccu_exec_t, aiccu_t)
	corecmd_search_bin($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aiccu_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute aiccu server in the aiccu domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`aiccu_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aiccu_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type aiccu_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, aiccu_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aiccu_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read aiccu PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`aiccu_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aiccu_read_pid_files'($*)) dnl
	
	gen_require(`
		type aiccu_var_run_t;
	')

	allow $1 aiccu_var_run_t:file read_file_perms;
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aiccu_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an aiccu environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`aiccu_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aiccu_admin'($*)) dnl
	
	gen_require(`
		type aiccu_t, aiccu_initrc_exec_t, aiccu_etc_t;
		type aiccu_var_run_t;
	')

	allow $1 aiccu_t:process signal_perms;
	ps_process_pattern($1, aiccu_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 aiccu_t:process ptrace;
	')

	aiccu_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 aiccu_initrc_exec_t system_r;
	allow $2 system_r;

	admin_pattern($1, aiccu_etc_t)
	files_list_etc($1)

	admin_pattern($1, aiccu_var_run_t)
	files_list_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aiccu_admin'($*)) dnl
	')

## <summary>Aide filesystem integrity checker.</summary>

########################################
## <summary>
##	Execute aide in the aide domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`aide_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aide_domtrans'($*)) dnl
	
	gen_require(`
		type aide_t, aide_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, aide_exec_t, aide_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aide_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute aide programs in the AIDE
##	domain and allow the specified role
##	the AIDE domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`aide_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aide_run'($*)) dnl
	
	gen_require(`
		attribute_role aide_roles;
	')

	aide_domtrans($1)
	roleattribute $2 aide_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aide_run'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an aide environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`aide_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aide_admin'($*)) dnl
	
	gen_require(`
		type aide_t, aide_db_t, aide_log_t;
	')

	allow $1 aide_t:process signal_perms;
	ps_process_pattern($1, aide_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 aide_t:process ptrace;
	')

	aide_run($1, $2)

	files_list_etc($1)
	admin_pattern($1, aide_db_t)

	logging_list_logs($1)
	admin_pattern($1, aide_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aide_admin'($*)) dnl
	')

## <summary>Aisexec Cluster Engine.</summary>

########################################
## <summary>
##	Execute a domain transition to run aisexec.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`aisexec_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aisexec_domtrans'($*)) dnl
	
	gen_require(`
		type aisexec_t, aisexec_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, aisexec_exec_t, aisexec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aisexec_domtrans'($*)) dnl
	')


#####################################
## <summary>
##	Connect to aisexec over a unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`aisexec_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aisexec_stream_connect'($*)) dnl
	
	gen_require(`
		type aisexec_t, aisexec_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, aisexec_var_run_t, aisexec_var_run_t, aisexec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aisexec_stream_connect'($*)) dnl
	')


#######################################
## <summary>
##	Read aisexec log files content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`aisexec_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aisexec_read_log'($*)) dnl
	
	gen_require(`
		type aisexec_var_log_t;
	')

	logging_search_logs($1)
	list_dirs_pattern($1, aisexec_var_log_t, aisexec_var_log_t)
	read_files_pattern($1, aisexec_var_log_t, aisexec_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aisexec_read_log'($*)) dnl
	')


######################################
## <summary>
##	All of the rules required to
##	administrate an aisexec environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`aisexecd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `aisexecd_admin'($*)) dnl
	
	gen_require(`
		type aisexec_t, aisexec_var_lib_t, aisexec_var_log_t;
		type aisexec_var_run_t, aisexec_tmp_t, aisexec_tmpfs_t;
		type aisexec_initrc_exec_t;
	')

	allow $1 aisexec_t:process signal_perms;
	ps_process_pattern($1, aisexec_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 aisexec_t:process ptrace;
	')

	init_labeled_script_domtrans($1, aisexec_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 aisexec_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_var_lib($1)
	admin_pattern($1, aisexec_var_lib_t)

	logging_list_logs($1)
	admin_pattern($1, aisexec_var_log_t)

	files_list_pids($1)
	admin_pattern($1, aisexec_var_run_t)

	files_list_tmp($1)
	admin_pattern($1, aisexec_tmp_t)

	admin_pattern($1, aisexec_tmpfs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `aisexecd_admin'($*)) dnl
	')

## <summary>policy for ajaxterm</summary>

########################################
## <summary>
##	Execute a domain transition to run ajaxterm.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ajaxterm_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ajaxterm_domtrans'($*)) dnl
	
	gen_require(`
		type ajaxterm_t, ajaxterm_exec_t;
	')

	domtrans_pattern($1, ajaxterm_exec_t, ajaxterm_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ajaxterm_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute ajaxterm server in the ajaxterm domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ajaxterm_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ajaxterm_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type ajaxterm_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, ajaxterm_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ajaxterm_initrc_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Read and write the ajaxterm pty type.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`ajaxterm_rw_ptys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ajaxterm_rw_ptys'($*)) dnl
	
    gen_require(`
        type ajaxterm_devpts_t;
    ')

    allow $1 ajaxterm_devpts_t:chr_file	rw_inherited_term_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ajaxterm_rw_ptys'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an ajaxterm environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ajaxterm_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ajaxterm_admin'($*)) dnl
	
	gen_require(`
		type ajaxterm_t, ajaxterm_initrc_exec_t;
	')

	allow $1 ajaxterm_t:process signal_perms;
	ps_process_pattern($1, ajaxterm_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 ajaxterm_t:process ptrace;
	')

	ajaxterm_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 ajaxterm_initrc_exec_t system_r;
	allow $2 system_r;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ajaxterm_admin'($*)) dnl
	')

## <summary>Advanced Linux Sound Architecture utilities.</summary>

########################################
## <summary>
##	Role access for alsa.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role.
##	</summary>
## </param>
#
 	 	define(`alsa_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_role'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_role'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run Alsa.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`alsa_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_domtrans'($*)) dnl
	
	gen_require(`
		type alsa_t, alsa_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, alsa_exec_t, alsa_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
##	Alsa, and allow the specified role
##	the Alsa domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_run'($*)) dnl
	
	gen_require(`
		attribute_role alsa_roles;
	')

	alsa_domtrans($1)
	roleattribute $2 alsa_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_run'($*)) dnl
	')


########################################
## <summary>
##	Read and write Alsa semaphores.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_rw_semaphores',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_rw_semaphores'($*)) dnl
	
	gen_require(`
		type alsa_t;
	')

	allow $1 alsa_t:sem rw_sem_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_rw_semaphores'($*)) dnl
	')


########################################
## <summary>
##	Read and write Alsa shared memory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_rw_shared_mem',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_rw_shared_mem'($*)) dnl
	
	gen_require(`
		type alsa_t;
	')

	allow $1 alsa_t:shm rw_shm_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_rw_shared_mem'($*)) dnl
	')


########################################
## <summary>
##	Read writable Alsa configuration content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_read_rw_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_read_rw_config'($*)) dnl
	
	gen_require(`
		type alsa_etc_rw_t;
	')

	files_search_etc($1)
	allow $1 alsa_etc_rw_t:dir list_dir_perms;
	read_files_pattern($1, alsa_etc_rw_t, alsa_etc_rw_t)
	read_lnk_files_pattern($1, alsa_etc_rw_t, alsa_etc_rw_t)

	ifdef(`distro_debian',`
		files_search_usr($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_read_rw_config'($*)) dnl
	')


########################################
## <summary>
##	Manage writable Alsa config files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_manage_rw_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_manage_rw_config'($*)) dnl
	
	gen_require(`
		type alsa_etc_rw_t;
	')

	files_search_etc($1)
	allow $1 alsa_etc_rw_t:dir list_dir_perms;
	manage_files_pattern($1, alsa_etc_rw_t, alsa_etc_rw_t)
	read_lnk_files_pattern($1, alsa_etc_rw_t, alsa_etc_rw_t)

	ifdef(`distro_debian',`
		files_search_usr($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_manage_rw_config'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	alsa home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_manage_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_manage_home_files'($*)) dnl
	
	gen_require(`
		type alsa_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 alsa_home_t:file manage_file_perms;
	alsa_filetrans_home_content($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_manage_home_files'($*)) dnl
	')


########################################
## <summary>
##	Read Alsa home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_read_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_read_home_files'($*)) dnl
	
	gen_require(`
		type alsa_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 alsa_home_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_read_home_files'($*)) dnl
	')


########################################
## <summary>
##	Relabel alsa home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_relabel_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_relabel_home_files'($*)) dnl
	
	gen_require(`
		type alsa_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 alsa_home_t:file relabel_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_relabel_home_files'($*)) dnl
	')


########################################
## <summary>
##	Read Alsa lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_read_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_read_lib'($*)) dnl
	
	gen_require(`
		type alsa_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, alsa_var_lib_t, alsa_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_read_lib'($*)) dnl
	')


########################################
## <summary>
##	Transition to alsa named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_filetrans_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_filetrans_home_content'($*)) dnl
	
	gen_require(`
		type alsa_home_t;
	')

	userdom_user_home_dir_filetrans($1, alsa_home_t, file, ".asoundrc")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_filetrans_home_content'($*)) dnl
	')


########################################
## <summary>
##	Transition to alsa named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type alsa_home_t;
		type alsa_etc_rw_t;
		type alsa_var_lib_t;
	')

	files_etc_filetrans($1, alsa_etc_rw_t, file, "asound.state")
	files_etc_filetrans($1, alsa_etc_rw_t, dir, "pcm")
	files_etc_filetrans($1, alsa_etc_rw_t, dir, "asound")
	files_usr_filetrans($1, alsa_etc_rw_t, file, "alsa.conf")
	files_usr_filetrans($1, alsa_etc_rw_t, dir, "pcm")
	files_var_lib_filetrans($1, alsa_var_lib_t, dir, "alsa")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_filetrans_named_content'($*)) dnl
	')


########################################
## <summary>
##	Execute alsa server in the alsa domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`alsa_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_systemctl'($*)) dnl
	
	gen_require(`
		type alsa_t;
		type alsa_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 alsa_unit_file_t:file read_file_perms;
	allow $1 alsa_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, alsa_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_systemctl'($*)) dnl
	')


#########################################
## <summary>
##	Write Alsa lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`alsa_write_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `alsa_write_lib'($*)) dnl
	
	gen_require(`
		type alsa_var_lib_t;
	')

	files_search_var_lib($1)
	write_files_pattern($1, alsa_var_lib_t, alsa_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `alsa_write_lib'($*)) dnl
	')

## <summary>Advanced Maryland Automatic Network Disk Archiver.</summary>

########################################
## <summary>
##	Execute a domain transition to run
##	Amanda recover.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`amanda_domtrans_recover',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_domtrans_recover'($*)) dnl
	
	gen_require(`
		type amanda_recover_t, amanda_recover_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, amanda_recover_exec_t, amanda_recover_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_domtrans_recover'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
##	Amanda recover, and allow the specified
##	role the Amanda recover domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`amanda_run_recover',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_run_recover'($*)) dnl
	
	gen_require(`
		attribute_role amanda_recover_roles;
	')

	amanda_domtrans_recover($1)
	roleattribute $2 amanda_recover_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_run_recover'($*)) dnl
	')


########################################
## <summary>
##	Search Amanda library directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amanda_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_search_lib'($*)) dnl
	
	gen_require(`
		type amanda_usr_lib_t;
	')

	files_search_usr($1)
	allow $1 amanda_usr_lib_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read /etc/dumpdates.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`amanda_dontaudit_read_dumpdates',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_dontaudit_read_dumpdates'($*)) dnl
	
	gen_require(`
		type amanda_dumpdates_t;
	')

	dontaudit $1 amanda_dumpdates_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_dontaudit_read_dumpdates'($*)) dnl
	')


########################################
## <summary>
##	Read and write /etc/dumpdates.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amanda_rw_dumpdates_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_rw_dumpdates_files'($*)) dnl
	
	gen_require(`
		type amanda_dumpdates_t;
	')

	files_search_etc($1)
	allow $1 amanda_dumpdates_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_rw_dumpdates_files'($*)) dnl
	')


########################################
## <summary>
##	Search Amanda library directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amanda_manage_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_manage_lib'($*)) dnl
	
	gen_require(`
		type amanda_usr_lib_t;
	')

	files_search_usr($1)
	allow $1 amanda_usr_lib_t:dir manage_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_manage_lib'($*)) dnl
	')


########################################
## <summary>
##	Read and append amanda log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amanda_append_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_append_log_files'($*)) dnl
	
	gen_require(`
		type amanda_log_t;
	')

	logging_search_logs($1)
	allow $1 amanda_log_t:file { read_file_perms append_file_perms };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_append_log_files'($*)) dnl
	')


#######################################
## <summary>
##	Search Amanda var library directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amanda_search_var_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amanda_search_var_lib'($*)) dnl
	
	gen_require(`
		type amanda_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 amanda_var_lib_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amanda_search_var_lib'($*)) dnl
	')

## <summary>High-performance interface between an email server and content checkers.</summary>

########################################
## <summary>
##	Execute a domain transition to run amavis.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`amavis_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_domtrans'($*)) dnl
	
	gen_require(`
		type amavis_t, amavis_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, amavis_exec_t, amavis_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute amavis server in the amavis domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`amavis_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type amavis_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, amavis_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read amavis spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_read_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_read_spool_files'($*)) dnl
	
	gen_require(`
		type amavis_spool_t;
	')

	files_search_spool($1)
	read_files_pattern($1, amavis_spool_t, amavis_spool_t)
	allow $1 amavis_spool_t:dir list_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_read_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	amavis spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_manage_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_manage_spool_files'($*)) dnl
	
	gen_require(`
		type amavis_spool_t;
	')

	files_search_spool($1)
	manage_dirs_pattern($1, amavis_spool_t, amavis_spool_t)
	manage_files_pattern($1, amavis_spool_t, amavis_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_manage_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Create objects in the amavis spool directories
##	with a private type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="private_type">
##	<summary>
##	Private file type.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	Class of the object being created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`amavis_spool_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_spool_filetrans'($*)) dnl
	
	gen_require(`
		type amavis_spool_t;
	')

	files_search_spool($1)
	filetrans_pattern($1, amavis_spool_t, $2, $3, $4)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_spool_filetrans'($*)) dnl
	')


########################################
## <summary>
##	Search amavis lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_search_lib'($*)) dnl
	
	gen_require(`
		type amavis_var_lib_t;
	')

	allow $1 amavis_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read amavis lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_read_lib_files'($*)) dnl
	
	gen_require(`
		type amavis_var_lib_t;
	')

	read_files_pattern($1, amavis_var_lib_t, amavis_var_lib_t)
	allow $1 amavis_var_lib_t:dir list_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Read and write amavis lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_rw_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_rw_lib_files'($*)) dnl
	
	gen_require(`
		type amavis_var_lib_t;
	')

	rw_files_pattern($1, amavis_var_lib_t, amavis_var_lib_t)
	allow $1 amavis_var_lib_t:dir list_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_rw_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	amavis lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_manage_lib_files'($*)) dnl
	
	gen_require(`
		type amavis_var_lib_t;
	')

	manage_files_pattern($1, amavis_var_lib_t, amavis_var_lib_t)
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of amavis pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_setattr_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_setattr_pid_files'($*)) dnl
	
	gen_require(`
		type amavis_var_run_t;
	')

	allow $1 amavis_var_run_t:file setattr_file_perms;
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_setattr_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Create amavis pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`amavis_create_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_create_pid_files'($*)) dnl
	
	gen_require(`
		type amavis_var_run_t;
	')

	allow $1 amavis_var_run_t:dir add_entry_dir_perms;
	allow $1 amavis_var_run_t:file create_file_perms;
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_create_pid_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an amavis environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`amavis_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amavis_admin'($*)) dnl
	
	gen_require(`
		type amavis_t, amavis_tmp_t, amavis_var_log_t;
		type amavis_spool_t, amavis_var_lib_t, amavis_var_run_t;
		type amavis_etc_t, amavis_quarantine_t, amavis_initrc_exec_t;
	')

	allow $1 amavis_t:process signal_perms;
	ps_process_pattern($1, amavis_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 amavis_t:process ptrace;
	')

	amavis_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 amavis_initrc_exec_t system_r;
 	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, amavis_etc_t)

	admin_pattern($1, amavis_quarantine_t)

	files_list_spool($1)
	admin_pattern($1, amavis_spool_t)

	files_list_tmp($1)
	admin_pattern($1, amavis_tmp_t)

	files_list_var_lib($1)
	admin_pattern($1, amavis_var_lib_t)

	logging_list_logs($1)
	admin_pattern($1, amavis_var_log_t)

	files_list_pids($1)
	admin_pattern($1, amavis_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amavis_admin'($*)) dnl
	')

## <summary>Abstract Machine Test Utility.</summary>

########################################
## <summary>
##	Execute a domain transition to run Amtu.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`amtu_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amtu_domtrans'($*)) dnl
	
	gen_require(`
		type amtu_t, amtu_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, amtu_exec_t, amtu_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amtu_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
##	Amtu, and allow the specified role
##	the Amtu domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`amtu_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amtu_run'($*)) dnl
	
	gen_require(`
		attribute_role amtu_roles;
	')

	amtu_domtrans($1)
	roleattribute $2 amtu_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amtu_run'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an amtu environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`amtu_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `amtu_admin'($*)) dnl
	
	gen_require(`
		type amtu_t, amtu_initrc_exec_t;
	')

	allow $1 amtu_t:process { ptrace signal_perms };
	ps_process_pattern($1, amtu_t)

	init_labeled_script_domtrans($1, amtu_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 amtu_initrc_exec_t system_r;
	allow $2 system_r;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `amtu_admin'($*)) dnl
	')

## <summary>Anaconda installer.</summary>

########################################
## <summary>
##	Execute a domain transition to run install.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`anaconda_domtrans_install',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_domtrans_install'($*)) dnl
	
	gen_require(`
		type install_t, install_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, install_exec_t, install_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_domtrans_install'($*)) dnl
	')


########################################
## <summary>
##	Execute install in the install
##	domain, and allow the specified
##	role the install domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`anaconda_run_install',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_run_install'($*)) dnl
	
	gen_require(`
		type install_t;
		type install_exec_t;
		attribute_role install_roles;
	')

	anaconda_domtrans_install($1)
	roleattribute $2 install_roles;
	role_transition $2 install_exec_t system_r;

	optional_policy(`
		rpm_transition_script(install_t, $2)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_run_install'($*)) dnl
	')


########################################
## <summary>
##	Execute preupgrade in the caller domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`anaconda_exec_preupgrade',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_exec_preupgrade'($*)) dnl
	
	gen_require(`
		type preupgrade_exec_t;
	')

	corecmd_search_bin($1)
    can_exec($1, preupgrade_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_exec_preupgrade'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run preupgrade.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`anaconda_domtrans_preupgrade',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_domtrans_preupgrade'($*)) dnl
	
	gen_require(`
		type preupgrade_t, preupgrade_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, preupgrade_exec_t, preupgrade_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_domtrans_preupgrade'($*)) dnl
	')


########################################
## <summary>
##	Read preupgrade lib files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`anaconda_read_lib_files_preupgrade',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_read_lib_files_preupgrade'($*)) dnl
	
	gen_require(`
		type preupgrade_data_t;
	')

	read_files_pattern($1, preupgrade_data_t, preupgrade_data_t)
	read_lnk_files_pattern($1, preupgrade_data_t, preupgrade_data_t)
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_read_lib_files_preupgrade'($*)) dnl
	')


########################################
## <summary>
##	Manage preupgrade lib files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`anaconda_manage_lib_files_preupgrade',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_manage_lib_files_preupgrade'($*)) dnl
	
	gen_require(`
		type preupgrade_data_t;
	')

	manage_dirs_pattern($1, preupgrade_data_t, preupgrade_data_t)
	manage_files_pattern($1, preupgrade_data_t, preupgrade_data_t)
	manage_lnk_files_pattern($1, preupgrade_data_t, preupgrade_data_t)
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_manage_lib_files_preupgrade'($*)) dnl
	')


########################################
## <summary>
##	Connect over a unix stream socket
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`anaconda_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_stream_connect'($*)) dnl
	
	gen_require(`
		type install_t, install_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, install_var_run_t, install_var_run_t, install_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Create and use a unix stream socket
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`anaconda_create_unix_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_create_unix_stream_sockets'($*)) dnl
	
	gen_require(`
		type install_t;
	')

	allow $1 install_t:unix_stream_socket create_stream_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_create_unix_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	Use file descriptors from the install domain
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`anaconda_fd_use',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `anaconda_fd_use'($*)) dnl
	
	gen_require(`
		type install_t;
	')

	allow $1 install_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `anaconda_fd_use'($*)) dnl
	')

## <summary>SELinux policy for antivirus programs - amavis, clamd, freshclam and clamscan</summary>

######################################
## <summary>
##  Creates types and rules for a basic
##  antivirus domain.
## </summary>
## <param name="domain">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`antivirus_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_domain_template'($*)) dnl
	
        gen_require(`
                attribute antivirus_domain;
        ')

        typeattribute $1 antivirus_domain;

        kernel_read_system_state($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_domain_template'($*)) dnl
	')


#######################################
## <summary>
##  Execute a domain transition to run antivirus program.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`antivirus_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_domtrans'($*)) dnl
	
    gen_require(`
        type antivirus_t, antivirus_exec_t;
    ')

    domtrans_pattern($1, antivirus_exec_t, antivirus_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Execute antivirus program without a transition.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_exec'($*)) dnl
	
    gen_require(`
        type antivirus_exec_t;
    ')

    can_exec($1, antivirus_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_exec'($*)) dnl
	')


#######################################
## <summary>
##  Connect to run antivirus program.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_stream_connect'($*)) dnl
	
    gen_require(`
        type antivirus_t, antivirus_db_t, antivirus_var_run_t;
    ')

    files_search_pids($1)
    stream_connect_pattern($1, antivirus_var_run_t, antivirus_var_run_t, antivirus_t)
	stream_connect_pattern($1, antivirus_db_t, antivirus_db_t, antivirus_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_stream_connect'($*)) dnl
	')


#######################################
## <summary>
##  Allow the specified domain to append
##  to antivirus log files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_append_log'($*)) dnl
	
    gen_require(`
        type antivirus_log_t;
    ')

    logging_search_logs($1)
    allow $1 antivirus_log_t:dir list_dir_perms;
    append_files_pattern($1, antivirus_log_t, antivirus_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_append_log'($*)) dnl
	')


#######################################
## <summary>
##  Read antivirus configuration files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_read_config'($*)) dnl
	
    gen_require(`
        type antivirus_conf_t;
    ')

    files_search_etc($1)
    allow $1 antivirus_conf_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_read_config'($*)) dnl
	')


#######################################
## <summary>
##  Search antivirus db content directories.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_search_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_search_db'($*)) dnl
	
    gen_require(`
        type antivirus_db_t;
    ')

    files_search_var_lib($1)
	files_search_spool($1)
    allow $1 antivirus_db_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_search_db'($*)) dnl
	')


######################################
## <summary>
##  Read antivirus db content directories.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_read_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_read_db'($*)) dnl
	
    gen_require(`
        type antivirus_db_t;
    ')

    files_search_var_lib($1)
    files_search_spool($1)
	read_files_pattern($1, antivirus_db_t, antivirus_db_t)
	read_lnk_files_pattern($1, antivirus_db_t, antivirus_db_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_read_db'($*)) dnl
	')


#####################################
## <summary>
##  Read and write antivirus db content directories.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_rw_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_rw_db'($*)) dnl
	
    gen_require(`
        type antivirus_db_t;
    ')

    files_search_var_lib($1)
    files_search_spool($1)
    write_files_pattern($1, antivirus_db_t, antivirus_db_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_rw_db'($*)) dnl
	')


####################################
## <summary>
##  Manage antivirus db content directories.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_manage_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_manage_db'($*)) dnl
	
    gen_require(`
        type antivirus_db_t;
    ')

    files_search_var_lib($1)
    files_search_spool($1)
    manage_files_pattern($1, antivirus_db_t, antivirus_db_t)
	manage_dirs_pattern($1, antivirus_db_t, antivirus_db_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_manage_db'($*)) dnl
	')


#######################################
## <summary>
##  Manage antivirus pid content.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`antivirus_manage_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_manage_pid'($*)) dnl
	
    gen_require(`
        type antivirus_var_run_t;
    ')

    manage_dirs_pattern($1, antivirus_var_run_t, antivirus_var_run_t)
    manage_files_pattern($1, antivirus_var_run_t, antivirus_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_manage_pid'($*)) dnl
	')


######################################
## <summary>
##      Read antivirus state files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`antivirus_read_state_clamd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_read_state_clamd'($*)) dnl
	
        gen_require(`
                type antivirus_t;
        ')

        kernel_search_proc($1)
        ps_process_pattern($1, antivirus_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_read_state_clamd'($*)) dnl
	')


######################################
## <summary>
##      Execute antivirus server in the antivirus domain.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed to transition.
##      </summary>
## </param>
#
 	 	define(`antivirus_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_systemctl'($*)) dnl
	
        gen_require(`
                type antivirus_t;
                type antivirus_unit_file_t;
        ')

        systemd_exec_systemctl($1)
	init_reload_services($1)
        systemd_read_fifo_file_passwd_run($1)
        allow $1 antivirus_unit_file_t:file read_file_perms;
        allow $1 antivirus_unit_file_t:service manage_service_perms;

        ps_process_pattern($1, antivirus_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_systemctl'($*)) dnl
	')


#######################################
## <summary>
##  All of the rules required to administrate
##  an antivirus programs environment
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
## <param name="role">
##  <summary>
##  The role to be allowed to manage the clamav domain.
##  </summary>
## </param>
## <rolecap/>
#
 	 	define(`antivirus_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `antivirus_admin'($*)) dnl
	
    gen_require(`
		attribute antivirus_domain;
        type antivirus_t, antivirus_conf_t, antivirus_tmp_t;
        type antivirus_log_t, antivirus_db_t, antivirus_var_run_t;
        type antivirus_initrc_exec_t, antivirus_unit_file_t;
    ')

	allow $1 antivirus_t:process signal_perms;
    ps_process_pattern($1, antivirus_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 antivirus_t:process ptrace;
    ')

    init_labeled_script_domtrans($1, antivirus_initrc_exec_t)
    domain_system_change_exemption($1)
    role_transition $2 antivirus_initrc_exec_t system_r;
    allow $2 system_r;

	antivirus_systemctl($1)
    admin_pattern($1, antivirus_unit_file_t)
    allow $1 antivirus_unit_file_t:service all_service_perms;

    files_list_etc($1)
    admin_pattern($1, antivirus_conf_t)

    files_list_var_lib($1)
	admin_pattern($1, antivirus_db_t)

    logging_list_logs($1)
    admin_pattern($1, antivirus_log_t)

    files_list_pids($1)
    admin_pattern($1, antivirus_var_run_t)

    files_list_tmp($1)
    admin_pattern($1, antivirus_tmp_t)

    optional_policy(`
        systemd_passwd_agent_exec($1)
        systemd_read_fifo_file_passwd_run($1)
    ')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `antivirus_admin'($*)) dnl
	')

## <summary>Apache web server</summary>

########################################
## <summary>
##	Create a set of derived types for apache
##	web content.
## </summary>
## <param name="prefix">
##	<summary>
##	The prefix to be used for deriving type names.
##	</summary>
## </param>
#
 	 	define(`apache_user_content_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_user_content_template'($*)) dnl
	
	gen_require(`
		attribute httpd_exec_scripts, httpd_script_exec_type;
		type httpd_t, httpd_suexec_t;
		attribute httpd_script_type, httpd_user_content_type;
	')

	#This type is for webpages
	type $1_content_t; # customizable;
	typeattribute $1_content_t httpd_user_content_type;
	typealias $1_content_t alias { httpd_$1_content_t httpd_$1_script_ro_t };
	files_type($1_content_t)

	# This type is used for .htaccess files
	type $1_htaccess_t, httpd_content_type; # customizable;
	typeattribute $1_htaccess_t httpd_user_content_type;
    typealias $1_htaccess_t alias {httpd_$1_htaccess_t };
	files_type($1_htaccess_t)

	# Type that CGI scripts run as
	type $1_script_t,	httpd_script_type;
	typealias $1_script_t alias { httpd_$1_script_t };
	domain_type($1_script_t)
	role system_r types $1_script_t;

	kernel_read_system_state($1_script_t)

	# This type is used for executable scripts files
	type $1_script_exec_t, httpd_script_exec_type; # customizable;
	typeattribute $1_script_exec_t httpd_user_content_type;
	typealias $1_script_exec_t alias { httpd_$1_script_exec_t };
	domain_entry_file($1_script_t, $1_script_exec_t)

	type $1_rw_content_t; # customizable
	typeattribute $1_rw_content_t httpd_user_content_type;
	typealias $1_rw_content_t alias { httpd_$1_rw_content_t $1_script_rw_t $1_content_rw_t };
	files_type($1_rw_content_t)

	type $1_ra_content_t, httpd_content_type; # customizable
	typeattribute $1_ra_content_t httpd_user_content_type;
	typealias $1_ra_content_t alias { httpd_$1_ra_content_t $1_script_ra_t $1_content_ra_t };
	files_type($1_ra_content_t)

	# Allow the script process to search the cgi directory, and users directory
	allow $1_script_t $1_content_t:dir search_dir_perms;

	can_exec($1_script_t, $1_script_exec_t)
	allow $1_script_t $1_script_exec_t:dir list_dir_perms;
	allow $1_script_t $1_ra_content_t:dir { list_dir_perms add_entry_dir_perms };
	read_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)
	append_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)
	create_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)
	read_lnk_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)

	allow $1_script_t $1_content_t:dir list_dir_perms;
	read_files_pattern($1_script_t, $1_content_t, $1_content_t)
	read_lnk_files_pattern($1_script_t, $1_content_t, $1_content_t)

	manage_dirs_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_lnk_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_fifo_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_sock_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	allow $1_script_t $1_rw_content_t:file map;

	allow $1_script_t httpd_t:unix_stream_socket { ioctl accept getattr read write };

	# Allow the web server to run scripts and serve pages
	tunable_policy(`httpd_builtin_scripting',`
		manage_dirs_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)
		manage_files_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)
		manage_lnk_files_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)
		rw_sock_files_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)

		allow httpd_t $1_ra_content_t:dir { add_entry_dir_perms };
		read_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)
		append_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)
		create_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)
		read_lnk_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)

	')

	tunable_policy(`httpd_enable_cgi',`
		allow $1_script_t $1_script_exec_t:file entrypoint;

		domtrans_pattern(httpd_suexec_t, $1_script_exec_t, $1_script_t)

		# privileged users run the script:
		domtrans_pattern(httpd_exec_scripts, $1_script_exec_t, $1_script_t)

		allow httpd_exec_scripts $1_script_exec_t:file read_file_perms;

		# apache runs the script:
		domtrans_pattern(httpd_t, $1_script_exec_t, $1_script_t)
		allow httpd_t $1_script_t:unix_dgram_socket sendto;
	')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_user_content_template'($*)) dnl
	')


########################################
## <summary>
##	Create a set of derived types for apache
##	web content.
## </summary>
## <param name="prefix">
##	<summary>
##	The prefix to be used for deriving type names.
##	</summary>
## </param>
#
 	 	define(`apache_content_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_content_template'($*)) dnl
	
	gen_require(`
		attribute httpd_exec_scripts, httpd_script_exec_type;
		type httpd_t, httpd_suexec_t;
		attribute httpd_script_type, httpd_content_type;
	')

	#This type is for webpages
	type $1_content_t; # customizable;
	typeattribute $1_content_t httpd_content_type;
	typealias $1_content_t alias httpd_$1_script_ro_t;
	files_type($1_content_t)

	# This type is used for .htaccess files
	type $1_htaccess_t, httpd_content_type; # customizable;
	typeattribute $1_htaccess_t httpd_content_type;
	files_type($1_htaccess_t)

	# Type that CGI scripts run as
	type $1_script_t,	httpd_script_type;
    typealias $1_script_t alias { httpd_$1_script_t };
	domain_type($1_script_t)
	role system_r types $1_script_t;

	kernel_read_system_state($1_script_t)

	# This type is used for executable scripts files
	type $1_script_exec_t, httpd_script_exec_type; # customizable;
	typeattribute $1_script_exec_t httpd_content_type;
	domain_entry_file($1_script_t, $1_script_exec_t)

	type $1_rw_content_t; # customizable
	typeattribute $1_rw_content_t httpd_content_type;
	typealias $1_rw_content_t alias { $1_script_rw_t $1_content_rw_t };
	files_type($1_rw_content_t)

	type $1_ra_content_t, httpd_content_type; # customizable
	typeattribute $1_ra_content_t httpd_content_type;
	typealias $1_ra_content_t alias { $1_script_ra_t $1_content_ra_t };
	files_type($1_ra_content_t)

	# Allow the script process to search the cgi directory, and users directory
	allow $1_script_t $1_content_t:dir search_dir_perms;

	can_exec($1_script_t, $1_script_exec_t)
	allow $1_script_t $1_script_exec_t:dir list_dir_perms;
	allow $1_script_t $1_ra_content_t:dir { list_dir_perms add_entry_dir_perms };
	read_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)
	append_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)
	create_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)
	read_lnk_files_pattern($1_script_t, $1_ra_content_t, $1_ra_content_t)

	allow $1_script_t $1_content_t:dir list_dir_perms;
	read_files_pattern($1_script_t, $1_content_t, $1_content_t)
	read_lnk_files_pattern($1_script_t, $1_content_t, $1_content_t)

	manage_dirs_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_lnk_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_fifo_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)
	manage_sock_files_pattern($1_script_t, $1_rw_content_t, $1_rw_content_t)

	allow $1_script_t httpd_t:unix_stream_socket { ioctl accept getattr read write shutdown };

	# Allow the web server to run scripts and serve pages
	tunable_policy(`httpd_builtin_scripting',`
		manage_dirs_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)
		manage_files_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)
		manage_lnk_files_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)
		rw_sock_files_pattern(httpd_t, $1_rw_content_t, $1_rw_content_t)

		allow httpd_t $1_ra_content_t:dir { add_entry_dir_perms };
		read_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)
		append_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)
		create_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)
		read_lnk_files_pattern(httpd_t, $1_ra_content_t, $1_ra_content_t)

	')

	tunable_policy(`httpd_enable_cgi',`
		allow $1_script_t $1_script_exec_t:file entrypoint;

		domtrans_pattern(httpd_suexec_t, $1_script_exec_t, $1_script_t)

		# privileged users run the script:
		domtrans_pattern(httpd_exec_scripts, $1_script_exec_t, $1_script_t)

		allow httpd_exec_scripts $1_script_exec_t:file read_file_perms;

		# apache runs the script:
		domtrans_pattern(httpd_t, $1_script_exec_t, $1_script_t)
		allow httpd_t $1_script_t:unix_dgram_socket sendto;
	')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_content_template'($*)) dnl
	')


########################################
## <summary>
##	Create a set of derived types for apache
##	web content.
## </summary>
## <param name="prefix">
##	<summary>
##	The prefix to be used for deriving new type names.
##	</summary>
## </param>
## <param name="oldprefix">
##	<summary>
##	The prefix to be used for deriving old type names.
##	</summary>
## </param>
#
 	 	define(`apache_content_alias_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_content_alias_template'($*)) dnl
	
	typealias $1_htaccess_t alias httpd_$2_htaccess_t;
	#typealias $1_script_t alias httpd_$2_script_t;
	typealias $1_script_exec_t alias httpd_$2_script_exec_t;
	typealias $1_content_t alias httpd_$2_content_t;
	typealias $1_rw_content_t alias httpd_$2_script_rw_content_t;
	typealias $1_ra_content_t alias httpd_$2_script_ra_content_t;
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_content_alias_template'($*)) dnl
	')


########################################
## <summary>
##	Role access for apache
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`apache_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_role'($*)) dnl
	
	gen_require(`
		attribute httpdcontent;
		type httpd_user_content_t, httpd_user_htaccess_t, httpd_user_script_t;
		type httpd_user_ra_content_t, httpd_user_rw_content_t, httpd_user_script_exec_t;
	')

	role $1 types httpd_user_script_t;

	allow $2 httpd_user_htaccess_t:file { manage_file_perms relabelto relabelfrom };

	manage_dirs_pattern($2, httpd_user_content_t, httpd_user_content_t)
	manage_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
	manage_lnk_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
	relabel_dirs_pattern($2, httpd_user_content_t, httpd_user_content_t)
	relabel_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
	relabel_lnk_files_pattern($2, httpd_user_content_t, httpd_user_content_t)

	manage_dirs_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
	manage_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
	manage_lnk_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
	relabel_dirs_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
	relabel_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
	relabel_lnk_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)

	manage_dirs_pattern($2, httpd_user_content_t, httpd_user_content_t)
	manage_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
	manage_lnk_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
	relabel_dirs_pattern($2, httpd_user_content_t, httpd_user_content_t)
	relabel_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
	relabel_lnk_files_pattern($2, httpd_user_content_t, httpd_user_content_t)

	manage_dirs_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
	manage_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
	manage_lnk_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
	relabel_dirs_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
	relabel_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
	relabel_lnk_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)

	manage_dirs_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
	manage_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
	manage_lnk_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
	relabel_dirs_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
	relabel_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
	relabel_lnk_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)

	apache_exec_modules($2)
	apache_filetrans_home_content($2)

	tunable_policy(`httpd_enable_cgi',`
		# If a user starts a script by hand it gets the proper context
		domtrans_pattern($2, httpd_user_script_exec_t, httpd_user_script_t)
	')

	tunable_policy(`httpd_enable_cgi && httpd_unified',`
		domtrans_pattern($2, httpdcontent, httpd_user_script_t)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_role'($*)) dnl
	')


########################################
## <summary>
##	Read httpd user scripts executables.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_user_scripts',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_user_scripts'($*)) dnl
	
	gen_require(`
		type httpd_user_script_exec_t;
	')

	allow $1 httpd_user_script_exec_t:dir list_dir_perms;
	read_files_pattern($1, httpd_user_script_exec_t, httpd_user_script_exec_t)
	read_lnk_files_pattern($1, httpd_user_script_exec_t, httpd_user_script_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_user_scripts'($*)) dnl
	')


########################################
## <summary>
##	Read user web content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_user_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_user_content'($*)) dnl
	
	gen_require(`
		type httpd_user_content_t;
	')

	allow $1 httpd_user_content_t:dir list_dir_perms;
	read_files_pattern($1, httpd_user_content_t, httpd_user_content_t)
	read_lnk_files_pattern($1, httpd_user_content_t, httpd_user_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_user_content'($*)) dnl
	')


########################################
## <summary>
##	Manage user web content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_manage_user_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_user_content'($*)) dnl
	
	gen_require(`
		type httpd_user_content_t;
	')

	allow $1 httpd_user_content_t:dir manage_dir_perms;
	manage_files_pattern($1, httpd_user_content_t, httpd_user_content_t)
	manage_lnk_files_pattern($1, httpd_user_content_t, httpd_user_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_user_content'($*)) dnl
	')


########################################
## <summary>
##	Transition to apache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apache_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_domtrans'($*)) dnl
	
	gen_require(`
		type httpd_t, httpd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, httpd_exec_t, httpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Allow the specified domain to execute apache
##	in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_exec'($*)) dnl
	
	gen_require(`
		type httpd_exec_t;
	')

	can_exec($1, httpd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_exec'($*)) dnl
	')


######################################
## <summary>
##	Allow the specified domain to execute apache suexec
##	in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_exec_suexec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_exec_suexec'($*)) dnl
	
	gen_require(`
		type httpd_suexec_exec_t;
	')

	can_exec($1, httpd_suexec_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_exec_suexec'($*)) dnl
	')


#######################################
## <summary>
##	Send a generic signal to apache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_signal'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	allow $1 httpd_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_signal'($*)) dnl
	')


########################################
## <summary>
##	Send a null signal to apache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_signull'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	allow $1 httpd_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_signull'($*)) dnl
	')


########################################
## <summary>
##	Send a SIGCHLD signal to apache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_sigchld',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_sigchld'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	allow $1 httpd_t:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_sigchld'($*)) dnl
	')


########################################
## <summary>
##	Allow the domain to read apache state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_state'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, httpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_state'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use file descriptors from Apache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_use_fds'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	allow $1 httpd_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and write Apache
##	unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_rw_fifo_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_rw_fifo_file'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	dontaudit $1 httpd_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_rw_fifo_file'($*)) dnl
	')


########################################
## <summary>
##	Allow attempts to read and write Apache
##	unix domain stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_rw_stream_sockets'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	allow $1 httpd_t:unix_stream_socket { getattr read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_rw_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and write Apache
##	unix domain stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_rw_stream_sockets'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	dontaudit $1 httpd_t:unix_stream_socket { getattr read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_rw_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and write Apache
##	TCP sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_rw_tcp_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_rw_tcp_sockets'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	dontaudit $1 httpd_t:tcp_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_rw_tcp_sockets'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete all web content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_manage_all_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_all_content'($*)) dnl
	
	gen_require(`
		attribute httpdcontent, httpd_script_exec_type;
	')

	manage_dirs_pattern($1, httpdcontent, httpdcontent)
	manage_files_pattern($1, httpdcontent, httpdcontent)
	manage_lnk_files_pattern($1, httpdcontent, httpdcontent)

	manage_dirs_pattern($1, httpd_script_exec_type, httpd_script_exec_type)
	manage_files_pattern($1, httpd_script_exec_type, httpd_script_exec_type)
	manage_lnk_files_pattern($1, httpd_script_exec_type, httpd_script_exec_type)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_all_content'($*)) dnl
	')


########################################
## <summary>
##	Allow domain to  set the attributes
##	of the APACHE cache directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_setattr_cache_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_setattr_cache_dirs'($*)) dnl
	
	gen_require(`
		type httpd_cache_t;
	')

	allow $1 httpd_cache_t:dir setattr_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_setattr_cache_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to list
##	Apache cache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_list_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_list_cache'($*)) dnl
	
	gen_require(`
		type httpd_cache_t;
	')

	list_dirs_pattern($1, httpd_cache_t, httpd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_list_cache'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	and write Apache cache files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_rw_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_rw_cache_files'($*)) dnl
	
	gen_require(`
		type httpd_cache_t;
	')

	allow $1 httpd_cache_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_rw_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to delete
##	Apache cache dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_delete_cache_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_delete_cache_dirs'($*)) dnl
	
	gen_require(`
		type httpd_cache_t;
	')

	delete_dirs_pattern($1, httpd_cache_t, httpd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_delete_cache_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to delete
##	Apache cache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_delete_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_delete_cache_files'($*)) dnl
	
	gen_require(`
		type httpd_cache_t;
	')

	delete_files_pattern($1, httpd_cache_t, httpd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_delete_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to search
##	apache configuration dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_search_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_search_config'($*)) dnl
	
	gen_require(`
		type httpd_config_t;
	')

	files_search_etc($1)
	allow $1 httpd_config_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_search_config'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit the specified domain to search
##	apache configuration dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_search_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_search_config'($*)) dnl
	
	gen_require(`
		type httpd_config_t;
	')

	dontaudit $1 httpd_config_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_search_config'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	apache configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_config'($*)) dnl
	
	gen_require(`
		type httpd_config_t;
	')

	files_search_etc($1)
	allow $1 httpd_config_t:dir list_dir_perms;
	read_files_pattern($1, httpd_config_t, httpd_config_t)
	read_lnk_files_pattern($1, httpd_config_t, httpd_config_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_config'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to manage
##	apache configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_config'($*)) dnl
	
	gen_require(`
		type httpd_config_t;
	')

	files_search_etc($1)
	manage_dirs_pattern($1, httpd_config_t, httpd_config_t)
	manage_files_pattern($1, httpd_config_t, httpd_config_t)
	read_lnk_files_pattern($1, httpd_config_t, httpd_config_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_config'($*)) dnl
	')


########################################
## <summary>
##	Execute the Apache helper program with
##	a domain transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_domtrans_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_domtrans_helper'($*)) dnl
	
	gen_require(`
		type httpd_helper_t, httpd_helper_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, httpd_helper_exec_t, httpd_helper_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_domtrans_helper'($*)) dnl
	')


########################################
## <summary>
##	Execute the Apache helper program with
##	a domain transition, and allow the
##	specified role the Apache helper domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_run_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_run_helper'($*)) dnl
	
	gen_require(`
		type httpd_helper_t;
	')

	apache_domtrans_helper($1)
	role $2 types httpd_helper_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_run_helper'($*)) dnl
	')


########################################
## <summary>
##	dontaudit attempts to read
##	apache log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_dontaudit_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_read_log'($*)) dnl
	
	gen_require(`
		type httpd_log_t;
	')

	dontaudit $1 httpd_log_t:file read_file_perms;
	dontaudit $1 httpd_log_t:lnk_file read_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_read_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	apache log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_log'($*)) dnl
	
	gen_require(`
		type httpd_log_t;
	')

	logging_search_logs($1)
	allow $1 httpd_log_t:dir list_dir_perms;
	read_files_pattern($1, httpd_log_t, httpd_log_t)
	read_lnk_files_pattern($1, httpd_log_t, httpd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to append
##	to apache log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_append_log'($*)) dnl
	
	gen_require(`
		type httpd_log_t;
	')

	logging_search_logs($1)
	allow $1 httpd_log_t:dir list_dir_perms;
	append_files_pattern($1, httpd_log_t, httpd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_append_log'($*)) dnl
	')


########################################
## <summary>
##      Allow the specified domain to create 
#       apache's log directories.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access
##      </summary>
## </param>
#
 	 	define(`apache_create_log_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_create_log_dirs'($*)) dnl
	
        gen_require(`
                type httpd_log_t;
        ')

        create_dirs_pattern($1, httpd_log_t, httpd_log_t)
        logging_search_logs($1)
        setattr_dirs_pattern($1, httpd_log_t, httpd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_create_log_dirs'($*)) dnl
	')


#######################################
## <summary>
##  Allow the specified domain to write
##  to apache log files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`apache_write_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_write_log'($*)) dnl
	
    gen_require(`
        type httpd_log_t;
    ')

	allow $1 httpd_log_t:file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_write_log'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to append to the
##	Apache logs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_append_log'($*)) dnl
	
	gen_require(`
		type httpd_log_t;
	')

	dontaudit $1 httpd_log_t:file append_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_append_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to manage
##	to apache var lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_manage_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_lib'($*)) dnl
	
	gen_require(`
		type httpd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, httpd_var_lib_t, httpd_var_lib_t)
	manage_files_pattern($1, httpd_var_lib_t, httpd_var_lib_t)
	read_lnk_files_pattern($1, httpd_var_lib_t, httpd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_lib'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to manage
##	to apache log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_log'($*)) dnl
	
	gen_require(`
		type httpd_log_t;
	')

	logging_search_logs($1)
	manage_dirs_pattern($1, httpd_log_t, httpd_log_t)
	manage_files_pattern($1, httpd_log_t, httpd_log_t)
	read_lnk_files_pattern($1, httpd_log_t, httpd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to search Apache
##	module directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_search_modules',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_search_modules'($*)) dnl
	
	gen_require(`
		type httpd_modules_t;
	')

	dontaudit $1 httpd_modules_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_search_modules'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	the apache module directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_modules',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_modules'($*)) dnl
	
	gen_require(`
		type httpd_modules_t;
	')

	read_files_pattern($1, httpd_modules_t, httpd_modules_t)
    allow $1 httpd_modules_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_modules'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to list
##	the contents of the apache modules
##	directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_list_modules',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_list_modules'($*)) dnl
	
	gen_require(`
		type httpd_modules_t;
	')

	allow $1 httpd_modules_t:dir list_dir_perms;
	read_lnk_files_pattern($1, httpd_modules_t, httpd_modules_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_list_modules'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to execute
##	apache modules.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_exec_modules',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_exec_modules'($*)) dnl
	
	gen_require(`
		type httpd_modules_t;
	')

	allow $1 httpd_modules_t:dir list_dir_perms;
	allow $1 httpd_modules_t:lnk_file read_lnk_file_perms;
	can_exec($1, httpd_modules_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_exec_modules'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run httpd_rotatelogs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apache_domtrans_rotatelogs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_domtrans_rotatelogs'($*)) dnl
	
	gen_require(`
		type httpd_rotatelogs_t, httpd_rotatelogs_exec_t;
	')

	domtrans_pattern($1, httpd_rotatelogs_exec_t, httpd_rotatelogs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_domtrans_rotatelogs'($*)) dnl
	')


#######################################
## <summary>
##  Execute httpd_rotatelogs in the caller domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`apache_exec_rotatelogs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_exec_rotatelogs'($*)) dnl
	
    gen_require(`
        type httpd_rotatelogs_exec_t;
    ')

	can_exec($1, httpd_rotatelogs_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_exec_rotatelogs'($*)) dnl
	')


#######################################
## <summary>
##  Execute httpd system scripts in the caller domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`apache_exec_sys_script',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_exec_sys_script'($*)) dnl
	
	gen_require(`
		type httpd_sys_script_exec_t;
	')

	allow $1 httpd_sys_script_exec_t:dir search_dir_perms;
	can_exec($1, httpd_sys_script_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_exec_sys_script'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to list
##	apache system content files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_list_sys_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_list_sys_content'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t;
	')

	list_dirs_pattern($1, httpd_sys_content_t, httpd_sys_content_t)
	read_lnk_files_pattern($1, httpd_sys_content_t, httpd_sys_content_t)
	files_search_var($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_list_sys_content'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to manage
##	apache system content files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
# Note that httpd_sys_content_t is found in /var, /etc, /srv and /usr
 	 	define(`apache_manage_sys_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_sys_content'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t;
	')

	files_search_var($1)
	manage_dirs_pattern($1, httpd_sys_content_t, httpd_sys_content_t)
	manage_files_pattern($1, httpd_sys_content_t, httpd_sys_content_t)
	manage_lnk_files_pattern($1, httpd_sys_content_t, httpd_sys_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_sys_content'($*)) dnl
	')


######################################
## <summary>
##	Allow the specified domain to read
##	apache system content rw files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_read_sys_content_rw_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_sys_content_rw_files'($*)) dnl
	
	gen_require(`
		type httpd_sys_rw_content_t;
	')

	read_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_sys_content_rw_files'($*)) dnl
	')


######################################
## <summary>
##	Allow the specified domain to read inherited
##	apache system content rw files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_read_inherited_sys_content_rw_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_inherited_sys_content_rw_files'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t;
		type httpd_sys_rw_content_t;
	')

	allow $1 httpd_sys_content_t:dir search_dir_perms;
	allow $1 httpd_sys_rw_content_t:file read_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_inherited_sys_content_rw_files'($*)) dnl
	')


######################################
## <summary>
##	Allow the specified domain to read
##	apache system content rw dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_read_sys_content_rw_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_sys_content_rw_dirs'($*)) dnl
	
	gen_require(`
		type httpd_sys_rw_content_t;
	')

	list_dirs_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_sys_content_rw_dirs'($*)) dnl
	')


######################################
## <summary>
##	Allow the specified domain to manage
##	apache system content rw files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_manage_sys_content_rw',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_sys_content_rw'($*)) dnl
	
	gen_require(`
		type httpd_sys_rw_content_t;
	')

	files_search_var($1)
	manage_dirs_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
	manage_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
	manage_lnk_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_sys_content_rw'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to delete
##	apache system content rw files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_delete_sys_content_rw',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_delete_sys_content_rw'($*)) dnl
	
	gen_require(`
		type httpd_sys_rw_content_t;
	')

	files_search_tmp($1)
	delete_dirs_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
	delete_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
	delete_lnk_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
	delete_fifo_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
	delete_sock_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_delete_sys_content_rw'($*)) dnl
	')


########################################
## <summary>
##	Execute all web scripts in the system
##	script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
# cjp: this interface specifically added to allow
# sysadm_t to run scripts
 	 	define(`apache_domtrans_sys_script',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_domtrans_sys_script'($*)) dnl
	
	gen_require(`
		attribute httpdcontent;
		type httpd_sys_script_exec_t;
		type httpd_sys_script_t, httpd_sys_content_t;
	')

	tunable_policy(`httpd_enable_cgi',`
		domtrans_pattern($1, httpd_sys_script_exec_t, httpd_sys_script_t)
	')

	tunable_policy(`httpd_enable_cgi && httpd_unified',`
		domtrans_pattern($1, httpdcontent, httpd_sys_script_t)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_domtrans_sys_script'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and write Apache
##	system script unix domain stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_rw_sys_script_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_rw_sys_script_stream_sockets'($*)) dnl
	
	gen_require(`
		type httpd_sys_script_t;
	')

	dontaudit $1 httpd_sys_script_t:unix_stream_socket { getattr read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_rw_sys_script_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	Execute all user scripts in the user
##	script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apache_domtrans_all_scripts',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_domtrans_all_scripts'($*)) dnl
	
	gen_require(`
		attribute httpd_exec_scripts;
	')

	typeattribute $1 httpd_exec_scripts;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_domtrans_all_scripts'($*)) dnl
	')


########################################
## <summary>
##	Execute all user scripts in the user
##	script domain.  Add user script domains
##	to the specified role.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_run_all_scripts',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_run_all_scripts'($*)) dnl
	
	gen_require(`
		attribute httpd_exec_scripts, httpd_script_domains;
	')

	role $2 types httpd_script_domains;
	apache_domtrans_all_scripts($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_run_all_scripts'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	apache squirrelmail data.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_squirrelmail_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_squirrelmail_data'($*)) dnl
	
	gen_require(`
		type httpd_squirrelmail_t;
	')

	read_files_pattern($1, httpd_squirrelmail_t, httpd_squirrelmail_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_squirrelmail_data'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to append
##	apache squirrelmail data.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_append_squirrelmail_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_append_squirrelmail_data'($*)) dnl
	
	gen_require(`
		type httpd_squirrelmail_t;
	')

	allow $1 httpd_squirrelmail_t:file append_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_append_squirrelmail_data'($*)) dnl
	')


########################################
## <summary>
##	Search apache system content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_search_sys_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_search_sys_content'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t;
	')

	allow $1 httpd_sys_content_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_search_sys_content'($*)) dnl
	')


########################################
## <summary>
##	Read apache system content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_sys_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_sys_content'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t;
	')

	allow $1 httpd_sys_content_t:dir list_dir_perms;
	read_files_pattern($1, httpd_sys_content_t, httpd_sys_content_t)
	read_lnk_files_pattern($1, httpd_sys_content_t, httpd_sys_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_sys_content'($*)) dnl
	')


########################################
## <summary>
##	Search apache system CGI directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_search_sys_scripts',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_search_sys_scripts'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t, httpd_sys_script_exec_t;
	')

	search_dirs_pattern($1, httpd_sys_content_t, httpd_sys_script_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_search_sys_scripts'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete all user web content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_manage_all_user_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_all_user_content'($*)) dnl
	
	gen_require(`
		attribute httpd_user_content_type, httpd_user_script_exec_type;
	')

	manage_dirs_pattern($1, httpd_user_content_type, httpd_user_content_type)
	manage_files_pattern($1, httpd_user_content_type, httpd_user_content_type)
	manage_lnk_files_pattern($1, httpd_user_content_type, httpd_user_content_type)

	manage_dirs_pattern($1, httpd_user_script_exec_type, httpd_user_script_exec_type)
	manage_files_pattern($1, httpd_user_script_exec_type, httpd_user_script_exec_type)
	manage_lnk_files_pattern($1, httpd_user_script_exec_type, httpd_user_script_exec_type)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_all_user_content'($*)) dnl
	')


########################################
## <summary>
##	Search system script state directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_search_sys_script_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_search_sys_script_state'($*)) dnl
	
	gen_require(`
		type httpd_sys_script_t;
	')

	allow $1 httpd_sys_script_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_search_sys_script_state'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	apache tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_tmp_dirs'($*)) dnl
	
	gen_require(`
		type httpd_tmp_t;
	')

	files_search_tmp($1)
	list_dirs_pattern($1, httpd_tmp_t, httpd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	apache tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_tmp_files'($*)) dnl
	
	gen_require(`
		type httpd_tmp_t;
	')

	files_search_tmp($1)
	read_files_pattern($1, httpd_tmp_t, httpd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	apache tmp lnk files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_tmp_symlinks',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_tmp_symlinks'($*)) dnl
	
	gen_require(`
		type httpd_tmp_t;
	')

	files_search_tmp($1)
	read_lnk_files_pattern($1, httpd_tmp_t, httpd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_tmp_symlinks'($*)) dnl
	')


######################################
## <summary>
##	Dontaudit attempts to read and write
##	apache tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_rw_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_rw_tmp_files'($*)) dnl
	
	gen_require(`
		type httpd_tmp_t;
	')

	dontaudit $1 httpd_tmp_t:file { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_rw_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit attempts to write
##	apache tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_write_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_write_tmp_files'($*)) dnl
	
	gen_require(`
		type httpd_tmp_t;
	')

	dontaudit $1 httpd_tmp_t:file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_write_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Execute CGI in the specified domain.
## </summary>
##	<desc>
##	<p>
##	Execute CGI in the specified domain.
##	</p>
##	<p>
##	This is an interface to support third party modules
##	and its use is not allowed in upstream reference
##	policy.
##	</p>
##	</desc>
## <param name="domain">
##	<summary>
##	Domain run the cgi script in.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	Type of the executable to enter the cgi domain.
##	</summary>
## </param>
#
 	 	define(`apache_cgi_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_cgi_domain'($*)) dnl
	
	gen_require(`
		type httpd_t, httpd_sys_script_exec_t;
	')

	domtrans_pattern(httpd_t, $2, $1)
	apache_search_sys_scripts($1)

	allow httpd_t $1:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_cgi_domain'($*)) dnl
	')


########################################
## <summary>
##	Execute httpd server in the httpd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apache_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_systemctl'($*)) dnl
	
	gen_require(`
		type httpd_t;
		type httpd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 httpd_unit_file_t:file read_file_perms;
	allow $1 httpd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, httpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate an apache environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_admin'($*)) dnl
	
	gen_require(`
		attribute httpdcontent, httpd_script_exec_type;
		type httpd_t, httpd_config_t, httpd_log_t;
		type httpd_modules_t, httpd_lock_t, httpd_bool_t;
		type httpd_var_run_t, httpd_php_tmp_t, httpd_initrc_exec_t;
		type httpd_suexec_tmp_t, httpd_tmp_t;
		type httpd_unit_file_t;
	')

	allow $1 httpd_t:process signal_perms;
	ps_process_pattern($1, httpd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 httpd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, httpd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 httpd_initrc_exec_t system_r;
	allow $2 system_r;

	apache_manage_all_content($1)
	miscfiles_manage_public_files($1)

	files_list_etc($1)
	admin_pattern($1, httpd_config_t)

	logging_list_logs($1)
	admin_pattern($1, httpd_log_t)

	admin_pattern($1, httpd_modules_t)

	admin_pattern($1, httpd_lock_t)
	files_lock_filetrans($1, httpd_lock_t, file)

	admin_pattern($1, httpd_var_run_t)
	files_pid_filetrans($1, httpd_var_run_t, file)

	admin_pattern($1, httpdcontent)
	admin_pattern($1, httpd_script_exec_type)

	seutil_domtrans_setfiles($1)

	files_list_tmp($1)
	admin_pattern($1, httpd_tmp_t)
	admin_pattern($1, httpd_php_tmp_t)
	admin_pattern($1, httpd_suexec_tmp_t)

	apache_systemctl($1)
	admin_pattern($1, httpd_unit_file_t)
	allow $1 httpd_unit_file_t:service all_service_perms;

	apache_filetrans_named_content($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_admin'($*)) dnl
	')


########################################
## <summary>
##	dontaudit read and write an leaked file descriptors
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apache_dontaudit_leaks',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dontaudit_leaks'($*)) dnl
	
	gen_require(`
		type httpd_t;
		type httpd_tmp_t;
	')

	dontaudit $1 httpd_t:fifo_file rw_inherited_fifo_file_perms;
	dontaudit $1 httpd_t:tcp_socket { read write };
	dontaudit $1 httpd_t:unix_dgram_socket { read write };
	dontaudit $1 httpd_t:unix_stream_socket { getattr read write };
	dontaudit $1 httpd_tmp_t:file { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dontaudit_leaks'($*)) dnl
	')


########################################
## <summary>
##	Transition to apache named content
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type httpd_sys_content_t, httpd_sys_rw_content_t;
		type httpd_tmp_t;
	')


	apache_filetrans_home_content($1)
	files_usr_filetrans($1, httpd_sys_content_t, dir, "gallery2")
	files_usr_filetrans($1, httpd_sys_content_t, dir, "z-push")
	files_etc_filetrans($1, httpd_sys_content_t, dir, "z-push")
	files_etc_filetrans($1, httpd_sys_content_t, dir, "web")
	files_etc_filetrans($1, httpd_sys_content_t, dir, "WebCalendar")
	files_etc_filetrans($1, httpd_sys_content_t, dir, "htdig")
	files_etc_filetrans($1, httpd_sys_rw_content_t, dir, "horde")
	files_etc_filetrans($1, httpd_sys_rw_content_t, dir, "owncloud")
	files_etc_filetrans($1, httpd_sys_rw_content_t, dir, "nextcloud")
	filetrans_pattern($1, httpd_sys_content_t, httpd_sys_rw_content_t, file, "settings.php")
	filetrans_pattern($1, httpd_sys_content_t, httpd_sys_rw_content_t, dir, "smarty")
	filetrans_pattern($1, httpd_sys_content_t, httpd_sys_rw_content_t, dir, "uploads")
	filetrans_pattern($1, httpd_sys_content_t, httpd_sys_rw_content_t, dir, "wp-content")
	filetrans_pattern($1, httpd_sys_content_t, httpd_sys_rw_content_t, dir, "upgrade")
	userdom_user_tmp_filetrans($1, httpd_tmp_t, dir, "apache")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_filetrans_named_content'($*)) dnl
	')


########################################
## <summary>
##	Allow any httpd_exec_t to be an entrypoint of this domain
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apache_entrypoint',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_entrypoint'($*)) dnl
	
	gen_require(`
		type httpd_exec_t;
	')
	allow $1 httpd_exec_t:file entrypoint;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_entrypoint'($*)) dnl
	')


########################################
## <summary>
##	Execute a httpd_exec_t in the specified domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="target_domain">
##	<summary>
##	The type of the new process.
##	</summary>
## </param>
#
 	 	define(`apache_exec_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_exec_domtrans'($*)) dnl
	
	gen_require(`
		type httpd_exec_t;
	')

	domtrans_pattern($1, httpd_exec_t, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_exec_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Transition to apache home content
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_filetrans_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_filetrans_home_content'($*)) dnl
	
	gen_require(`
		type httpd_user_content_t, httpd_user_script_exec_t, httpd_user_htaccess_t;
		type httpd_user_content_ra_t;
	')

	userdom_user_home_dir_filetrans($1, httpd_user_content_t, dir, "public_html")
	userdom_user_home_dir_filetrans($1, httpd_user_content_t, dir, "www")
	userdom_user_home_dir_filetrans($1, httpd_user_content_t, dir, "web")
	filetrans_pattern($1, httpd_user_content_t, httpd_user_script_exec_t, dir, "cgi-bin")
	filetrans_pattern($1, httpd_user_content_t, httpd_user_content_ra_t, dir, "logs")
	filetrans_pattern($1, { httpd_user_content_t httpd_user_script_exec_t }, httpd_user_htaccess_t, file, ".htaccess")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_filetrans_home_content'($*)) dnl
	')


########################################
## <summary>
##	Read apache pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_pid_files'($*)) dnl
	
	gen_require(`
		type httpd_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, httpd_var_run_t, httpd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Manage apache pid objects.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_manage_pid_files'($*)) dnl
	
	gen_require(`
		type httpd_var_run_t;
	')

	files_search_pids($1)
	manage_dirs_pattern($1, httpd_var_run_t, httpd_var_run_t)
	manage_files_pattern($1, httpd_var_run_t, httpd_var_run_t)
	manage_sock_files_pattern($1, httpd_var_run_t, httpd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##      Send and receive messages from
##      httpd over dbus.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`apache_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_dbus_chat'($*)) dnl
	
        gen_require(`
                type httpd_t;
                class dbus send_msg;
        ')

        allow $1 httpd_t:dbus send_msg;
        allow httpd_t $1:dbus send_msg;
		ps_process_pattern(httpd_t, $1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Delete the httpd tmp.
## </summary>
## <param name="file_type">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_delete_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_delete_tmp'($*)) dnl
	
	gen_require(`
		type httpd_tmp_t;
	')

	allow $1 httpd_tmp_t:file unlink;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_delete_tmp'($*)) dnl
	')


########################################
## <summary>
##	Allow httpd noatsecure
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_noatsecure',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_noatsecure'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

    allow $1 httpd_t:process { noatsecure };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_noatsecure'($*)) dnl
	')


#######################################
## <summary>
##  Allow the specified domain to ioctl an
##  httpd with a unix domain stream sockets.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`apache_ioctl_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_ioctl_stream_sockets'($*)) dnl
	
    gen_require(`
        type httpd_t;
    ')

    allow $1 httpd_t:unix_stream_socket ioctl;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_ioctl_stream_sockets'($*)) dnl
	')


#######################################
## <summary>
##	Allow the specified domain read httpd semaphores
## </summary>
##	<param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apache_read_semaphores',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apache_read_semaphores'($*)) dnl
	
	gen_require(`
		type httpd_t;
	')

	allow $1 httpd_t:sem r_sem_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apache_read_semaphores'($*)) dnl
	')

## <summary>APC UPS monitoring daemon.</summary>

########################################
## <summary>
##	Execute a domain transition to
##	run apcupsd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`apcupsd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_domtrans'($*)) dnl
	
	gen_require(`
		type apcupsd_t, apcupsd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, apcupsd_exec_t, apcupsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute apcupsd server in the
##	apcupsd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apcupsd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type apcupsd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, apcupsd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read apcupsd PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apcupsd_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_read_pid_files'($*)) dnl
	
	gen_require(`
		type apcupsd_var_run_t;
	')

	files_search_pids($1)
	allow $1 apcupsd_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read apcupsd power files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apcupsd_read_power_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_read_power_files'($*)) dnl
	
	gen_require(`
		type apcupsd_power_t;
	')

	allow $1 apcupsd_power_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_read_power_files'($*)) dnl
	')


########################################
## <summary>
##	Read apcupsd log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apcupsd_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_read_log'($*)) dnl
	
	gen_require(`
		type apcupsd_log_t;
	')

	logging_search_logs($1)
	allow $1 apcupsd_log_t:dir list_dir_perms;
	allow $1 apcupsd_log_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append apcupsd log files.
## </summary>
## <param name="domain">
## 	<summary>
##	Domain allowed access.
## 	</summary>
## </param>
#
 	 	define(`apcupsd_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_append_log'($*)) dnl
	
	gen_require(`
		type apcupsd_log_t;
	')

	logging_search_logs($1)
	allow $1 apcupsd_log_t:dir list_dir_perms;
	allow $1 apcupsd_log_t:file append_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_append_log'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to
##	run apcupsd_cgi_script.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`apcupsd_cgi_script_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_cgi_script_domtrans'($*)) dnl
	
	gen_require(`
		type apcupsd_cgi_script_t, apcupsd_cgi_script_exec_t;
	')

	files_search_var($1)
	domtrans_pattern($1, apcupsd_cgi_script_exec_t, apcupsd_cgi_script_t)

	optional_policy(`
		apache_search_sys_content($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_cgi_script_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute apcupsd server in the apcupsd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apcupsd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_systemctl'($*)) dnl
	
	gen_require(`
		type apcupsd_t;
		type apcupsd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 apcupsd_unit_file_t:file read_file_perms;
	allow $1 apcupsd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, apcupsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Create configuration files in /var/lock 
##	with a named file type transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apcupsd_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type apcupsd_lock_t;
	')

	files_lock_filetrans($1, apcupsd_lock_t, file, "apcupsd")
	files_lock_filetrans($1, apcupsd_lock_t, file, "LCK..")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_filetrans_named_content'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an apcupsd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apcupsd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apcupsd_admin'($*)) dnl
	
	gen_require(`
		type apcupsd_t, apcupsd_tmp_t, apcupsd_log_t;
		type apcupsd_var_run_t, apcupsd_initrc_exec_t, apcupsd_lock_t;
		type apcupsd_unit_file_t;
		type apcupsd_power_t;
	')

	allow $1 apcupsd_t:process signal_perms;
	ps_process_pattern($1, apcupsd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 apcupsd_t:process ptrace;
	')

	apcupsd_initrc_domtrans($1, apcupsd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 apcupsd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_var($1)
	admin_pattern($1, apcupsd_lock_t)

	logging_list_logs($1)
	admin_pattern($1, apcupsd_log_t)

	files_list_tmp($1)
	admin_pattern($1, apcupsd_tmp_t)

	files_list_pids($1)
	admin_pattern($1, apcupsd_var_run_t)

	apcupsd_systemctl($1)
	admin_pattern($1, apcupsd_unit_file_t)
	allow $1 apcupsd_unit_file_t:service all_service_perms;

	manage_files_pattern($1, apcupsd_power_t, apcupsd_power_t)
	files_etc_filetrans(apcupsd_t, apcupsd_power_t, file, "powerfail")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apcupsd_admin'($*)) dnl
	')

## <summary>Advanced power management.</summary>

########################################
## <summary>
##	Execute apm in the apm domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apm_domtrans_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_domtrans_client'($*)) dnl
	
	gen_require(`
		type apm_t, apm_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, apm_exec_t, apm_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_domtrans_client'($*)) dnl
	')


########################################
## <summary>
##	Execute apm in the apm domain
##	and allow the specified role
##	the apm domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`apm_run_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_run_client'($*)) dnl
	
	gen_require(`
		attribute_role apm_roles;
	')

	apm_domtrans_client($1)
	roleattribute $2 apm_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_run_client'($*)) dnl
	')


########################################
## <summary>
##	Use apmd file descriptors.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apm_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_use_fds'($*)) dnl
	
	gen_require(`
		type apmd_t;
	')

	allow $1 apmd_t:fd use; 

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Write apmd unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apm_write_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_write_pipes'($*)) dnl
	
	gen_require(`
		type apmd_t;
	')

	allow $1 apmd_t:fifo_file write; 

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_write_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write to apmd unix
##	stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apm_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_rw_stream_sockets'($*)) dnl
	
	gen_require(`
		type apmd_t;
	')

	allow $1 apmd_t:unix_stream_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_rw_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	Append apmd log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apm_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_append_log'($*)) dnl
	
	gen_require(`
		type apmd_log_t;
	')

	logging_search_logs($1)
	allow $1 apmd_log_t:file append_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_append_log'($*)) dnl
	')


########################################
## <summary>
##	Connect to apmd over an unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apm_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_stream_connect'($*)) dnl
	
	gen_require(`
		type apmd_t, apmd_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, apmd_var_run_t, apmd_var_run_t, apmd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Execute apmd server in the apmd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apmd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apmd_systemctl'($*)) dnl
	
	gen_require(`
		type apmd_t;
		type apmd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 apmd_unit_file_t:file read_file_perms;
	allow $1 apmd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, apmd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apmd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an apm environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apm_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apm_admin'($*)) dnl
	
	gen_require(`
		type apmd_t, apmd_initrc_exec_t, apmd_log_t;
		type apmd_lock_t, apmd_var_run_t, apmd_var_lib_t;
		type apmd_tmp_t;
	')

	allow $1 apmd_t:process { signal_perms };
	ps_process_pattern($1, apmd_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 apmd_t:process ptrace;
    ')

	init_labeled_script_domtrans($1, apmd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 apmd_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, apmd_log_t)

	files_search_locks($1)
	admin_pattern($1, apmd_lock_t)

	files_search_pids($1)
	admin_pattern($1, apmd_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, apmd_var_lib_t)

	files_search_tmp($1)
	admin_pattern($1, apmd_tmp_t)

	apm_run_client($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apm_admin'($*)) dnl
	')

## <summary>Advanced package tool.</summary>

########################################
## <summary>
##	Execute apt programs in the apt domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`apt_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_domtrans'($*)) dnl
	
	gen_require(`
		type apt_t, apt_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, apt_exec_t, apt_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute the apt in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_exec'($*)) dnl
	
	gen_require(`
		type apt_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, apt_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute apt programs in the apt domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`apt_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_run'($*)) dnl
	
	gen_require(`
		attribute_role apt_roles;
	')

	apt_domtrans($1)
	roleattribute $2 apt_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_run'($*)) dnl
	')


########################################
## <summary>
##	Use apt file descriptors.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_use_fds'($*)) dnl
	
	gen_require(`
		type apt_t;
	')

	allow $1 apt_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to use
##	apt file descriptors.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apt_dontaudit_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_dontaudit_use_fds'($*)) dnl
	
	gen_require(`
		type apt_t;
	')

	dontaudit $1 apt_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_dontaudit_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Read apt unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_read_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_read_pipes'($*)) dnl
	
	gen_require(`
		type apt_t;
	')

	allow $1 apt_t:fifo_file read_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_read_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write apt unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_rw_pipes'($*)) dnl
	
	gen_require(`
		type apt_t;
	')

	allow $1 apt_t:fifo_file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_rw_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write apt ptys.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_use_ptys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_use_ptys'($*)) dnl
	
	gen_require(`
		type apt_devpts_t;
	')

	allow $1 apt_devpts_t:chr_file rw_term_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_use_ptys'($*)) dnl
	')


########################################
## <summary>
##	Read apt package cache content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_read_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_read_cache'($*)) dnl
	
	gen_require(`
		type apt_var_cache_t;
	')

	files_search_var($1)
	allow $1 apt_var_cache_t:dir list_dir_perms;
	dontaudit $1 apt_var_cache_t:dir rw_dir_perms;
	allow $1 apt_var_cache_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_read_cache'($*)) dnl
	')


########################################
## <summary>
##	Read apt package database content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_read_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_read_db'($*)) dnl
	
	gen_require(`
		type apt_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 apt_var_lib_t:dir list_dir_perms;
	read_files_pattern($1, apt_var_lib_t, apt_var_lib_t)
	read_lnk_files_pattern($1, apt_var_lib_t, apt_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_read_db'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	apt package database content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`apt_manage_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_manage_db'($*)) dnl
	
	gen_require(`
		type apt_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, apt_var_lib_t, apt_var_lib_t)
	manage_lnk_files_pattern($1, apt_var_lib_t, apt_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_manage_db'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to create,
##	read, write, and delete apt
##	package database content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`apt_dontaudit_manage_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `apt_dontaudit_manage_db'($*)) dnl
	
	gen_require(`
		type apt_var_lib_t;
	')

	dontaudit $1 apt_var_lib_t:dir rw_dir_perms;
	dontaudit $1 apt_var_lib_t:file manage_file_perms;
	dontaudit $1 apt_var_lib_t:lnk_file manage_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `apt_dontaudit_manage_db'($*)) dnl
	')

## <summary>Ethernet activity monitor.</summary>

########################################
## <summary>
##	Execute arpwatch server in the
##	arpwatch domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`arpwatch_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type arpwatch_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, arpwatch_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search arpwatch data file directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`arpwatch_search_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_search_data'($*)) dnl
	
	gen_require(`
		type arpwatch_data_t;
	')

	files_search_var_lib($1)
	allow $1 arpwatch_data_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_search_data'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	arpwatch data files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`arpwatch_manage_data_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_manage_data_files'($*)) dnl
	
	gen_require(`
		type arpwatch_data_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, arpwatch_data_t, arpwatch_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_manage_data_files'($*)) dnl
	')


########################################
## <summary>
##	Read and write arpwatch temporary
##	files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`arpwatch_rw_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_rw_tmp_files'($*)) dnl
	
	gen_require(`
		type arpwatch_tmp_t;
	')

	files_search_tmp($1)
	allow $1 arpwatch_tmp_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_rw_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	arpwatch temporary files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`arpwatch_manage_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_manage_tmp_files'($*)) dnl
	
	gen_require(`
		type arpwatch_tmp_t;
	')

	files_search_tmp($1)
	allow $1 arpwatch_tmp_t:file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_manage_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and
##	write arpwatch packet sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`arpwatch_dontaudit_rw_packet_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_dontaudit_rw_packet_sockets'($*)) dnl
	
	gen_require(`
		type arpwatch_t;
	')

	dontaudit $1 arpwatch_t:packet_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_dontaudit_rw_packet_sockets'($*)) dnl
	')


########################################
## <summary>
##	Execute arpwatch server in the arpwatch domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`arpwatch_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_systemctl'($*)) dnl
	
	gen_require(`
		type arpwatch_t;
		type arpwatch_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 arpwatch_unit_file_t:file read_file_perms;
	allow $1 arpwatch_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, arpwatch_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an arpwatch environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`arpwatch_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_admin'($*)) dnl
	
	gen_require(`
		type arpwatch_t, arpwatch_tmp_t, arpwatch_initrc_exec_t;
		type arpwatch_data_t, arpwatch_var_run_t;
		type arpwatch_unit_file_t;
	')

	allow $1 arpwatch_t:process signal_perms;
	ps_process_pattern($1, arpwatch_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 arpwatch_t:process ptrace;
	')

	arpwatch_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 arpwatch_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_tmp($1)
	admin_pattern($1, arpwatch_tmp_t)

	files_list_var($1)
	admin_pattern($1, arpwatch_data_t)

	files_list_pids($1)
	admin_pattern($1, arpwatch_var_run_t)

	arpwatch_systemctl($1)
	admin_pattern($1, arpwatch_unit_file_t)
	allow $1 arpwatch_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_admin'($*)) dnl
	')


########################################
## <summary>
##	Create objects in the arpwatch home directory
##	with an automatic type transition to a specified type
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="type">
##	<summary>
##	The type of the object being created.
##	</summary>
## </param>
## <param name="object">
##      <summary>
##      The class of the object being created.
##      </summary>
## </param>
## <param name="name">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`arpwatch_data_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `arpwatch_data_filetrans'($*)) dnl
	
	gen_require(`
		type arpwatch_data_t;
	')

	filetrans_pattern($1, arpwatch_data_t, $2, $3, $4)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `arpwatch_data_filetrans'($*)) dnl
	')

## <summary>Asterisk IP telephony server.</summary>

######################################
## <summary>
##	Execute asterisk in the asterisk domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`asterisk_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `asterisk_domtrans'($*)) dnl
	
	gen_require(`
		type asterisk_t, asterisk_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, asterisk_exec_t, asterisk_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `asterisk_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute asterisk in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`asterisk_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `asterisk_exec'($*)) dnl
	
	gen_require(`
		type asterisk_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, asterisk_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `asterisk_exec'($*)) dnl
	')


#####################################
## <summary>
##	Connect to asterisk over a unix domain.
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`asterisk_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `asterisk_stream_connect'($*)) dnl
	
	gen_require(`
		type asterisk_t, asterisk_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, asterisk_var_run_t, asterisk_var_run_t, asterisk_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `asterisk_stream_connect'($*)) dnl
	')


#######################################
## <summary>
##	Set attributes of asterisk log
##	files and directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`asterisk_setattr_logs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `asterisk_setattr_logs'($*)) dnl
	
	gen_require(`
		type asterisk_log_t;
	')

	setattr_files_pattern($1, asterisk_log_t, asterisk_log_t)
	setattr_dirs_pattern($1, asterisk_log_t, asterisk_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `asterisk_setattr_logs'($*)) dnl
	')


#######################################
## <summary>
##	Set attributes of the asterisk
##	PID content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`asterisk_setattr_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `asterisk_setattr_pid_files'($*)) dnl
	
	gen_require(`
		type asterisk_var_run_t;
	')

	setattr_files_pattern($1, asterisk_var_run_t, asterisk_var_run_t)
	setattr_dirs_pattern($1, asterisk_var_run_t, asterisk_var_run_t)
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `asterisk_setattr_pid_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an asterisk environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`asterisk_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `asterisk_admin'($*)) dnl
	
	gen_require(`
		type asterisk_t, asterisk_var_run_t, asterisk_spool_t;
		type asterisk_etc_t, asterisk_tmp_t, asterisk_log_t;
		type asterisk_var_lib_t, asterisk_initrc_exec_t;
	')

	allow $1 asterisk_t:process signal_perms;
	ps_process_pattern($1, asterisk_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 asterisk_t:process ptrace;
	')

	init_labeled_script_domtrans($1, asterisk_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 asterisk_initrc_exec_t system_r;
	allow $2 system_r;

	asterisk_exec($1)

	files_list_tmp($1)
	admin_pattern($1, asterisk_tmp_t)

	files_list_etc($1)
	admin_pattern($1, asterisk_etc_t)

	logging_list_logs($1)
	admin_pattern($1, asterisk_log_t)

	files_list_spool($1)
	admin_pattern($1, asterisk_spool_t)

	files_list_var_lib($1)
	admin_pattern($1, asterisk_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, asterisk_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `asterisk_admin'($*)) dnl
	')


## <summary>policy for authconfig</summary>

########################################
## <summary>
##	Execute TEMPLATE in the authconfig domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`authconfig_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `authconfig_domtrans'($*)) dnl
	
	gen_require(`
		type authconfig_t, authconfig_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, authconfig_exec_t, authconfig_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `authconfig_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search authconfig lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`authconfig_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `authconfig_search_lib'($*)) dnl
	
	gen_require(`
		type authconfig_var_lib_t;
	')

	allow $1 authconfig_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `authconfig_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read authconfig lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`authconfig_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `authconfig_read_lib_files'($*)) dnl
	
	gen_require(`
		type authconfig_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, authconfig_var_lib_t, authconfig_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `authconfig_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage authconfig lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`authconfig_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `authconfig_manage_lib_files'($*)) dnl
	
	gen_require(`
		type authconfig_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, authconfig_var_lib_t, authconfig_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `authconfig_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage authconfig lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`authconfig_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `authconfig_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type authconfig_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, authconfig_var_lib_t, authconfig_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `authconfig_manage_lib_dirs'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an authconfig environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`authconfig_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `authconfig_admin'($*)) dnl
	
	gen_require(`
		type authconfig_t;
		type authconfig_var_lib_t;
	')

	allow $1 authconfig_t:process { ptrace signal_perms };
	ps_process_pattern($1, authconfig_t)

	files_search_var_lib($1)
	admin_pattern($1, authconfig_var_lib_t)

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `authconfig_admin'($*)) dnl
	')

## <summary>Filesystem automounter service.</summary>

########################################
## <summary>
##	Execute automount in the automount domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`automount_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_domtrans'($*)) dnl
	
	gen_require(`
		type automount_t, automount_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, automount_exec_t, automount_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to automount.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`automount_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_signal'($*)) dnl
	
	gen_require(`
		type automount_t;
	')

	allow $1 automount_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_signal'($*)) dnl
	')


########################################
## <summary>
##	Execute automount in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`automount_exec_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_exec_config'($*)) dnl
	
	refpolicywarn(`$0(): has been deprecated, please use files_exec_etc_files() instead.')
	files_exec_etc_files($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_exec_config'($*)) dnl
	')


########################################
## <summary>
##	Read automount process state.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to allow access.
##	</summary>
## </param>
#
 	 	define(`automount_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_read_state'($*)) dnl
	
	gen_require(`
		type automount_t;
	')

	kernel_search_proc($1)
	allow $1 automount_t:dir list_dir_perms;
	read_files_pattern($1, automount_t, automount_t)
	read_lnk_files_pattern($1, automount_t, automount_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_read_state'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to use
##	automount file descriptors.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`automount_dontaudit_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_dontaudit_use_fds'($*)) dnl
	
	gen_require(`
		type automount_t;
	')

	dontaudit $1 automount_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_dontaudit_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Write to a automount unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`automount_write_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_write_pipes'($*)) dnl
	
	gen_require(`
		type automount_t;
	')

	allow $1 automount_t:fd use;
	allow $1 automount_t:fifo_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_write_pipes'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to write
##	automount unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`automount_dontaudit_write_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_dontaudit_write_pipes'($*)) dnl
	
	gen_require(`
		type automount_t;
	')

	dontaudit $1 automount_t:fifo_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_dontaudit_write_pipes'($*)) dnl
	')


########################################
## <summary>
##	Allow domain to search of automount temporary
##	directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`automount_search_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_search_tmp_dirs'($*)) dnl
	
	gen_require(`
		type automount_tmp_t;
	')
    
    search_dirs_pattern($1, automount_tmp_t, automount_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_search_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to get
##	attributes of automount temporary
##	directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`automount_dontaudit_getattr_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_dontaudit_getattr_tmp_dirs'($*)) dnl
	
	gen_require(`
		type automount_tmp_t;
	')

	dontaudit $1 automount_tmp_t:dir getattr_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_dontaudit_getattr_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##	Execute automount server in the automount domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`automount_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_systemctl'($*)) dnl
	
	gen_require(`
		type automount_t;
		type automount_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 automount_unit_file_t:file read_file_perms;
	allow $1 automount_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, automount_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an automount environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`automount_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `automount_admin'($*)) dnl
	
	gen_require(`
		type automount_t, automount_lock_t, automount_tmp_t;
		type automount_var_run_t, automount_initrc_exec_t;
		type automount_unit_file_t, automount_keytab_t;
	')

	allow $1 automount_t:process signal_perms;
	ps_process_pattern($1, automount_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 automount_t:process ptrace;
	')

	init_labeled_script_domtrans($1, automount_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 automount_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, automount_keytab_t)

	files_list_var($1)
	admin_pattern($1, automount_lock_t)

	files_list_tmp($1)
	admin_pattern($1, automount_tmp_t)

	files_list_pids($1)
	admin_pattern($1, automount_var_run_t)

	automount_systemctl($1)
	admin_pattern($1, automount_unit_file_t)
	allow $1 automount_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `automount_admin'($*)) dnl
	')

## <summary>mDNS/DNS-SD daemon implementing Apple ZeroConf architecture.</summary>

########################################
## <summary>
##	Execute avahi server in the avahi domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`avahi_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_domtrans'($*)) dnl
	
	gen_require(`
		type avahi_exec_t, avahi_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, avahi_exec_t, avahi_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute avahi init scripts in the
##	init script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`avahi_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type avahi_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, avahi_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to avahi.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_signal'($*)) dnl
	
	gen_require(`
		type avahi_t;
	')

	allow $1 avahi_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_signal'($*)) dnl
	')


########################################
## <summary>
##	Send kill signals to avahi.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_kill',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_kill'($*)) dnl
	
	gen_require(`
		type avahi_t;
	')

	allow $1 avahi_t:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_kill'($*)) dnl
	')


########################################
## <summary>
##	Send null signals to avahi.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_signull'($*)) dnl
	
	gen_require(`
		type avahi_t;
	')

	allow $1 avahi_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_signull'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	avahi over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_dbus_chat'($*)) dnl
	
	gen_require(`
		type avahi_t;
		class dbus send_msg;
	')

	allow $1 avahi_t:dbus send_msg;
	allow avahi_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Connect to avahi using a unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_stream_connect'($*)) dnl
	
	gen_require(`
		type avahi_t, avahi_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, avahi_var_run_t, avahi_var_run_t, avahi_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Create avahi pid directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_create_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_create_pid_dirs'($*)) dnl
	
	gen_require(`
		type avahi_var_run_t;
	')

	files_search_pids($1)
	allow $1 avahi_var_run_t:dir create_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_create_pid_dirs'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of avahi pid directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_setattr_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_setattr_pid_dirs'($*)) dnl
	
	gen_require(`
		type avahi_var_run_t;
	')

	files_search_pids($1)
	allow $1 avahi_var_run_t:dir setattr_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_setattr_pid_dirs'($*)) dnl
	')


########################################
## <summary>
##	Create, read, and write avahi pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`avahi_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_manage_pid_files'($*)) dnl
	
	gen_require(`
		type avahi_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, avahi_var_run_t, avahi_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to search
##	avahi pid directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`avahi_dontaudit_search_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_dontaudit_search_pid'($*)) dnl
	
	gen_require(`
		type avahi_var_run_t;
	')

	dontaudit $1 avahi_var_run_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_dontaudit_search_pid'($*)) dnl
	')


########################################
## <summary>
##	Execute avahi server in the avahi domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`avahi_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_systemctl'($*)) dnl
	
	gen_require(`
		type avahi_t;
		type avahi_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 avahi_unit_file_t:file read_file_perms;
	allow $1 avahi_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, avahi_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Create specified objects in generic
##	pid directories with the avahi pid file type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	Class of the object being created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`avahi_filetrans_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_filetrans_pid'($*)) dnl
	
	gen_require(`
		type avahi_var_run_t;
	')

	files_pid_filetrans($1, avahi_var_run_t, $2, $3)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_filetrans_pid'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an avahi environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`avahi_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `avahi_admin'($*)) dnl
	
	gen_require(`
		type avahi_t, avahi_var_run_t, avahi_initrc_exec_t;
		type avahi_unit_file_t;
		type avahi_var_lib_t;
	')

	allow $1 avahi_t:process signal_perms;
	ps_process_pattern($1, avahi_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 avahi_t:process ptrace;
	')

	avahi_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 avahi_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, avahi_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, avahi_var_lib_t)

	avahi_systemctl($1)
	admin_pattern($1, avahi_unit_file_t)
	allow $1 avahi_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `avahi_admin'($*)) dnl
	')

## <summary>Log file analyzer for advanced statistics.</summary>

########################################
## <summary>
##	Execute the awstats program in
##	the awstats domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`awstats_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `awstats_domtrans'($*)) dnl
	
	gen_require(`
		type awstats_t, awstats_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, awstats_exec_t, awstats_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `awstats_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read and write awstats unnamed pipes. (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`awstats_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `awstats_rw_pipes'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `awstats_rw_pipes'($*)) dnl
	')


########################################
## <summary>
##	Execute the awstats scripts in the awstats scripts domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`awstats_domtrans_script',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `awstats_domtrans_script'($*)) dnl
	
	gen_require(`
		type awstats_script_t, awstats_script_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, awstats_script_exec_t, awstats_script_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `awstats_domtrans_script'($*)) dnl
	')


########################################
## <summary>
##	Execute awstats cgi scripts in the caller domain. (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`awstats_cgi_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `awstats_cgi_exec'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `awstats_cgi_exec'($*)) dnl
	')

## <summary>System backup scripts.</summary>

########################################
## <summary>
##	Execute backup in the backup domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`backup_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `backup_domtrans'($*)) dnl
	
	gen_require(`
		type backup_t, backup_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, backup_exec_t, backup_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `backup_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute backup in the backup
##	domain, and allow the specified
##	role the backup domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`backup_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `backup_run'($*)) dnl
	
	gen_require(`
		attribute_role backup_roles;
	')

	backup_domtrans($1)
	roleattribute $2 backup_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `backup_run'($*)) dnl
	')


########################################
## <summary>
##	Create, read, and write backup
##	store files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`backup_manage_store_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `backup_manage_store_files'($*)) dnl
	
	gen_require(`
		type backup_store_t;
	')

	files_search_var($1)
	manage_files_pattern($1, backup_store_t, backup_store_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `backup_manage_store_files'($*)) dnl
	')

## <summary>Cross platform network backup.</summary>

########################################
## <summary>
##	Execute bacula admin bacula
##	admin domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bacula_domtrans_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bacula_domtrans_admin'($*)) dnl
	
	gen_require(`
		type bacula_admin_t, bacula_admin_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, bacula_admin_exec_t, bacula_admin_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bacula_domtrans_admin'($*)) dnl
	')


########################################
## <summary>
##	Execute user interfaces in the
##	bacula admin domain, and allow the
##	specified role the bacula admin domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bacula_run_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bacula_run_admin'($*)) dnl
	
	gen_require(`
		attribute_role bacula_admin_roles;
	')

	bacula_domtrans_admin($1)
	roleattribute $2 bacula_admin_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bacula_run_admin'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an bacula environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bacula_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bacula_admin'($*)) dnl
	
	gen_require(`
		type bacula_t, bacula_etc_t, bacula_log_t;
		type bacula_spool_t, bacula_var_lib_t;
		type bacula_var_run_t, bacula_initrc_exec_t;
        attribute_role bacula_admin_roles;
	')

	allow $1 bacula_t:process { ptrace signal_perms };
	ps_process_pattern($1, bacula_t)

	init_labeled_script_domtrans($1, bacula_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 bacula_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, bacula_etc_t)

	logging_search_logs($1)
	admin_pattern($1, bacula_log_t)

	files_search_var($1)
	admin_pattern($1, bacula_spool_t)

	files_search_var_lib($1)
	admin_pattern($1, bacula_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, bacula_var_run_t)

	bacula_run_admin($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bacula_admin'($*)) dnl
	')

## <summary>configuration management suite.</summary>

########################################
## <summary>
##	Execute bcfg2 in the bcfg2 domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`bcfg2_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_domtrans'($*)) dnl
	
	gen_require(`
		type bcfg2_t, bcfg2_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, bcfg2_exec_t, bcfg2_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute bcfg2 server in the bcfg2 domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bcfg2_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type bcfg2_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, bcfg2_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search bcfg2 lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bcfg2_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_search_lib'($*)) dnl
	
	gen_require(`
		type bcfg2_var_lib_t;
	')

	allow $1 bcfg2_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read bcfg2 lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bcfg2_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_read_lib_files'($*)) dnl
	
	gen_require(`
		type bcfg2_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, bcfg2_var_lib_t, bcfg2_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	bcfg2 lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bcfg2_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_manage_lib_files'($*)) dnl
	
	gen_require(`
		type bcfg2_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, bcfg2_var_lib_t, bcfg2_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	bcfg2 lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bcfg2_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type bcfg2_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, bcfg2_var_lib_t, bcfg2_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Execute bcfg2 server in the bcfg2 domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bcfg2_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_systemctl'($*)) dnl
	
	gen_require(`
		type bcfg2_t;
		type bcfg2_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	systemd_read_fifo_file_passwd_run($1)
	allow $1 bcfg2_unit_file_t:file read_file_perms;
	allow $1 bcfg2_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, bcfg2_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_systemctl'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to
##	administrate an bcfg2 environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bcfg2_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bcfg2_admin'($*)) dnl
	
	gen_require(`
		type bcfg2_t, bcfg2_initrc_exec_t, bcfg2_var_lib_t;
		type bcfg2_var_run_t;
		type bcfg2_unit_file_t;
	')

	allow $1 bcfg2_t:process { signal_perms };
	ps_process_pattern($1, bcfg2_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 bcfg2_t:process ptrace;
    ')

	bcfg2_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 bcfg2_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, bcfg2_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, bcfg2_var_lib_t)

	bcfg2_systemctl($1)
	admin_pattern($1, bcfg2_unit_file_t)
	allow $1 bcfg2_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bcfg2_admin'($*)) dnl
	')

## <summary>Berkeley Internet name domain DNS server.</summary>

########################################
## <summary>
##	Execute bind server in the bind domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bind_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type named_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, named_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute bind server in the bind domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bind_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_systemctl'($*)) dnl
	
	gen_require(`
		type named_unit_file_t;
		type named_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 named_unit_file_t:file read_file_perms;
	allow $1 named_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, named_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Execute ndc in the ndc domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bind_domtrans_ndc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_domtrans_ndc'($*)) dnl
	
	gen_require(`
		type ndc_t, ndc_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ndc_exec_t, ndc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_domtrans_ndc'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to bind.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_signal'($*)) dnl
	
	gen_require(`
		type named_t;
	')

	allow $1 named_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_signal'($*)) dnl
	')


########################################
## <summary>
##	Send null signals to bind.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_signull'($*)) dnl
	
	gen_require(`
		type named_t;
	')

	allow $1 named_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_signull'($*)) dnl
	')


########################################
## <summary>
##	Send kill signals to bind.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_kill',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_kill'($*)) dnl
	
	gen_require(`
		type named_t;
	')

	allow $1 named_t:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_kill'($*)) dnl
	')


########################################
## <summary>
##	Execute ndc in the ndc domain, and
##	allow the specified role the ndc domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bind_run_ndc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_run_ndc'($*)) dnl
	
	gen_require(`
		attribute_role ndc_roles;
	')

	bind_domtrans_ndc($1)
	roleattribute $2 ndc_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_run_ndc'($*)) dnl
	')


########################################
## <summary>
##	Execute bind in the named domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bind_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_domtrans'($*)) dnl
	
	gen_require(`
		type named_t, named_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, named_exec_t, named_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read dnssec key files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_dnssec_keys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_dnssec_keys'($*)) dnl
	
	gen_require(`
		type named_conf_t, named_zone_t, dnssec_t;
	')

	read_files_pattern($1, { named_conf_t named_zone_t }, dnssec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_dnssec_keys'($*)) dnl
	')


########################################
## <summary>
##	Mmap dnssec key files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_map_dnssec_keys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_map_dnssec_keys'($*)) dnl
	
	gen_require(`
		type named_conf_t, named_zone_t, dnssec_t;
	')

	allow $1 dnssec_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_map_dnssec_keys'($*)) dnl
	')


########################################
## <summary>
##	Read bind named configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_config'($*)) dnl
	
	gen_require(`
		type named_conf_t;
	')

	allow $1 named_conf_t:dir  list_dir_perms;
	read_files_pattern($1, named_conf_t, named_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_config'($*)) dnl
	')


########################################
## <summary>
##	Write bind named configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_write_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_write_config'($*)) dnl
	
	gen_require(`
		type named_conf_t;
	')

	write_files_pattern($1, named_conf_t, named_conf_t)
	allow $1 named_conf_t:file setattr_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_write_config'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	bind configuration directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_manage_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_manage_config_dirs'($*)) dnl
	
	gen_require(`
		type named_conf_t;
	')

	manage_dirs_pattern($1, named_conf_t, named_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_manage_config_dirs'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	BIND configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_manage_config'($*)) dnl
	
	gen_require(`
		type named_conf_t;
	')

	manage_files_pattern($1, named_conf_t, named_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_manage_config'($*)) dnl
	')


########################################
## <summary>
##	Search bind cache directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_search_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_search_cache'($*)) dnl
	
	gen_require(`
		type named_conf_t, named_cache_t, named_zone_t;
	')

	files_search_var($1)
	allow $1 named_conf_t:dir search_dir_perms;
	allow $1 named_zone_t:dir search_dir_perms;
	allow $1 named_cache_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_search_cache'($*)) dnl
	')


########################################
## <summary>
##	Read bind cache files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_cache'($*)) dnl
	
	gen_require(`
		type named_cache_t;
	')

	files_search_var($1)
	allow $1 named_cache_t:dir list_dir_perms;
	read_files_pattern($1, named_cache_t, named_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_cache'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	and write Bind cache files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_rw_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_rw_cache'($*)) dnl
	
	gen_require(`
		type named_cache_t;
	')

	allow $1 named_cache_t:dir list_dir_perms;
	allow $1 named_cache_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_rw_cache'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	bind cache files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_manage_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_manage_cache'($*)) dnl
	
	gen_require(`
		type named_cache_t, named_zone_t;
	')

	files_search_var($1)
	allow $1 named_zone_t:dir search_dir_perms;
	manage_files_pattern($1, named_cache_t, named_cache_t)
	manage_lnk_files_pattern($1, named_cache_t, named_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_manage_cache'($*)) dnl
	')


########################################
## <summary>
##	Read bind pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_pid_files'($*)) dnl
	
	gen_require(`
		type named_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, named_var_run_t, named_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of bind pid directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_setattr_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_setattr_pid_dirs'($*)) dnl
	
	gen_require(`
		type named_var_run_t;
	')

	allow $1 named_var_run_t:dir setattr_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_setattr_pid_dirs'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of bind zone directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_setattr_zone_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_setattr_zone_dirs'($*)) dnl
	
	gen_require(`
		type named_zone_t;
	')

	allow $1 named_zone_t:dir setattr_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_setattr_zone_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read bind zone files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_zone',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_zone'($*)) dnl
	
	gen_require(`
		type named_zone_t;
	')

	files_search_var($1)
	read_files_pattern($1, named_zone_t, named_zone_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_zone'($*)) dnl
	')


########################################
## <summary>
##	Read BIND zone files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_log'($*)) dnl
	
	gen_require(`
		type named_zone_t;
		type named_log_t;
	')

	files_search_var($1)
	allow $1 named_zone_t:dir search_dir_perms;
	read_files_pattern($1, named_log_t, named_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_log'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	bind zone files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_manage_zone_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_manage_zone_dirs'($*)) dnl
	
	gen_require(`
		type named_zone_t;
	')

	files_search_var($1)
	allow $1  named_zone_t:dir manage_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_manage_zone_dirs'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	bind zone files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_manage_zone',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_manage_zone'($*)) dnl
	
	gen_require(`
		type named_zone_t;
	')

	files_search_var($1)
	manage_files_pattern($1, named_zone_t, named_zone_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_manage_zone'($*)) dnl
	')


########################################
## <summary>
##	Send and receive datagrams to and from named.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_udp_chat_named',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_udp_chat_named'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_udp_chat_named'($*)) dnl
	')


########################################
## <summary>
##	Allow the domain to read bind state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_read_state'($*)) dnl
	
	gen_require(`
		type named_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, named_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_read_state'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an bind environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bind_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_admin'($*)) dnl
	
	gen_require(`
		type named_t, named_tmp_t, named_log_t;
		type named_cache_t, named_zone_t, named_initrc_exec_t;
		type dnssec_t, ndc_t, named_conf_t, named_var_run_t;
		type named_keytab_t, named_unit_file_t;
	')

	allow $1 named_t:process signal_perms;
	ps_process_pattern($1, named_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 named_t:process ptrace;
	')

	bind_run_ndc($1, $2)

	init_labeled_script_domtrans($1, named_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 named_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_tmp($1)
	admin_pattern($1, named_tmp_t)

	logging_list_logs($1)
	admin_pattern($1, named_log_t)

	files_list_etc($1)
	admin_pattern($1, { named_keytab_t named_conf_t })

	admin_pattern($1, named_keytab_t)

	files_list_var($1)
	admin_pattern($1, { dnssec_t named_cache_t named_zone_t })

	files_list_pids($1)
	admin_pattern($1, named_var_run_t)

	admin_pattern($1, named_unit_file_t)
	bind_systemctl($1)
	allow $1 named_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_admin'($*)) dnl
	')


######################################
## <summary>
##	Execute bind in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_exec'($*)) dnl
	
	gen_require(`
		type named_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, named_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_exec'($*)) dnl
	')


######################################
## <summary>
##	Execute named-checkconf in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bind_exec_named_checkconf',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bind_exec_named_checkconf'($*)) dnl
	
	gen_require(`
		type named_exec_named_checkconf_t;
	')

	corecmd_search_bin($1)
	can_exec($1, named_exec_named_checkconf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bind_exec_named_checkconf'($*)) dnl
	')

## <summary>BIRD Internet Routing Daemon.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an bird environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bird_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bird_admin'($*)) dnl
	
	gen_require(`
		type bird_t, bird_etc_t, bird_log_t;
		type bird_var_run_t, bird_initrc_exec_t;
	')

	allow $1 bird_t:process { ptrace signal_perms };
	ps_process_pattern($1, bird_t)

	init_labeled_script_domtrans($1, bird_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 bird_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, bird_etc_t)

	logging_list_logs($1)
	admin_pattern($1, bird_log_t)

	files_list_pids($1)
	admin_pattern($1, bird_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bird_admin'($*)) dnl
	')

## <summary>Tunnels instant messaging traffic to a virtual IRC channel.</summary>

########################################
## <summary>
##	Read bitlbee configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bitlbee_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bitlbee_read_config'($*)) dnl
	
	gen_require(`
		type bitlbee_conf_t;
	')

	files_search_etc($1)
	allow $1 bitlbee_conf_t:dir list_dir_perms;
	allow $1 bitlbee_conf_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bitlbee_read_config'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an bitlbee environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bitlbee_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bitlbee_admin'($*)) dnl
	
	gen_require(`
		type bitlbee_t, bitlbee_conf_t, bitlbee_var_t;
		type bitlbee_initrc_exec_t, bitlbee_var_run_t;
		type bitlbee_log_t, bitlbee_tmp_t;
	')

	allow $1 bitlbee_t:process signal_perms;
	ps_process_pattern($1, bitlbee_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 bitlbee_t:process ptrace;
	')

	init_labeled_script_domtrans($1, bitlbee_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 bitlbee_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, bitlbee_conf_t)

	logging_search_logs($1)
	admin_pattern($1, bitlbee_log_t)

	files_search_tmp($1)
	admin_pattern($1, bitlbee_tmp_t)

	files_search_pids($1)
	admin_pattern($1, bitlbee_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, bitlbee_var_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bitlbee_admin'($*)) dnl
	')


## <summary>The blkmapd daemon performs device discovery and mapping for pNFS block layout client.</summary>

########################################
## <summary>
##	Execute blkmapd_exec_t in the blkmapd domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`blkmapd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blkmapd_domtrans'($*)) dnl
	
	gen_require(`
		type blkmapd_t, blkmapd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, blkmapd_exec_t, blkmapd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blkmapd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute blkmapd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blkmapd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blkmapd_exec'($*)) dnl
	
	gen_require(`
		type blkmapd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, blkmapd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blkmapd_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute blkmapd server in the blkmapd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blkmapd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blkmapd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type blkmapd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, blkmapd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blkmapd_initrc_domtrans'($*)) dnl
	')

########################################
## <summary>
##	Read blkmapd PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blkmapd_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blkmapd_read_pid_files'($*)) dnl
	
	gen_require(`
		type blkmapd_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, blkmapd_var_run_t, blkmapd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blkmapd_read_pid_files'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an blkmapd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`blkmapd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blkmapd_admin'($*)) dnl
	
	gen_require(`
		type blkmapd_t;
		type blkmapd_initrc_exec_t;
		type blkmapd_var_run_t;
	')

	allow $1 blkmapd_t:process { signal_perms };
	ps_process_pattern($1, blkmapd_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 blkmapd_t:process ptrace;
    ')

	blkmapd_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 blkmapd_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, blkmapd_var_run_t)
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blkmapd_admin'($*)) dnl
	')

## <summary>Tool to manage Bluetooth devices.</summary>

########################################
## <summary>
##	Execute blueman in the blueman domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`blueman_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blueman_domtrans'($*)) dnl
	
	gen_require(`
		type blueman_t, blueman_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, blueman_exec_t, blueman_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blueman_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	blueman over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blueman_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blueman_dbus_chat'($*)) dnl
	
	gen_require(`
		type blueman_t;
		class dbus send_msg;
	')

	allow $1 blueman_t:dbus send_msg;
	allow blueman_t $1:dbus send_msg;
	ps_process_pattern(blueman_t, $1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blueman_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Search blueman lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blueman_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blueman_search_lib'($*)) dnl
	
	gen_require(`
		type blueman_var_lib_t;
	')

	allow $1 blueman_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blueman_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read blueman lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blueman_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blueman_read_lib_files'($*)) dnl
	
	gen_require(`
		type blueman_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, blueman_var_lib_t, blueman_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blueman_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	blueman lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`blueman_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `blueman_manage_lib_files'($*)) dnl
	
	gen_require(`
		type blueman_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, blueman_var_lib_t, blueman_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `blueman_manage_lib_files'($*)) dnl
	')

## <summary>Bluetooth tools and system services.</summary>

########################################
## <summary>
##	Role access for bluetooth.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`bluetooth_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_role'($*)) dnl
	
	gen_require(`
		attribute_role bluetooth_helper_roles;
		type bluetooth_t, bluetooth_helper_t, bluetooth_helper_exec_t;
		type bluetooth_helper_tmp_t, bluetooth_helper_tmpfs_t, bluetooth_var_run_t;
	')

	########################################
	#
	# Declarations
	#

	roleattribute $1 bluetooth_helper_roles;

	########################################
	#
	# Policy
	#

	domtrans_pattern($2, bluetooth_helper_exec_t, bluetooth_helper_t)

	ps_process_pattern($2, bluetooth_helper_t)

	allow $2 bluetooth_helper_t:process signal_perms;

	tunable_policy(`deny_ptrace',`',`
		allow $2 bluetooth_helper_t:process ptrace;
	')

	allow $2 bluetooth_t:socket rw_socket_perms;

	allow $2 { bluetooth_helper_tmp_t bluetooth_helper_tmpfs_t }:dir { manage_dir_perms relabel_dir_perms };
	allow $2 { bluetooth_helper_tmp_t bluetooth_helper_tmpfs_t }:file { manage_file_perms relabel_file_perms };
	allow $2 bluetooth_helper_tmp_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };

	manage_dirs_pattern($2, bluetooth_helper_tmpfs_t, bluetooth_helper_tmpfs_t)
	manage_files_pattern($2, bluetooth_helper_tmpfs_t, bluetooth_helper_tmpfs_t)
	bluetooth_stream_connect($2)
	stream_connect_pattern($2, bluetooth_var_run_t, bluetooth_var_run_t, bluetooth_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_role'($*)) dnl
	')


#####################################
## <summary>
##	Connect to bluetooth over a unix domain
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bluetooth_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_stream_connect'($*)) dnl
	
	gen_require(`
		type bluetooth_t, bluetooth_var_run_t;
		type bluetooth_tmp_t;
	')

	files_search_pids($1)
	allow $1 bluetooth_t:socket rw_socket_perms;
	stream_connect_pattern($1, bluetooth_var_run_t, bluetooth_var_run_t, bluetooth_t)
	stream_connect_pattern($1, bluetooth_tmp_t, bluetooth_tmp_t, bluetooth_t)

    tunable_policy(`deny_bluetooth',`',`
	    allow $1 bluetooth_t:bluetooth_socket rw_socket_perms;
    ')


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Allow read and write bluetooth domain stream.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bluetooth_rw_stream',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_rw_stream'($*)) dnl
	
	gen_require(`
		type bluetooth_t;
	')

	tunable_policy(`deny_bluetooth',`',`
		allow $1 bluetooth_t:unix_stream_socket { read write };
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_rw_stream'($*)) dnl
	')


########################################
## <summary>
##	Execute bluetooth in the bluetooth domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bluetooth_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_domtrans'($*)) dnl
	
	gen_require(`
		type bluetooth_t, bluetooth_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, bluetooth_exec_t, bluetooth_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read bluetooth configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bluetooth_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_read_config'($*)) dnl
	
	gen_require(`
		type bluetooth_conf_t;
	')

	allow $1 bluetooth_conf_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_read_config'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	bluetooth over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bluetooth_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_dbus_chat'($*)) dnl
	
	gen_require(`
		type bluetooth_t;
		class dbus send_msg;
	')

	allow $1 bluetooth_t:dbus send_msg;
	allow bluetooth_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	dontaudit Send and receive messages from
##	bluetooth over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`bluetooth_dontaudit_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_dontaudit_dbus_chat'($*)) dnl
	
	gen_require(`
		type bluetooth_t;
		class dbus send_msg;
	')

	dontaudit $1 bluetooth_t:dbus send_msg;
	dontaudit bluetooth_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_dontaudit_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Execute bluetooth_helper in the bluetooth_helper domain.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bluetooth_domtrans_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_domtrans_helper'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_domtrans_helper'($*)) dnl
	')


########################################
## <summary>
##	Execute bluetooth_helper in the bluetooth_helper domain, and
##	allow the specified role the bluetooth_helper domain.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="terminal">
##	<summary>
##	The type of the terminal allow the bluetooth_helper domain to use.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bluetooth_run_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_run_helper'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_run_helper'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read
##	bluetooth process state files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`bluetooth_dontaudit_read_helper_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_dontaudit_read_helper_state'($*)) dnl
	
	gen_require(`
		type bluetooth_helper_t;
	')

	dontaudit $1 bluetooth_helper_t:dir search_dir_perms;
	dontaudit $1 bluetooth_helper_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_dontaudit_read_helper_state'($*)) dnl
	')


########################################
## <summary>
##	Execute bluetooth server in the bluetooth domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bluetooth_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_systemctl'($*)) dnl
	
	gen_require(`
		type bluetooth_t;
		type bluetooth_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 bluetooth_unit_file_t:file read_file_perms;
	allow $1 bluetooth_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, bluetooth_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an bluetooth environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bluetooth_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bluetooth_admin'($*)) dnl
	
	gen_require(`
		type bluetooth_t, bluetooth_tmp_t, bluetooth_lock_t;
		type bluetooth_var_lib_t, bluetooth_var_run_t;
		type bluetooth_conf_t, bluetooth_conf_rw_t, bluetooth_var_lib_t;
		type bluetooth_unit_file_t, bluetooth_initrc_exec_t;
	')

	allow $1 bluetooth_t:process signal_perms;
	ps_process_pattern($1, bluetooth_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 bluetooth_t:process ptrace;
	')

	init_labeled_script_domtrans($1, bluetooth_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 bluetooth_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_tmp($1)
	admin_pattern($1, bluetooth_tmp_t)

	files_list_var($1)
	admin_pattern($1, bluetooth_lock_t)

	files_list_etc($1)
	admin_pattern($1, { bluetooth_conf_t bluetooth_conf_rw_t })

	files_list_var_lib($1)
	admin_pattern($1, bluetooth_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, bluetooth_var_run_t)

	bluetooth_systemctl($1)
	admin_pattern($1, bluetooth_unit_file_t)
	allow $1 bluetooth_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bluetooth_admin'($*)) dnl
	')

## <summary>policy for boinc</summary>

########################################
## <summary>
##	Execute a domain transition to run boinc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`boinc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_domtrans'($*)) dnl
	
	gen_require(`
		type boinc_t, boinc_exec_t;
	')

	domtrans_pattern($1, boinc_exec_t, boinc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_domtrans'($*)) dnl
	')


#######################################
## <summary>
##	Execute boinc server in the boinc domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boinc_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type boinc_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, boinc_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_initrc_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Dontaudit getattr on boinc lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`boinc_dontaudit_getattr_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_dontaudit_getattr_lib'($*)) dnl
	
    gen_require(`
        type boinc_var_lib_t;
    ')

    dontaudit $1 boinc_var_lib_t:file getattr;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_dontaudit_getattr_lib'($*)) dnl
	')


########################################
## <summary>
##	Search boinc lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boinc_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_search_lib'($*)) dnl
	
	gen_require(`
		type boinc_var_lib_t;
	')

	allow $1 boinc_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read boinc lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boinc_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_read_lib_files'($*)) dnl
	
	gen_require(`
		type boinc_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, boinc_var_lib_t, boinc_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	boinc lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boinc_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_manage_lib_files'($*)) dnl
	
	gen_require(`
		type boinc_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, boinc_var_lib_t, boinc_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage boinc var_lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boinc_manage_var_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_manage_var_lib'($*)) dnl
	
	gen_require(`
		type boinc_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, boinc_var_lib_t, boinc_var_lib_t)
	manage_files_pattern($1, boinc_var_lib_t, boinc_var_lib_t)
	manage_lnk_files_pattern($1, boinc_var_lib_t, boinc_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_manage_var_lib'($*)) dnl
	')


#######################################
## <summary>
##  Execute boinc server in the boinc domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`boinc_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_systemctl'($*)) dnl
	
    gen_require(`
        type boinc_t;
        type boinc_unit_file_t;
    ')

    systemd_exec_systemctl($1)
	init_reload_services($1)
    allow $1 boinc_unit_file_t:file read_file_perms;
    allow $1 boinc_unit_file_t:service manage_service_perms;

    ps_process_pattern($1, boinc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an boinc environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`boinc_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boinc_admin'($*)) dnl
	
	gen_require(`
		type boinc_t, boinc_initrc_exec_t, boinc_var_lib_t;
		type boinc_unit_file_t;
	')

	allow $1 boinc_t:process signal_perms;
	ps_process_pattern($1, boinc_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 boinc_t:process ptrace;
	')

	boinc_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 boinc_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_var_lib($1)
	admin_pattern($1, boinc_var_lib_t)

	boinc_systemctl($1)
	admin_pattern($1, boinc_unit_file_t)

	allow $1 boinc_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boinc_admin'($*)) dnl
	')


## <summary>policy for boltd</summary>

########################################
## <summary>
##	Execute boltd_exec_t in the boltd domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`boltd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_domtrans'($*)) dnl
	
	gen_require(`
		type boltd_t, boltd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, boltd_exec_t, boltd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute boltd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_exec'($*)) dnl
	
	gen_require(`
		type boltd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, boltd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_exec'($*)) dnl
	')


########################################
## <summary>
##	Search boltd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_search_lib'($*)) dnl
	
	gen_require(`
		type boltd_var_lib_t;
	')

	allow $1 boltd_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read boltd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_read_lib_files'($*)) dnl
	
	gen_require(`
		type boltd_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, boltd_var_lib_t, boltd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage boltd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_manage_lib_files'($*)) dnl
	
	gen_require(`
		type boltd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, boltd_var_lib_t, boltd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage boltd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type boltd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, boltd_var_lib_t, boltd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_manage_lib_dirs'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an boltd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`boltd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_admin'($*)) dnl
	
	gen_require(`
		type boltd_t;
		type boltd_var_lib_t;
	')

	allow $1 boltd_t:process { signal_perms };
	ps_process_pattern($1, boltd_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 boltd_t:process ptrace;
    ')

	files_search_var_lib($1)
	admin_pattern($1, boltd_var_lib_t)
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_admin'($*)) dnl
	')



########################################

## <summary>
##	Mounton boltd lib  directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_mounton_var_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_mounton_var_lib'($*)) dnl
	
	gen_require(`
		type boltd_var_lib_t;
	')

	allow $1 boltd_var_lib_t:dir mounton;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_mounton_var_lib'($*)) dnl
	')


########################################

## <summary>
##	Mounton boltd var_run  directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_mounton_var_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_mounton_var_run'($*)) dnl
	
	gen_require(`
		type boltd_var_run_t;
	')

	allow $1 boltd_var_run_t:dir mounton;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_mounton_var_run'($*)) dnl
	')


######################################
## <summary>
##	Write to boltd named pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_write_var_run_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_write_var_run_pipes'($*)) dnl
	
	gen_require(`
		type boltd_var_run_t;
	')

	allow $1 boltd_var_run_t:fd use;
	allow $1 boltd_var_run_t:fifo_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_write_var_run_pipes'($*)) dnl
	')


########################################
## <summary>
##	Send messages to boltd over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boltd_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boltd_dbus_chat'($*)) dnl
	
	gen_require(`
		type boltd_t;
		class dbus send_msg;
	')

	allow $1 boltd_t:dbus send_msg;
	allow boltd_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boltd_dbus_chat'($*)) dnl
	')

## <summary>policy for boothd</summary>

########################################
## <summary>
##	Execute boothd_exec_t in the boothd domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`boothd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boothd_domtrans'($*)) dnl
	
	gen_require(`
		type boothd_t, boothd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, boothd_exec_t, boothd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boothd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute boothd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`boothd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `boothd_exec'($*)) dnl
	
	gen_require(`
		type boothd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, boothd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `boothd_exec'($*)) dnl
	')

## <summary>policy for bootupd</summary>

########################################
## <summary>
##	Execute bootupd_exec_t in the bootupd domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`bootupd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootupd_domtrans'($*)) dnl
	
	gen_require(`
		type bootupd_t, bootupd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, bootupd_exec_t, bootupd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootupd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute bootupd in the caller domain.
## </summary>
## <param name="domain">
##    <summary>
##	Domain allowed access.
##    </summary>
## </param>
#
 	 	define(`bootupd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bootupd_exec'($*)) dnl
	
	gen_require(`
		type bootupd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, bootupd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bootupd_exec'($*)) dnl
	')

## <summary>Utilities for configuring the Linux ethernet bridge.</summary>

########################################
## <summary>
##	Execute a domain transition to run brctl.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`brctl_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `brctl_domtrans'($*)) dnl
	
	gen_require(`
		type brctl_t, brctl_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, brctl_exec_t, brctl_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `brctl_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute brctl in the brctl domain, and
##	allow the specified role the brctl domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`brctl_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `brctl_run'($*)) dnl
	
	gen_require(`
		attribute_role brctl_roles;
	')

	brctl_domtrans($1)
	roleattribute $2 brctl_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `brctl_run'($*)) dnl
	')


## <summary>brltty is refreshable braille display driver for Linux/Unix</summary>

########################################
## <summary>
##	Execute brltty in the brltty domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`brltty_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `brltty_domtrans'($*)) dnl
	
	gen_require(`
		type brltty_t, brltty_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, brltty_exec_t, brltty_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `brltty_domtrans'($*)) dnl
	')

########################################
## <summary>
##	Execute brltty server in the brltty domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`brltty_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `brltty_systemctl'($*)) dnl
	
	gen_require(`
		type brltty_t;
		type brltty_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
    systemd_read_fifo_file_passwd_run($1)
	allow $1 brltty_unit_file_t:file read_file_perms;
	allow $1 brltty_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, brltty_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `brltty_systemctl'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an brltty environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`brltty_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `brltty_admin'($*)) dnl
	
	gen_require(`
		type brltty_t;
	type brltty_unit_file_t;
	')

	allow $1 brltty_t:process { signal_perms };
	ps_process_pattern($1, brltty_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 brltty_t:process ptrace;
    ')

	brltty_systemctl($1)
	admin_pattern($1, brltty_unit_file_t)
	allow $1 brltty_unit_file_t:service all_service_perms;
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `brltty_admin'($*)) dnl
	')

## <summary>Bugtracker.</summary>

########################################
## <summary>
##	Search bugzilla directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bugzilla_search_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bugzilla_search_content'($*)) dnl
	
	gen_require(`
		type bugzilla_content_t;
	')

	allow $1 bugzilla_content_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bugzilla_search_content'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and
##	write bugzilla script unix domain
##	stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`bugzilla_dontaudit_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bugzilla_dontaudit_rw_stream_sockets'($*)) dnl
	
	gen_require(`
		type bugzilla_script_t;
	')

	dontaudit $1 bugzilla_script_t:unix_stream_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bugzilla_dontaudit_rw_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an bugzilla environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bugzilla_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bugzilla_admin'($*)) dnl
	
	gen_require(`
		type bugzilla_script_t, bugzilla_content_t, bugzilla_ra_content_t;
		type bugzilla_rw_content_t, bugzilla_script_exec_t;
		type bugzilla_htaccess_t, bugzilla_tmp_t;
	')

	allow $1 bugzilla_script_t:process signal_perms;
	ps_process_pattern($1, bugzilla_script_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 bugzilla_script_t:process ptrace;
	')

	files_list_tmp($1)
	admin_pattern($1, bugzilla_tmp_t)

	files_list_var_lib(bugzilla_script_t)

	admin_pattern($1, bugzilla_script_exec_t)
	admin_pattern($1, bugzilla_script_t)
	admin_pattern($1, bugzilla_content_t)
	admin_pattern($1, bugzilla_htaccess_t)
	admin_pattern($1, bugzilla_ra_content_t)

	files_search_tmp($1)
	files_search_var_lib($1)
	admin_pattern($1, bugzilla_rw_content_t)

	optional_policy(`
		apache_list_sys_content($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bugzilla_admin'($*)) dnl
	')

## <summary>policy for bumblebee</summary>

########################################
## <summary>
##	Execute bumblebee in the bumblebee domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`bumblebee_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bumblebee_domtrans'($*)) dnl
	
	gen_require(`
		type bumblebee_t, bumblebee_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, bumblebee_exec_t, bumblebee_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bumblebee_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read bumblebee PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bumblebee_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bumblebee_read_pid_files'($*)) dnl
	
	gen_require(`
		type bumblebee_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, bumblebee_var_run_t, bumblebee_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bumblebee_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Execute bumblebee server in the bumblebee domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`bumblebee_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bumblebee_systemctl'($*)) dnl
	
	gen_require(`
		type bumblebee_t;
		type bumblebee_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
    systemd_read_fifo_file_passwd_run($1)
	allow $1 bumblebee_unit_file_t:file read_file_perms;
	allow $1 bumblebee_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, bumblebee_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bumblebee_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Connect to bumblebee over a unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`bumblebee_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bumblebee_stream_connect'($*)) dnl
	
	gen_require(`
		type bumblebee_t, bumblebee_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, bumblebee_var_run_t, bumblebee_var_run_t, bumblebee_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bumblebee_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an bumblebee environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`bumblebee_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `bumblebee_admin'($*)) dnl
	
	gen_require(`
		type bumblebee_t;
		type bumblebee_var_run_t;
		type bumblebee_unit_file_t;
	')

	allow $1 bumblebee_t:process { signal_perms };
	ps_process_pattern($1, bumblebee_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 bumblebee_t:process ptrace;
    ')

	files_search_pids($1)
	admin_pattern($1, bumblebee_var_run_t)

	bumblebee_systemctl($1)
	admin_pattern($1, bumblebee_unit_file_t)
	allow $1 bumblebee_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `bumblebee_admin'($*)) dnl
	')

###############################################################################
#
# Copyright (C) 2006 Red Hat, Inc. All Rights Reserved.
# Written by David Howells (dhowells@redhat.com)
#            Karl MacMillan (kmacmill@redhat.com)
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version
# 2 of the License, or (at your option) any later version.
#
###############################################################################

#
# Define the policy interface for the CacheFiles userspace management daemon.
#
## <summary>policy for cachefilesd</summary>

########################################
## <summary>
##	Execute a domain transition to run cachefilesd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cachefilesd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cachefilesd_domtrans'($*)) dnl
	
	gen_require(`
		type cachefilesd_t, cachefilesd_exec_t;
	')

	domtrans_pattern($1, cachefilesd_exec_t, cachefilesd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cachefilesd_domtrans'($*)) dnl
	')

## <summary>Squid log analysis.</summary>

########################################
## <summary>
##	Execute the calamaris in
##	the calamaris domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`calamaris_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `calamaris_domtrans'($*)) dnl
	
	gen_require(`
		type calamaris_t, calamaris_exec_t;
	')

	files_search_etc($1)
	domtrans_pattern($1, calamaris_exec_t, calamaris_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `calamaris_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute calamaris in the
##	calamaris domain, and allow the
##	specified role the calamaris domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`calamaris_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `calamaris_run'($*)) dnl
	
	gen_require(`
		attribute_role calamaris_roles;
	')

	calamaris_domtrans($1)
	roleattribute $2 calamaris_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `calamaris_run'($*)) dnl
	')


#######################################
## <summary>
##	Read calamaris www files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`calamaris_read_www_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `calamaris_read_www_files'($*)) dnl
	
	gen_require(`
		type calamaris_www_t;
	')

	allow $1 calamaris_www_t:dir list_dir_perms;
	read_files_pattern($1, calamaris_www_t, calamaris_www_t)
	read_lnk_files_pattern($1, calamaris_www_t, calamaris_www_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `calamaris_read_www_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an calamaris environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`calamaris_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `calamaris_admin'($*)) dnl
	
	gen_require(`
		type calamaris_t, calamaris_log_t, calamaris_www_t;
	')

	allow $1 calamaris_t:process { ptrace signal_perms };
	ps_process_pattern($1, calamaris_t)

	calamaris_run($1, $2)

	logging_list_logs($1)
	admin_pattern($1, calamaris_log_t)

	apache_list_sys_content($1)
	admin_pattern($1, calamaris_www_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `calamaris_admin'($*)) dnl
	')

## <summary>PBX software.</summary>

########################################
## <summary>
##	Execute callweaver in the caller domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`callweaver_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `callweaver_exec'($*)) dnl
	
	gen_require(`
		type callweaver_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, callweaver_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `callweaver_exec'($*)) dnl
	')


########################################
## <summary>
##	Connect to callweaver over a
##	unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`callweaver_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `callweaver_stream_connect'($*)) dnl
	
	gen_require(`
		type callweaver_t, callweaver_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, callweaver_var_run_t, callweaver_var_run_t, callweaver_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `callweaver_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an callweaver environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`callweaver_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `callweaver_admin'($*)) dnl
	
	gen_require(`
		type callweaver_t, callweaver_initrc_exec_t, callweaver_log_t;
		type callweaver_var_lib_t, callweaver_var_run_t, callweaver_spool_t;
	')

	allow $1 callweaver_t:process { ptrace signal_perms };
	ps_process_pattern($1, callweaver_t)

	init_labeled_script_domtrans($1, callweaver_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 callweaver_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, callweaver_log_t)

	files_search_pids($1)
	admin_pattern($1, callweaver_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, { callweaver_spool_t callweaver_var_lib_t })

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `callweaver_admin'($*)) dnl
	')

## <summary>Kana-kanji conversion server.</summary>

########################################
## <summary>
##	Connect to Canna using a unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`canna_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `canna_stream_connect'($*)) dnl
	
	gen_require(`
		type canna_t, canna_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, canna_var_run_t, canna_var_run_t, canna_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `canna_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an canna environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`canna_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `canna_admin'($*)) dnl
	
	gen_require(`
		type canna_t, canna_log_t, canna_var_lib_t;
		type canna_var_run_t, canna_initrc_exec_t;
	')

	allow $1 canna_t:process signal_perms;
	ps_process_pattern($1, canna_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 canna_t:process ptrace;
	')

	init_labeled_script_domtrans($1, canna_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 canna_initrc_exec_t system_r;
	allow $2 system_r;

	logging_list_logs($1)
	admin_pattern($1, canna_log_t)

	files_list_var_lib($1)
	admin_pattern($1, canna_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, canna_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `canna_admin'($*)) dnl
	')

## <summary>Cluster Configuration System.</summary>

########################################
## <summary>
##	Execute a domain transition to run ccs.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`ccs_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ccs_domtrans'($*)) dnl
	
	gen_require(`
		type ccs_t, ccs_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ccs_exec_t, ccs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ccs_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Connect to ccs over an unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ccs_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ccs_stream_connect'($*)) dnl
	
	gen_require(`
		type ccs_t, ccs_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, ccs_var_run_t, ccs_var_run_t, ccs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ccs_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Read cluster configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ccs_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ccs_read_config'($*)) dnl
	
	gen_require(`
		type cluster_conf_t;
	')

	files_search_etc($1)
	read_files_pattern($1, cluster_conf_t, cluster_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ccs_read_config'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	cluster configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ccs_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ccs_manage_config'($*)) dnl
	
	gen_require(`
		type cluster_conf_t;
	')

	files_search_etc($1)
	manage_dirs_pattern($1, cluster_conf_t, cluster_conf_t)
	manage_files_pattern($1, cluster_conf_t, cluster_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ccs_manage_config'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an ccs environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ccs_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ccs_admin'($*)) dnl
	
	gen_require(`
		type ccs_t, ccs_initrc_exec_t, cluster_conf_t;
		type ccs_var_lib_t, ccs_var_log_t;
		type ccs_var_run_t, ccs_tmp_t;
	')

	allow $1 ccs_t:process { signal_perms };
	ps_process_pattern($1, ccs_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 ccs_t:process ptrace;
    ')

	init_labeled_script_domtrans($1, ccs_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 ccs_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, cluster_conf_t)

	files_search_var_lib($1)
	admin_pattern($1, ccs_var_lib_t)

	logging_search_logs($1)
	admin_pattern($1, ccs_var_log_t)

	files_search_pids($1)
	admin_pattern($1, ccs_var_run_t)

	files_search_tmp($1)
	admin_pattern($1, ccs_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ccs_admin'($*)) dnl
	')

## <summary>Record audio or data Compact Discs from a master.</summary>

########################################
## <summary>
##	Role access for cdrecord.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role.
##	</summary>
## </param>
#
 	 	define(`cdrecord_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cdrecord_role'($*)) dnl
	
	gen_require(`
		attribute_role cdrecord_roles;
		type cdrecord_t, cdrecord_exec_t;
	')

	roleattribute $1 cdrecord_roles;

	domtrans_pattern($2, cdrecord_exec_t, cdrecord_t)

	allow cdrecord_t $2:unix_stream_socket rw_socket_perms;

	allow $2 cdrecord_t:process signal_perms;
	tunable_policy(`deny_ptrace',`',`
		allow $2 cdrecord_t:process ptrace;
	')
	ps_process_pattern($2, cdrecord_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cdrecord_role'($*)) dnl
	')

## <summary>Remote certificate distribution framework.</summary>

########################################
## <summary>
##	Execute a domain transition to run certmaster.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`certmaster_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmaster_domtrans'($*)) dnl
	
	gen_require(`
		type certmaster_t, certmaster_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, certmaster_exec_t, certmaster_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmaster_domtrans'($*)) dnl
	')


####################################
## <summary>
##	Execute certmaster in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmaster_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmaster_exec'($*)) dnl
	
	gen_require(`
		type certmaster_exec_t;
	')

	can_exec($1, certmaster_exec_t)
	corecmd_search_bin($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmaster_exec'($*)) dnl
	')


#######################################
## <summary>
##	read certmaster logs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmaster_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmaster_read_log'($*)) dnl
	
	gen_require(`
		type certmaster_var_log_t;
	')

	read_files_pattern($1, certmaster_var_log_t, certmaster_var_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmaster_read_log'($*)) dnl
	')


#######################################
## <summary>
##	Append certmaster log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmaster_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmaster_append_log'($*)) dnl
	
	gen_require(`
		type certmaster_var_log_t;
	')

	append_files_pattern($1, certmaster_var_log_t, certmaster_var_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmaster_append_log'($*)) dnl
	')


#######################################
## <summary>
##	Create, read, write, and delete
##	certmaster log content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmaster_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmaster_manage_log'($*)) dnl
	
	gen_require(`
		type certmaster_var_log_t;
	')

	manage_files_pattern($1, certmaster_var_log_t, certmaster_var_log_t)
	manage_lnk_files_pattern($1, certmaster_var_log_t, certmaster_var_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmaster_manage_log'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an certmaster environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
## 	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`certmaster_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmaster_admin'($*)) dnl
	
	gen_require(`
		type certmaster_t, certmaster_var_run_t, certmaster_var_lib_t;
		type certmaster_etc_rw_t, certmaster_var_log_t, certmaster_initrc_exec_t;
	')

	allow $1 certmaster_t:process signal_perms;
	ps_process_pattern($1, certmaster_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 certmaster_t:process ptrace;
	')

	init_labeled_script_domtrans($1, certmaster_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 certmaster_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	miscfiles_manage_generic_cert_dirs($1)
	miscfiles_manage_generic_cert_files($1)	

	admin_pattern($1, certmaster_etc_rw_t)

	files_list_pids($1)
	admin_pattern($1, certmaster_var_run_t)

	logging_list_logs($1)
	admin_pattern($1, certmaster_var_log_t)

	files_list_var_lib($1)
	admin_pattern($1, certmaster_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmaster_admin'($*)) dnl
	')

## <summary>Certificate status monitor and PKI enrollment client.</summary>

########################################
## <summary>
##	Execute a domain transition to run certmonger.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`certmonger_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_domtrans'($*)) dnl
	
	gen_require(`
		type certmonger_t, certmonger_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, certmonger_exec_t, certmonger_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	certmonger over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmonger_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_dbus_chat'($*)) dnl
	
	gen_require(`
		type certmonger_t;
		class dbus send_msg;
	')

	allow $1 certmonger_t:dbus send_msg;
	allow certmonger_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Execute certmonger server in
##	the certmonger domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`certmonger_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type certmonger_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, certmonger_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read certmonger PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmonger_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_read_pid_files'($*)) dnl
	
	gen_require(`
		type certmonger_var_run_t;
	')

	files_search_pids($1)
	allow $1 certmonger_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read inherited certmonger PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmonger_read_inherited_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_read_inherited_pid_files'($*)) dnl
	
	gen_require(`
		type certmonger_var_run_t;
	')

	files_search_pids($1)
	allow $1 certmonger_var_run_t:file read_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_read_inherited_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Search certmonger lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmonger_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_search_lib'($*)) dnl
	
	gen_require(`
		type certmonger_var_lib_t;
	')

	allow $1 certmonger_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read certmonger lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmonger_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_read_lib_files'($*)) dnl
	
	gen_require(`
		type certmonger_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, certmonger_var_lib_t, certmonger_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	certmonger lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`certmonger_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_manage_lib_files'($*)) dnl
	
	gen_require(`
		type certmonger_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, certmonger_var_lib_t, certmonger_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an certmonger environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`certmonger_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certmonger_admin'($*)) dnl
	
	gen_require(`
		type certmonger_t, certmonger_initrc_exec_t;
		type certmonger_var_lib_t, certmonger_var_run_t;
	')

	ps_process_pattern($1, certmonger_t)
	allow $1 certmonger_t:process signal_perms;

	tunable_policy(`deny_ptrace',`',`
		allow $1 certmonger_t:process ptrace;
	')

	certmonger_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 certmonger_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_var_lib($1)
	admin_pattern($1, certmonger_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, certmonger_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certmonger_admin'($*)) dnl
	')

## <summary>Digital Certificate Tracking.</summary>

########################################
## <summary>
##	Domain transition to certwatch.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`certwatch_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certwatch_domtrans'($*)) dnl
	
	gen_require(`
		type certwatch_exec_t, certwatch_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, certwatch_exec_t, certwatch_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certwatch_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute certwatch in the certwatch
##	domain, and allow the specified role
##	the certwatch domain.
##	backchannel.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`certwatch_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certwatch_run'($*)) dnl
	
	gen_require(`
		attribute_role certwatch_roles;
	')

	certwatch_domtrans($1)
	roleattribute $2 certwatch_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certwatch_run'($*)) dnl
	')


########################################
## <summary>
##	Execute certwatch in the certwatch domain, and
##	allow the specified role the certwatch domain,
##	and use the caller's terminal. Has a sigchld
##	backchannel.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="terminal">
##	<summary>
##	The type of the terminal allow the certwatch domain to use.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`certwatach_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `certwatach_run'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated, please use certwatch_run() instead.')
	certwatch_run($*)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `certwatach_run'($*)) dnl
	')

## <summary>System administration tool for networks.</summary>

#######################################
## <summary>
##	The template to define a cfengine domain.
## </summary>
## <param name="domain_prefix">
##	<summary>
##	Domain prefix to be used.
##	</summary>
## </param>
#
 	 	define(`cfengine_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_domain_template'($*)) dnl
	
	gen_require(`
		attribute cfengine_domain;
	')

	########################################
	#
	# Declarations
	#

	type cfengine_$1_t, cfengine_domain;
	type cfengine_$1_exec_t;
	init_daemon_domain(cfengine_$1_t, cfengine_$1_exec_t)

	########################################
	#
	# Policy
	#

	kernel_read_system_state(cfengine_$1_t)

	auth_use_nsswitch(cfengine_$1_t)

	logging_send_syslog_msg(cfengine_$1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_domain_template'($*)) dnl
	')


######################################
## <summary>
##  Search cfengine lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`cfengine_search_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_search_lib_files'($*)) dnl
	
	gen_require(`
		type cfengine_var_lib_t;
	')

	allow $1 cfengine_var_lib_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_search_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Read cfengine lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cfengine_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_read_lib_files'($*)) dnl
	
	gen_require(`
		type cfengine_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, cfengine_var_lib_t, cfengine_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_read_lib_files'($*)) dnl
	')


####################################
## <summary>
##	Do not audit attempts to write
##	cfengine log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cfengine_dontaudit_write_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_dontaudit_write_log_files'($*)) dnl
	
	gen_require(`
		type cfengine_var_log_t;
	')

	dontaudit $1 cfengine_var_log_t:file write_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_dontaudit_write_log_files'($*)) dnl
	')


#####################################
## <summary>
##      Allow the specified domain to append cfengine's log files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`cfengine_append_inherited_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_append_inherited_log'($*)) dnl
	
        gen_require(`
                type cfengine_var_log_t;
        ')

        cfengine_search_lib_files($1)
		allow $1 cfengine_var_log_t:file { getattr append ioctl lock };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_append_inherited_log'($*)) dnl
	')


####################################
## <summary>
##      Dontaudit the specified domain to write cfengine's log files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`cfengine_dontaudit_write_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_dontaudit_write_log'($*)) dnl
	
        gen_require(`
                type cfengine_var_log_t;
        ')

		dontaudit $1 cfengine_var_log_t:file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_dontaudit_write_log'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cfengine environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cfengine_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cfengine_admin'($*)) dnl
	
	gen_require(`
		attribute cfengine_domain;
		type cfengine_initrc_exec_t, cfengine_log_t, cfengine_var_lib_t;
	')

	allow $1 cfengine_domain:process { signal_perms };
	ps_process_pattern($1, cfengine_domain)

	init_labeled_script_domtrans($1, cfengine_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 cfengine_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_var_lib($1)
	admin_pattern($1, { cfengine_log_t cfengine_var_lib_t })

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cfengine_admin'($*)) dnl
	')


## <summary>libcg is a library that abstracts the control group file system in Linux.</summary>

########################################
## <summary>
##	Execute a domain transition to run
##	CG Clear.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`cgroup_domtrans_cgclear',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_domtrans_cgclear'($*)) dnl
	
	gen_require(`
		type cgclear_t, cgclear_exec_t;
	')

	domtrans_pattern($1, cgclear_exec_t, cgclear_t)
	corecmd_search_bin($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_domtrans_cgclear'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
##	CG config parser.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`cgroup_domtrans_cgconfig',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_domtrans_cgconfig'($*)) dnl
	
	gen_require(`
		type cgconfig_t, cgconfig_exec_t;
	')

	domtrans_pattern($1, cgconfig_exec_t, cgconfig_t)
	corecmd_search_bin($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_domtrans_cgconfig'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
##	CG config parser.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cgroup_initrc_domtrans_cgconfig',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_initrc_domtrans_cgconfig'($*)) dnl
	
	gen_require(`
		type cgconfig_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, cgconfig_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_initrc_domtrans_cgconfig'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
##	CG rules engine daemon.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`cgroup_domtrans_cgred',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_domtrans_cgred'($*)) dnl
	
	gen_require(`
		type cgred_t, cgred_exec_t;
	')

	domtrans_pattern($1, cgred_exec_t, cgred_t)
	corecmd_search_bin($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_domtrans_cgred'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run
## 	CG rules engine daemon.
##	domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cgroup_initrc_domtrans_cgred',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_initrc_domtrans_cgred'($*)) dnl
	
	gen_require(`
		type cgred_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, cgred_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_initrc_domtrans_cgred'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to
##	run CG Clear and allow the
##	specified role the CG Clear
##	domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cgroup_run_cgclear',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_run_cgclear'($*)) dnl
	
	gen_require(`
		type cgclear_t;
	')

	cgroup_domtrans_cgclear($1)
	role $2 types cgclear_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_run_cgclear'($*)) dnl
	')


########################################
## <summary>
##	Connect to CG rules engine daemon
##	over unix stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cgroup_stream_connect_cgred',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_stream_connect_cgred'($*)) dnl
	
	gen_require(`
		type cgred_var_run_t, cgred_t;
	')

	stream_connect_pattern($1, cgred_var_run_t, cgred_var_run_t, cgred_t)
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_stream_connect_cgred'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an cgroup environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cgroup_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cgroup_admin'($*)) dnl
	
	gen_require(`
		type cgred_t, cgconfig_t, cgred_var_run_t;
		type cgconfig_etc_t, cgconfig_initrc_exec_t, cgred_initrc_exec_t;
		type cgrules_etc_t, cgclear_t;
	')

	allow $1 cgclear_t:process signal_perms;
	ps_process_pattern($1, cgclear_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 cgclear_t:process ptrace;
	')

	allow $1 cgconfig_t:process signal_perms;
	ps_process_pattern($1, cgconfig_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 cgconfig_t:process ptrace;
	')

	allow $1 cgred_t:process signal_perms;
	ps_process_pattern($1, cgred_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 cgred_t:process ptrace;
	')

	admin_pattern($1, { cgconfig_etc_t cgrules_etc_t })
	files_list_etc($1)

	admin_pattern($1, cgred_var_run_t)
	files_list_pids($1)

	cgroup_initrc_domtrans_cgconfig($1)
	cgroup_initrc_domtrans_cgred($1)
	domain_system_change_exemption($1)
	role_transition $2 { cgconfig_initrc_exec_t cgred_initrc_exec_t } system_r;
	allow $2 system_r;

	cgroup_run_cgclear($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cgroup_admin'($*)) dnl
	')


## <summary>policy for chrome</summary>

########################################
## <summary>
##	Execute a domain transition to run chrome_sandbox.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`chrome_domtrans_sandbox',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chrome_domtrans_sandbox'($*)) dnl
	
	gen_require(`
		type chrome_sandbox_t, chrome_sandbox_exec_t;
	')

	domtrans_pattern($1, chrome_sandbox_exec_t, chrome_sandbox_t)
	ps_process_pattern(chrome_sandbox_t, $1)

	allow $1 chrome_sandbox_t:fd use;

	dontaudit chrome_sandbox_t $1:socket_class_set getattr;
	allow chrome_sandbox_t $1:unix_stream_socket rw_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chrome_domtrans_sandbox'($*)) dnl
	')



########################################
## <summary>
##	Execute chrome_sandbox in the chrome_sandbox domain, and
##	allow the specified role the chrome_sandbox domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed the chrome_sandbox domain.
##	</summary>
## </param>
#
 	 	define(`chrome_run_sandbox',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chrome_run_sandbox'($*)) dnl
	
	gen_require(`
		type chrome_sandbox_t;
		type chrome_sandbox_nacl_t;
	')

	chrome_domtrans_sandbox($1)
	role $2 types chrome_sandbox_t;
	role $2 types chrome_sandbox_nacl_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chrome_run_sandbox'($*)) dnl
	')


########################################
## <summary>
##	Role access for chrome sandbox
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`chrome_role_notrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chrome_role_notrans'($*)) dnl
	
	gen_require(`
		type chrome_sandbox_t;
		type chrome_sandbox_tmpfs_t;
		type chrome_sandbox_nacl_t;
	')

	role $1 types chrome_sandbox_t;
	role $1 types chrome_sandbox_nacl_t;

	ps_process_pattern($2, chrome_sandbox_t)
	allow $2 chrome_sandbox_t:process signal_perms;

	allow chrome_sandbox_t $2:unix_dgram_socket { read write };
	allow $2 chrome_sandbox_t:unix_dgram_socket { read write };
	allow chrome_sandbox_t $2:unix_stream_socket rw_socket_perms;
	allow chrome_sandbox_t $2:udp_socket rw_socket_perms;;
	allow chrome_sandbox_nacl_t $2:unix_stream_socket rw_socket_perms;
	allow $2 chrome_sandbox_nacl_t:unix_stream_socket { getattr read write };
	allow $2 chrome_sandbox_t:unix_stream_socket { getattr read write };

	allow $2 chrome_sandbox_t:shm rw_shm_perms;

	allow $2 chrome_sandbox_tmpfs_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chrome_role_notrans'($*)) dnl
	')


########################################
## <summary>
##	Role access for chrome sandbox
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`chrome_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chrome_role'($*)) dnl
	
	chrome_role_notrans($1, $2)
	chrome_domtrans_sandbox($2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chrome_role'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit read/write to a chrome_sandbox leaks
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`chrome_dontaudit_sandbox_leaks',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chrome_dontaudit_sandbox_leaks'($*)) dnl
	
	gen_require(`
		type chrome_sandbox_t;
	')

	dontaudit $1 chrome_sandbox_t:unix_stream_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chrome_dontaudit_sandbox_leaks'($*)) dnl
	')



########################################
## <summary>
##      Create chrome directory in the user home directory
##      with an correct label.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`chrome_filetrans_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chrome_filetrans_home_content'($*)) dnl
	
        gen_require(`
                type chrome_sandbox_home_t;
        ')

        optional_policy(`
		gnome_config_filetrans($1, chrome_sandbox_home_t, dir, "chromium")
	        gnome_cache_filetrans($1, chrome_sandbox_home_t, dir, "chromium")
		gnome_cache_filetrans($1, chrome_sandbox_home_t, dir, "chrome")
		gnome_cache_filetrans($1, chrome_sandbox_home_t, dir, "google-chrome")
		gnome_cache_filetrans($1, chrome_sandbox_home_t, dir, "google-chrome-unstable")

        ')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chrome_filetrans_home_content'($*)) dnl
	')


## <summary>Chrony NTP background daemon.</summary>

#####################################
## <summary>
##	Execute chronyd in the chronyd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`chronyd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_domtrans'($*)) dnl
	
	gen_require(`
		type chronyd_t, chronyd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, chronyd_exec_t, chronyd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute chronyd server in the
##	chronyd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`chronyd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type chronyd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, chronyd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_initrc_domtrans'($*)) dnl
	')


####################################
## <summary>
##	Execute chronyd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_exec'($*)) dnl
	
	gen_require(`
		type chronyd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, chronyd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_exec'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to chronyd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_signal'($*)) dnl
	
	gen_require(`
		type chronyd_t;
	')

	allow $1 chronyd_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_signal'($*)) dnl
	')


#####################################
## <summary>
##	Read chronyd log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_read_log'($*)) dnl
	
	gen_require(`
		type chronyd_var_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, chronyd_var_log_t, chronyd_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_read_log'($*)) dnl
	')


########################################
## <summary>
##	Read and write chronyd shared memory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_rw_shm',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_rw_shm'($*)) dnl
	
	gen_require(`
		type chronyd_t, chronyd_tmpfs_t;
	')

	allow $1 chronyd_t:shm rw_shm_perms;
	allow $1 chronyd_tmpfs_t:dir list_dir_perms;
	rw_files_pattern($1, chronyd_tmpfs_t, chronyd_tmpfs_t)
	read_lnk_files_pattern($1, chronyd_tmpfs_t, chronyd_tmpfs_t)
	fs_search_tmpfs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_rw_shm'($*)) dnl
	')


########################################
## <summary>
##	Read chronyd keys files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_read_keys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_read_keys'($*)) dnl
	
	gen_require(`
		type chronyd_keys_t;
	')

	read_files_pattern($1, chronyd_keys_t, chronyd_keys_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_read_keys'($*)) dnl
	')


########################################
## <summary>
##	Append chronyd keys files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_append_keys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_append_keys'($*)) dnl
	
	gen_require(`
		type chronyd_keys_t;
	')

	append_files_pattern($1, chronyd_keys_t, chronyd_keys_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_append_keys'($*)) dnl
	')


########################################
## <summary>
##	Execute chronyd server in the chronyd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`chronyd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_systemctl'($*)) dnl
	
	gen_require(`
		type chronyd_t;
		type chronyd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 chronyd_unit_file_t:file read_file_perms;
	allow $1 chronyd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, chronyd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_systemctl'($*)) dnl
	')


#######################################
## <summary>
##  Connect to chronyd using a unix
##  domain stream socket.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`chronyd_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_stream_connect'($*)) dnl
	
	gen_require(`
		type chronyd_t, chronyd_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, chronyd_var_run_t, chronyd_var_run_t, chronyd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Send to chronyd using a unix domain
##	datagram socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_dgram_send',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_dgram_send'($*)) dnl
	
	gen_require(`
		type chronyd_t, chronyd_var_run_t;
	')

	files_search_pids($1)
	dgram_send_pattern($1, chronyd_var_run_t, chronyd_var_run_t, chronyd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_dgram_send'($*)) dnl
	')


########################################
## <summary>
##	Manage pid files used by chronyd
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_manage_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_manage_pid'($*)) dnl
	
	gen_require(`
		type chronyd_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, chronyd_var_run_t, chronyd_var_run_t)
	manage_dirs_pattern($1, chronyd_var_run_t, chronyd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_manage_pid'($*)) dnl
	')


########################################
## <summary>
##	Manage pid files used by chronyd
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_manage_pid_files'($*)) dnl
	
	gen_require(`
		type chronyd_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, chronyd_var_run_t, chronyd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_manage_pid_files'($*)) dnl
	')


######################################
## <summary>
##      Create objects in /var/run
##	with chronyd runtime private file type.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`chronyd_pid_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_pid_filetrans'($*)) dnl
	
        gen_require(`
                type chronyd_var_run_t;
        ')

	create_dirs_pattern($1, chronyd_var_run_t, chronyd_var_run_t)
        files_pid_filetrans($1, chronyd_var_run_t, dir, "chrony-dhcp")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_pid_filetrans'($*)) dnl
	')


####################################
## <summary>
##	All of the rules required to
##	administrate an chronyd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`chronyd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_admin'($*)) dnl
	
	gen_require(`
		type chronyd_t, chronyd_var_log_t, chronyd_var_run_t;
		type chronyd_var_lib_t, chronyd_tmpfs_t, chronyd_initrc_exec_t;
		type chronyd_keys_t, chronyd_unit_file_t;
	')

	allow $1 chronyd_t:process signal_perms;
	ps_process_pattern($1, chronyd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 chronyd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, chronyd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 chronyd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, chronyd_keys_t)

	logging_list_logs($1)
	admin_pattern($1, chronyd_var_log_t)

	files_list_var_lib($1)
	admin_pattern($1, chronyd_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, chronyd_var_run_t)

	admin_pattern($1, chronyd_tmpfs_t)

	admin_pattern($1, chronyd_unit_file_t)
	chronyd_systemctl($1)
	allow $1 chronyd_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_admin'($*)) dnl
	')


#######################################
## <summary>
##  Get chronyd service status
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`chronyd_service_status',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_service_status'($*)) dnl
	
    gen_require(`
        type chronyd_unit_file_t;
    ')

        allow $1 chronyd_unit_file_t:service status;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_service_status'($*)) dnl
	')


########################################
## <summary>
##	Execute chronyc in the chronyc domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`chronyd_domtrans_chronyc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_domtrans_chronyc'($*)) dnl
	
	gen_require(`
		type chronyc_t, chronyc_exec_t;
	')

	domtrans_pattern($1, chronyc_exec_t, chronyc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_domtrans_chronyc'($*)) dnl
	')


########################################
## <summary>
##	Execute chronyc in the chronyc domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`chronyd_run_chronyc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `chronyd_run_chronyc'($*)) dnl
	
	gen_require(`
		type chronyc_t;
        attribute_role chronyc_roles;
	')

    chronyd_domtrans_chronyc($1)
    roleattribute $2 chronyc_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `chronyd_run_chronyc'($*)) dnl
	')

## <summary>Utilities for managing CIFS mounts</summary>
## <summary>openstack-cinder</summary>

######################################
## <summary>
##  Manage cinder lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`cinder_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cinder_manage_lib_files'($*)) dnl
	
    gen_require(`
                type cinder_var_lib_t;
                                ')

    files_search_var_lib($1)
    manage_files_pattern($1, cinder_var_lib_t, cinder_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cinder_manage_lib_files'($*)) dnl
	')


#######################################
## <summary>
##  Creates types and rules for a basic
##  openstack-cinder systemd daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`cinder_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cinder_domain_template'($*)) dnl
	
	gen_require(`
		attribute cinder_domain;
	')

	type cinder_$1_t, cinder_domain;
	type cinder_$1_exec_t;
	init_daemon_domain(cinder_$1_t, cinder_$1_exec_t)

	type cinder_$1_unit_file_t;
	systemd_unit_file(cinder_$1_unit_file_t)

	type cinder_$1_tmp_t;
	files_tmp_file(cinder_$1_tmp_t)

	manage_dirs_pattern(cinder_$1_t, cinder_$1_tmp_t, cinder_$1_tmp_t)
	manage_files_pattern(cinder_$1_t, cinder_$1_tmp_t, cinder_$1_tmp_t)
	files_tmp_filetrans(cinder_$1_t, cinder_$1_tmp_t, { file dir })
	can_exec(cinder_$1_t, cinder_$1_tmp_t)

	kernel_read_system_state(cinder_$1_t)

    logging_send_syslog_msg(cinder_$1_t)

 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cinder_domain_template'($*)) dnl
	')

## <summary>Encrypted tunnel daemon.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an cipe environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cipe_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cipe_admin'($*)) dnl
	
	gen_require(`
		type ciped_t, ciped_initrc_exec_t;
	')

	allow $1 ciped_t:process { ptrace signal_perms };
	ps_process_pattern($1, ciped_t)

	init_labeled_script_domtrans($1, ciped_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 ciped_initrc_exec_t system_r;
	allow $2 system_r;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cipe_admin'($*)) dnl
	')

## <summary>ClamAV Virus Scanner</summary>

########################################
## <summary>
##	Execute a domain transition to run clamd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`clamav_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_domtrans'($*)) dnl
	
	gen_require(`
		type clamd_t, clamd_exec_t;
	')

	domtrans_pattern($1, clamd_exec_t, clamd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Connect to run clamd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clamav_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_stream_connect'($*)) dnl
	
	gen_require(`
		type clamd_t, clamd_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, clamd_var_run_t, clamd_var_run_t, clamd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to append
##	to clamav log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clamav_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_append_log'($*)) dnl
	
	gen_require(`
		type clamd_var_log_t;
	')

	logging_search_logs($1)
	allow $1 clamd_var_log_t:dir list_dir_perms;
	append_files_pattern($1, clamd_var_log_t, clamd_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_append_log'($*)) dnl
	')


########################################
## <summary>
##	Read clamav configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clamav_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_read_config'($*)) dnl
	
	gen_require(`
		type clamd_etc_t;
	')

	files_search_etc($1)
	allow $1 clamd_etc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_read_config'($*)) dnl
	')


########################################
## <summary>
##	Search clamav libraries directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clamav_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_search_lib'($*)) dnl
	
	gen_require(`
		type clamd_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 clamd_var_lib_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run clamscan.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`clamav_domtrans_clamscan',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_domtrans_clamscan'($*)) dnl
	
	gen_require(`
		type clamscan_t, clamscan_exec_t;
	')

	domtrans_pattern($1, clamscan_exec_t, clamscan_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_domtrans_clamscan'($*)) dnl
	')


########################################
## <summary>
##	Execute clamscan without a transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clamav_exec_clamscan',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_exec_clamscan'($*)) dnl
	
	gen_require(`
		type clamscan_exec_t;
	')

	can_exec($1, clamscan_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_exec_clamscan'($*)) dnl
	')


########################################
## <summary>
##	Manage clamd pid content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clamav_manage_clamd_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_manage_clamd_pid'($*)) dnl
	
	gen_require(`
		type clamd_var_run_t;
	')

	manage_dirs_pattern($1, clamd_var_run_t, clamd_var_run_t)
	manage_files_pattern($1, clamd_var_run_t, clamd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_manage_clamd_pid'($*)) dnl
	')


#######################################
## <summary>
##      Read clamd state files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`clamav_read_state_clamd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_read_state_clamd'($*)) dnl
	
        gen_require(`
                type clamd_t;
        ')

        kernel_search_proc($1)
        ps_process_pattern($1, clamd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_read_state_clamd'($*)) dnl
	')


#######################################
## <summary>
##      Execute clamd server in the clamd domain.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed to transition.
##      </summary>
## </param>
#
 	 	define(`clamd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamd_systemctl'($*)) dnl
	
        gen_require(`
                type clamd_t;
                type clamd_unit_file_t;
        ')

        systemd_exec_systemctl($1)
	init_reload_services($1)
        systemd_read_fifo_file_passwd_run($1)
        allow $1 clamd_unit_file_t:file read_file_perms;
        allow $1 clamd_unit_file_t:service manage_service_perms;

        ps_process_pattern($1, clamd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an clamav environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed to manage the clamav domain.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`clamav_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clamav_admin'($*)) dnl
	
	gen_require(`
		type clamd_t, clamd_etc_t, clamd_tmp_t;
		type clamd_var_log_t, clamd_var_lib_t, clamd_var_run_t;
		type clamscan_t, clamscan_tmp_t, clamd_initrc_exec_t;
		type freshclam_t, freshclam_var_log_t;
		type clamd_unit_file_t;
	')

	allow $1 clamd_t:process signal_perms;
	ps_process_pattern($1, clamd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 clamd_t:process ptrace;
		allow $1 clamscan_t:process ptrace;
		allow $1 freshclam_t:process ptrace;
	')

	allow $1 clamscan_t:process signal_perms;
	ps_process_pattern($1, clamscan_t)

	allow $1 freshclam_t:process signal_perms;
	ps_process_pattern($1, freshclam_t)

	init_labeled_script_domtrans($1, clamd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 clamd_initrc_exec_t system_r;
	allow $2 system_r;

	clamd_systemctl($1)
	admin_pattern($1, clamd_unit_file_t)
	allow $1 clamd_unit_file_t:service all_service_perms;

	files_list_etc($1)
	admin_pattern($1, clamd_etc_t)

	files_list_var_lib($1)
	admin_pattern($1, clamd_var_lib_t)

	logging_list_logs($1)
	admin_pattern($1, clamd_var_log_t)

	files_list_pids($1)
	admin_pattern($1, clamd_var_run_t)

	files_list_tmp($1)
	admin_pattern($1, clamd_tmp_t)

	admin_pattern($1, clamscan_tmp_t)

	admin_pattern($1, freshclam_var_log_t)

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clamav_admin'($*)) dnl
	')

## <summary>Clock speed measurement and manipulation.</summary>

########################################
## <summary>
##	Execute clockspeed utilities in
##	the clockspeed_cli domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`clockspeed_domtrans_cli',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clockspeed_domtrans_cli'($*)) dnl
	
	gen_require(`
		type clockspeed_cli_t, clockspeed_cli_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, clockspeed_cli_exec_t, clockspeed_cli_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clockspeed_domtrans_cli'($*)) dnl
	')


########################################
## <summary>
##	Execute clockspeed utilities in the
##	clockspeed cli domain, and allow the
##	specified role the clockspeed cli domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`clockspeed_run_cli',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clockspeed_run_cli'($*)) dnl
	
	gen_require(`
		attribute_role clockspeed_cli_roles;
	')

	clockspeed_domtrans_cli($1)
	roleattribute $2 clockspeed_cli_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clockspeed_run_cli'($*)) dnl
	')

## <summary>Clustered Mirror Log Server.</summary>

######################################
## <summary>
##	Execute a domain transition to run clogd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`clogd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clogd_domtrans'($*)) dnl
	
	gen_require(`
		type clogd_t, clogd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, clogd_exec_t, clogd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clogd_domtrans'($*)) dnl
	')


#####################################
## <summary>
##	Connect to clogd over a unix domain
##	stream socket.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clogd_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clogd_stream_connect'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clogd_stream_connect'($*)) dnl
	')


#####################################
## <summary>
##	Read and write clogd semaphores.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clogd_rw_semaphores',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clogd_rw_semaphores'($*)) dnl
	
	gen_require(`
		type clogd_t;
	')

	allow $1 clogd_t:sem rw_sem_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clogd_rw_semaphores'($*)) dnl
	')


########################################
## <summary>
##	Read and write clogd shared memory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`clogd_rw_shm',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `clogd_rw_shm'($*)) dnl
	
	gen_require(`
		type clogd_t, clogd_tmpfs_t;
	')

	allow $1 clogd_t:shm rw_shm_perms;
	allow $1 clogd_tmpfs_t:dir list_dir_perms;
	rw_files_pattern($1, clogd_tmpfs_t, clogd_tmpfs_t)
	fs_search_tmpfs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `clogd_rw_shm'($*)) dnl
	')

## <summary>cloudform policy</summary>

#######################################
## <summary>
##  Creates types and rules for a basic
##  cloudform daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`cloudform_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_domain_template'($*)) dnl
	
    gen_require(`
        attribute cloudform_domain;
    ')

    type $1_t, cloudform_domain;
    type $1_exec_t;
    init_daemon_domain($1_t, $1_exec_t)

    kernel_read_system_state($1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_domain_template'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run cloud_init.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`cloudform_init_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_init_domtrans'($*)) dnl
	
	gen_require(`
		type cloud_init_t, cloud_init_exec_t;
	')

	domtrans_pattern($1, cloud_init_exec_t, cloud_init_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_init_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read and write unnamed cloud-init pipes.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`cloudform_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_rw_pipes'($*)) dnl
	
	gen_require(`
		type cloud_init_t;
	')

	allow $1 cloud_init_t:fifo_file rw_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_rw_pipes'($*)) dnl
	')


########################################
## <summary>
##	Send a message to cloud-init over a datagram socket.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`cloudform_init_dgram_send',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_init_dgram_send'($*)) dnl
	
	gen_require(`
		type cloud_init_t;
	')

	allow $1 cloud_init_t:unix_dgram_socket sendto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_init_dgram_send'($*)) dnl
	')


########################################
## <summary>
##	Write to cloud-init temporary files.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`cloudform_init_write_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_init_write_tmp'($*)) dnl
	
	gen_require(`
		type cloud_init_tmp_t;
	')

	files_search_tmp($1)
	write_files_pattern($1, cloud_init_tmp_t, cloud_init_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_init_write_tmp'($*)) dnl
	')


######################################
## <summary>
##	Execute mongod in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cloudform_exec_mongod',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_exec_mongod'($*)) dnl
	
    gen_require(`
	type mongod_exec_t;
    ')

    can_exec($1, mongod_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_exec_mongod'($*)) dnl
	')


#######################################
## <summary>
##  Allow read to cloud lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`cloudform_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_read_lib_files'($*)) dnl
	
    gen_require(`
        type cloud_var_lib_t;
    ')

    files_search_var_lib($1)
    read_files_pattern($1, cloud_var_lib_t, cloud_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_read_lib_files'($*)) dnl
	')


#######################################
## <summary>
##  Allow read to cloud lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`cloudform_read_lib_lnk_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_read_lib_lnk_files'($*)) dnl
	
    gen_require(`
        type cloud_var_lib_t;
    ')

    files_search_var_lib($1)
    read_lnk_files_pattern($1, cloud_var_lib_t, cloud_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_read_lib_lnk_files'($*)) dnl
	')


######################################
## <summary>
##	Execute mongod in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cloudform_dontaudit_write_cloud_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cloudform_dontaudit_write_cloud_log'($*)) dnl
	
    gen_require(`
	type cloud_log_t;
    ')

    dontaudit $1 cloud_log_t:file write_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cloudform_dontaudit_write_cloud_log'($*)) dnl
	')

## <summary>Cluster mirror log daemon.</summary>

########################################
## <summary>
##	Execute a domain transition to
##	run cmirrord.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cmirrord_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cmirrord_domtrans'($*)) dnl
	
	gen_require(`
		type cmirrord_t, cmirrord_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cmirrord_exec_t, cmirrord_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cmirrord_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute cmirrord server in the
##	cmirrord domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cmirrord_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cmirrord_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type cmirrord_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, cmirrord_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cmirrord_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read cmirrord PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cmirrord_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cmirrord_read_pid_files'($*)) dnl
	
	gen_require(`
		type cmirrord_var_run_t;
	')

	files_search_pids($1)
	allow $1 cmirrord_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cmirrord_read_pid_files'($*)) dnl
	')


#######################################
## <summary>
##	Read and write cmirrord shared memory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cmirrord_rw_shm',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cmirrord_rw_shm'($*)) dnl
	
	gen_require(`
		type cmirrord_t, cmirrord_tmpfs_t;
	')

	allow $1 cmirrord_t:shm { rw_shm_perms destroy };

	allow $1 cmirrord_tmpfs_t:dir list_dir_perms;
	rw_files_pattern($1, cmirrord_tmpfs_t, cmirrord_tmpfs_t)
	delete_files_pattern($1, cmirrord_tmpfs_t, cmirrord_tmpfs_t)
	read_lnk_files_pattern($1, cmirrord_tmpfs_t, cmirrord_tmpfs_t)
	fs_search_tmpfs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cmirrord_rw_shm'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cmirrord environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cmirrord_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cmirrord_admin'($*)) dnl
	
	gen_require(`
		type cmirrord_t, cmirrord_initrc_exec_t, cmirrord_var_run_t;
	')

	allow $1 cmirrord_t:process signal_perms;
	ps_process_pattern($1, cmirrord_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 cmirrord_t:process ptrace;
	')

	cmirrord_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 cmirrord_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_pids($1)
	admin_pattern($1, cmirrord_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cmirrord_admin'($*)) dnl
	')

## <summary>Cobbler installation server.</summary>

########################################
## <summary>
##	Execute a domain transition to run cobblerd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`cobblerd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobblerd_domtrans'($*)) dnl
	
	gen_require(`
		type cobblerd_t, cobblerd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cobblerd_exec_t, cobblerd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobblerd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute cobblerd init scripts in
##	the init script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cobblerd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobblerd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type cobblerd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, cobblerd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobblerd_initrc_domtrans'($*)) dnl
	')




########################################
## <summary>
##	Read cobbler configuration dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cobbler_list_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_list_config'($*)) dnl
	
	gen_require(`
		type cobbler_etc_t;
	')

	list_dirs_pattern($1, cobbler_etc_t, cobbler_etc_t)
	files_search_etc($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_list_config'($*)) dnl
	')



########################################
## <summary>
##	Read cobbler configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cobbler_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_read_config'($*)) dnl
	
	gen_require(`
		type cobbler_etc_t;
	')

	read_files_pattern($1, cobbler_etc_t, cobbler_etc_t)
	files_search_etc($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_read_config'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and write
##	cobbler log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cobbler_dontaudit_rw_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_dontaudit_rw_log'($*)) dnl
	
	gen_require(`
		type cobbler_var_log_t;
	')

	dontaudit $1 cobbler_var_log_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_dontaudit_rw_log'($*)) dnl
	')


########################################
## <summary>
##	Search cobbler lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cobbler_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_search_lib'($*)) dnl
	
	gen_require(`
		type cobbler_var_lib_t;
	')

	files_search_var_lib($1)
	search_dirs_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read cobbler lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cobbler_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_read_lib_files'($*)) dnl
	
	gen_require(`
		type cobbler_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
    read_lnk_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	cobbler lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cobbler_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_manage_lib_files'($*)) dnl
	
	gen_require(`
		type cobbler_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
    manage_lnk_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
    manage_dirs_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cobbler environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cobblerd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobblerd_admin'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated, use cobbler_admin() instead.')
	cobbler_admin($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobblerd_admin'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cobbler environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cobbler_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cobbler_admin'($*)) dnl
	
	gen_require(`
		type cobblerd_t, cobbler_var_lib_t, cobbler_var_log_t;
		type cobbler_etc_t, cobblerd_initrc_exec_t;
		type cobbler_tmp_t;
	')

	allow $1 cobblerd_t:process { ptrace signal_perms };
	ps_process_pattern($1, cobblerd_t)

	cobblerd_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 cobblerd_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, cobbler_etc_t)

	files_search_tmp($1)
	admin_pattern($1, cobbler_tmp_t)

	files_search_var_lib($1)
	admin_pattern($1, cobbler_var_lib_t)

	logging_search_logs($1)
	admin_pattern($1, cobbler_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cobbler_admin'($*)) dnl
	')

## <summary>policy for cockpit</summary>

########################################
## <summary>
##	Execute TEMPLATE in the cockpit domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#

	 	 	define(`cockpit_ws_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_ws_domtrans'($*)) dnl
	
		gen_require(`
			type cockpit_ws_t, cockpit_ws_exec_t;
		')

		corecmd_search_bin($1)
		domtrans_pattern($1, cockpit_ws_exec_t, cockpit_ws_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_ws_domtrans'($*)) dnl
	')



########################################
## <summary>
##	Execute TEMPLATE in the cockpit domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#

	 	 	define(`cockpit_session_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_session_domtrans'($*)) dnl
	
		gen_require(`
			type cockpit_session_t, cockpit_session_exec_t;
		')

		corecmd_search_bin($1)
		domtrans_pattern($1, cockpit_session_exec_t, cockpit_session_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_session_domtrans'($*)) dnl
	')



########################################
## <summary>
##	Read and write cockpit_session_t unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_rw_pipes'($*)) dnl
	
		gen_require(`
			type cockpit_session_t;
		')

		allow $1 cockpit_session_t:fifo_file rw_fifo_file_perms;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_rw_pipes'($*)) dnl
	')



########################################
## <summary>
##	Read and write cockpit_session_t unix stream sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_session_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_session_rw_stream_sockets'($*)) dnl
	
		gen_require(`
			type cockpit_session_t;
		')

		allow $1 cockpit_session_t:unix_stream_socket { read write };
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_session_rw_stream_sockets'($*)) dnl
	')



########################################
## <summary>
##	Create cockpit unix_stream_sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_manage_unix_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_manage_unix_stream_sockets'($*)) dnl
	
		gen_require(`
			type cockpit_ws_t;
		')

		allow $1 cockpit_ws_t:unix_stream_socket { create_stream_socket_perms connectto };
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_manage_unix_stream_sockets'($*)) dnl
	')



########################################
## <summary>
##	Search cockpit lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_search_lib'($*)) dnl
	
		gen_require(`
			type cockpit_var_lib_t;
		')

		allow $1 cockpit_var_lib_t:dir search_dir_perms;
		files_search_var_lib($1)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_search_lib'($*)) dnl
	')



########################################
## <summary>
##	Read cockpit lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_read_lib_files'($*)) dnl
	
		gen_require(`
			type cockpit_var_lib_t;
		')

		files_search_var_lib($1)
		read_files_pattern($1, cockpit_var_lib_t, cockpit_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_read_lib_files'($*)) dnl
	')



########################################
## <summary>
##	Manage cockpit lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_manage_lib_files'($*)) dnl
	
		gen_require(`
			type cockpit_var_lib_t;
		')

		files_search_var_lib($1)
		manage_files_pattern($1, cockpit_var_lib_t, cockpit_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_manage_lib_files'($*)) dnl
	')



########################################
## <summary>
##	Manage cockpit lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_manage_lib_dirs'($*)) dnl
	
		gen_require(`
			type cockpit_var_lib_t;
		')

		files_search_var_lib($1)
		manage_dirs_pattern($1, cockpit_var_lib_t, cockpit_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_manage_lib_dirs'($*)) dnl
	')



########################################
## <summary>
##	Read cockpit pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_read_pid_files'($*)) dnl
	
		gen_require(`
			type cockpit_var_run_t;
		')

		read_files_pattern($1, cockpit_var_run_t, cockpit_var_run_t)
		read_lnk_files_pattern($1, cockpit_var_run_t, cockpit_var_run_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_read_pid_files'($*)) dnl
	')



########################################
## <summary>
##	Manage cockpit pid dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_manage_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_manage_pid_dirs'($*)) dnl
	
		gen_require(`
			type cockpit_var_run_t;
		')

		manage_dirs_pattern($1, cockpit_var_run_t, cockpit_var_run_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_manage_pid_dirs'($*)) dnl
	')



########################################
## <summary>
##	Manage cockpit pid dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`cockpit_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_manage_pid_files'($*)) dnl
	
		gen_require(`
			type cockpit_var_run_t;
		')

		manage_files_pattern($1, cockpit_var_run_t, cockpit_var_run_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_manage_pid_files'($*)) dnl
	')



########################################
## <summary>
##	Execute cockpit server in the cockpit domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#

	 	 	define(`cockpit_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_systemctl'($*)) dnl
	
		gen_require(`
			type cockpit_ws_t;
			type cockpit_unit_file_t;
		')

		systemd_exec_systemctl($1)
		init_reload_services($1)
		systemd_read_fifo_file_passwd_run($1)
		allow $1 cockpit_unit_file_t:file read_file_perms;
		allow $1 cockpit_unit_file_t:service manage_service_perms;

		ps_process_pattern($1, cockpit_ws_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_systemctl'($*)) dnl
	')




########################################
## <summary>
##	All of the rules required to administrate
##	an cockpit environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#

	 	 	define(`cockpit_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cockpit_admin'($*)) dnl
	
		gen_require(`
			type cockpit_ws_t;
			type cockpit_session_t;
			type cockpit_var_lib_t;
			type cockpit_var_run_t;
			type cockpit_unit_file_t;
		')

		allow $1 cockpit_ws_t:process { signal_perms };
		ps_process_pattern($1, cockpit_ws_t)

		allow $1 cockpit_session_t:process { signal_perms };
		ps_process_pattern($1, cockpit_session_t)

		tunable_policy(`deny_ptrace',`',`
			allow $1 cockpit_ws_t:process ptrace;
			allow $1 cockpit_session_t:process ptrace;
		')

		files_search_var_lib($1)
		admin_pattern($1, cockpit_var_lib_t)

		files_search_pids($1)
		admin_pattern($1, cockpit_var_run_t)

		cockpit_systemctl($1)
		admin_pattern($1, cockpit_unit_file_t)
		allow $1 cockpit_unit_file_t:service all_service_perms;
		optional_policy(`
			systemd_passwd_agent_exec($1)
			systemd_read_fifo_file_passwd_run($1)
		')
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cockpit_admin'($*)) dnl
	')


## <summary>Statistics collection daemon for filling RRD files.</summary>

########################################
## <summary>
##	Transition to collectd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`collectd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_domtrans'($*)) dnl
	
	gen_require(`
		type collectd_t, collectd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, collectd_exec_t, collectd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute collectd server in the collectd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`collectd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type collectd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, collectd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search collectd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`collectd_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_search_lib'($*)) dnl
	
	gen_require(`
		type collectd_var_lib_t;
	')

	allow $1 collectd_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read collectd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`collectd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_read_lib_files'($*)) dnl
	
	gen_require(`
		type collectd_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, collectd_var_lib_t, collectd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage collectd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`collectd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_manage_lib_files'($*)) dnl
	
	gen_require(`
		type collectd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, collectd_var_lib_t, collectd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage collectd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`collectd_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type collectd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, collectd_var_lib_t, collectd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Manage collectd httpd rw content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`collectd_manage_rw_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_manage_rw_content'($*)) dnl
	
	gen_require(`
		type collectd_rw_content_t;
	')

	manage_dirs_pattern($1, collectd_rw_content_t, collectd_rw_content_t)
	manage_files_pattern($1, collectd_rw_content_t, collectd_rw_content_t)
	manage_lnk_files_pattern($1, collectd_rw_content_t, collectd_rw_content_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_manage_rw_content'($*)) dnl
	')


########################################
## <summary>
##	Execute collectd server in the collectd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`collectd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_systemctl'($*)) dnl
	
	gen_require(`
		type collectd_t;
		type collectd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 collectd_unit_file_t:file read_file_perms;
	allow $1 collectd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, collectd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an collectd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`collectd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `collectd_admin'($*)) dnl
	
	gen_require(`
		type collectd_t, collectd_initrc_exec_t, collectd_var_run_t;
        type collectd_var_lib_t, collectd_unit_file_t;
	')

	allow $1 collectd_t:process signal_perms;
	ps_process_pattern($1, collectd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 collectd_t:process ptrace;
	')

	collectd_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 collectd_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, collectd_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, collectd_var_lib_t)

	collectd_systemctl($1)
	admin_pattern($1, collectd_unit_file_t)
	allow $1 collectd_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `collectd_admin'($*)) dnl
	')


## <summary>GNOME color manager</summary>

########################################
## <summary>
##	Execute a domain transition to run colord.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`colord_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `colord_domtrans'($*)) dnl
	
	gen_require(`
		type colord_t, colord_exec_t;
	')

	domtrans_pattern($1, colord_exec_t, colord_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `colord_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	colord over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`colord_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `colord_dbus_chat'($*)) dnl
	
	gen_require(`
		type colord_t;
		class dbus send_msg;
	')

	allow $1 colord_t:dbus send_msg;
	allow colord_t $1:dbus send_msg;
	ps_process_pattern(colord_t, $1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `colord_dbus_chat'($*)) dnl
	')


######################################
## <summary>
##	Read colord lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`colord_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `colord_read_lib_files'($*)) dnl
	
	gen_require(`
		type colord_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, colord_var_lib_t, colord_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `colord_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Execute colord server in the colord domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`colord_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `colord_systemctl'($*)) dnl
	
	gen_require(`
		type colord_t;
		type colord_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 colord_unit_file_t:file read_file_perms;
	allow $1 colord_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, colord_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `colord_systemctl'($*)) dnl
	')

## <summary>Comsat, a biff server.</summary>

## <summary>policy for condor</summary>

#####################################
## <summary>
##  Creates types and rules for a basic
##  condor init daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`condor_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_domain_template'($*)) dnl
	
    gen_require(`
        type condor_master_t;
        attribute condor_domain;
    ')

    #############################
    #
    # Declarations
    #

    type condor_$1_t, condor_domain;
    type condor_$1_exec_t;
    init_daemon_domain(condor_$1_t, condor_$1_exec_t)
    role system_r types condor_$1_t;

    domtrans_pattern(condor_master_t, condor_$1_exec_t, condor_$1_t)
    allow condor_master_t condor_$1_exec_t:file ioctl;

	kernel_read_system_state(condor_$1_t)

	corenet_all_recvfrom_netlabel(condor_$1_t)
	corenet_all_recvfrom_unlabeled(condor_$1_t)

    auth_use_nsswitch(condor_$1_t)

    logging_send_syslog_msg(condor_$1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_domain_template'($*)) dnl
	')


########################################
## <summary>
##	Transition to condor.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`condor_domtrans_master',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_domtrans_master'($*)) dnl
	
	gen_require(`
		type condor_master_t, condor_master_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, condor_master_exec_t, condor_master_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_domtrans_master'($*)) dnl
	')


#######################################
## <summary>
##  Allows to start userland processes
##  by transitioning to the specified domain,
##  with a range transition.
## </summary>
## <param name="domain">
##  <summary>
##  The process type entered by condor_startd.
##  </summary>
## </param>
## <param name="entrypoint">
##  <summary>
##  The executable type for the entrypoint.
##  </summary>
## </param>
## <param name="range">
##  <summary>
##  Range for the domain.
##  </summary>
## </param>
#
 	 	define(`condor_startd_ranged_domtrans_to',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_startd_ranged_domtrans_to'($*)) dnl
	
    gen_require(`
        type sshd_t;
    ')
    condor_startd_domtrans_to($1, $2)


    ifdef(`enable_mcs',`
        range_transition condor_startd_t $2:process $3;
    ')


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_startd_ranged_domtrans_to'($*)) dnl
	')


#######################################
## <summary>
##  Allows to start userlandprocesses
##  by transitioning to the specified domain.
## </summary>
## <param name="domain">
##  <summary>
##  The process type entered by condor_startd.
##  </summary>
## </param>
## <param name="entrypoint">
##  <summary>
##  The executable type for the entrypoint.
##  </summary>
## </param>
#
 	 	define(`condor_startd_domtrans_to',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_startd_domtrans_to'($*)) dnl
	
    gen_require(`
        type condor_startd_t;
    ')

    domtrans_pattern(condor_startd_t, $2, $1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_startd_domtrans_to'($*)) dnl
	')


########################################
## <summary>
##	Read condor's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`condor_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_read_log'($*)) dnl
	
	gen_require(`
		type condor_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, condor_log_t, condor_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append to condor log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_append_log'($*)) dnl
	
	gen_require(`
		type condor_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, condor_log_t, condor_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_append_log'($*)) dnl
	')


########################################
## <summary>
##	Manage condor log files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_manage_log'($*)) dnl
	
	gen_require(`
		type condor_log_t;
	')

	logging_search_logs($1)
	manage_dirs_pattern($1, condor_log_t, condor_log_t)
	manage_files_pattern($1, condor_log_t, condor_log_t)
	manage_lnk_files_pattern($1, condor_log_t, condor_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Search condor lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_search_lib'($*)) dnl
	
	gen_require(`
		type condor_var_lib_t;
	')

	allow $1 condor_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read condor lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_read_lib_files'($*)) dnl
	
	gen_require(`
		type condor_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, condor_var_lib_t, condor_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_read_lib_files'($*)) dnl
	')


######################################
## <summary>
##  Read and write condor lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`condor_rw_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_rw_lib_files'($*)) dnl
	
    gen_require(`
        type condor_var_lib_t;
    ')

    files_search_var_lib($1)
    rw_files_pattern($1, condor_var_lib_t, condor_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_rw_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage condor lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_manage_lib_files'($*)) dnl
	
	gen_require(`
		type condor_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, condor_var_lib_t, condor_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage condor lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type condor_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, condor_var_lib_t, condor_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read condor PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_read_pid_files'($*)) dnl
	
	gen_require(`
		type condor_var_run_t;
	')

	files_search_pids($1)
	allow $1 condor_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Execute condor server in the condor domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`condor_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_systemctl'($*)) dnl
	
	gen_require(`
		attribute condor_domain;
		type condor_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	systemd_read_fifo_file_passwd_run($1)
	allow $1 condor_unit_file_t:file read_file_perms;
	allow $1 condor_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, condor_domain)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_systemctl'($*)) dnl
	')


#######################################
## <summary>
##  Read and write condor_startd server TCP sockets.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`condor_rw_tcp_sockets_startd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_rw_tcp_sockets_startd'($*)) dnl
	
	gen_require(`
		type condor_startd_t;
	')

	allow $1 condor_startd_t:tcp_socket rw_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_rw_tcp_sockets_startd'($*)) dnl
	')


######################################
## <summary>
##  Read and write condor_schedd server TCP sockets.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`condor_rw_tcp_sockets_schedd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_rw_tcp_sockets_schedd'($*)) dnl
	
    gen_require(`
        type condor_schedd_t;
    ')

    allow $1 condor_schedd_t:tcp_socket rw_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_rw_tcp_sockets_schedd'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an condor environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`condor_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `condor_admin'($*)) dnl
	
    gen_require(`
        attribute condor_domain;
        type condor_initrc_exec_t, condor_log_t, condor_conf_t;
        type condor_var_lib_t, condor_var_lock_t, condor_schedd_tmp_t;
        type condor_var_run_t, condor_startd_tmp_t;
		type condor_unit_file_t;
    ')

	allow $1 condor_domain:process { signal_perms };
	ps_process_pattern($1, condor_domain)

    init_labeled_script_domtrans($1, condor_initrc_exec_t)
    domain_system_change_exemption($1)
    role_transition $2 condor_initrc_exec_t system_r;
    allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, condor_conf_t)

	logging_search_logs($1)
	admin_pattern($1, condor_log_t)

    files_search_locks($1)
    admin_pattern($1, condor_var_lock_t)

	files_search_var_lib($1)
	admin_pattern($1, condor_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, condor_var_run_t)

	files_search_tmp($1)
	admin_pattern($1, { condor_schedd_tmp_t condor_startd_tmp_t })

	condor_systemctl($1)
	admin_pattern($1, condor_unit_file_t)
	allow $1 condor_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `condor_admin'($*)) dnl
	')

## <summary>Conman is a program for connecting to remote consoles being managed by conmand</summary>

########################################
## <summary>
##	Execute conman in the conman domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`conman_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conman_domtrans'($*)) dnl
	
	gen_require(`
		type conman_t, conman_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, conman_exec_t, conman_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conman_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read conman's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`conman_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conman_read_log'($*)) dnl
	
	gen_require(`
		type conman_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, conman_log_t, conman_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conman_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append to conman log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`conman_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conman_append_log'($*)) dnl
	
	gen_require(`
		type conman_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, conman_log_t, conman_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conman_append_log'($*)) dnl
	')


########################################
## <summary>
##	Manage conman log files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`conman_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conman_manage_log'($*)) dnl
	
	gen_require(`
		type conman_log_t;
	')

	logging_search_logs($1)
	manage_dirs_pattern($1, conman_log_t, conman_log_t)
	manage_files_pattern($1, conman_log_t, conman_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conman_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Execute conman server in the conman domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`conman_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conman_systemctl'($*)) dnl
	
	gen_require(`
		type conman_t;
		type conman_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
    systemd_read_fifo_file_passwd_run($1)
	allow $1 conman_unit_file_t:file read_file_perms;
	allow $1 conman_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, conman_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conman_systemctl'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an conman environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`conman_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conman_admin'($*)) dnl
	
	gen_require(`
		type conman_t;
		type conman_log_t;
	    type conman_unit_file_t;
	')

	allow $1 conman_t:process { signal_perms };
	ps_process_pattern($1, conman_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 conman_t:process ptrace;
    ')

	logging_search_logs($1)
	admin_pattern($1, conman_log_t)

	conman_systemctl($1)
	admin_pattern($1, conman_unit_file_t)
	allow $1 conman_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conman_admin'($*)) dnl
	')

## <summary>Conntrackd connection tracking service</summary>

########################################
## <summary>
##	Read the configuration files for conntrackd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`conntrackd_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conntrackd_read_config'($*)) dnl
	
	gen_require(`
		type conntrackd_conf_t;
	')

	files_search_etc($1)
	allow $1 conntrackd_conf_t:dir list_dir_perms;
	read_files_pattern($1, conntrackd_conf_t, conntrackd_conf_t)
	read_lnk_files_pattern($1, conntrackd_conf_t, conntrackd_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conntrackd_read_config'($*)) dnl
	')


########################################
## <summary>
##	Connect to conntrackd over an unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`conntrackd_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conntrackd_stream_connect'($*)) dnl
	
	gen_require(`
		type conntrackd_t, conntrackd_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, conntrackd_var_run_t, conntrackd_var_run_t, conntrackd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conntrackd_stream_connect'($*)) dnl
	')


#######################################
## <summary>
##  Execute conntrackd services in the conntrackd domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`conntrackd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conntrackd_systemctl'($*)) dnl
	
    gen_require(`
        type conntrackd_t;
        type conntrackd_unit_file_t;
    ')

        systemd_exec_systemctl($1)
	init_reload_services($1)
        allow $1 conntrackd_unit_file_t:file read_file_perms;
        allow $1 conntrackd_unit_file_t:service manage_service_perms;

        ps_process_pattern($1, conntrackd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conntrackd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an conntrackd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed to manage the conntrackd domain.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`conntrackd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `conntrackd_admin'($*)) dnl
	
	gen_require(`
		type conntrackd_t, conntrackd_tmp_t, conntrackd_log_t;
		type conntrackd_conf_t, conntrackd_var_run_t, conntrackd_initrc_exec_t;
	')

	allow $1 conntrackd_t:process signal_perms;
	ps_process_pattern($1, conntrackd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 conntrackd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, conntrackd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 conntrackd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, conntrackd_conf_t)

	logging_list_logs($1)
	admin_pattern($1, conntrackd_log_t)

	files_list_tmp($1)
	admin_pattern($1, conntrackd_tmp_t)

	files_list_pids($1)
	admin_pattern($1, conntrackd_var_run_t)

    conntrackd_systemctl($1)
    admin_pattern($1, conntrackd_unit_file_t)
    allow $1 conntrackd_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `conntrackd_admin'($*)) dnl
	')

## <summary>Framework for facilitating multiple user sessions on desktops.</summary>

########################################
## <summary>
##	Execute a domain transition to run consolekit.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`consolekit_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_domtrans'($*)) dnl
	
	gen_require(`
		type consolekit_t, consolekit_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, consolekit_exec_t, consolekit_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_domtrans'($*)) dnl
	')


########################################
## <summary>
##	dontaudit Send and receive messages from
##	consolekit over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`consolekit_dontaudit_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_dontaudit_dbus_chat'($*)) dnl
	
	gen_require(`
		type consolekit_t;
		class dbus send_msg;
	')

	dontaudit $1 consolekit_t:dbus send_msg;
	dontaudit consolekit_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_dontaudit_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	consolekit over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`consolekit_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_dbus_chat'($*)) dnl
	
	gen_require(`
		type consolekit_t;
		class dbus send_msg;
	')

	allow $1 consolekit_t:dbus send_msg;
	allow consolekit_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit attempts to read consolekit log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`consolekit_dontaudit_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_dontaudit_read_log'($*)) dnl
	
	gen_require(`
		type consolekit_log_t;
	')

	dontaudit $1 consolekit_log_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_dontaudit_read_log'($*)) dnl
	')


########################################
## <summary>
##	Read consolekit log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`consolekit_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_read_log'($*)) dnl
	
	gen_require(`
		type consolekit_log_t;
	')

	read_files_pattern($1, consolekit_log_t, consolekit_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_read_log'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	consolekit log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`consolekit_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_manage_log'($*)) dnl
	
	gen_require(`
		type consolekit_log_t;
	')

	manage_files_pattern($1, consolekit_log_t, consolekit_log_t)
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Read consolekit PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`consolekit_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_read_pid_files'($*)) dnl
	
	gen_require(`
		type consolekit_var_run_t;
	')

	files_search_pids($1)
	allow $1 consolekit_var_run_t:dir list_dir_perms;
	read_files_pattern($1, consolekit_var_run_t, consolekit_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	List consolekit PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`consolekit_list_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_list_pid_files'($*)) dnl
	
	gen_require(`
		type consolekit_var_run_t;
	')

	files_search_pids($1)
	list_dirs_pattern($1, consolekit_var_run_t, consolekit_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_list_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Allow the domain to read consolekit state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`consolekit_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_read_state'($*)) dnl
	
	gen_require(`
		type consolekit_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, consolekit_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_read_state'($*)) dnl
	')


########################################
## <summary>
##	Execute consolekit server in the consolekit domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`consolekit_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `consolekit_systemctl'($*)) dnl
	
	gen_require(`
		type consolekit_t;
		type consolekit_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 consolekit_unit_file_t:file read_file_perms;
	allow $1 consolekit_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, consolekit_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `consolekit_systemctl'($*)) dnl
	')

## <summary>policy for coreos_installer</summary>

########################################
## <summary>
##	Execute coreos_installer_exec_t in the coreos_installer domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`coreos_installer_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `coreos_installer_domtrans'($*)) dnl
	
	gen_require(`
		type coreos_installer_t, coreos_installer_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, coreos_installer_exec_t, coreos_installer_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `coreos_installer_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute coreos_installer in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`coreos_installer_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `coreos_installer_exec'($*)) dnl
	
	gen_require(`
		type coreos_installer_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, coreos_installer_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `coreos_installer_exec'($*)) dnl
	')

## <summary>Corosync Cluster Engine.</summary>

########################################
## <summary>
##	Execute a domain transition to run corosync.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`corosync_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_domtrans'($*)) dnl
	
	gen_require(`
		type corosync_t, corosync_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, corosync_exec_t, corosync_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute corosync init scripts in
##	the init script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`corosync_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type corosync_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, corosync_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_initrc_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute corosync in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`corosync_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_exec'($*)) dnl
	
	gen_require(`
		type corosync_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, corosync_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_exec'($*)) dnl
	')


#######################################
## <summary>
##	Read corosync log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`corosync_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_read_log'($*)) dnl
	
	gen_require(`
		type corosync_var_log_t;
	')

	logging_search_logs($1)
	list_dirs_pattern($1, corosync_var_log_t, corosync_var_log_t)
	read_files_pattern($1, corosync_var_log_t, corosync_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_read_log'($*)) dnl
	')


#######################################
## <summary>
##	Setattr corosync log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`corosync_setattr_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_setattr_log'($*)) dnl
	
	gen_require(`
		type corosync_var_log_t;
	')

	setattr_files_pattern($1, corosync_var_log_t, corosync_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_setattr_log'($*)) dnl
	')



#####################################
## <summary>
##	Connect to corosync over a unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`corosync_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_stream_connect'($*)) dnl
	
	gen_require(`
		type corosync_t, corosync_var_run_t;
		type corosync_var_lib_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, corosync_var_lib_t, corosync_var_lib_t, corosync_t)
	stream_connect_pattern($1, corosync_var_run_t, corosync_var_run_t, corosync_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_stream_connect'($*)) dnl
	')


######################################
## <summary>
##  Allow the specified domain to read/write corosync's tmpfs files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`corosync_rw_tmpfs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_rw_tmpfs'($*)) dnl
	
    gen_require(`
        type corosync_tmpfs_t;
    ')

	rw_files_pattern($1, corosync_tmpfs_t, corosync_tmpfs_t)


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_rw_tmpfs'($*)) dnl
	')


########################################
## <summary>
##	Execute corosync server in the corosync domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`corosync_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_systemctl'($*)) dnl
	
	gen_require(`
		type corosync_t;
		type corosync_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 corosync_unit_file_t:file read_file_perms;
	allow $1 corosync_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, corosync_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_systemctl'($*)) dnl
	')


######################################
## <summary>
##	All of the rules required to
##	administrate an corosync environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`corosyncd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosyncd_admin'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated, use corosync_admin() instead.')
	corosync_admin($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosyncd_admin'($*)) dnl
	')


######################################
## <summary>
##	All of the rules required to
##	administrate an corosync environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`corosync_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `corosync_admin'($*)) dnl
	
	gen_require(`
		type corosync_t, corosync_var_lib_t, corosync_var_log_t;
		type corosync_var_run_t, corosync_tmp_t, corosync_tmpfs_t;
		type corosync_initrc_exec_t;
		type corosync_unit_file_t;
	')

	allow $1 corosync_t:process signal_perms;
	ps_process_pattern($1, corosync_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 corosync_t:process ptrace;
	')

	init_labeled_script_domtrans($1, corosync_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 corosync_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_tmp($1)
	admin_pattern($1, corosync_tmp_t)

	admin_pattern($1, corosync_tmpfs_t)

	files_list_var_lib($1)
	admin_pattern($1, corosync_var_lib_t)

	logging_list_logs($1)
	admin_pattern($1, corosync_var_log_t)

	files_list_pids($1)
	admin_pattern($1, corosync_var_run_t)

	corosync_systemctl($1)
	admin_pattern($1, corosync_unit_file_t)
	allow $1 corosync_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `corosync_admin'($*)) dnl
	')

## <summary>Document database server.</summary>

########################################
## <summary>
##	Allow to read couchdb log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`couchdb_read_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_read_log_files'($*)) dnl
	
	gen_require(`
		type couchdb_log_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, couchdb_log_t, couchdb_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_read_log_files'($*)) dnl
	')


########################################
## <summary>
##	Allow to read couchdb lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`couchdb_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_read_lib_files'($*)) dnl
	
	gen_require(`
		type couchdb_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, couchdb_var_lib_t, couchdb_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an couchdb environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`couchdb_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_manage_lib_files'($*)) dnl
	
	gen_require(`
		type couchdb_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, couchdb_var_lib_t, couchdb_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage couchdb lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`couchdb_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type couchdb_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, couchdb_var_lib_t, couchdb_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow to read couchdb conf files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`couchdb_read_conf_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_read_conf_files'($*)) dnl
	
	gen_require(`
		type couchdb_conf_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, couchdb_conf_t, couchdb_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_read_conf_files'($*)) dnl
	')


########################################
## <summary>
##	Read couchdb PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`couchdb_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_read_pid_files'($*)) dnl
	
	gen_require(`
		type couchdb_var_run_t;
	')

	files_search_pids($1)
	allow $1 couchdb_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_read_pid_files'($*)) dnl
	')


#######################################
## <summary>
##      Search couchdb PID dirs.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`couchdb_search_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_search_pid_dirs'($*)) dnl
	
        gen_require(`
                type couchdb_var_run_t;
        ')

        files_search_pids($1)
        allow $1 couchdb_var_run_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_search_pid_dirs'($*)) dnl
	')


#######################################
## <summary>
##  Allow domain to manage couchdb content.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`couchdb_manage_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_manage_files'($*)) dnl
	
        gen_require(`
                type couchdb_var_run_t;
                type couchdb_log_t;
                type couchdb_var_lib_t;
                type couchdb_conf_t;
        ')

    manage_files_pattern($1, couchdb_log_t, couchdb_log_t)
    manage_files_pattern($1, couchdb_var_lib_t, couchdb_var_lib_t)
    manage_files_pattern($1, couchdb_var_run_t, couchdb_var_run_t)
    manage_files_pattern($1, couchdb_conf_t, couchdb_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_manage_files'($*)) dnl
	')


########################################
## <summary>
##	Execute couchdb server in the couchdb domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`couchdb_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_systemctl'($*)) dnl
	
	gen_require(`
		type couchdb_t;
		type couchdb_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	systemd_read_fifo_file_passwd_run($1)
	allow $1 couchdb_unit_file_t:file read_file_perms;
	allow $1 couchdb_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, couchdb_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_systemctl'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an couchdb environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
## </summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`couchdb_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `couchdb_admin'($*)) dnl
	
	gen_require(`
		type couchdb_unit_file_t;
		type couchdb_t, couchdb_conf_t, couchdb_initrc_exec_t;
		type couchdb_log_t, couchdb_var_lib_t, couchdb_var_run_t;
		type couchdb_tmp_t;
	')

	allow $1 couchdb_t:process { signal_perms };
	ps_process_pattern($1, couchdb_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 couchdb_t:process ptrace;
    ')

	init_labeled_script_domtrans($1, couchdb_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 couchdb_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, couchdb_conf_t)

	logging_search_logs($1)
	admin_pattern($1, couchdb_log_t)

	files_search_tmp($1)
	admin_pattern($1, couchdb_tmp_t)

	files_search_var_lib($1)
	admin_pattern($1, couchdb_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, couchdb_var_run_t)

	admin_pattern($1, couchdb_unit_file_t)
	couchdb_systemctl($1)
	allow $1 couchdb_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `couchdb_admin'($*)) dnl
	')

## <summary>Courier IMAP and POP3 email servers</summary>

########################################
## <summary>
##	Template for creating courier server processes.
## </summary>
## <param name="prefix">
##	<summary>
##	Prefix name of the server process.
##	</summary>
## </param>
#
 	 	define(`courier_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_domain_template'($*)) dnl
	
	gen_require(`
		attribute courier_domain;
	')

	##############################
	#
	# Declarations
	#

	type courier_$1_t, courier_domain;
	type courier_$1_exec_t;
	init_daemon_domain(courier_$1_t, courier_$1_exec_t)

	##############################
	#
	# Declarations
	#

	can_exec(courier_$1_t, courier_$1_exec_t)

	kernel_read_system_state(courier_$1_t)

	corenet_all_recvfrom_netlabel(courier_$1_t)
	corenet_tcp_sendrecv_generic_if(courier_$1_t)
	corenet_udp_sendrecv_generic_if(courier_$1_t)
	corenet_tcp_sendrecv_generic_node(courier_$1_t)
	corenet_udp_sendrecv_generic_node(courier_$1_t)
	corenet_tcp_sendrecv_all_ports(courier_$1_t)
	corenet_udp_sendrecv_all_ports(courier_$1_t)

	logging_send_syslog_msg(courier_$1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_domain_template'($*)) dnl
	')


########################################
## <summary>
##	Execute the courier authentication daemon with
##	a domain transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`courier_domtrans_authdaemon',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_domtrans_authdaemon'($*)) dnl
	
	gen_require(`
		type courier_authdaemon_t, courier_authdaemon_exec_t;
	')

	domtrans_pattern($1, courier_authdaemon_exec_t, courier_authdaemon_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_domtrans_authdaemon'($*)) dnl
	')


#######################################
## <summary>
##  Connect to courier-authdaemon over a unix stream socket.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`courier_stream_connect_authdaemon',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_stream_connect_authdaemon'($*)) dnl
	
    gen_require(`
        type courier_authdaemon_t, courier_spool_t;
    ')

	files_search_spool($1)
    stream_connect_pattern($1, courier_spool_t, courier_spool_t, courier_authdaemon_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_stream_connect_authdaemon'($*)) dnl
	')


########################################
## <summary>
##	Execute the courier POP3 and IMAP server with
##	a domain transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`courier_domtrans_pop',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_domtrans_pop'($*)) dnl
	
	gen_require(`
		type courier_pop_t, courier_pop_exec_t;
	')

	domtrans_pattern($1, courier_pop_exec_t, courier_pop_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_domtrans_pop'($*)) dnl
	')


########################################
## <summary>
##	Read courier config files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`courier_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_read_config'($*)) dnl
	
	gen_require(`
		type courier_etc_t;
	')

	files_search_etc($1)
	read_files_pattern($1, courier_etc_t, courier_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_read_config'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete courier
##	spool directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`courier_manage_spool_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_manage_spool_dirs'($*)) dnl
	
	gen_require(`
		type courier_spool_t;
	')

	files_search_spool($1)
	manage_dirs_pattern($1, courier_spool_t, courier_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_manage_spool_dirs'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete courier
##	spool files.
## </summary>
## <param name="domains">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`courier_manage_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_manage_spool_files'($*)) dnl
	
	gen_require(`
		type courier_spool_t;
	')

	files_search_spool($1)
	manage_files_pattern($1, courier_spool_t, courier_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_manage_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Manage named socket in a courier spool directory.
## </summary>
## <param name="domains">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`courier_manage_spool_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_manage_spool_sockets'($*)) dnl
	
	gen_require(`
		type courier_spool_t;
	')

	files_search_spool($1)
	manage_sock_files_pattern($1, courier_spool_t, courier_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_manage_spool_sockets'($*)) dnl
	')


########################################
## <summary>
##	Read courier spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`courier_read_spool',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_read_spool'($*)) dnl
	
	gen_require(`
		type courier_spool_t;
	')

	files_search_spool($1)
	read_files_pattern($1, courier_spool_t, courier_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_read_spool'($*)) dnl
	')


########################################
## <summary>
##	Read and write to courier spool pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`courier_rw_spool_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `courier_rw_spool_pipes'($*)) dnl
	
	gen_require(`
		type courier_spool_t;
	')

	allow $1 courier_spool_t:fifo_file rw_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `courier_rw_spool_pipes'($*)) dnl
	')

## <summary>Services for loading CPU microcode and CPU frequency scaling.</summary>

########################################
## <summary>
##	CPUcontrol stub interface.  No access allowed.
## </summary>
## <param name="domain" unused="true">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cpucontrol_stub',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cpucontrol_stub'($*)) dnl
	
	gen_require(`
		type cpucontrol_t;
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cpucontrol_stub'($*)) dnl
	')

## <summary>Command-line CPU frequency settings.</summary>

########################################
## <summary>
##	Send and receive messages from
##	cpufreq-selector over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cpufreqselector_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cpufreqselector_dbus_chat'($*)) dnl
	
	gen_require(`
		type cpufreqselector_t;
		class dbus send_msg;
	')

	allow $1 cpufreqselector_t:dbus send_msg;
	allow cpufreqselector_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cpufreqselector_dbus_chat'($*)) dnl
	')

## <summary>cpuplugd - Linux on System z CPU and memory hotplug daemon</summary>

########################################
## <summary>
##	Execute cpuplug in the cpuplug domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`cpuplug_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cpuplug_domtrans'($*)) dnl
	
	gen_require(`
		type cpuplug_t, cpuplug_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cpuplug_exec_t, cpuplug_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cpuplug_domtrans'($*)) dnl
	')

## <summary>Periodic execution of scheduled commands.</summary>

#######################################
## <summary>
##	The common rules for a crontab domain.
## </summary>
## <param name="userdomain_prefix">
##	<summary>
##	The prefix of the user domain (e.g., user
##	is the prefix for user_t).
##	</summary>
## </param>
#
 	 	define(`cron_common_crontab_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_common_crontab_template'($*)) dnl
	
	gen_require(`
		type crontab_exec_t;
	')

	##############################
	#
	# Declarations
	#

	userdom_user_application_domain($1_t, crontab_exec_t)

	##############################
	#
	# Local policy
	#

	kernel_read_system_state($1_t)

	auth_domtrans_chk_passwd($1_t)
	auth_use_nsswitch($1_t)

	logging_send_syslog_msg($1_t)

	userdom_home_reader($1_t)

 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_common_crontab_template'($*)) dnl
	')


########################################
## <summary>
##	Role access for cron
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="userdomain_prefix">
##	<summary>
##	The prefix of the user domain (e.g., user
##	is the prefix for user_t).
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cron_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_role'($*)) dnl
	
	gen_require(`
		type cronjob_t, crontab_t, crontab_exec_t;
		type user_cron_spool_t, crond_t;
        bool cron_userdomain_transition;
	')

    ##############################
    #
    # Declarations
    #

	role $1 types { cronjob_t crontab_t };

    ##############################
    #
    # Local policy
    #

	# Transition from the user domain to the derived domain.
	domtrans_pattern($2_t, crontab_exec_t, crontab_t)

	dontaudit crond_t $2_t:process { noatsecure siginh rlimitinh };
	allow $2_t crond_t:process sigchld;

    allow $2_t user_cron_spool_t:file { getattr read write ioctl };

	# crontab shows up in user ps
	allow $2_t crontab_t:process signal_perms;
	ps_process_pattern($2_t, crontab_t)

    cron_common_crontab_template($2)

	tunable_policy(`deny_ptrace',`',`
		allow $2_t crontab_t:process ptrace;
	')

	# Run helper programs as the user domain
	#corecmd_bin_domtrans(crontab_t, $2)
	#corecmd_shell_domtrans(crontab_t, $2)
	corecmd_exec_bin(crontab_t)
	corecmd_exec_shell(crontab_t)

    tunable_policy(`cron_userdomain_transition',`
        allow crond_t $2_t:process transition;
        allow crond_t $2_t:fd use;
        allow crond_t $2_t:key manage_key_perms;

	    # needs to be authorized SELinux context for cron
	    allow $2_t user_cron_spool_t:file entrypoint;
        allow $2_t crond_t:fifo_file rw_fifo_file_perms;

        allow $2_t cronjob_t:process { signal_perms };

        ps_process_pattern($2_t, cronjob_t)
    ',`
        dontaudit crond_t $2_t:process transition;
        dontaudit crond_t $2_t:fd use;
        dontaudit crond_t $2_t:key manage_key_perms;

        dontaudit $2_t user_cron_spool_t:file entrypoint;

        dontaudit $2_t crond_t:fifo_file rw_fifo_file_perms;

        dontaudit $2_t cronjob_t:process { signal_perms };
    ')

	optional_policy(`
		gen_require(`
			class dbus send_msg;
		')

		dbus_stub(cronjob_t)

		allow cronjob_t $2_t:dbus send_msg;
		allow $2_t cronjob_t:dbus send_msg;
	')		

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_role'($*)) dnl
	')


########################################
## <summary>
##	Role access for unconfined cronjobs
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="userdomain_prefix">
##	<summary>
##	The prefix of the user domain (e.g., user
##	is the prefix for user_t).
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cron_unconfined_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_unconfined_role'($*)) dnl
	
	gen_require(`
		attribute crontab_domain;
		type unconfined_cronjob_t, crontab_t, crontab_exec_t;
        type crond_t, user_cron_spool_t;
        bool cron_userdomain_transition;
	')

    ##############################
    #
    # Declarations
    #
    
    role $1 types unconfined_cronjob_t;

    ##############################
    #
    # Local policy
    #

    dontaudit crond_t $2_t:process { noatsecure siginh rlimitinh };

    allow $2_t crond_t:process sigchld;

    allow $2_t user_cron_spool_t:file { getattr read write ioctl };

	# cronjob shows up in user ps
	ps_process_pattern($2_t, unconfined_cronjob_t)
	allow $2_t unconfined_cronjob_t:process signal_perms;

    cron_common_crontab_template($2)
	typeattribute $2_t crontab_domain;

	tunable_policy(`deny_ptrace',`',`
		allow $2_t unconfined_cronjob_t:process ptrace;
	')

    tunable_policy(`cron_userdomain_transition',`
        allow crond_t $2_t:process transition;
        allow crond_t $2_t:fd use;
        allow crond_t $2_t:key manage_key_perms;

        allow $2_t user_cron_spool_t:file entrypoint;

        allow $2_t crond_t:fifo_file rw_fifo_file_perms;
    ',`
        dontaudit crond_t $2_t:process transition;
        dontaudit crond_t $2_t:fd use;
        dontaudit crond_t $2_t:key manage_key_perms;

        dontaudit $2_t user_cron_spool_t:file entrypoint;

        dontaudit $2_t crond_t:fifo_file rw_fifo_file_perms;
    ')

	optional_policy(`
		gen_require(`
			class dbus send_msg;
		')

		dbus_stub(unconfined_cronjob_t)
		allow unconfined_cronjob_t $2_t:dbus send_msg;
		allow $2_t unconfined_cronjob_t:dbus send_msg;
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_unconfined_role'($*)) dnl
	')


########################################
## <summary>
##	Role access for cron
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="userdomain_prefix">
##	<summary>
##	The prefix of the user domain (e.g., user
##	is the prefix for user_t).
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cron_admin_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_admin_role'($*)) dnl
	
	gen_require(`
		attribute crontab_domain;
		type cronjob_t, crontab_exec_t, admin_crontab_t, admin_crontab_tmp_t;
		type user_cron_spool_t, crond_t;
		class passwd crontab;
        bool cron_userdomain_transition;
	')

    ##############################
    #
    # Declarations
    #

	role $1 types { cronjob_t admin_crontab_t admin_crontab_tmp_t };

    ##############################
    #
    # Local policy
    #

	# Transition from the user domain to the derived domain.
	domtrans_pattern($2_t, crontab_exec_t, admin_crontab_t)

	dontaudit crond_t $2_t:process { noatsecure siginh rlimitinh };

	allow $2_t crond_t:process sigchld;

	# crontab shows up in user ps
	ps_process_pattern($2_t, admin_crontab_t)
	allow $2_t admin_crontab_t:process signal_perms;

    cron_common_crontab_template($2)
	typeattribute $2_t crontab_domain;

	tunable_policy(`deny_ptrace',`',`
		allow $2_t admin_crontab_t:process ptrace;
	')

	# Manipulate other users crontab.
	allow $2_t self:passwd crontab;

	corecmd_exec_bin(admin_crontab_t)
	corecmd_exec_shell(admin_crontab_t)

    tunable_policy(`cron_userdomain_transition',`
        allow crond_t $2_t:process transition;
        allow crond_t $2_t:fd use;
        allow crond_t $2_t:key manage_key_perms;

        allow $2_t user_cron_spool_t:file entrypoint;

        allow $2_t crond_t:fifo_file rw_fifo_file_perms;

        allow $2_t cronjob_t:process { signal_perms };
        ps_process_pattern($2_t, cronjob_t)
    ',`
        dontaudit crond_t $2_t:process transition;
        dontaudit crond_t $2_t:fd use;
        dontaudit crond_t $2_t:key manage_key_perms;

        dontaudit $2_t user_cron_spool_t:file entrypoint;
        dontaudit $2_t crond_t:fifo_file rw_fifo_file_perms;
        dontaudit $2_t cronjob_t:process { signal_perms };
    ')

	optional_policy(`
		gen_require(`
			class dbus send_msg;
		')

		dbus_stub(admin_cronjob_t)

		allow cronjob_t $2_t:dbus send_msg;
		allow $2_t cronjob_t:dbus send_msg;
	')		

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_admin_role'($*)) dnl
	')


########################################
## <summary>
##	Make the specified program domain accessable
##	from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	The type of the process to transition to.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	The type of the file used as an entrypoint to this domain.
##	</summary>
## </param>
#
 	 	define(`cron_system_entry',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_system_entry'($*)) dnl
	
	gen_require(`
		type crond_t, system_cronjob_t;
	')

	domtrans_pattern(system_cronjob_t, $2, $1)
	domtrans_pattern(crond_t, $2, $1)

	role system_r types $1;

	allow $1 crond_t:fifo_file rw_fifo_file_perms;
	allow $1 system_cronjob_t:fifo_file rw_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_system_entry'($*)) dnl
	')


########################################
## <summary>
##	Execute cron in the cron system domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cron_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_domtrans'($*)) dnl
	
	gen_require(`
		type system_cronjob_t, crond_exec_t;
	')

	domtrans_pattern($1, crond_exec_t, system_cronjob_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute crond_exec_t 
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_exec'($*)) dnl
	
	gen_require(`
		type crond_exec_t;
	')

	can_exec($1, crond_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute crond server in the crond domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cron_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type crond_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, crond_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute crond server in the crond domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cron_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_systemctl'($*)) dnl
	
	gen_require(`
		type crond_unit_file_t;
		type crond_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 crond_unit_file_t:file read_file_perms;
	allow $1 crond_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, crond_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use a file descriptor
##	from the cron daemon.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_use_fds'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	allow $1 crond_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Send a SIGCHLD signal to the cron daemon.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_sigchld',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_sigchld'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	allow $1 crond_t:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_sigchld'($*)) dnl
	')


########################################
## <summary>
##	Send a generic signal to cron daemon.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_signal'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	allow $1 crond_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_signal'($*)) dnl
	')


########################################
## <summary>
##	Read a cron daemon unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_read_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_read_pipes'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	allow $1 crond_t:fifo_file read_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_read_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read crond state files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_read_state_crond',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_read_state_crond'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, crond_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_read_state_crond'($*)) dnl
	')



########################################
## <summary>
##	Send and receive messages from
##	crond over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_dbus_chat_crond',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dbus_chat_crond'($*)) dnl
	
	gen_require(`
		type crond_t;
		class dbus send_msg;
	')

	allow $1 crond_t:dbus send_msg;
	allow crond_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dbus_chat_crond'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	the cron system domain over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_dbus_chat_system_job',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dbus_chat_system_job'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
		class dbus send_msg;
	')

	allow $1 system_cronjob_t:dbus send_msg;
	allow system_cronjob_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dbus_chat_system_job'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to write cron daemon unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cron_dontaudit_write_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dontaudit_write_pipes'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	dontaudit $1 crond_t:fifo_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dontaudit_write_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write a cron daemon unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_rw_pipes'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	allow $1 crond_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_rw_pipes'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to setattr cron daemon unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cron_dontaudit_setattr_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dontaudit_setattr_pipes'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	dontaudit $1 crond_t:fifo_file setattr;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dontaudit_setattr_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write inherited user spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_rw_inherited_user_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_rw_inherited_user_spool_files'($*)) dnl
	
	gen_require(`
		type user_cron_spool_t;
	')

	allow $1 user_cron_spool_t:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_rw_inherited_user_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Read and write inherited spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_rw_inherited_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_rw_inherited_spool_files'($*)) dnl
	
	gen_require(`
		type cron_spool_t;
	')

	allow $1 cron_spool_t:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_rw_inherited_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Read, and write cron daemon TCP sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_rw_tcp_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_rw_tcp_sockets'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	allow $1 crond_t:tcp_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_rw_tcp_sockets'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit Read, and write cron daemon TCP sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cron_dontaudit_rw_tcp_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dontaudit_rw_tcp_sockets'($*)) dnl
	
	gen_require(`
		type crond_t;
	')

	dontaudit $1 crond_t:tcp_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dontaudit_rw_tcp_sockets'($*)) dnl
	')


########################################
## <summary>
##	Search the directory containing user cron tables.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_search_spool',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_search_spool'($*)) dnl
	
	gen_require(`
		type cron_spool_t;
	')

	files_search_spool($1)
	allow $1 cron_spool_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_search_spool'($*)) dnl
	')


########################################
## <summary>
##	Search the directory containing user cron tables.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_manage_system_spool',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_manage_system_spool'($*)) dnl
	
	gen_require(`
		type cron_system_spool_t;
	')

	files_search_spool($1)
	manage_files_pattern($1, cron_system_spool_t, cron_system_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_manage_system_spool'($*)) dnl
	')


########################################
## <summary>
##	Manage pid files used by cron
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_manage_pid_files'($*)) dnl
	
	gen_require(`
		type crond_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, crond_var_run_t, crond_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read pid files used by cron
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_read_pid_files'($*)) dnl
	
	gen_require(`
		type crond_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, crond_var_run_t, crond_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Execute anacron in the cron system domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cron_anacron_domtrans_system_job',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_anacron_domtrans_system_job'($*)) dnl
	
	gen_require(`
		type system_cronjob_t, anacron_exec_t;
	')

	domtrans_pattern($1, anacron_exec_t, system_cronjob_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_anacron_domtrans_system_job'($*)) dnl
	')


########################################
## <summary>
##	Send a null signal to cron system job.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_signull_system_job',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_signull_system_job'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
	')

	allow $1 system_cronjob_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_signull_system_job'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use a file descriptor
##	from system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_use_system_job_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_use_system_job_fds'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
	')

	allow $1 system_cronjob_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_use_system_job_fds'($*)) dnl
	')


########################################
## <summary>
##	Write a system cron job unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_write_system_job_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_write_system_job_pipes'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
	')

	allow $1 system_cronjob_t:fifo_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_write_system_job_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write a system cron job unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_rw_system_job_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_rw_system_job_pipes'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
	')

	allow $1 system_cronjob_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_rw_system_job_pipes'($*)) dnl
	')


########################################
## <summary>
##	Allow read/write unix stream sockets from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_rw_system_job_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_rw_system_job_stream_sockets'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
	')

	allow $1 system_cronjob_t:unix_stream_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_rw_system_job_stream_sockets'($*)) dnl
	')


########################################
## <summary>
##	Read temporary files from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_read_system_job_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_read_system_job_tmp_files'($*)) dnl
	
	gen_require(`
		type system_cronjob_tmp_t, cron_var_run_t;
	')

	files_search_tmp($1)
	allow $1 system_cronjob_tmp_t:file read_file_perms;

	files_search_pids($1)
	allow $1 cron_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_read_system_job_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to append temporary
##	files from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cron_dontaudit_append_system_job_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dontaudit_append_system_job_tmp_files'($*)) dnl
	
	gen_require(`
		type system_cronjob_tmp_t;
	')

	dontaudit $1 system_cronjob_tmp_t:file append_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dontaudit_append_system_job_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to write temporary
##	files from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`cron_dontaudit_write_system_job_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dontaudit_write_system_job_tmp_files'($*)) dnl
	
	gen_require(`
		type system_cronjob_tmp_t;
		type cron_var_run_t;
	')

	dontaudit $1 system_cronjob_tmp_t:file write_file_perms;
	dontaudit $1 cron_var_run_t:file write_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dontaudit_write_system_job_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Send to system_cronjob over a unix domain
##	datagram socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_dgram_send',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_dgram_send'($*)) dnl
	
	gen_require(`
		type system_cronjob_t;
	')

	allow $1 system_cronjob_t:unix_dgram_socket sendto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_dgram_send'($*)) dnl
	')


########################################
## <summary>
##	Read temporary files from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_read_system_job_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_read_system_job_lib_files'($*)) dnl
	
	gen_require(`
		type system_cronjob_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, system_cronjob_var_lib_t, system_cronjob_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_read_system_job_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage files from the system cron jobs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cron_manage_system_job_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_manage_system_job_lib_files'($*)) dnl
	
	gen_require(`
		type system_cronjob_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, system_cronjob_var_lib_t, system_cronjob_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_manage_system_job_lib_files'($*)) dnl
	')


#######################################
## <summary>
##  Create, read, write and delete
##  cron log files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`cron_manage_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_manage_log_files'($*)) dnl
	
    gen_require(`
        type cron_log_t;
    ')

    manage_files_pattern($1, cron_log_t, cron_log_t)

    logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_manage_log_files'($*)) dnl
	')


#######################################
## <summary>
##  Create specified objects in generic
##  log directories with the cron log file type.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
## <param name="object_class">
##  <summary>
##  Class of the object being created.
##  </summary>
## </param>
## <param name="name" optional="true">
##  <summary>
##  The name of the object being created.
##  </summary>
## </param>
#
 	 	define(`cron_generic_log_filetrans_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_generic_log_filetrans_log'($*)) dnl
	
    gen_require(`
        type cron_log_t;
    ')

    logging_log_filetrans($1, cron_log_t, $2, $3)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_generic_log_filetrans_log'($*)) dnl
	')


#######################################
## <summary>
##  Create specified objects in generic
##  log directories with the cron log file type.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
## <param name="object_class">
##  <summary>
##  Class of the object being created.
##  </summary>
## </param>
## <param name="name" optional="true">
##  <summary>
##  The name of the object being created.
##  </summary>
## </param>
#
 	 	define(`cron_generic_log_filetrans_log_insights',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_generic_log_filetrans_log_insights'($*)) dnl
	
    gen_require(`
        type var_log_t;
    ')

    logging_log_filetrans($1, var_log_t, file, "redhat-access-insights.log")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_generic_log_filetrans_log_insights'($*)) dnl
	')


########################################
## <summary>
##	Allow system_cron_spool_t to be an entrypoint of this domain
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cron_system_spool_entrypoint',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cron_system_spool_entrypoint'($*)) dnl
	
	gen_require(`
		attribute system_cron_spool_t;
	')
	allow $1 system_cron_spool_t:file entrypoint;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cron_system_spool_entrypoint'($*)) dnl
	')


########################################
## <summary>
##	Execute crontab in the crontab domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`crontab_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `crontab_domtrans'($*)) dnl
	
	gen_require(`
		type crontab_exec_t, crontab_t;
	')

	domtrans_pattern($1, crontab_exec_t, crontab_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `crontab_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute crontab in the admin crontab domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`crontab_admin_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `crontab_admin_domtrans'($*)) dnl
	
	gen_require(`
		type crontab_exec_t, admin_crontab_t;
	')

	domtrans_pattern($1, crontab_exec_t, admin_crontab_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `crontab_admin_domtrans'($*)) dnl
	')


## <summary>policy for ctdbd</summary>

########################################
## <summary>
##	Transition to ctdbd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`ctdbd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_domtrans'($*)) dnl
	
	gen_require(`
		type ctdbd_t, ctdbd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ctdbd_exec_t, ctdbd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute ctdbd server in the ctdbd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type ctdbd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, ctdbd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_initrc_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Allow domain to signal ctdbd.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`ctdbd_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_signal'($*)) dnl
	
    gen_require(`
        type ctdbd_t;
    ')
        allow $1 ctdbd_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_signal'($*)) dnl
	')


#######################################
## <summary>
##  Allow domain to sigchld ctdbd.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`ctdbd_sigchld',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_sigchld'($*)) dnl
	
    gen_require(`
        type ctdbd_t;
    ')
        allow $1 ctdbd_t:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_sigchld'($*)) dnl
	')


########################################
## <summary>
##	Read ctdbd's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ctdbd_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_read_log'($*)) dnl
	
	gen_require(`
		type ctdbd_log_t;
	')

	logging_search_logs($1)
        read_files_pattern($1, ctdbd_log_t, ctdbd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append to ctdbd log files.
## </summary>
## <param name="domain">
## 	<summary>
##	Domain allowed to transition.
## 	</summary>
## </param>
#
 	 	define(`ctdbd_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_append_log'($*)) dnl
	
	gen_require(`
		type ctdbd_log_t;
	')

	logging_search_logs($1)
        append_files_pattern($1, ctdbd_log_t, ctdbd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_append_log'($*)) dnl
	')


########################################
## <summary>
##	Manage ctdbd log files
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`ctdbd_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_manage_log'($*)) dnl
	
	gen_require(`
		type ctdbd_log_t;
	')

	logging_search_logs($1)
        manage_dirs_pattern($1, ctdbd_log_t, ctdbd_log_t)
        manage_files_pattern($1, ctdbd_log_t, ctdbd_log_t)
        manage_lnk_files_pattern($1, ctdbd_log_t, ctdbd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Search ctdbd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_search_lib'($*)) dnl
	
	gen_require(`
		type ctdbd_var_lib_t;
	')

	allow $1 ctdbd_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read ctdbd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_read_lib_files'($*)) dnl
	
	gen_require(`
		type ctdbd_var_lib_t;
	')

	files_search_var_lib($1)
        read_files_pattern($1, ctdbd_var_lib_t, ctdbd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Map ctdbd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_map_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_map_lib_files'($*)) dnl
	
	gen_require(`
		type ctdbd_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 ctdbd_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_map_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage ctdbd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_manage_lib_files'($*)) dnl
	
	gen_require(`
		type ctdbd_var_lib_t;
	')

	files_search_var_lib($1)
        manage_files_pattern($1, ctdbd_var_lib_t, ctdbd_var_lib_t)
	allow $1 ctdbd_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage ctdbd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type ctdbd_var_lib_t;
	')

	files_search_var_lib($1)
        manage_dirs_pattern($1, ctdbd_var_lib_t, ctdbd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read ctdbd PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ctdbd_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_read_pid_files'($*)) dnl
	
	gen_require(`
		type ctdbd_var_run_t;
	')

	files_search_pids($1)
	allow $1 ctdbd_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_read_pid_files'($*)) dnl
	')


#######################################
## <summary>
##  Connect to ctdbd over a unix stream socket.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`ctdbd_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_stream_connect'($*)) dnl
	
    gen_require(`
        type ctdbd_t, ctdbd_var_run_t, ctdbd_tmp_t;
    ')

    files_search_pids($1)
    stream_connect_pattern($1, ctdbd_var_run_t, ctdbd_var_run_t, ctdbd_t)
    stream_connect_pattern($1, ctdbd_tmp_t, ctdbd_tmp_t, ctdbd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an ctdbd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ctdbd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ctdbd_admin'($*)) dnl
	
	gen_require(`
		type ctdbd_t, ctdbd_initrc_exec_t;
		type ctdbd_log_t, ctdbd_var_lib_t, ctdbd_var_run_t;
	')

	allow $1 ctdbd_t:process signal_perms;
	ps_process_pattern($1, ctdbd_t)
	tunable_policy(`deny_ptrace',`',`
		allow $1 ctdbd_t:process ptrace;
	')

	ctdbd_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 ctdbd_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, ctdbd_log_t)

	files_search_var_lib($1)
	admin_pattern($1, ctdbd_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, ctdbd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ctdbd_admin'($*)) dnl
	')


## <summary>Common UNIX printing system.</summary>

########################################
## <summary>
##	Create a domain which can be
##	started by cupsd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="entry_point">
##	<summary>
##	Type of the program to be used as an entry point to this domain.
##	</summary>
## </param>
#
 	 	define(`cups_backend',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_backend'($*)) dnl
	
	gen_require(`
		type cupsd_t;
	')

	domain_type($1)
	domain_entry_file($1, $2)
	role system_r types $1;

	domtrans_pattern(cupsd_t, $2, $1)
	allow cupsd_t $1:process signal;
	allow $1 cupsd_t:unix_stream_socket connected_stream_socket_perms;

	cups_read_config($1)
	cups_append_log($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_backend'($*)) dnl
	')


########################################
## <summary>
##	Execute cups in the cups domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cups_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_domtrans'($*)) dnl
	
	gen_require(`
		type cupsd_t, cupsd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cupsd_exec_t, cupsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Connect to cupsd over an unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_stream_connect'($*)) dnl
	
	gen_require(`
		type cupsd_t, cupsd_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, cupsd_var_run_t, cupsd_var_run_t, cupsd_t)
	allow $1 cupsd_var_run_t:sock_file read_sock_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Connect to cups over TCP.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_tcp_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_tcp_connect'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_tcp_connect'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	cups over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_dbus_chat'($*)) dnl
	
	gen_require(`
		type cupsd_t;
		class dbus send_msg;
	')

	allow $1 cupsd_t:dbus send_msg;
	allow cupsd_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Read cups PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_read_pid_files'($*)) dnl
	
	gen_require(`
		type cupsd_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, cupsd_var_run_t, cupsd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Execute cups_config in the
##	cups config domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cups_domtrans_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_domtrans_config'($*)) dnl
	
	gen_require(`
		type cupsd_config_t, cupsd_config_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cupsd_config_exec_t, cupsd_config_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_domtrans_config'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to the cups
##	configuration daemon.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_signal_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_signal_config'($*)) dnl
	
	gen_require(`
		type cupsd_config_t;
	')

	allow $1 cupsd_config_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_signal_config'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	cupsd_config over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_dbus_chat_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_dbus_chat_config'($*)) dnl
	
	gen_require(`
		type cupsd_config_t;
		class dbus send_msg;
	')

	allow $1 cupsd_config_t:dbus send_msg;
	allow cupsd_config_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_dbus_chat_config'($*)) dnl
	')


########################################
## <summary>
##	Read cups configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cups_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_read_config'($*)) dnl
	
	gen_require(`
		type cupsd_etc_t, cupsd_rw_etc_t;
		type hplip_etc_t;
	')

	files_search_etc($1)
	read_files_pattern($1, cupsd_etc_t, cupsd_etc_t)
	read_files_pattern($1, hplip_etc_t, hplip_etc_t)
	read_files_pattern($1, cupsd_etc_t, cupsd_rw_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_read_config'($*)) dnl
	')


########################################
## <summary>
##	Read cups-writable configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cups_read_rw_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_read_rw_config'($*)) dnl
	
	gen_require(`
		type cupsd_etc_t, cupsd_rw_etc_t;
	')

	files_search_etc($1)
	read_files_pattern($1, cupsd_etc_t, cupsd_rw_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_read_rw_config'($*)) dnl
	')


########################################
## <summary>
##	Read cups log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cups_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_read_log'($*)) dnl
	
	gen_require(`
		type cupsd_log_t;
	')

	logging_search_logs($1)
	allow $1 cupsd_log_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append cups log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_append_log'($*)) dnl
	
	gen_require(`
		type cupsd_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, cupsd_log_t, cupsd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_append_log'($*)) dnl
	')


########################################
## <summary>
##	Write cups log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_write_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_write_log'($*)) dnl
	
	gen_require(`
		type cupsd_log_t;
	')

	logging_search_logs($1)
	allow $1 cupsd_log_t:file write_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_write_log'($*)) dnl
	')


########################################
## <summary>
##	Connect to ptal over an unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_stream_connect_ptal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_stream_connect_ptal'($*)) dnl
	
	gen_require(`
		type ptal_t, ptal_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, ptal_var_run_t, ptal_var_run_t, ptal_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_stream_connect_ptal'($*)) dnl
	')


########################################
## <summary>
##	Execute cupsd server in the cupsd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`cupsd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cupsd_systemctl'($*)) dnl
	
	gen_require(`
		type cupsd_t;
		type cupsd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 cupsd_unit_file_t:file read_file_perms;
	allow $1 cupsd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, cupsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cupsd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Read the process state (/proc/pid) of cupsd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_read_state'($*)) dnl
	
	gen_require(`
		type cupsd_t;
	')

	allow $1 cupsd_t:dir search_dir_perms;
	allow $1 cupsd_t:file read_file_perms;
	allow $1 cupsd_t:lnk_file read_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_read_state'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cups environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cups_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_admin'($*)) dnl
	
	gen_require(`
		type cupsd_t, cupsd_tmp_t, cupsd_lpd_tmp_t;
		type cupsd_etc_t, cupsd_log_t;
		type cupsd_config_var_run_t, cupsd_lpd_var_run_t;
		type cupsd_var_run_t, ptal_etc_t, cupsd_rw_etc_t;
		type ptal_var_run_t, hplip_var_run_t, cupsd_initrc_exec_t;
		type cupsd_config_t, cupsd_lpd_t, cups_pdf_t;
		type ptal_t;
		type cupsd_unit_file_t;
	')

	allow $1 { cupsd_t cupsd_config_t cupsd_lpd_t }:process { signal_perms };
	allow $1 { cups_pdf_t ptal_t }:process { signal_perms };
	ps_process_pattern($1, { cupsd_t cupsd_config_t cupsd_lpd_t })
	ps_process_pattern($1, { cups_pdf_t ptal_t })

	tunable_policy(`deny_ptrace',`',`
		allow $1 { cupsd_t cupsd_config_t cupsd_lpd_t }:process ptrace;
	')

	init_labeled_script_domtrans($1, cupsd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 cupsd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, { cupsd_etc_t cupsd_rw_etc_t ptal_etc_t })

	logging_list_logs($1)
	admin_pattern($1, cupsd_log_t)

	files_list_tmp($1)
	admin_pattern($1, { cupsd_tmp_t  cupsd_lpd_tmp_t })
	admin_pattern($1, { cupsd_config_var_run_t cupsd_var_run_t hplip_var_run_t })
	admin_pattern($1, { ptal_var_run_t cupsd_lpd_var_run_t })

	cupsd_systemctl($1)
	admin_pattern($1, cupsd_unit_file_t)
	allow $1 cupsd_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_admin'($*)) dnl
	')


########################################
## <summary>
##	Transition to cups named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cups_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cups_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type cupsd_rw_etc_t;
		type cupsd_etc_t;
	')

	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "classes.conf")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "printers.conf")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "printers.conf.O")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "cupsd.conf")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "cupsd.conf.default")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "lpoptions")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "subscriptions.conf")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "subscriptions.conf.O")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "subscriptions.conf.N")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, file, "ppds.dat")
	filetrans_pattern($1, cupsd_etc_t, cupsd_rw_etc_t, dir, "ppd")
	files_etc_filetrans($1, cupsd_rw_etc_t, file, "printcap")
	files_etc_filetrans($1, cupsd_rw_etc_t, file, "ppds.dat")
	files_etc_filetrans($1, cupsd_rw_etc_t, file, "ppd")
	files_etc_filetrans($1, cupsd_rw_etc_t, dir, "inf")
	files_etc_filetrans($1, cupsd_rw_etc_t, dir, "ppd")
	files_usr_filetrans($1, cupsd_rw_etc_t, dir, "inf")
	corecmd_bin_filetrans($1, cupsd_rw_etc_t, dir, "inf")
	files_var_filetrans($1, cupsd_rw_etc_t, dir, "cups")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cups_filetrans_named_content'($*)) dnl
	')

## <summary>Concurrent versions system.</summary>

######################################
## <summary>
##  Dontaudit Attempts to list the CVS data and metadata.
## </summary>
## <param name="domain">
##  <summary>
##	Domain to not audit.
##  </summary>
## </param>
#
 	 	define(`cvs_dontaudit_list_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cvs_dontaudit_list_data'($*)) dnl
	
    gen_require(`
        type cvs_data_t;
    ')

    dontaudit $1 cvs_data_t:dir list_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cvs_dontaudit_list_data'($*)) dnl
	')


########################################
## <summary>
##	Read CVS data and metadata content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cvs_read_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cvs_read_data'($*)) dnl
	
	gen_require(`
		type cvs_data_t;
	')

	list_dirs_pattern($1, cvs_data_t, cvs_data_t)
	read_files_pattern($1, cvs_data_t, cvs_data_t)
	read_lnk_files_pattern($1, cvs_data_t, cvs_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cvs_read_data'($*)) dnl
	')


########################################
## <summary>
##	Execute cvs in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cvs_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cvs_exec'($*)) dnl
	
	gen_require(`
		type cvs_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, cvs_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cvs_exec'($*)) dnl
	')


########################################
## <summary>
##	Transition to cvs named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cvs_filetrans_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cvs_filetrans_home_content'($*)) dnl
	
	gen_require(`
		type cvs_home_t;
	')

	userdom_user_home_dir_filetrans($1, cvs_home_t, file, ".cvsignore")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cvs_filetrans_home_content'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cvs environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cvs_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cvs_admin'($*)) dnl
	
	gen_require(`
		type cvs_t, cvs_tmp_t, cvs_initrc_exec_t;
		type cvs_data_t, cvs_var_run_t, cvs_keytab_t;
		type cvs_home_t;
	')

	allow $1 cvs_t:process signal_perms;
	ps_process_pattern($1, cvs_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 cvs_t:process ptrace;
	')

	# Allow cvs_t to restart the apache service
	init_labeled_script_domtrans($1, cvs_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 cvs_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, cvs_keytab_t)

	files_list_tmp($1)
	admin_pattern($1, cvs_tmp_t)

	files_search_usr($1)
	admin_pattern($1, cvs_data_t)

	files_list_pids($1)
	admin_pattern($1, cvs_var_run_t)

	userdom_search_user_home_dirs($1)
	admin_pattern($1, cvs_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cvs_admin'($*)) dnl
	')

## <summary>Cyphesis WorldForge game server.</summary>

########################################
## <summary>
##	Execute a domain transition to run cyphesis.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`cyphesis_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyphesis_domtrans'($*)) dnl
	
	gen_require(`
		type cyphesis_t, cyphesis_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cyphesis_exec_t, cyphesis_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyphesis_domtrans'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cyphesis environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cyphesis_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyphesis_admin'($*)) dnl
	
	gen_require(`
		type cyphesis_t, cyphesis_initrc_exec_t, cyphesis_log_t;
		type cyphesis_var_run_t, cyphesis_tmp_t;
	')

	allow $1 cyphesis_t:process { ptrace signal_perms };
	ps_process_pattern($1, cyphesis_t)

	init_labeled_script_domtrans($1, cyphesis_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 cyphesis_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, cyphesis_log_t)

	files_search_pids($1)
	admin_pattern($1, cyphesis_var_run_t)

	files_search_tmp($1)
	admin_pattern($1, cyphesis_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyphesis_admin'($*)) dnl
	')

## <summary>Cyrus is an IMAP service intended to be run on sealed servers.</summary>

########################################
## <summary>
##	Create, read, write, and delete
##	cyrus data files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cyrus_manage_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyrus_manage_data'($*)) dnl
	
	gen_require(`
		type cyrus_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, cyrus_var_lib_t, cyrus_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyrus_manage_data'($*)) dnl
	')


#######################################
## <summary>
##  Allow write cyrus data files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`cyrus_write_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyrus_write_data'($*)) dnl
	
    gen_require(`
        type cyrus_var_lib_t;
    ')

    files_search_var_lib($1)
    write_files_pattern($1, cyrus_var_lib_t, cyrus_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyrus_write_data'($*)) dnl
	')


########################################
## <summary>
##	Connect to Cyrus using a unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cyrus_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyrus_stream_connect'($*)) dnl
	
	gen_require(`
		type cyrus_t, cyrus_var_lib_t, cyrus_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, cyrus_var_run_t, cyrus_var_run_t, cyrus_t)
	# deprecated, new socket location is in /run
	files_search_var_lib($1)
	stream_connect_pattern($1, cyrus_var_lib_t, cyrus_var_lib_t, cyrus_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyrus_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Connect to Cyrus using a unix
##	domain stream socket in the runtime filesystem.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`cyrus_runtime_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyrus_runtime_stream_connect'($*)) dnl
	
	gen_require(`
		type cyrus_t, cyrus_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, cyrus_var_run_t, cyrus_var_run_t, cyrus_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyrus_runtime_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an cyrus environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`cyrus_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `cyrus_admin'($*)) dnl
	
	gen_require(`
		type cyrus_t, cyrus_tmp_t, cyrus_var_lib_t;
		type cyrus_var_run_t, cyrus_initrc_exec_t;
		type cyrus_keytab_t;
	')

	allow $1 cyrus_t:process signal_perms;
	ps_process_pattern($1, cyrus_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 cyrus_t:process ptrace;
	')

	init_labeled_script_domtrans($1, cyrus_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 cyrus_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, cyrus_keytab_t)

	files_list_tmp($1)
	admin_pattern($1, cyrus_tmp_t)

	files_list_var_lib($1)
	admin_pattern($1, cyrus_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, cyrus_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `cyrus_admin'($*)) dnl
	')

## <summary>Collection of tools for managing UNIX services.</summary>

########################################
## <summary>
##	An ipc channel between the
##	supervised domain and svc_start_t.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`daemontools_ipc_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_ipc_domain'($*)) dnl
	
	gen_require(`
		type svc_start_t;
	')

	allow $1 svc_start_t:process sigchld;
	allow $1 svc_start_t:fd use;
	allow $1 svc_start_t:fifo_file rw_fifo_file_perms;
	allow svc_start_t $1:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_ipc_domain'($*)) dnl
	')


########################################
## <summary>
##	Create a domain which can be
##	started by daemontools.
## </summary>
## <param name="domain">
##	<summary>
##	Type to be used as a domain.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	Type of the program to be used as an entry point to this domain.
##	</summary>
## </param>
#
 	 	define(`daemontools_service_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_service_domain'($*)) dnl
	
	gen_require(`
		type svc_run_t;
	')

	domain_auto_trans(svc_run_t, $2, $1)
	daemontools_ipc_domain($1)

	allow svc_run_t $1:process signal;
	allow $1 svc_run_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_service_domain'($*)) dnl
	')


########################################
## <summary>
##	Execute svc start in the svc
##	start domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`daemontools_domtrans_start',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_domtrans_start'($*)) dnl
	
	gen_require(`
		type svc_start_t, svc_start_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, svc_start_exec_t, svc_start_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_domtrans_start'($*)) dnl
	')


######################################
## <summary>
##	Execute svc start in the svc
##	start domain, and allow the
##	specified role the svc start domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`daemonstools_run_start',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemonstools_run_start'($*)) dnl
	
	gen_require(`
		attribute_role svc_start_roles;
	')

	daemontools_domtrans_start($1)
	roleattribute $2 svc_start_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemonstools_run_start'($*)) dnl
	')


########################################
## <summary>
##	Execute avc run in the svc run domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`daemontools_domtrans_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_domtrans_run'($*)) dnl
	
	gen_require(`
		type svc_run_t, svc_run_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, svc_run_exec_t, svc_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_domtrans_run'($*)) dnl
	')


######################################
## <summary>
##	Send child terminated signals
##	to svc run.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`daemontools_sigchld_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_sigchld_run'($*)) dnl
	
	gen_require(`
		type svc_run_t;
	')

	allow $1 svc_run_t:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_sigchld_run'($*)) dnl
	')


########################################
## <summary>
##	Execute avc multilog in the svc
##	multilog domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`daemontools_domtrans_multilog',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_domtrans_multilog'($*)) dnl
	
	gen_require(`
		type svc_multilog_t, svc_multilog_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, svc_multilog_exec_t, svc_multilog_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_domtrans_multilog'($*)) dnl
	')


######################################
## <summary>
##	Search svc svc directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`daemontools_search_svc_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_search_svc_dir'($*)) dnl
	
	gen_require(`
		type svc_svc_t;
	')

	files_search_var($1)
	allow $1 svc_svc_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_search_svc_dir'($*)) dnl
	')


########################################
## <summary>
##	Read svc avc files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`daemontools_read_svc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_read_svc'($*)) dnl
	
	gen_require(`
		type svc_svc_t;
	')

	files_search_var($1)
	allow $1 svc_svc_t:dir list_dir_perms;
	allow $1 svc_svc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_read_svc'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write and delete
##	svc svc content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`daemontools_manage_svc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `daemontools_manage_svc'($*)) dnl
	
	gen_require(`
		type svc_svc_t;
	')

	files_search_var($1)
	allow $1 svc_svc_t:dir manage_dir_perms;
	allow $1 svc_svc_t:fifo_file manage_fifo_file_perms;
	allow $1 svc_svc_t:file manage_file_perms;
	allow $1 svc_svc_t:lnk_file manage_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `daemontools_manage_svc'($*)) dnl
	')


## <summary>Dante msproxy and socks4/5 proxy server.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an dante environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dante_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dante_admin'($*)) dnl
	
	gen_require(`
		type dante_t, dante_conf_t, dante_var_run_t;
		type dante_initrc_exec_t;
	')

	allow $1 dante_t:process { ptrace signal_perms };
	ps_process_pattern($1, dante_t)

	init_labeled_script_domtrans($1, dante_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dante_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, dante_conf_t)

	files_search_pids($1)
	admin_pattern($1, dante_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dante_admin'($*)) dnl
	')

## <summary>Database administrator role.</summary>

########################################
## <summary>
##	Change to the database administrator role.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dbadm_role_change',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbadm_role_change'($*)) dnl
	
	gen_require(`
		role dbadm_r;
	')

	allow $1 dbadm_r;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbadm_role_change'($*)) dnl
	')


########################################
## <summary>
##	Change from the database administrator role.
## </summary>
## <desc>
##	<p>
##	Change from the database administrator role to
##	the specified role.
##	</p>
##	<p>
##	This is an interface to support third party modules
##	and its use is not allowed in upstream reference
##	policy.
##	</p>
## </desc>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dbadm_role_change_to',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbadm_role_change_to'($*)) dnl
	
	gen_require(`
		role dbadm_r;
	')

	allow dbadm_r $1;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbadm_role_change_to'($*)) dnl
	')

## <summary>Dictionary server for the SKK Japanese input method system.</summary>
## <summary>Desktop messaging bus</summary>

########################################
## <summary>
##	DBUS stub interface.  No access allowed.
## </summary>
## <param name="domain" unused="true">
##	<summary>
##	Domain allowed access
##	</summary>
## </param>
#
 	 	define(`dbus_stub',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_stub'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
		class dbus all_dbus_perms;
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_stub'($*)) dnl
	')


########################################
## <summary>
##	Execute dbus-daemon in the caller domain.
## </summary>
## <param name="domain" unused="true">
##	<summary>
##	Domain allowed access
##	</summary>
## </param>
#
 	 	define(`dbus_exec_dbusd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_exec_dbusd'($*)) dnl
	
	gen_require(`
        type dbusd_exec_t;
	')
    can_exec($1, dbusd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_exec_dbusd'($*)) dnl
	')


########################################
## <summary>
##	Role access for dbus
## </summary>
## <param name="role_prefix">
##	<summary>
##	The prefix of the user role (e.g., user
##	is the prefix for user_r).
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`dbus_role_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_role_template'($*)) dnl
	
	gen_require(`
		class dbus { send_msg acquire_svc };
		attribute dbusd_unconfined, session_bus_type;
		type system_dbusd_t, session_dbusd_tmp_t, dbusd_exec_t, dbusd_etc_t;
		type $1_t;
	')

	##############################
	#
	# Delcarations
	#

	type $1_dbusd_t, session_bus_type;
	application_domain($1_dbusd_t, dbusd_exec_t)
	ubac_constrained($1_dbusd_t)
	role $2 types $1_dbusd_t;

	kernel_read_system_state($1_dbusd_t)

	selinux_get_fs_mount($1_dbusd_t)

	userdom_home_manager($1_dbusd_t)

	##############################
	#
	# Local policy
	#

	# For connecting to the bus
	allow $3 $1_dbusd_t:unix_stream_socket { accept connectto listen rw_socket_perms create };
	allow $1_dbusd_t $3:unix_stream_socket { accept getattr getopt  read write };
    allow $1_dbusd_t $3:unix_dgram_socket sendto;

	# SE-DBus specific permissions
	allow { dbusd_unconfined $3 } $1_dbusd_t:dbus { send_msg acquire_svc };
	allow $1_dbusd_t { dbusd_unconfined $3 }:dbus send_msg;
	allow $3 system_dbusd_t:dbus { send_msg acquire_svc };
	allow system_dbusd_t $3:dbus send_msg;

    # Permissions for dbus-broker running with systemd user sessions
    allow $3 $1_dbusd_t:process { noatsecure rlimitinh siginh };
    allow $1_dbusd_t $3:dbus send_msg;
    allow $3 $1_dbusd_t:dbus send_msg;
    allow $1_dbusd_t $3:system { reload start status };
    allow $1_dbusd_t session_dbusd_tmp_t:service { start stop };
    allow $3 session_dbusd_tmp_t:dir manage_dir_perms;
    allow $3 session_dbusd_tmp_t:file manage_file_perms;

    can_exec($1_dbusd_t, dbusd_exec_t)

	domtrans_pattern($3, dbusd_exec_t, $1_dbusd_t)

	ps_process_pattern($3, $1_dbusd_t)
	allow $3 $1_dbusd_t:process signal_perms;

	tunable_policy(`deny_ptrace',`',`
		allow $3 $1_dbusd_t:process ptrace;
	')

	# cjp: this seems very broken
	corecmd_bin_domtrans($1_dbusd_t, $1_t)
	corecmd_shell_domtrans($1_dbusd_t, $1_t)
	allow $1_dbusd_t $3:process sigkill;
	allow $3 $1_dbusd_t:fd use;
	allow $3 $1_dbusd_t:fifo_file rw_fifo_file_perms;

	auth_use_nsswitch($1_dbusd_t)

	files_config_all_files($1_dbusd_t)

	logging_send_syslog_msg($1_dbusd_t)

	dontaudit $1_dbusd_t self:capability net_admin;

	optional_policy(`
		mozilla_domtrans_spec($1_dbusd_t, $1_t)
	')

	optional_policy(`
		systemd_start_systemd_services($1_dbusd_t)
	')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_role_template'($*)) dnl
	')


#######################################
## <summary>
##	Template for creating connections to
##	the system DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_system_bus_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_system_bus_client'($*)) dnl
	
	gen_require(`
		type system_dbusd_t, system_dbusd_t;
		type system_dbusd_var_run_t, system_dbusd_var_lib_t;
		class dbus send_msg;
		attribute dbusd_unconfined;
	')

	# SE-DBus specific permissions
	allow $1 self:dbus send_msg;
	allow $1 { system_dbusd_t dbusd_unconfined }:dbus send_msg;
	allow { system_dbusd_t dbusd_unconfined } $1:dbus send_msg;

	read_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
	read_lnk_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
	files_search_var_lib($1)

	dev_read_urand($1)

	# For connecting to the bus
	files_search_pids($1)
	stream_connect_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t, system_dbusd_t)
	dbus_read_config($1)

    optional_policy(`
        unconfined_server_dbus_chat($1)
    ')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_system_bus_client'($*)) dnl
	')


#######################################
## <summary>
##	Creating connections to specified
##	DBUS sessions.
## </summary>
## <param name="role_prefix">
##	<summary>
##	The prefix of the user role (e.g., user
##	is the prefix for user_r).
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_session_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_session_client'($*)) dnl
	
	gen_require(`
		class dbus send_msg;
		type $1_dbusd_t;
	')

	allow $2 $1_dbusd_t:fd use;
	allow $2 { $1_dbusd_t self }:dbus send_msg;
	allow $2 $1_dbusd_t:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_session_client'($*)) dnl
	')


#######################################
## <summary>
##	Template for creating connections to
##	a user DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_session_bus_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_session_bus_client'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
		class dbus send_msg;
	')

	# SE-DBus specific permissions
	allow $1 self:dbus send_msg;
	allow $1 session_bus_type:dbus send_msg;
	allow session_bus_type $1:dbus send_msg;

	# For connecting to the bus
	allow $1 session_bus_type:unix_stream_socket connectto;

	allow session_bus_type $1:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_session_bus_client'($*)) dnl
	')


########################################
## <summary>
##	Send a message the session DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_send_session_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_send_session_bus'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
		class dbus send_msg;
	')

	allow $1 session_bus_type:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_send_session_bus'($*)) dnl
	')


########################################
## <summary>
##	Read dbus configuration.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_read_config'($*)) dnl
	
	gen_require(`
		type dbusd_etc_t;
	')

	allow $1 dbusd_etc_t:dir list_dir_perms;
	allow $1 dbusd_etc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_read_config'($*)) dnl
	')


########################################
## <summary>
##	Watch dbus configuration.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_watch_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_watch_config'($*)) dnl
	
	gen_require(`
		type dbusd_etc_t;
	')

	allow $1 dbusd_etc_t:dir watch_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_watch_config'($*)) dnl
	')


########################################
## <summary>
##	Read system dbus lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_read_lib_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
	read_lnk_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	system dbus lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_manage_lib_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Connect to the system DBUS
##	for service (acquire_svc).
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_connect_session_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_connect_session_bus'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
		class dbus acquire_svc;
	')

	allow $1 session_bus_type:dbus acquire_svc;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_connect_session_bus'($*)) dnl
	')


########################################
## <summary>
##	Allow a application domain to be started
##	by the session dbus.
## </summary>
## <param name="domain_prefix">
##	<summary>
##	User domain prefix to be used.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	Type to be used as a domain.
##	</summary>
## </param>
## <param name="entry_point">
##	<summary>
##	Type of the program to be used as an
##	entry point to this domain.
##	</summary>
## </param>
#
 	 	define(`dbus_session_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_session_domain'($*)) dnl
	
	gen_require(`
		type $1_dbusd_t;
	')

	domtrans_pattern($1_dbusd_t, $2, $3)

	dbus_session_bus_client($3)
	dbus_connect_session_bus($3)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_session_domain'($*)) dnl
	')


########################################
## <summary>
##	Connect to the system DBUS
##	for service (acquire_svc).
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_connect_system_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_connect_system_bus'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
		class dbus acquire_svc;
	')

	allow $1 system_dbusd_t:dbus acquire_svc;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_connect_system_bus'($*)) dnl
	')


########################################
## <summary>
##	Send a message on the system DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_send_system_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_send_system_bus'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
		class dbus send_msg;
	')

	allow $1 system_dbusd_t:dbus send_msg;
	allow system_dbusd_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_send_system_bus'($*)) dnl
	')


########################################
## <summary>
##	Allow unconfined access to the system DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_system_bus_unconfined',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_system_bus_unconfined'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
		class dbus all_dbus_perms;
	')

	allow $1 system_dbusd_t:dbus *;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_system_bus_unconfined'($*)) dnl
	')


########################################
## <summary>
##	Create a domain for processes
##	which can be started by the system dbus
## </summary>
## <param name="domain">
##	<summary>
##	Type to be used as a domain.
##	</summary>
## </param>
## <param name="entry_point">
##	<summary>
##	Type of the program to be used as an entry point to this domain.
##	</summary>
## </param>
#
 	 	define(`dbus_system_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_system_domain'($*)) dnl
	
	gen_require(`
		attribute system_bus_type;
		type system_dbusd_t;
		role system_r;
	')
	typeattribute $1  system_bus_type;

	domain_type($1)
	domain_entry_file($1, $2)

	domtrans_pattern(system_dbusd_t, $2, $1)
	init_system_domain($1, $2)

	ps_process_pattern($1, system_dbusd_t)


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_system_domain'($*)) dnl
	')


########################################
## <summary>
##	Use and inherit system DBUS file descriptors.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_use_system_bus_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_use_system_bus_fds'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
	')

	allow $1 system_dbusd_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_use_system_bus_fds'($*)) dnl
	')


########################################
## <summary>
##	Allow unconfined access to the system DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_unconfined',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_unconfined'($*)) dnl
	
	gen_require(`
		attribute dbusd_unconfined;
	')

	typeattribute $1 dbusd_unconfined;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_unconfined'($*)) dnl
	')


########################################
## <summary>
##	Delete all dbus pid files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_delete_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_delete_pid_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	files_search_pids($1)
	delete_files_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_delete_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read all dbus pid files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_read_pid_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	files_search_pids($1)
	list_dirs_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)
	read_files_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read all dbus pid files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_read_pid_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_read_pid_sock_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	files_search_pids($1)
	list_dirs_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)
	read_sock_files_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_read_pid_sock_files'($*)) dnl
	')


########################################
## <summary>
##      Allow domain to write the dbus pid sock_file.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dbus_write_pid_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_write_pid_sock_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	write_sock_files_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_write_pid_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Watch system dbus pid socket files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_watch_pid_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_watch_pid_sock_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	files_search_pids($1)
	allow $1 system_dbusd_var_run_t:sock_file watch_sock_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_watch_pid_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Watch system dbus pid directory
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_watch_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_watch_pid_dirs'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	files_search_pids($1)
	allow $1 system_dbusd_var_run_t:dir watch_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_watch_pid_dirs'($*)) dnl
	')


########################################
## <summary>
##	Watch system dbusd pid directory and all its parents
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_watch_pid_dir_path',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_watch_pid_dir_path'($*)) dnl
	
	gen_require(`
		type system_dbusd_var_run_t;
	')

	files_watch_root_dirs($1)
	files_watch_var_run_dirs($1)
	files_search_pids($1)
	allow $1 system_dbusd_var_run_t:dir watch_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_watch_pid_dir_path'($*)) dnl
	')


########################################
## <summary>
##	Read and write system dbus tmp socket files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dbus_rw_tmp_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_rw_tmp_sock_files'($*)) dnl
	
	gen_require(`
		type system_dbusd_tmp_t;
	')

	rw_sock_files_pattern($1, system_dbusd_tmp_t, system_dbusd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_rw_tmp_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to connect to
##	session bus types with a unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_dontaudit_stream_connect_session_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_dontaudit_stream_connect_session_bus'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
	')

	dontaudit $1 session_bus_type:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_dontaudit_stream_connect_session_bus'($*)) dnl
	')


########################################
## <summary>
##	Allow attempts to connect to
##	session bus types with a unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_stream_connect_session_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_stream_connect_session_bus'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
	')

	allow $1 session_bus_type:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_stream_connect_session_bus'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to send dbus
##	messages to session bus types.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_chat_session_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_chat_session_bus'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
		class dbus send_msg;
	')

	allow $1 session_bus_type:dbus send_msg;
	allow session_bus_type $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_chat_session_bus'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to send dbus
##	messages to session bus types.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_dontaudit_chat_session_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_dontaudit_chat_session_bus'($*)) dnl
	
	gen_require(`
		attribute session_bus_type;
		class dbus send_msg;
	')

	dontaudit $1 session_bus_type:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_dontaudit_chat_session_bus'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to send dbus
##	messages to system bus types.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_dontaudit_chat_system_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_dontaudit_chat_system_bus'($*)) dnl
	
	gen_require(`
		attribute system_bus_type;
		class dbus send_msg;
	')

	dontaudit $1 system_bus_type:dbus send_msg;
	dontaudit system_bus_type $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_dontaudit_chat_system_bus'($*)) dnl
	')



########################################
## <summary>
##	Allow attempts to connect to
##	session bus types with a unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_stream_connect_system_dbusd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_stream_connect_system_dbusd'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
	')

	allow $1 system_dbusd_t:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_stream_connect_system_dbusd'($*)) dnl
	')



########################################
## <summary>
##	Do not audit attempts to connect to
##	session bus types with a unix
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_dontaudit_stream_connect_system_dbusd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_dontaudit_stream_connect_system_dbusd'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
		type system_dbusd_var_run_t;
	')

	dontaudit $1 system_dbusd_t:unix_stream_socket connectto;
	dontaudit $1 system_dbusd_t:sock_file write;
	dontaudit $1 system_dbusd_var_run_t:sock_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_dontaudit_stream_connect_system_dbusd'($*)) dnl
	')


########################################
## <summary>
##	Allow attempts to send dbus
##	messages to system bus types.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_chat_system_bus',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_chat_system_bus'($*)) dnl
	
	gen_require(`
		attribute system_bus_type;
		class dbus send_msg;
	')

	allow $1 system_bus_type:dbus send_msg;
	allow system_bus_type $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_chat_system_bus'($*)) dnl
	')


#######################################
## <summary>
##      Transition to dbus named content
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dbus_filetrans_named_content_system',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_filetrans_named_content_system'($*)) dnl
	
    gen_require(`
        type system_dbusd_var_lib_t;
    ')
    files_var_filetrans($1, system_dbusd_var_lib_t, dir, "ibus")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_filetrans_named_content_system'($*)) dnl
	')


########################################
## <summary>
##	Allow attempts to send dbus
##	messages to system dbusd type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_acquire_svc_system_dbusd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_acquire_svc_system_dbusd'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
		class dbus acquire_svc;
	')

	allow $1 system_dbusd_t:dbus acquire_svc;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_acquire_svc_system_dbusd'($*)) dnl
	')


########################################
## <summary>
##	Allow signal the system dbusd type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dbus_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_signal'($*)) dnl
	
	gen_require(`
		type system_dbusd_t;
	')

	allow $1 system_dbusd_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_signal'($*)) dnl
	')


########################################
## <summary>
##      Manage session_dbusd tmp dirs.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dbus_manage_session_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_manage_session_tmp_dirs'($*)) dnl
	
        gen_require(`
                type session_dbusd_tmp_t;
        ')

	manage_dirs_pattern($1, session_dbusd_tmp_t, session_dbusd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_manage_session_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##      Write to session_dbusd tmp socket files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dbus_write_session_tmp_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_write_session_tmp_sock_files'($*)) dnl
	
        gen_require(`
                type session_dbusd_tmp_t;
        ')

	write_sock_files_pattern($1, session_dbusd_tmp_t, session_dbusd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_write_session_tmp_sock_files'($*)) dnl
	')


########################################
## <summary>
##      Delete session_dbusd tmp socket files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dbus_delete_session_tmp_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_delete_session_tmp_sock_files'($*)) dnl
	
        gen_require(`
                type session_dbusd_tmp_t;
        ')

	delete_sock_files_pattern($1, session_dbusd_tmp_t, session_dbusd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_delete_session_tmp_sock_files'($*)) dnl
	')


########################################
## <summary>
##      Create session_dbusd tmp socket files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dbus_create_session_tmp_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_create_session_tmp_sock_files'($*)) dnl
	
        gen_require(`
                type session_dbusd_tmp_t;
        ')

	create_sock_files_pattern($1, session_dbusd_tmp_t, session_dbusd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_create_session_tmp_sock_files'($*)) dnl
	')


########################################
## <summary>
## Allow systemctl dbus services
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dbus_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dbus_systemctl'($*)) dnl
	
	gen_require(`
		type dbusd_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 dbusd_unit_file_t:file read_file_perms;
	allow $1 dbusd_unit_file_t:service manage_service_perms;


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dbus_systemctl'($*)) dnl
	')

## <summary>Distributed checksum clearinghouse spam filtering.</summary>

########################################
## <summary>
##	Execute cdcc in the cdcc domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dcc_domtrans_cdcc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_domtrans_cdcc'($*)) dnl
	
	gen_require(`
		type cdcc_t, cdcc_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, cdcc_exec_t, cdcc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_domtrans_cdcc'($*)) dnl
	')


########################################
## <summary>
##	Execute cdcc in the cdcc domain, and
##	allow the specified role the
##	cdcc domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dcc_run_cdcc',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_run_cdcc'($*)) dnl
	
	gen_require(`
		attribute_role cdcc_roles;
	')

	dcc_domtrans_cdcc($1)
	roleattribute $2 cdcc_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_run_cdcc'($*)) dnl
	')


########################################
## <summary>
##	Execute dcc client in the dcc
##	client domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dcc_domtrans_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_domtrans_client'($*)) dnl
	
	gen_require(`
		type dcc_client_t, dcc_client_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dcc_client_exec_t, dcc_client_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_domtrans_client'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to dcc client.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dcc_signal_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_signal_client'($*)) dnl
	
	gen_require(`
		type dcc_client_t;
	')

	allow $1 dcc_client_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_signal_client'($*)) dnl
	')


########################################
## <summary>
##	Execute dcc client in the dcc
##	client domain, and allow the
##	specified role the dcc client domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dcc_run_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_run_client'($*)) dnl
	
	gen_require(`
		attribute_role dcc_client_roles;
	')

	dcc_domtrans_client($1)
	roleattribute $2 dcc_client_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_run_client'($*)) dnl
	')


########################################
## <summary>
##	Execute dbclean in the dcc dbclean domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dcc_domtrans_dbclean',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_domtrans_dbclean'($*)) dnl
	
	gen_require(`
		type dcc_dbclean_t, dcc_dbclean_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dcc_dbclean_exec_t, dcc_dbclean_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_domtrans_dbclean'($*)) dnl
	')


########################################
## <summary>
##	Execute dbclean in the dcc dbclean
##	domain, and allow the specified
##	role the dcc dbclean domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dcc_run_dbclean',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_run_dbclean'($*)) dnl
	
	gen_require(`
		attribute_role dcc_dbclean_roles;
	')

	dcc_domtrans_dbclean($1)
	roleattribute $2 dcc_dbclean_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_run_dbclean'($*)) dnl
	')


########################################
## <summary>
##	Connect to dccifd over a unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dcc_stream_connect_dccifd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dcc_stream_connect_dccifd'($*)) dnl
	
	gen_require(`
		type dcc_var_t, dccifd_var_run_t, dccifd_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, dcc_var_t, dccifd_var_run_t, dccifd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dcc_stream_connect_dccifd'($*)) dnl
	')

## <summary>Update dynamic IP address at DynDNS.org.</summary>

#######################################
## <summary>
##	Execute ddclient in the ddclient domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ddclient_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddclient_domtrans'($*)) dnl
	
	gen_require(`
		type ddclient_t, ddclient_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ddclient_exec_t, ddclient_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddclient_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute ddclient in the ddclient
##	domain, and allow the specified
##	role the ddclient domain.
## </summary>
## <param name="domain">
##	<summary>
##	 Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ddclient_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddclient_run'($*)) dnl
	
	gen_require(`
		attribute_role ddclient_roles;
	')

	ddclient_domtrans($1)
	roleattribute $2 ddclient_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddclient_run'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an ddclient environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ddclient_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddclient_admin'($*)) dnl
	
	gen_require(`
		type ddclient_t, ddclient_etc_t, ddclient_log_t;
		type ddclient_var_t, ddclient_var_lib_t, ddclient_tmp_t;
		type ddclient_var_run_t, ddclient_initrc_exec_t;
	')

	allow $1 ddclient_t:process signal_perms;
	ps_process_pattern($1, ddclient_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 ddclient_t:process ptrace;
	')

	init_labeled_script_domtrans($1, ddclient_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 ddclient_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, ddclient_etc_t)

	logging_list_logs($1)
	admin_pattern($1, ddclient_log_t)

	files_list_var($1)
	admin_pattern($1, ddclient_var_t)

	files_list_var_lib($1)
	admin_pattern($1, ddclient_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, ddclient_var_run_t)

	files_list_tmp($1)
	admin_pattern($1, ddclient_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddclient_admin'($*)) dnl
	')


########################################
## <summary>
##	Get the attributes of ddclient PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ddclient_getattr_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddclient_getattr_pid_files'($*)) dnl
	
	gen_require(`
		type ddclient_var_run_t;
	')

	getattr_files_pattern($1, ddclient_var_run_t, ddclient_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddclient_getattr_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Create objects in the ddclient home directory
##	with an automatic type transition to a specified type
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="type">
##	<summary>
##	The type of the object being created.
##	</summary>
## </param>
## <param name="object">
##      <summary>
##      The class of the object being created.
##      </summary>
## </param>
## <param name="name">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`ddclient_var_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddclient_var_filetrans'($*)) dnl
	
	gen_require(`
		type ddclient_var_t;
	')

	filetrans_pattern($1, ddclient_var_t, $2, $3, $4)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddclient_var_filetrans'($*)) dnl
	')

## <summary>ddcprobe retrieves monitor and graphics card information.</summary>

########################################
## <summary>
##	Execute ddcprobe in the ddcprobe domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ddcprobe_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddcprobe_domtrans'($*)) dnl
	
	gen_require(`
		type ddcprobe_t, ddcprobe_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ddcprobe_exec_t, ddcprobe_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddcprobe_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute ddcprobe in the ddcprobe
##	domain, and allow the specified
##	role the ddcprobe domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ddcprobe_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ddcprobe_run'($*)) dnl
	
	gen_require(`
		attribute_role ddcprobe_roles;
	')

	ddcprobe_domtrans($1)
	roleattribute $2 ddcprobe_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ddcprobe_run'($*)) dnl
	')

## <summary>SSH dictionary attack mitigation.</summary>

########################################
## <summary>
##	Execute a domain transition to run denyhosts.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`denyhosts_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `denyhosts_domtrans'($*)) dnl
	
	gen_require(`
		type denyhosts_t, denyhosts_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, denyhosts_exec_t, denyhosts_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `denyhosts_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute denyhost server in the
##	denyhost domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`denyhosts_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `denyhosts_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type denyhosts_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, denyhosts_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `denyhosts_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an denyhosts environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`denyhosts_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `denyhosts_admin'($*)) dnl
	
	gen_require(`
		type denyhosts_t, denyhosts_var_lib_t, denyhosts_var_lock_t;
		type denyhosts_var_log_t, denyhosts_initrc_exec_t;
	')

	allow $1 denyhosts_t:process signal_perms;
	ps_process_pattern($1, denyhosts_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 denyhosts_t:process ptrace;
	')

	denyhosts_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 denyhosts_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_var_lib($1)
	admin_pattern($1, denyhosts_var_lib_t)

	logging_list_logs($1)
	admin_pattern($1, denyhosts_var_log_t)

	files_list_locks($1)
	admin_pattern($1, denyhosts_var_lock_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `denyhosts_admin'($*)) dnl
	')

## <summary>Devicekit modular hardware abstraction layer</summary>

########################################
## <summary>
##	Execute a domain transition to run devicekit.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`devicekit_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_domtrans'($*)) dnl
	
	gen_require(`
		type devicekit_t, devicekit_exec_t;
	')

	domtrans_pattern($1, devicekit_exec_t, devicekit_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to run devicekit_disk.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`devicekit_domtrans_disk',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_domtrans_disk'($*)) dnl
	
	gen_require(`
		type devicekit_disk_t, devicekit_disk_exec_t;
	')

	domtrans_pattern($1, devicekit_disk_exec_t, devicekit_disk_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_domtrans_disk'($*)) dnl
	')


########################################
## <summary>
##	Send to devicekit over a unix domain
##	datagram socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_dgram_send',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dgram_send'($*)) dnl
	
	gen_require(`
		type devicekit_t;
	')

	allow $1 devicekit_t:unix_dgram_socket sendto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dgram_send'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	devicekit over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dbus_chat'($*)) dnl
	
	gen_require(`
		type devicekit_t;
		class dbus send_msg;
	')

	allow $1 devicekit_t:dbus send_msg;
	allow devicekit_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	devicekit disk over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_dbus_chat_disk',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dbus_chat_disk'($*)) dnl
	
	gen_require(`
		type devicekit_disk_t;
		class dbus send_msg;
	')

	allow $1 devicekit_disk_t:dbus send_msg;
	allow devicekit_disk_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dbus_chat_disk'($*)) dnl
	')


########################################
## <summary>
##	Use file descriptors for devicekit_disk.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_use_fds_disk',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_use_fds_disk'($*)) dnl
	
	gen_require(`
		type devicekit_disk_t;
	')

	allow $1 devicekit_disk_t:fd use; 

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_use_fds_disk'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit Send and receive messages from
##	devicekit disk over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`devicekit_dontaudit_dbus_chat_disk',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dontaudit_dbus_chat_disk'($*)) dnl
	
	gen_require(`
		type devicekit_disk_t;
		class dbus send_msg;
	')

	dontaudit $1 devicekit_disk_t:dbus send_msg;
	dontaudit devicekit_disk_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dontaudit_dbus_chat_disk'($*)) dnl
	')


#####################################
## <summary>
##	Read and write devicekit disk semaphores.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_rw_semaphores_disk',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_rw_semaphores_disk'($*)) dnl
	
	gen_require(`
		type devicekit_disk_t;
	')

	allow $1 devicekit_disk_t:sem rw_sem_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_rw_semaphores_disk'($*)) dnl
	')


########################################
## <summary>
##	Send signal devicekit power
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_signal_power',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_signal_power'($*)) dnl
	
	gen_require(`
		type devicekit_power_t;
	')

	allow $1 devicekit_power_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_signal_power'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	devicekit power over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_dbus_chat_power',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dbus_chat_power'($*)) dnl
	
	gen_require(`
		type devicekit_power_t;
		class dbus send_msg;
	')

	allow $1 devicekit_power_t:dbus send_msg;
	allow devicekit_power_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dbus_chat_power'($*)) dnl
	')


#######################################
## <summary>
##  Use and inherit devicekit power
##  file descriptors.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`devicekit_use_fds_power',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_use_fds_power'($*)) dnl
	
    gen_require(`
        type devicekit_power_t;
    ')

        allow $1 devicekit_power_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_use_fds_power'($*)) dnl
	')


#######################################
## <summary>
##  Append inherited devicekit log files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`devicekit_append_inherited_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_append_inherited_log_files'($*)) dnl
	
	gen_require(`
		type devicekit_var_log_t;
	')

	logging_search_logs($1)
	allow $1 devicekit_var_log_t:file append_inherited_file_perms;

	devicekit_use_fds_power($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_append_inherited_log_files'($*)) dnl
	')


#######################################
## <summary>
##  Allow read devicekit log files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`devicekit_read_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_read_log_files'($*)) dnl
	
	gen_require(`
		type devicekit_var_log_t;
	')

	logging_search_logs($1)
	allow $1 devicekit_var_log_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_read_log_files'($*)) dnl
	')


#######################################
## <summary>
##  Do not audit attempts to write the devicekit
##  log files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain to not audit.
##  </summary>
## </param>
#
 	 	define(`devicekit_dontaudit_rw_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dontaudit_rw_log'($*)) dnl
	
	gen_require(`
		type devicekit_var_log_t;
	')

	dontaudit $1 devicekit_var_log_t:file rw_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dontaudit_rw_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the domain to read devicekit_power state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_read_state_power',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_read_state_power'($*)) dnl
	
	gen_require(`
		type devicekit_power_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, devicekit_power_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_read_state_power'($*)) dnl
	')


########################################
## <summary>
##	Read devicekit PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_read_pid_files'($*)) dnl
	
	gen_require(`
		type devicekit_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, devicekit_var_run_t, devicekit_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read
##	devicekit PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`devicekit_dontaudit_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_dontaudit_read_pid_files'($*)) dnl
	
	gen_require(` 
		type devicekit_var_run_t;
	')

	dontaudit $1 devicekit_var_run_t:file read_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_dontaudit_read_pid_files'($*)) dnl
	')



########################################
## <summary>
##	Manage devicekit PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_manage_pid_files'($*)) dnl
	
	gen_require(`
		type devicekit_var_run_t;
	')

	files_search_pids($1)
	manage_dirs_pattern($1, devicekit_var_run_t, devicekit_var_run_t)
	manage_files_pattern($1, devicekit_var_run_t, devicekit_var_run_t)
	files_pid_filetrans($1, devicekit_var_run_t, dir, "pm-utils")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_manage_pid_files'($*)) dnl
	')


#######################################
## <summary>
##  Relabel devicekit LOG files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`devicekit_relabel_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_relabel_log_files'($*)) dnl
	
    gen_require(`
        type devicekit_var_log_t;
    ')

    logging_search_logs($1)
    relabel_files_pattern($1, devicekit_var_log_t, devicekit_var_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_relabel_log_files'($*)) dnl
	')


########################################
## <summary>
##	Manage devicekit LOG files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_manage_log_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_manage_log_files'($*)) dnl
	
	gen_require(`
		type devicekit_var_log_t;
	')

	logging_search_logs($1)
	manage_files_pattern($1, devicekit_var_log_t, devicekit_var_log_t)
	#logging_log_filetrans($1, devicekit_var_log_t, file, "pm-powersave.log")
	#logging_log_filetrans($1, devicekit_var_log_t, file, "pm-suspend.log")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_manage_log_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an devicekit environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`devicekit_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_admin'($*)) dnl
	
	gen_require(`
		type devicekit_t, devicekit_disk_t, devicekit_power_t;
		type devicekit_var_lib_t, devicekit_var_run_t, devicekit_tmp_t;
	')

	allow $1 devicekit_t:process signal_perms;
	ps_process_pattern($1, devicekit_t)
	tunable_policy(`deny_ptrace',`',`
		allow $1 devicekit_t:process ptrace;
		allow $1 devicekit_disk_t:process ptrace;
		allow $1 devicekit_power_t:process ptrace;
	')

	allow $1 devicekit_disk_t:process signal_perms;
	ps_process_pattern($1, devicekit_disk_t)

	allow $1 devicekit_power_t:process signal_perms;
	ps_process_pattern($1, devicekit_power_t)

	admin_pattern($1, devicekit_tmp_t)
	files_list_tmp($1)

	admin_pattern($1, devicekit_var_lib_t)
	files_list_var_lib($1)

	admin_pattern($1, devicekit_var_run_t)
	files_list_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_admin'($*)) dnl
	')


########################################
## <summary>
##	Transition to devicekit named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type devicekit_var_run_t, devicekit_var_log_t;
	')

	files_pid_filetrans($1, devicekit_var_run_t, dir, "pm-utils")
	logging_log_filetrans($1, devicekit_var_log_t, file, "pm-powersave.log")
	logging_log_filetrans($1, devicekit_var_log_t, file, "pm-suspend.log")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_filetrans_named_content'($*)) dnl
	')


########################################

## <summary>
##	Mounton devicekit lib directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`devicekit_mounton_var_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `devicekit_mounton_var_lib'($*)) dnl
	
	gen_require(`
		type devicekit_var_lib_t;
	')

	allow $1 devicekit_var_lib_t:dir mounton;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `devicekit_mounton_var_lib'($*)) dnl
	')

## <summary>Dynamic host configuration protocol server.</summary>

########################################
## <summary>
##	Execute a domain transition to run dhcpd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dhcpd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dhcpd_domtrans'($*)) dnl
	
	gen_require(`
		type dhcpd_t, dhcpd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dhcpd_exec_t, dhcpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dhcpd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of dhcpd server
##	state files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dhcpd_setattr_state_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dhcpd_setattr_state_files'($*)) dnl
	
	gen_require(`
		type dhcpd_state_t;
	')

	sysnet_search_dhcp_state($1)
	allow $1 dhcpd_state_t:file setattr_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dhcpd_setattr_state_files'($*)) dnl
	')


########################################
## <summary>
##	Execute dhcp server in the dhcp domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
#
 	 	define(`dhcpd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dhcpd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type dhcpd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, dhcpd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dhcpd_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute dhcpd server in the dhcpd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dhcpd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dhcpd_systemctl'($*)) dnl
	
	gen_require(`
		type dhcpd_unit_file_t;
		type dhcpd_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	systemd_search_unit_dirs($1)
	allow $1 dhcpd_unit_file_t:file read_file_perms;
	allow $1 dhcpd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, dhcpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dhcpd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an dhcpd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dhcpd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dhcpd_admin'($*)) dnl
	
	gen_require(`
		type dhcpd_t, dhcpd_tmp_t, dhcpd_state_t;
		type dhcpd_var_run_t, dhcpd_initrc_exec_t;
		type dhcpd_unit_file_t;
	')

	allow $1 dhcpd_t:process signal_perms;
	ps_process_pattern($1, dhcpd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 dhcpd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, dhcpd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dhcpd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_tmp($1)
	admin_pattern($1, dhcpd_tmp_t)

	files_list_var_lib($1)
	admin_pattern($1, dhcpd_state_t)

	files_list_pids($1)
	admin_pattern($1, dhcpd_var_run_t)

	dhcpd_systemctl($1)
	admin_pattern($1, dhcpd_unit_file_t)
	allow $1 dhcpd_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dhcpd_admin'($*)) dnl
	')

## <summary>Dictionary daemon.</summary>

########################################
## <summary>
##	Use dictionary services by connecting
##	over TCP.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dictd_tcp_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dictd_tcp_connect'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dictd_tcp_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an dictd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dictd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dictd_admin'($*)) dnl
	
	gen_require(`
		type dictd_t, dictd_etc_t, dictd_var_lib_t;
		type dictd_var_run_t, dictd_initrc_exec_t;
	')

	allow $1 dictd_t:process signal_perms;
	ps_process_pattern($1, dictd_t)
	tunable_policy(`deny_ptrace',`',`
		allow $1 dictd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, dictd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dictd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, dictd_etc_t)

	files_list_var_lib($1)
	admin_pattern($1, dictd_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, dictd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dictd_admin'($*)) dnl
	')

## <summary>Server for managing and downloading certificate revocation lists.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an dirmngr environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dirmngr_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirmngr_admin'($*)) dnl
	
	gen_require(`
		type dirmngr_t, dirmngr_initrc_exec_t, dirmngr_var_run_t;
		type dirmngr_conf_t, dirmngr_var_lib_t, dirmngr_log_t;
	')

	allow $1 dirmngr_t:process { ptrace signal_perms };
	ps_process_pattern($1, dirmngr_t)

	init_labeled_script_domtrans($1, dirmngr_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dirmngr_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, dirmngr_conf_t)

	logging_search_logs($1)
	admin_pattern($1, dirmngr_log_t)

	files_search_pids($1)
	admin_pattern($1, dirmngr_var_run_t)

	files_search_var_lib($1)
	admin_pattern($1, dirmngr_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirmngr_admin'($*)) dnl
	')

## <summary>Administration Server for Directory Server, dirsrv-admin.</summary>

########################################
## <summary>
##	Exec dirsrv-admin programs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrvadmin_run_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_run_exec'($*)) dnl
	
	gen_require(`
		type dirsrvadmin_exec_t;
	')

	allow $1 dirsrvadmin_exec_t:dir search_dir_perms;
	can_exec($1, dirsrvadmin_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_run_exec'($*)) dnl
	')


########################################
## <summary>
##	Exec cgi programs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrvadmin_run_script_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_run_script_exec'($*)) dnl
	
	gen_require(`
		type dirsrvadmin_script_exec_t;
	')

	allow $1 dirsrvadmin_script_exec_t:dir search_dir_perms;
	can_exec($1, dirsrvadmin_script_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_run_script_exec'($*)) dnl
	')


########################################
## <summary>
##	Manage dirsrv-adminserver configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrvadmin_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_read_config'($*)) dnl
	
	gen_require(`
		type dirsrvadmin_config_t;
	')

	read_files_pattern($1, dirsrvadmin_config_t, dirsrvadmin_config_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_read_config'($*)) dnl
	')


########################################
## <summary>
##	Manage dirsrv-adminserver configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrvadmin_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_manage_config'($*)) dnl
	
	gen_require(`
		type dirsrvadmin_config_t;
	')

	allow $1 dirsrvadmin_config_t:dir manage_dir_perms;
	allow $1 dirsrvadmin_config_t:file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_manage_config'($*)) dnl
	')


#######################################
## <summary>
##      Read dirsrv-adminserver tmp files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dirsrvadmin_read_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_read_tmp'($*)) dnl
	
        gen_require(`
                type dirsrvadmin_tmp_t;
        ')

        read_files_pattern($1, dirsrvadmin_tmp_t, dirsrvadmin_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_read_tmp'($*)) dnl
	')


########################################
## <summary>
##      Manage dirsrv-adminserver tmp files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dirsrvadmin_manage_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_manage_tmp'($*)) dnl
	
        gen_require(`
                type dirsrvadmin_tmp_t;
        ')

	manage_files_pattern($1, dirsrvadmin_tmp_t, dirsrvadmin_tmp_t)
	manage_dirs_pattern($1, dirsrvadmin_tmp_t, dirsrvadmin_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_manage_tmp'($*)) dnl
	')


########################################
## <summary>
##	Execute dirsrv-admin server in the dirsrv-admin domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dirsrvadmin_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_systemctl'($*)) dnl
	
	gen_require(`
		type dirsrvadmin_t;
		type dirsrvadmin_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 dirsrvadmin_unit_file_t:file read_file_perms;
	allow $1 dirsrvadmin_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, dirsrvadmin_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_systemctl'($*)) dnl
	')


#######################################
## <summary>
##  Execute admin cgi programs in caller domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`dirsrvadmin_domtrans_unconfined_script_t',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrvadmin_domtrans_unconfined_script_t'($*)) dnl
	
    gen_require(`
       type dirsrvadmin_unconfined_script_t;
        type dirsrvadmin_unconfined_script_exec_t;
    ')

   domtrans_pattern($1, dirsrvadmin_unconfined_script_exec_t, dirsrvadmin_unconfined_script_t)
   allow $1 dirsrvadmin_unconfined_script_t:process signal_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrvadmin_domtrans_unconfined_script_t'($*)) dnl
	')

## <summary>policy for dirsrv</summary>

########################################
## <summary>
##	Execute a domain transition to run dirsrv.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`dirsrv_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_domtrans'($*)) dnl
	
	gen_require(`
		type dirsrv_t, dirsrv_exec_t;
	')

	domtrans_pattern($1, dirsrv_exec_t,dirsrv_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute dirsrv in the dirsrv domain, and
##	allow the specified role the dirsrv domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrv_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_run'($*)) dnl
	
	gen_require(`
		type dirsrv_t;
	')

	dirsrv_domtrans($1)
	role $2 types dirsrv_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_run'($*)) dnl
	')


########################################
## <summary>
##  Allow caller to signal dirsrv.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dirsrv_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_signal'($*)) dnl
	
	gen_require(`
		type dirsrv_t;
	')

	allow $1 dirsrv_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_signal'($*)) dnl
	')



########################################
## <summary>
##      Send a null signal to dirsrv.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dirsrv_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_signull'($*)) dnl
	
	gen_require(`
		type dirsrv_t;
	')

	allow $1 dirsrv_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_signull'($*)) dnl
	')


########################################
## <summary>
##	Execute dirsrv server in the dirsrv domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dirsrv_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_systemctl'($*)) dnl
	
	gen_require(`
		type dirsrv_unit_file_t;
		type dirsrv_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 dirsrv_unit_file_t:file read_file_perms;
	allow $1 dirsrv_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, dirsrv_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Allow domain to getattr dirsrv unit files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dirsrv_getattr_unit_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_getattr_unit_files'($*)) dnl
	
	gen_require(`
		type dirsrv_unit_file_t;
	')

	allow $1 dirsrv_unit_file_t:file getattr_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_getattr_unit_files'($*)) dnl
	')


#######################################
## <summary>
##      Allow a domain to manage dirsrv logs.
## </summary>
## <param name="domain">
## <summary>
##      Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dirsrv_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_manage_log'($*)) dnl
	
	gen_require(`
		type dirsrv_var_log_t;
	')

	allow $1 dirsrv_var_log_t:dir manage_dir_perms;
	allow $1 dirsrv_var_log_t:file manage_file_perms;
	allow $1 dirsrv_var_log_t:fifo_file manage_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_manage_log'($*)) dnl
	')


#######################################
## <summary>
##      Allow a domain to manage dirsrv /var/lib files.
## </summary>
## <param name="domain">
## 	<summary>
##		Domain allowed access.
## 	</summary>
## </param>
#
 	 	define(`dirsrv_manage_var_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_manage_var_lib'($*)) dnl
	
        gen_require(`
                type dirsrv_var_lib_t;
        ')
        allow $1 dirsrv_var_lib_t:dir manage_dir_perms;
        allow $1 dirsrv_var_lib_t:file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_manage_var_lib'($*)) dnl
	')


########################################
## <summary>
##	Connect to dirsrv over a unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrv_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_stream_connect'($*)) dnl
	
	gen_require(`
		type dirsrv_t, dirsrv_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, dirsrv_var_run_t, dirsrv_var_run_t, dirsrv_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_stream_connect'($*)) dnl
	')


#######################################
## <summary>
##      Allow a domain to manage dirsrv /var/run files.
## </summary>
## <param name="domain">
## <summary>
##      Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dirsrv_manage_var_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_manage_var_run'($*)) dnl
	
	gen_require(`
		type dirsrv_var_run_t;
	')
	allow $1 dirsrv_var_run_t:dir manage_dir_perms;
	allow $1 dirsrv_var_run_t:file manage_file_perms;
	allow $1 dirsrv_var_run_t:sock_file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_manage_var_run'($*)) dnl
	')


######################################
## <summary>
##      Allow a domain to create dirsrv pid directories.
## </summary>
## <param name="domain">
## <summary>
##      Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dirsrv_pid_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_pid_filetrans'($*)) dnl
	
        gen_require(`
                type dirsrv_var_run_t;
        ')
        # Allow creating a dir in /var/run with this type
        files_pid_filetrans($1, dirsrv_var_run_t, dir)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_pid_filetrans'($*)) dnl
	')


#######################################
## <summary>
##      Allow a domain to read dirsrv /var/run files.
## </summary>
## <param name="domain">
## <summary>
##      Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dirsrv_read_var_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_read_var_run'($*)) dnl
	
        gen_require(`
                type dirsrv_var_run_t;
        ')
        allow $1 dirsrv_var_run_t:dir list_dir_perms;
        allow $1 dirsrv_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_read_var_run'($*)) dnl
	')


########################################
## <summary>
##      Manage dirsrv configuration files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dirsrv_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_manage_config'($*)) dnl
	
	gen_require(`
		type dirsrv_config_t;
	')

	allow $1 dirsrv_config_t:dir manage_dir_perms;
	allow $1 dirsrv_config_t:file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_manage_config'($*)) dnl
	')


########################################
## <summary>
##      Read dirsrv share files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dirsrv_read_share',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_read_share'($*)) dnl
	
	gen_require(`
		type dirsrv_share_t;
	')

	allow $1 dirsrv_share_t:dir list_dir_perms;
	allow $1 dirsrv_share_t:file { map read_file_perms };
	allow $1 dirsrv_share_t:lnk_file read;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_read_share'($*)) dnl
	')


########################################
## <summary>
##	Allow dirsrv noatsecure
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dirsrv_noatsecure',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_noatsecure'($*)) dnl
	
	gen_require(`
		type dirsrv_t;
	')

    allow $1 dirsrv_t:process { noatsecure };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_noatsecure'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to list dirsrv tmpfs directories
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit
##	</summary>
## </param>
#
 	 	define(`dirsrv_dontaudit_list_tmpfs_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dirsrv_dontaudit_list_tmpfs_dirs'($*)) dnl
	
	gen_require(`
		type dirsrv_tmpfs_t;
	')

	dontaudit $1 dirsrv_tmpfs_t:dir list_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dirsrv_dontaudit_list_tmpfs_dirs'($*)) dnl
	')

## <summary>Distributed compiler daemon.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an distcc environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`distcc_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `distcc_admin'($*)) dnl
	
	gen_require(`
		type distccd_t, distccd_t, distccd_log_t, distccd_var_run_t;
		type disccd_var_run_t, distccd_tmp_t, distccd_initrc_exec_t;
	')

	allow $1 distccd_t:process { ptrace signal_perms };
	ps_process_pattern($1, distccd_t)

	init_labeled_script_domtrans($1, distccd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 distccd_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, distccd_log_t)

	files_search_tmp($1)
	admin_pattern($1, distccd_tmp_t)

	files_search_pids($1)
	admin_pattern($1, distccd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `distcc_admin'($*)) dnl
	')

## <summary>Small and secure DNS daemon.</summary>

#######################################
## <summary>
##	The template to define a djbdns domain.
## </summary>
## <param name="domain_prefix">
##	<summary>
##	Domain prefix to be used.
##	</summary>
## </param>
#
 	 	define(`djbdns_daemontools_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `djbdns_daemontools_domain_template'($*)) dnl
	
	gen_require(`
		attribute djbdns_domain;
	')

	########################################
	#
	# Declarations
	#

	type djbdns_$1_t, djbdns_domain;
	type djbdns_$1_exec_t;
	domain_type(djbdns_$1_t)
	domain_entry_file(djbdns_$1_t, djbdns_$1_exec_t)
	role system_r types djbdns_$1_t;

	type djbdns_$1_conf_t;
	files_config_file(djbdns_$1_conf_t)

	########################################
	#
	# Local policy
	#

	daemontools_service_domain(djbdns_$1_t, djbdns_$1_exec_t)
	daemontools_read_svc(djbdns_$1_t)

	allow djbdns_$1_t djbdns_$1_conf_t:dir list_dir_perms;
	allow djbdns_$1_t djbdns_$1_conf_t:file read_file_perms;

	corenet_all_recvfrom_netlabel(djbdns_$1_t)
	corenet_tcp_sendrecv_generic_if(djbdns_$1_t)
	corenet_udp_sendrecv_generic_if(djbdns_$1_t)
	corenet_tcp_sendrecv_generic_node(djbdns_$1_t)
	corenet_udp_sendrecv_generic_node(djbdns_$1_t)
	corenet_tcp_sendrecv_all_ports(djbdns_$1_t)
	corenet_udp_sendrecv_all_ports(djbdns_$1_t)
	corenet_tcp_bind_generic_node(djbdns_$1_t)
	corenet_udp_bind_generic_node(djbdns_$1_t)
	corenet_tcp_bind_dns_port(djbdns_$1_t)
	corenet_udp_bind_dns_port(djbdns_$1_t)
	corenet_udp_bind_generic_port(djbdns_$1_t)
	corenet_sendrecv_dns_server_packets(djbdns_$1_t)
	corenet_sendrecv_generic_server_packets(djbdns_$1_t)

	files_search_var(djbdns_$1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `djbdns_daemontools_domain_template'($*)) dnl
	')


#####################################
## <summary>
##	Search djbdns-tinydns key ring.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`djbdns_search_tinydns_keys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `djbdns_search_tinydns_keys'($*)) dnl
	
	gen_require(`
		type djbdns_tinydns_t;
	')

	allow $1 djbdns_tinydns_t:key search;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `djbdns_search_tinydns_keys'($*)) dnl
	')


#####################################
## <summary>
##	Link djbdns-tinydns key ring.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`djbdns_link_tinydns_keys',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `djbdns_link_tinydns_keys'($*)) dnl
	
	gen_require(`
		type djbdns_tinydn_t;
	')

	allow $1 djbdns_tinydn_t:key link;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `djbdns_link_tinydns_keys'($*)) dnl
	')

## <summary>DomainKeys Identified Mail milter.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an dkim environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dkim_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dkim_admin'($*)) dnl
	
	gen_require(`
		type dkim_milter_t, dkim_milter_initrc_exec_t, dkim_milter_private_key_t;
		type dkim_milter_data_t;
	')

	allow $1 dkim_milter_t:process { ptrace signal_perms };
	ps_process_pattern($1, dkim_milter_t)

	init_labeled_script_domtrans($1, dkim_milter_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dkim_milter_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, dkim_milter_private_key_t)

	files_search_pids($1)
	admin_pattern($1, dkim_milter_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dkim_admin'($*)) dnl
	')

## <summary>Decode DMI data for x86/ia64 bioses.</summary>

########################################
## <summary>
##	Execute dmidecode in the dmidecode domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dmidecode_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dmidecode_domtrans'($*)) dnl
	
	gen_require(`
		type dmidecode_t, dmidecode_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dmidecode_exec_t, dmidecode_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dmidecode_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute dmidecode in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dmidecode_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dmidecode_exec'($*)) dnl
	
	gen_require(`
		type dmidecode_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, dmidecode_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dmidecode_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute dmidecode in the dmidecode
##	domain, and allow the specified
##	role the dmidecode domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dmidecode_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dmidecode_run'($*)) dnl
	
	gen_require(`
		attribute_role dmidecode_roles;
	')

	dmidecode_domtrans($1)
	roleattribute $2 dmidecode_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dmidecode_run'($*)) dnl
	')

## <summary>DNS forwarder and DHCP server.</summary>

########################################
## <summary>
##	Execute dnsmasq server in the dnsmasq domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_domtrans'($*)) dnl
	
	gen_require(`
		type dnsmasq_exec_t, dnsmasq_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dnsmasq_exec_t, dnsmasq_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Execute dnsmasq server in the caller domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`dnsmasq_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_exec'($*)) dnl
	
    gen_require(`
        type dnsmasq_exec_t;
    ')

    can_exec($1, dnsmasq_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_exec'($*)) dnl
	')


########################################
## <summary>
##	Allow read/write dnsmasq pipes
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_rw_inherited_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_rw_inherited_pipes'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
	')

	allow $1 dnsmasq_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_rw_inherited_pipes'($*)) dnl
	')


########################################
## <summary>
##	Execute the dnsmasq init script in
##	the init script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
#
 	 	define(`dnsmasq_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type dnsmasq_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, dnsmasq_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute dnsmasq server in the dnsmasq domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_systemctl'($*)) dnl
	
	gen_require(`
		type dnsmasq_unit_file_t;
		type dnsmasq_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 dnsmasq_unit_file_t:file read_file_perms;
	allow $1 dnsmasq_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, dnsmasq_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Send sigchld to dnsmasq.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#
 	 	define(`dnsmasq_sigchld',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_sigchld'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
	')

    allow $1 dnsmasq_t:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_sigchld'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to dnsmasq.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#
 	 	define(`dnsmasq_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_signal'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
	')

	allow $1 dnsmasq_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_signal'($*)) dnl
	')


########################################
## <summary>
##	Send null signals to dnsmasq.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#
 	 	define(`dnsmasq_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_signull'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
	')

	allow $1 dnsmasq_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_signull'($*)) dnl
	')


########################################
## <summary>
##	Send kill signals to dnsmasq.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#
 	 	define(`dnsmasq_kill',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_kill'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
	')

	allow $1 dnsmasq_t:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_kill'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read
##	dnsmasq configuration files.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dnsmasq_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_read_config'($*)) dnl
	
	gen_require(`
		type dnsmasq_etc_t;
	')

	files_search_etc($1)
	allow $1 dnsmasq_etc_t:dir list_dir_perms;
	allow $1 dnsmasq_etc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_read_config'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to manage
##	dnsmasq configuration files.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dnsmasq_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_manage_config'($*)) dnl
	
	gen_require(`
		type dnsmasq_etc_t;
	')

	files_search_etc($1)
	allow $1 dnsmasq_etc_t:dir manage_dir_perms;
	allow $1 dnsmasq_etc_t:file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_manage_config'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to write
##	dnsmasq configuration files.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dnsmasq_write_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_write_config'($*)) dnl
	
	gen_require(`
		type dnsmasq_etc_t;
	')

	files_search_etc($1)
	allow $1 dnsmasq_etc_t:dir list_dir_perms;
	allow $1 dnsmasq_etc_t:file write_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_write_config'($*)) dnl
	')


########################################
## <summary>
##	Delete dnsmasq pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_delete_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_delete_pid_files'($*)) dnl
	
	gen_require(`
		type dnsmasq_var_run_t;
	')

	files_search_pids($1)
	delete_files_pattern($1, dnsmasq_var_run_t, dnsmasq_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_delete_pid_files'($*)) dnl
	')



########################################
## <summary>
##	Create, read, write, and delete
##	dnsmasq pid files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_manage_pid_files'($*)) dnl
	
	gen_require(`
		type dnsmasq_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, dnsmasq_var_run_t, dnsmasq_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read dnsmasq pid files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_read_pid_files'($*)) dnl
	
	gen_require(`
		type dnsmasq_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, dnsmasq_var_run_t, dnsmasq_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Create dnsmasq pid directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_create_pid_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_create_pid_dirs'($*)) dnl
	
	gen_require(`
		type dnsmasq_var_run_t;
	')

	files_search_pids($1)
	allow $1 dnsmasq_var_run_t:dir create_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_create_pid_dirs'($*)) dnl
	')


########################################
## <summary>
##	Create dnsmasq pid directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_read_state'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
	')
    ps_process_pattern($1, dnsmasq_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_read_state'($*)) dnl
	')


########################################
## <summary>
##	Transition to dnsmasq named content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
## <param name="private type">
##	<summary>
##	The type of the directory for the object to be created.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_filetrans_named_content_fromdir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_filetrans_named_content_fromdir'($*)) dnl
	
	gen_require(`
		type dnsmasq_var_run_t;
	')

	filetrans_pattern($1, $2, dnsmasq_var_run_t, dir, "network")
	filetrans_pattern($1, $2, dnsmasq_var_run_t, file, "dnsmasq.pid")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_filetrans_named_content_fromdir'($*)) dnl
	')


#######################################
## <summary>
##      Transition to dnsmasq named content
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`dnsmasq_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_filetrans_named_content'($*)) dnl
	
		gen_require(`
            type dnsmasq_etc_t;
			type dnsmasq_var_run_t;
	')

	files_pid_filetrans($1, dnsmasq_var_run_t, dir, "network")
	files_pid_filetrans($1, dnsmasq_var_run_t, file, "dnsmasq.pid")
	virt_pid_filetrans($1, dnsmasq_var_run_t, file, "network")
	files_etc_filetrans($1, dnsmasq_etc_t, file, "dnsmasq.conf")
	files_etc_filetrans($1, dnsmasq_etc_t, dir, "dnsmasq.d")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_filetrans_named_content'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an dnsmasq environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dnsmasq_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_admin'($*)) dnl
	
	gen_require(`
		type dnsmasq_t, dnsmasq_lease_t, dnsmasq_var_run_t;
        type dnsmasq_var_log_t;
		type dnsmasq_initrc_exec_t;
		type dnsmasq_unit_file_t;
	')

	allow $1 dnsmasq_t:process signal_perms;
	ps_process_pattern($1, dnsmasq_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 dnsmasq_t:process ptrace;
	')

	init_labeled_script_domtrans($1, dnsmasq_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dnsmasq_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_var_lib($1)
	admin_pattern($1, dnsmasq_lease_t)

	logging_search_logs($1)
	admin_pattern($1, dnsmasq_var_log_t)

	files_list_pids($1)
	admin_pattern($1, dnsmasq_var_run_t)

	dnsmasq_systemctl($1)
	admin_pattern($1, dnsmasq_unit_file_t)
	allow $1 dnsmasq_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_admin'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	dnsmasq over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnsmasq_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnsmasq_dbus_chat'($*)) dnl
	
	gen_require(`
		type dnsmasq_t;
		class dbus send_msg;
	')

	allow $1 dnsmasq_t:dbus send_msg;
	allow dnsmasq_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnsmasq_dbus_chat'($*)) dnl
	')




## <summary>policy for dnssec_trigger</summary>

########################################
## <summary>
##	Transition to dnssec_trigger.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`dnssec_trigger_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnssec_trigger_domtrans'($*)) dnl
	
	gen_require(`
		type dnssec_trigger_t, dnssec_trigger_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dnssec_trigger_exec_t, dnssec_trigger_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnssec_trigger_domtrans'($*)) dnl
	')

########################################
## <summary>
##	Read dnssec_trigger PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnssec_trigger_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnssec_trigger_read_pid_files'($*)) dnl
	
	gen_require(`
		type dnssec_trigger_var_run_t;
	')

	files_search_pids($1)
	allow $1 dnssec_trigger_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnssec_trigger_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Manage dnssec_trigger PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnssec_trigger_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnssec_trigger_manage_pid_files'($*)) dnl
	
	gen_require(`
		type dnssec_trigger_var_run_t;
	')

	files_search_pids($1)
	manage_dirs_pattern($1, dnssec_trigger_var_run_t, dnssec_trigger_var_run_t)
	manage_files_pattern($1, dnssec_trigger_var_run_t, dnssec_trigger_var_run_t)
	manage_lnk_files_pattern($1, dnssec_trigger_var_run_t, dnssec_trigger_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnssec_trigger_manage_pid_files'($*)) dnl
	')



########################################
## <summary>
##	Send signull to dnssec_trigger.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#
 	 	define(`dnssec_trigger_signull',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnssec_trigger_signull'($*)) dnl
	
	gen_require(`
		type dnssec_trigger_t;
	')

    allow $1 dnssec_trigger_t:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnssec_trigger_signull'($*)) dnl
	')


########################################
## <summary>
##	Send sigkill to dnssec_trigger.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#
 	 	define(`dnssec_trigger_sigkill',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnssec_trigger_sigkill'($*)) dnl
	
	gen_require(`
		type dnssec_trigger_t;
	')

    allow $1 dnssec_trigger_t:process sigkill;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnssec_trigger_sigkill'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an dnssec_trigger environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dnssec_trigger_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dnssec_trigger_admin'($*)) dnl
	
	gen_require(`
		type dnssec_trigger_t;
		type dnssec_trigger_var_run_t;
	')

	allow $1 dnssec_trigger_t:process { ptrace signal_perms };
	ps_process_pattern($1, dnssec_trigger_t)

	files_search_pids($1)
	admin_pattern($1, dnssec_trigger_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dnssec_trigger_admin'($*)) dnl
	')

## <summary>Dovecot POP and IMAP mail server</summary>

######################################
## <summary>
##  Creates types and rules for a basic
##  dovecot daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`dovecot_basic_types_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_basic_types_template'($*)) dnl
	
	gen_require(`
		attribute dovecot_domain;
	')

	type $1_t, dovecot_domain;
	type $1_exec_t;

	kernel_read_system_state($1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_basic_types_template'($*)) dnl
	')


#######################################
## <summary>
##  Connect to dovecot unix domain stream socket.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`dovecot_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_stream_connect'($*)) dnl
	
    gen_require(`
        type dovecot_t, dovecot_var_run_t;
    ')

    files_search_pids($1)
    stream_connect_pattern($1, dovecot_var_run_t, dovecot_var_run_t, dovecot_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Connect to dovecot auth unix domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dovecot_stream_connect_auth',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_stream_connect_auth'($*)) dnl
	
	gen_require(`
		type dovecot_auth_t, dovecot_var_run_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, dovecot_var_run_t, dovecot_var_run_t, dovecot_auth_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_stream_connect_auth'($*)) dnl
	')


########################################
## <summary>
##	Execute dovecot_deliver in the dovecot_deliver domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dovecot_domtrans_deliver',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_domtrans_deliver'($*)) dnl
	
	gen_require(`
		type dovecot_deliver_t, dovecot_deliver_exec_t;
	')

	domtrans_pattern($1, dovecot_deliver_exec_t, dovecot_deliver_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_domtrans_deliver'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete the dovecot spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dovecot_manage_spool',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_manage_spool'($*)) dnl
	
	gen_require(`
		type dovecot_spool_t;
	')

	files_search_spool($1)
	manage_files_pattern($1, dovecot_spool_t, dovecot_spool_t)
	manage_lnk_files_pattern($1, dovecot_spool_t, dovecot_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_manage_spool'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to delete dovecot lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dovecot_dontaudit_unlink_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_dontaudit_unlink_lib_files'($*)) dnl
	
	gen_require(`
		type dovecot_var_lib_t;
	')

	dontaudit $1 dovecot_var_lib_t:file unlink;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_dontaudit_unlink_lib_files'($*)) dnl
	')


######################################
## <summary>
##	Allow attempts to write inherited
##	dovecot tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dovecot_write_inherited_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_write_inherited_tmp_files'($*)) dnl
	
	gen_require(`
		type dovecot_tmp_t;
	')

	allow $1 dovecot_tmp_t:file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_write_inherited_tmp_files'($*)) dnl
	')


####################################
## <summary>
##	Read dovecot configuration file.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dovecot_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_read_config'($*)) dnl
	
	gen_require(`
		type dovecot_etc_t;
	')

	files_search_etc($1)
	list_dirs_pattern($1, dovecot_etc_t, dovecot_etc_t)
	read_files_pattern($1, dovecot_etc_t, dovecot_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_read_config'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an dovecot environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed to manage the dovecot domain.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dovecot_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_admin'($*)) dnl
	
	gen_require(`
		type dovecot_t, dovecot_etc_t, dovecot_var_log_t;
		type dovecot_spool_t, dovecot_var_lib_t, dovecot_initrc_exec_t;
		type dovecot_var_run_t, dovecot_cert_t, dovecot_passwd_t;
		type dovecot_tmp_t, dovecot_auth_tmp_t, dovecot_deliver_tmp_t;
		type dovecot_keytab_t;
	')

	allow $1 dovecot_t:process signal_perms;
	ps_process_pattern($1, dovecot_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 dovecot_t:process ptrace;
	')

	init_labeled_script_domtrans($1, dovecot_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 dovecot_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, { dovecot_keytab_t dovecot_etc_t })

	files_list_tmp($1)
	admin_pattern($1, dovecot_auth_tmp_t)
	admin_pattern($1, dovecot_tmp_t)

	admin_pattern($1, dovecot_keytab_t)

	files_list_spool($1)
	admin_pattern($1, dovecot_spool_t)

	files_list_var_lib($1)
	admin_pattern($1, dovecot_var_lib_t)

	logging_search_logs($1)
	admin_pattern($1, dovecot_var_log_t)

	files_list_pids($1)
	admin_pattern($1, dovecot_var_run_t)

	admin_pattern($1, dovecot_cert_t)

	admin_pattern($1, dovecot_passwd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_admin'($*)) dnl
	')


########################################
## <summary>
##	Read dovecot SSL certificates
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dovecot_read_certs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dovecot_read_certs'($*)) dnl
	
	gen_require(`
		type dovecot_cert_t;
	')

	miscfiles_search_generic_cert_dirs($1)
	read_files_pattern($1, dovecot_cert_t, dovecot_cert_t)
	read_lnk_files_pattern($1, dovecot_cert_t, dovecot_cert_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dovecot_read_certs'($*)) dnl
	')

## <summary>Debian package manager.</summary>

########################################
## <summary>
##	Execute dpkg programs in the dpkg domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dpkg_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_domtrans'($*)) dnl
	
	gen_require(`
		type dpkg_t, dpkg_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, dpkg_exec_t, dpkg_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute the dkpg in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_exec'($*)) dnl
	
	gen_require(`
		type dpkg_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, dpkg_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute dpkg_script programs in
##	the dpkg_script domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`dpkg_domtrans_script',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_domtrans_script'($*)) dnl
	
	gen_require(`
		type dpkg_script_t;
	')

	corecmd_shell_domtrans($1, dpkg_script_t)
	allow dpkg_script_t $1:fd use;
	allow dpkg_script_t $1:fifo_file rw_file_perms;
	allow dpkg_script_t $1:process sigchld;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_domtrans_script'($*)) dnl
	')


########################################
## <summary>
##	Execute dpkg programs in the dpkg domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dpkg_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_run'($*)) dnl
	
	gen_require(`
		attribute_role dpkg_roles;
	')

	dpkg_domtrans($1)
	roleattribute $2 dpkg_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_run'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use file descriptors from dpkg.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_use_fds'($*)) dnl
	
	gen_require(`
		type dpkg_t;
	')

	allow $1 dpkg_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Read from unnamed dpkg pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_read_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_read_pipes'($*)) dnl
	
	gen_require(`
		type dpkg_t;
	')

	allow $1 dpkg_t:fifo_file read_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_read_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and write unnamed dpkg pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_rw_pipes'($*)) dnl
	
	gen_require(`
		type dpkg_t;
	')

	allow $1 dpkg_t:fifo_file rw_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_rw_pipes'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use file descriptors
##	from dpkg scripts.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_use_script_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_use_script_fds'($*)) dnl
	
	gen_require(`
		type dpkg_script_t;
	')

	allow $1 dpkg_script_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_use_script_fds'($*)) dnl
	')


########################################
## <summary>
##	Read dpkg package database content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_read_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_read_db'($*)) dnl
	
	gen_require(`
		type dpkg_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 dpkg_var_lib_t:dir list_dir_perms;
	read_files_pattern($1, dpkg_var_lib_t, dpkg_var_lib_t)
	read_lnk_files_pattern($1, dpkg_var_lib_t, dpkg_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_read_db'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	dpkg package database content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_manage_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_manage_db'($*)) dnl
	
	gen_require(`
		type dpkg_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, dpkg_var_lib_t, dpkg_var_lib_t)
	manage_lnk_files_pattern($1, dpkg_var_lib_t, dpkg_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_manage_db'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to create,
##	read, write, and delete dpkg
##	package database content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dpkg_dontaudit_manage_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_dontaudit_manage_db'($*)) dnl
	
	gen_require(`
		type dpkg_var_lib_t;
	')

	dontaudit $1 dpkg_var_lib_t:dir rw_dir_perms;
	dontaudit $1 dpkg_var_lib_t:file manage_file_perms;
	dontaudit $1 dpkg_var_lib_t:lnk_file manage_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_dontaudit_manage_db'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	dpkg lock files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dpkg_lock_db',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dpkg_lock_db'($*)) dnl
	
	gen_require(`
		type dpkg_lock_t, dpkg_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 dpkg_var_lib_t:dir list_dir_perms;
	allow $1 dpkg_lock_t:file manage_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dpkg_lock_db'($*)) dnl
	')

## <summary>Mirrors a block device over the network to another machine.</summary>

########################################
## <summary>
##	Execute a domain transition to run drbd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`drbd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `drbd_domtrans'($*)) dnl
	
	gen_require(`
		type drbd_t, drbd_exec_t;
	')

	domtrans_pattern($1, drbd_exec_t, drbd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `drbd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search drbd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`drbd_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `drbd_search_lib'($*)) dnl
	
	gen_require(`
		type drbd_var_lib_t;
	')

	allow $1 drbd_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `drbd_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read drbd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`drbd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `drbd_read_lib_files'($*)) dnl
	
	gen_require(`
		type drbd_var_lib_t;
	')

	files_search_var_lib($1)
        read_files_pattern($1, drbd_var_lib_t, drbd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `drbd_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	drbd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`drbd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `drbd_manage_lib_files'($*)) dnl
	
	gen_require(`
		type drbd_var_lib_t;
	')

	files_search_var_lib($1)
        manage_files_pattern($1, drbd_var_lib_t, drbd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `drbd_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage drbd lib dirs files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`drbd_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `drbd_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type drbd_var_lib_t;
	')

	files_search_var_lib($1)
        manage_dirs_pattern($1, drbd_var_lib_t, drbd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `drbd_manage_lib_dirs'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an drbd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`drbd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `drbd_admin'($*)) dnl
	
	gen_require(`
		type drbd_t, drbd_initrc_exec_t, drbd_lock_t;
		type drbd_var_lib_t;
	')

	allow $1 drbd_t:process signal_perms;
	ps_process_pattern($1, drbd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 drbd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, drbd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 drbd_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_locks($1)
	admin_pattern($1, drbd_lock_t)

	files_search_var_lib($1)
	admin_pattern($1, drbd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `drbd_admin'($*)) dnl
	')



## <summary>policy for dspam</summary>


########################################
## <summary>
##	Execute a domain transition to run dspam.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`dspam_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_domtrans'($*)) dnl
	
	gen_require(`
		type dspam_t, dspam_exec_t;
	')

	domtrans_pattern($1, dspam_exec_t, dspam_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_domtrans'($*)) dnl
	')



########################################
## <summary>
##	Execute dspam server in the dspam domain.
## </summary>
## <param name="domain">
##	<summary>
##	The type of the process performing this action.
##	</summary>
## </param>
#
 	 	define(`dspam_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type dspam_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, dspam_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read dspam's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dspam_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_read_log'($*)) dnl
	
	gen_require(`
		type dspam_log_t;
	')

	logging_search_logs($1)
        read_files_pattern($1, dspam_log_t, dspam_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_read_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to append
##	dspam log files.
## </summary>
## <param name="domain">
## 	<summary>
##	Domain allowed to transition.
## 	</summary>
## </param>
#
 	 	define(`dspam_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_append_log'($*)) dnl
	
	gen_require(`
		type dspam_log_t;
	')

	logging_search_logs($1)
        append_files_pattern($1, dspam_log_t, dspam_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_append_log'($*)) dnl
	')


########################################
## <summary>
##	Allow domain to manage dspam log files
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`dspam_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_manage_log'($*)) dnl
	
	gen_require(`
		type dspam_log_t;
	')

	logging_search_logs($1)
        manage_dirs_pattern($1, dspam_log_t, dspam_log_t)
        manage_files_pattern($1, dspam_log_t, dspam_log_t)
        manage_lnk_files_pattern($1, dspam_log_t, dspam_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Search dspam lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dspam_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_search_lib'($*)) dnl
	
	gen_require(`
		type dspam_var_lib_t;
	')

	allow $1 dspam_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read dspam lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dspam_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_read_lib_files'($*)) dnl
	
	gen_require(`
		type dspam_var_lib_t;
	')

	files_search_var_lib($1)
        read_files_pattern($1, dspam_var_lib_t, dspam_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	dspam lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dspam_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_manage_lib_files'($*)) dnl
	
	gen_require(`
		type dspam_var_lib_t;
	')

	files_search_var_lib($1)
        manage_files_pattern($1, dspam_var_lib_t, dspam_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage dspam lib dirs files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dspam_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type dspam_var_lib_t;
	')

	files_search_var_lib($1)
        manage_dirs_pattern($1, dspam_var_lib_t, dspam_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_manage_lib_dirs'($*)) dnl
	')



########################################
## <summary>
##	Read dspam PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`dspam_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_read_pid_files'($*)) dnl
	
	gen_require(`
		type dspam_var_run_t;
	')

	files_search_pids($1)
	allow $1 dspam_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_read_pid_files'($*)) dnl
	')


#######################################
## <summary>
##  Connect to DSPAM using a unix domain stream socket.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`dspam_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_stream_connect'($*)) dnl
	
    gen_require(`
        type dspam_t, dspam_var_run_t, dspam_tmp_t;
    ')

    files_search_pids($1)
	files_search_tmp($1)
    stream_connect_pattern($1, dspam_var_run_t, dspam_var_run_t, dspam_t)
    stream_connect_pattern($1, dspam_tmp_t, dspam_tmp_t, dspam_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an dspam environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`dspam_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `dspam_admin'($*)) dnl
	
	gen_require(`
		type dspam_t;
		type dspam_initrc_exec_t;
		type dspam_log_t;
		type dspam_var_lib_t;
		type dspam_var_run_t;
	')

	allow $1 dspam_t:process signal_perms;
	ps_process_pattern($1, dspam_t)
	tunable_policy(`deny_ptrace',`',`
		allow $1 dspam_t:process ptrace;
	')

	dspam_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 dspam_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, dspam_log_t)

	files_search_var_lib($1)
	admin_pattern($1, dspam_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, dspam_var_run_t)


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `dspam_admin'($*)) dnl
	')

## <summary>Generate entropy from audio input.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an entropyd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`entropyd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `entropyd_admin'($*)) dnl
	
	gen_require(`
		type entropyd_t, entropyd_initrc_exec_t, entropyd_var_run_t;
	')

	allow $1 entropyd_t:process { ptrace signal_perms };
	ps_process_pattern($1, entropyd_t)

	init_labeled_script_domtrans($1, entropyd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 entropyd_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, entropyd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `entropyd_admin'($*)) dnl
	')

## <summary>Evolution email client.</summary>

########################################
## <summary>
##	Role access for evolution.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role.
##	</summary>
## </param>
#
 	 	define(`evolution_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `evolution_role'($*)) dnl
	
	gen_require(`
		attribute_role evolution_roles;
		type evolution_t, evolution_exec_t, evolution_home_t;
		type evolution_alarm_t, evolution_alarm_exec_t, evolution_alarm_orbit_tmp_t;
		type evolution_exchange_t, evolution_exchange_exec_t, evolution_exchange_tmp_t;
		type evolution_exchange_orbit_tmp_t, evolution_orbit_tmp_t, evolution_server_orbit_tmp_t;
		type evolution_server_t, evolution_server_exec_t, evolution_webcal_t;
		type evolution_webcal_exec_t, evolution_alarm_tmpfs_t, evolution_exchange_tmpfs_t;
		type evolution_tmpfs_t, evolution_webcal_tmpfs_t;
	')

	roleattribute $1 evolution_roles;

	domtrans_pattern($2, evolution_exec_t, evolution_t)
	domtrans_pattern($2, evolution_alarm_exec_t, evolution_alarm_t)
	domtrans_pattern($2, evolution_exchange_exec_t, evolution_exchange_t)
	domtrans_pattern($2, evolution_server_exec_t, evolution_server_t)
	domtrans_pattern($2, evolution_webcal_exec_t, evolution_webcal_t)

	allow $2 { evolution_t evolution_alarm_t evolution_exchange_t evolution_server_t evolution_webcal_t }:process { noatsecure ptrace signal_perms };
	ps_process_pattern($2, { evolution_t evolution_alarm_t evolution_exchange_t })
	ps_process_pattern($2, { evolution_server_t evolution_webcal_t })

	allow evolution_t $2:dir search_dir_perms;
	allow evolution_t $2:file read_file_perms;
	allow evolution_t $2:lnk_file read_lnk_file_perms;

	allow $2 evolution_home_t:dir { relabel_dir_perms manage_dir_perms };
	allow $2 evolution_home_t:file { relabel_file_perms manage_file_perms };
	allow $2 evolution_home_t:lnk_file { relabel_lnk_file_perms manage_lnk_file_perms };

	userdom_user_home_dir_filetrans($2, evolution_home_t, dir, ".camel_certs")
	userdom_user_home_dir_filetrans($2, evolution_home_t, dir, ".evolution")

	allow $2 evolution_exchange_tmp_t:dir { manage_dir_perms relabel_dir_perms };
	allow $2 { evolution_alarm_orbit_tmp_t evolution_exchange_orbit_tmp_t evolution_orbit_tmp_t evolution_server_orbit_tmp_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };

	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:dir { manage_dir_perms relabel_dir_perms };
	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:file { manage_file_perms relabel_file_perms };
	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };

	allow { evolution_t evolution_exchange_t } $2:unix_stream_socket connectto;

	stream_connect_pattern($2, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)
	stream_connect_pattern($2, evolution_exchange_orbit_tmp_t, evolution_exchange_orbit_tmp_t, evolution_exchange_t)

	optional_policy(`
		evolution_dbus_chat($2)
		evolution_alarm_dbus_chat($2)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `evolution_role'($*)) dnl
	')


########################################
## <summary>
##	Create objects in the evolution home
##	directories with a private type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="private_type">
##	<summary>
##	Private file type.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	Class of the object being created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`evolution_home_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `evolution_home_filetrans'($*)) dnl
	
	gen_require(`
		type evolution_home_t;
	')

	userdom_search_user_home_dirs($1)
	filetrans_pattern($1, evolution_home_t, $2, $3, $4)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `evolution_home_filetrans'($*)) dnl
	')


########################################
## <summary>
##	Connect to evolution using a unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`evolution_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `evolution_stream_connect'($*)) dnl
	
	gen_require(`
		type evolution_t, evolution_orbit_tmp_t;
	')


	files_search_tmp($1)
	stream_connect_pattern($1, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `evolution_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	evolution over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`evolution_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `evolution_dbus_chat'($*)) dnl
	
	gen_require(`
		type evolution_t;
		class dbus send_msg;
	')

	allow $1 evolution_t:dbus send_msg;
	allow evolution_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `evolution_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	evolution_alarm over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`evolution_alarm_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `evolution_alarm_dbus_chat'($*)) dnl
	
	gen_require(`
		type evolution_alarm_t;
		class dbus send_msg;
	')

	allow $1 evolution_alarm_t:dbus send_msg;
	allow evolution_alarm_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `evolution_alarm_dbus_chat'($*)) dnl
	')

## <summary>Mail transfer agent.</summary>

########################################
## <summary>
##	Execute a domain transition to run exim.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`exim_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_domtrans'($*)) dnl
	
	gen_require(`
		type exim_t, exim_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, exim_exec_t, exim_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_domtrans'($*)) dnl
	')


########################################
## <summary>
##     Execute the mailman program in the mailman domain.
## </summary>
## <param name="domain">
##     <summary>
##     Domain allowed to transition.
##     </summary>
## </param>
## <param name="role">
##     <summary>
##     The role to allow the mailman domain.
##     </summary>
## </param>
## <rolecap/>
#
 	 	define(`exim_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_run'($*)) dnl
	
       gen_require(`
               type exim_t;
       ')

       exim_domtrans($1)
       role $2 types exim_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_run'($*)) dnl
	')


########################################
## <summary>
##	Execute exim in the exim domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`exim_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type exim_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, exim_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read, 
##	exim tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`exim_dontaudit_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_dontaudit_read_tmp_files'($*)) dnl
	
	gen_require(`
		type exim_tmp_t;
	')

	dontaudit $1 exim_tmp_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_dontaudit_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Allow domain to read, exim tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_read_tmp_files'($*)) dnl
	
	gen_require(`
		type exim_tmp_t;
	')

	allow $1 exim_tmp_t:file read_file_perms;
	files_search_tmp($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Read exim PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_read_pid_files'($*)) dnl
	
	gen_require(`
		type exim_var_run_t;
	')

	allow $1 exim_var_run_t:file read_file_perms;
	files_search_pids($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read exim's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`exim_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_read_log'($*)) dnl
	
	gen_require(`
		type exim_log_t;
	')

	read_files_pattern($1, exim_log_t, exim_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_read_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to append
##	exim log files.
## </summary>
## <param name="domain">
## 	<summary>
##	Domain allowed access.
## 	</summary>
## </param>
#
 	 	define(`exim_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_append_log'($*)) dnl
	
	gen_require(`
		type exim_log_t;
	')

	append_files_pattern($1, exim_log_t, exim_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_append_log'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to manage exim's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`exim_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_manage_log'($*)) dnl
	
	gen_require(`
		type exim_log_t;
	')

	manage_files_pattern($1, exim_log_t, exim_log_t)
	logging_search_logs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	exim spool dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_manage_spool_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_manage_spool_dirs'($*)) dnl
	
	gen_require(`
		type exim_spool_t;
	')

	manage_dirs_pattern($1, exim_spool_t, exim_spool_t)
	files_search_spool($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_manage_spool_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read exim spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_read_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_read_spool_files'($*)) dnl
	
	gen_require(`
		type exim_spool_t;
	')

	allow $1 exim_spool_t:file read_file_perms;
	allow $1 exim_spool_t:dir list_dir_perms;
	files_search_spool($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_read_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	exim spool files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_manage_spool_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_manage_spool_files'($*)) dnl
	
	gen_require(`
		type exim_spool_t;
	')

	manage_files_pattern($1, exim_spool_t, exim_spool_t)
	files_search_spool($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_manage_spool_files'($*)) dnl
	')


########################################
## <summary>
##	Read exim var lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_read_var_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_read_var_lib_files'($*)) dnl
	
	gen_require(`
		type exim_var_lib_t;
	')

	read_files_pattern($1, exim_var_lib_t, exim_var_lib_t)
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_read_var_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, and write exim var lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_manage_var_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_manage_var_lib_files'($*)) dnl
	
	gen_require(`
		type exim_var_lib_t;
	')

	manage_files_pattern($1, exim_var_lib_t, exim_var_lib_t)
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_manage_var_lib_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an exim environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`exim_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `exim_admin'($*)) dnl
	
	gen_require(`
		type exim_t, exim_spool_t, exim_log_t;
		type exim_var_run_t, exim_initrc_exec_t, exim_tmp_t;
		type exim_keytab_t;
	')

	allow $1 exim_t:process signal_perms;
	ps_process_pattern($1, exim_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 exim_t:process ptrace;
	')

	exim_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 exim_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, exim_keytab_t)

	files_search_spool($1)
	admin_pattern($1, exim_spool_t)

	logging_search_logs($1)
	admin_pattern($1, exim_log_t)

	files_search_pids($1)
	admin_pattern($1, exim_var_run_t)

	files_search_tmp($1)
	admin_pattern($1, exim_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `exim_admin'($*)) dnl
	')

## <summary>Update firewall filtering to ban IP addresses with too many password failures.</summary>

########################################
## <summary>
##	Execute a domain transition to run fail2ban.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#

	 	 	define(`fail2ban_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_domtrans'($*)) dnl
	
		gen_require(`
			type fail2ban_t, fail2ban_exec_t;
		')

		corecmd_search_bin($1)
		domtrans_pattern($1, fail2ban_exec_t, fail2ban_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_domtrans'($*)) dnl
	')



#######################################
## <summary>
##  Execute the fail2ban client in
##  the fail2ban client domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#

	 	 	define(`fail2ban_domtrans_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_domtrans_client'($*)) dnl
	
	    gen_require(`
	        type fail2ban_client_t, fail2ban_client_exec_t;
	    ')

	    corecmd_search_bin($1)
	    domtrans_pattern($1, fail2ban_client_exec_t, fail2ban_client_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_domtrans_client'($*)) dnl
	')



#######################################
## <summary>
##  Execute fail2ban client in the
##  fail2ban client domain, and allow
##  the specified role the fail2ban
##  client domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
## <param name="role">
##  <summary>
##  Role allowed access.
##  </summary>
## </param>
#

	 	 	define(`fail2ban_run_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_run_client'($*)) dnl
	
	    gen_require(`
	        attribute_role fail2ban_client_roles;
	    ')

	    fail2ban_domtrans_client($1)
	    roleattribute $2 fail2ban_client_roles;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_run_client'($*)) dnl
	')



#####################################
## <summary>
##	Connect to fail2ban over a unix domain
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`fail2ban_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_stream_connect'($*)) dnl
	
		gen_require(`
			type fail2ban_t, fail2ban_var_run_t;
		')

		files_search_pids($1)
		stream_connect_pattern($1, fail2ban_var_run_t, fail2ban_var_run_t, fail2ban_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_stream_connect'($*)) dnl
	')



########################################
## <summary>
##	Read and write inherited temporary files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`fail2ban_rw_inherited_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_rw_inherited_tmp_files'($*)) dnl
	
		gen_require(`
			type fail2ban_tmp_t;
		')

		files_search_tmp($1)
		allow $1 fail2ban_tmp_t:file rw_inherited_file_perms;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_rw_inherited_tmp_files'($*)) dnl
	')



########################################
## <summary>
##	Read and write to an fail2ba unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`fail2ban_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_rw_stream_sockets'($*)) dnl
	
		gen_require(`
			type fail2ban_t;
		')

		allow $1 fail2ban_t:unix_stream_socket rw_stream_socket_perms;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_rw_stream_sockets'($*)) dnl
	')



#######################################
## <summary>
##  Do not audit attempts to use
##  fail2ban file descriptors.
## </summary>
## <param name="domain">
##  <summary>
##  Domain to not audit.
##  </summary>
## </param>
#

	 	 	define(`fail2ban_dontaudit_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_dontaudit_use_fds'($*)) dnl
	
	    gen_require(`
	        type fail2ban_t;
	    ')

	    dontaudit $1 fail2ban_t:fd use;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_dontaudit_use_fds'($*)) dnl
	')



#######################################
## <summary>
##  Do not audit attempts to read and
##  write fail2ban unix stream sockets
## </summary>
## <param name="domain">
##  <summary>
##  Domain to not audit.
##  </summary>
## </param>
#

	 	 	define(`fail2ban_dontaudit_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_dontaudit_rw_stream_sockets'($*)) dnl
	
	    gen_require(`
	        type fail2ban_t;
	    ')

	    dontaudit $1 fail2ban_t:unix_stream_socket { read write };
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_dontaudit_rw_stream_sockets'($*)) dnl
	')



########################################
## <summary>
##	Read fail2ban lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`fail2ban_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_read_lib_files'($*)) dnl
	
		gen_require(`
			type fail2ban_var_lib_t;
		')

		files_search_var_lib($1)
		read_files_pattern($1, fail2ban_var_lib_t, fail2ban_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_read_lib_files'($*)) dnl
	')



########################################
## <summary>
##	Allow the specified domain to read fail2ban's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#

	 	 	define(`fail2ban_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_read_log'($*)) dnl
	
		gen_require(`
			type fail2ban_log_t;
		')

		logging_search_logs($1)
		allow $1 fail2ban_log_t:dir list_dir_perms;
		allow $1 fail2ban_log_t:file read_file_perms;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_read_log'($*)) dnl
	')



########################################
## <summary>
##	Allow the specified domain to append
##	fail2ban log files.
## </summary>
## <param name="domain">
## 	<summary>
##	Domain allowed access.
## 	</summary>
## </param>
#

	 	 	define(`fail2ban_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_append_log'($*)) dnl
	
		gen_require(`
			type fail2ban_log_t;
		')

		logging_search_logs($1)
		allow $1 fail2ban_log_t:dir list_dir_perms;
		allow $1 fail2ban_log_t:file append_file_perms;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_append_log'($*)) dnl
	')



########################################
## <summary>
##	Read fail2ban PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`fail2ban_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_read_pid_files'($*)) dnl
	
		gen_require(`
			type fail2ban_var_run_t;
		')

		files_search_pids($1)
		allow $1 fail2ban_var_run_t:file read_file_perms;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_read_pid_files'($*)) dnl
	')



########################################
## <summary>
##	dontaudit read and write an leaked file descriptors
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#

	 	 	define(`fail2ban_dontaudit_leaks',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_dontaudit_leaks'($*)) dnl
	
		gen_require(`
			type fail2ban_t;
		')

	 	dontaudit $1 fail2ban_t:tcp_socket { read write };
		dontaudit $1 fail2ban_t:unix_dgram_socket { read write };
		dontaudit $1 fail2ban_t:unix_stream_socket { read write };
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_dontaudit_leaks'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate 
##	an fail2ban environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed to manage the fail2ban domain.
##	</summary>
## </param>
## <rolecap/>
#

	 	 	define(`fail2ban_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fail2ban_admin'($*)) dnl
	
		gen_require(`
			type fail2ban_t, fail2ban_log_t, fail2ban_initrc_exec_t;
			type fail2ban_var_run_t, fail2ban_var_lib_t, fail2ban_tmp_t;
			type fail2ban_client_t;
		')

		allow $1 { fail2ban_t fail2ban_client_t }:process signal_perms;
		ps_process_pattern($1, { fail2ban_t fail2ban_client_t })

		tunable_policy(`deny_ptrace',`',`
			allow $1 { fail2ban_t fail2ban_client_t }:process ptrace;
		')

		init_labeled_script_domtrans($1, fail2ban_initrc_exec_t)
		domain_system_change_exemption($1)
		role_transition $2 fail2ban_initrc_exec_t system_r;
		allow $2 system_r;

		logging_list_logs($1)
		admin_pattern($1, fail2ban_log_t)

		files_list_pids($1)
		admin_pattern($1, fail2ban_var_run_t)

		files_list_var_lib($1)
		admin_pattern($1, fail2ban_var_lib_t)

		files_list_tmp($1)
		admin_pattern($1, fail2ban_tmp_t)

		fail2ban_run_client($1, $2)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fail2ban_admin'($*)) dnl
	')


## <summary>Fibre Channel over Ethernet utilities.</summary>

#######################################
## <summary>
##	Send to fcoemon with a unix dgram socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fcoe_dgram_send_fcoemon',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fcoe_dgram_send_fcoemon'($*)) dnl
	
	gen_require(`
		type fcoemon_t, fcoemon_var_run_t;
	')

	files_search_pids($1)
	dgram_send_pattern($1, fcoemon_var_run_t, fcoemon_var_run_t, fcoemon_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fcoe_dgram_send_fcoemon'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an fcoemon environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`fcoe_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fcoe_admin'($*)) dnl
	
	gen_require(`
		type fcoemon_t, fcoemon_initrc_exec_t, fcoemon_var_run_t;
	')

	allow $1 fcoemon_t:process { ptrace signal_perms };
	ps_process_pattern($1, fcoemon_t)

	init_labeled_script_domtrans($1, fcoemon_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 fcoemon_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, fcoemon_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fcoe_admin'($*)) dnl
	')


## <summary>policy for fdo</summary>

########################################
## <summary>
##	Execute fdo_exec_t in the fdo domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`fdo_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fdo_domtrans'($*)) dnl
	
	gen_require(`
		type fdo_t, fdo_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, fdo_exec_t, fdo_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fdo_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute fdo in the caller domain.
## </summary>
## <param name="domain">
##    <summary>
##	Domain allowed access.
##    </summary>
## </param>
#
 	 	define(`fdo_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fdo_exec'($*)) dnl
	
	gen_require(`
		type fdo_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, fdo_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fdo_exec'($*)) dnl
	')

## <summary>Policy for fedora-third-party</summary>

########################################
## <summary>
##	Execute fedoratp programs in the fedoratp domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`fedoratp_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fedoratp_domtrans'($*)) dnl
	
	gen_require(`
		type fedoratp_t, fedoratp_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, fedoratp_exec_t, fedoratp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fedoratp_domtrans'($*)) dnl
	')

## <summary>Remote-mail retrieval and forwarding utility.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an fetchmail environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`fetchmail_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fetchmail_admin'($*)) dnl
	
	gen_require(`
		type fetchmail_t, fetchmail_etc_t, fetchmail_uidl_cache_t;
		type fetchmail_var_run_t, fetchmail_initrc_exec_t, fetchmail_log_t;
	')

	ps_process_pattern($1, fetchmail_t)
	tunable_policy(`deny_ptrace',`',`
		allow $1 fetchmail_t:process ptrace;
	')

	init_labeled_script_domtrans($1, fetchmail_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 fetchmail_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, fetchmail_etc_t)

	files_search_var_lib($1)
	admin_pattern($1, fetchmail_uidl_cache_t)

	files_list_pids($1)
	admin_pattern($1, fetchmail_var_run_t)

	logging_search_logs($1)
	admin_pattern($1, fetchmail_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fetchmail_admin'($*)) dnl
	')

## <summary>Finger user information service.</summary>

########################################
## <summary>
##	Execute fingerd in the fingerd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`finger_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `finger_domtrans'($*)) dnl
	
	gen_require(`
		type fingerd_t, fingerd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, fingerd_exec_t, fingerd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `finger_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Connect to fingerd with a tcp socket.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`finger_tcp_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `finger_tcp_connect'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `finger_tcp_connect'($*)) dnl
	')

## <summary>Service daemon with a D-BUS interface that provides a dynamic managed firewall.</summary>

########################################
## <summary>
##	Read firewalld config
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed access.
## </summary>
## </param>
#
 	 	define(`firewalld_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_read_config'($*)) dnl
	
	gen_require(`
		type firewalld_etc_rw_t;
	')

	files_search_etc($1)
	read_files_pattern($1, firewalld_etc_rw_t, firewalld_etc_rw_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_read_config'($*)) dnl
	')


########################################
## <summary>
##	Execute firewalld server in the firewalld domain.
## </summary>
## <param name="domain">
##	<summary>
##	The type of the process performing this action.
##	</summary>
## </param>
#
 	 	define(`firewalld_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type firewalld_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, firewalld_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute firewalld server in the firewalld domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`firewalld_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_systemctl'($*)) dnl
	
	gen_require(`
		type firewalld_t;
		type firewalld_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 firewalld_unit_file_t:file read_file_perms;
	allow $1 firewalld_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, firewalld_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	firewalld over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`firewalld_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_dbus_chat'($*)) dnl
	
	gen_require(`
		type firewalld_t;
		class dbus send_msg;
	')

	allow $1 firewalld_t:dbus send_msg;
	allow firewalld_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit attempts to write
##	firewalld tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firewalld_dontaudit_write_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_dontaudit_write_tmp_files'($*)) dnl
	
	gen_require(`
		type firewalld_tmp_t;
	')

	dontaudit $1 firewalld_tmp_t:file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_dontaudit_write_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Read firewalld PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`firewalld_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_read_pid_files'($*)) dnl
	
	gen_require(`
		type firewalld_var_run_t;
	')

	files_search_pids($1)
	allow $1 firewalld_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit read and write leaked firewalld file descriptors 
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firewalld_dontaudit_leaks',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_dontaudit_leaks'($*)) dnl
	
	gen_require(`
		type firewalld_tmpfs_t;
	')

	dontaudit $1 firewalld_tmpfs_t:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_dontaudit_leaks'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an firewalld environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`firewalld_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewalld_admin'($*)) dnl
	
	gen_require(`
		type firewalld_t, firewalld_initrc_exec_t;
		type firewalld_etc_rw_t, firewalld_var_run_t;
		type firewalld_var_log_t;
	')

	allow $1 firewalld_t:process signal_perms;
	ps_process_pattern($1, firewalld_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 firewalld_t:process ptrace;
	')

	firewalld_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 firewalld_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, firewalld_var_run_t)
	
	logging_search_logs($1)
	admin_pattern($1, firewalld_var_log_t)

	admin_pattern($1, firewalld_etc_rw_t)

	admin_pattern($1, firewalld_unit_file_t)
	firewalld_systemctl($1)
	allow $1 firewalld_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewalld_admin'($*)) dnl
	')

## <summary>system-config-firewall dbus system service.</summary>

########################################
## <summary>
##	Send and receive messages from
##	firewallgui over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`firewallgui_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewallgui_dbus_chat'($*)) dnl
	
	gen_require(`
		type firewallgui_t;
		class dbus send_msg;
	')

	allow $1 firewallgui_t:dbus send_msg;
	allow firewallgui_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewallgui_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read and
##	write firewallgui unnamed pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firewallgui_dontaudit_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firewallgui_dontaudit_rw_pipes'($*)) dnl
	
	gen_require(`
		type firewallgui_t;
	')

	dontaudit $1 firewallgui_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firewallgui_dontaudit_rw_pipes'($*)) dnl
	')

## <summary>
##	Final system configuration run during the first boot
##	after installation of Red Hat/Fedora systems.
## </summary>

########################################
## <summary>
##	Execute firstboot in the firstboot domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`firstboot_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_domtrans'($*)) dnl
	
	gen_require(`
		type firstboot_t, firstboot_exec_t;
	')

	domtrans_pattern($1, firstboot_exec_t, firstboot_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute firstboot in the firstboot domain, and
##	allow the specified role the firstboot domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`firstboot_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_run'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	firstboot_domtrans($1)
	role $2 types firstboot_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_run'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use a file descriptor from firstboot.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`firstboot_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_use_fds'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	allow $1 firstboot_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to inherit a
##	file descriptor from firstboot.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firstboot_dontaudit_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_dontaudit_use_fds'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	dontaudit $1 firstboot_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_dontaudit_use_fds'($*)) dnl
	')


########################################
## <summary>
##	dontaudit read and write an leaked file descriptors
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firstboot_dontaudit_leaks',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_dontaudit_leaks'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	dontaudit $1 firstboot_t:socket_class_set { read write };
	dontaudit $1 firstboot_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_dontaudit_leaks'($*)) dnl
	')


########################################
## <summary>
##	Write to a firstboot unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`firstboot_write_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_write_pipes'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	allow $1 firstboot_t:fd use;
	allow $1 firstboot_t:fifo_file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_write_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read and Write to a firstboot unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`firstboot_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_rw_pipes'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	allow $1 firstboot_t:fifo_file { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_rw_pipes'($*)) dnl
	')


########################################
## <summary>
## 	Do not audit attemps to read and write to a firstboot unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firstboot_dontaudit_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_dontaudit_rw_pipes'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	dontaudit $1 firstboot_t:fifo_file { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_dontaudit_rw_pipes'($*)) dnl
	')


########################################
## <summary>
## 	Do not audit attemps to read and write to a firstboot
##	unix domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`firstboot_dontaudit_rw_stream_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `firstboot_dontaudit_rw_stream_sockets'($*)) dnl
	
	gen_require(`
		type firstboot_t;
	')

	dontaudit $1 firstboot_t:unix_stream_socket { read write };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `firstboot_dontaudit_rw_stream_sockets'($*)) dnl
	')

## <summary></summary>
## <summary>DBus fingerprint reader service.</summary>

########################################
## <summary>
##	Execute a domain transition to run fprintd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`fprintd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fprintd_domtrans'($*)) dnl
	
	gen_require(`
		type fprintd_t, fprintd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, fprintd_exec_t, fprintd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fprintd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute fprintd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fprintd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fprintd_exec'($*)) dnl
	
	gen_require(`
		type fprintd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, fprintd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fprintd_exec'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	fprintd over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fprintd_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fprintd_dbus_chat'($*)) dnl
	
	gen_require(`
		type fprintd_t;
		class dbus send_msg;
	')

	allow $1 fprintd_t:dbus send_msg;
	allow fprintd_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fprintd_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Mounton fprintd lib directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fprintd_mounton_var_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fprintd_mounton_var_lib'($*)) dnl
	
	gen_require(`
		type fprintd_var_lib_t;
	')

	allow $1 fprintd_var_lib_t:dir mounton;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fprintd_mounton_var_lib'($*)) dnl
	')


########################################
## <summary>
##	Read fprintd lib directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fprintd_read_var_lib_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fprintd_read_var_lib_dir'($*)) dnl
	
	gen_require(`
		type fprintd_var_lib_t;
	')

	allow $1 fprintd_var_lib_t:dir { list_dir_perms };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fprintd_read_var_lib_dir'($*)) dnl
	')


########################################
## <summary>
##	Setattr fprintd lib directory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fprintd_setattr_var_lib_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fprintd_setattr_var_lib_dir'($*)) dnl
	
	gen_require(`
		type fprintd_var_lib_t;
	')

	allow $1 fprintd_var_lib_t:dir { setattr_dir_perms };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fprintd_setattr_var_lib_dir'($*)) dnl
	')

## <summary>Remote-Console (out-of-band) and System Management Software (in-band) based on Intelligent Platform Management Interface specification</summary>

#####################################
## <summary>
##  Creates types and rules for a basic
##  freeipmi init daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`freeipmi_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `freeipmi_domain_template'($*)) dnl
	
    gen_require(`
        attribute freeipmi_domain, freeipmi_pid;
    ')

    #############################
    #
    # Declarations
    #

    type freeipmi_$1_t, freeipmi_domain;
    type freeipmi_$1_exec_t;
    init_daemon_domain(freeipmi_$1_t, freeipmi_$1_exec_t)
    role system_r types freeipmi_$1_t;

	type freeipmi_$1_unit_file_t;
	systemd_unit_file(freeipmi_$1_unit_file_t)

	type freeipmi_$1_var_run_t, freeipmi_pid;
	files_pid_file(freeipmi_$1_var_run_t)

    #############################
    #
    # Local policy
    #

	manage_files_pattern(freeipmi_$1_t, freeipmi_$1_var_run_t, freeipmi_$1_var_run_t)

	kernel_read_system_state(freeipmi_$1_t)

	corenet_all_recvfrom_netlabel(freeipmi_$1_t)
	corenet_all_recvfrom_unlabeled(freeipmi_$1_t)

    auth_use_nsswitch(freeipmi_$1_t)

    logging_send_syslog_msg(freeipmi_$1_t)
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `freeipmi_domain_template'($*)) dnl
	')


####################################
## <summary>
##	Connect to cluster domains over a unix domain
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`freeipmi_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `freeipmi_stream_connect'($*)) dnl
	
	gen_require(`
		attribute freeipmi_domain, freeipmi_pid;
	')

	files_search_pids($1)
	stream_connect_pattern($1, freeipmi_pid, freeipmi_pid, freeipmi_domain)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `freeipmi_stream_connect'($*)) dnl
	')



## <summary>policy for freqset</summary>

########################################
## <summary>
##	Execute TEMPLATE in the freqset domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`freqset_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `freqset_domtrans'($*)) dnl
	
	gen_require(`
		type freqset_t, freqset_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, freqset_exec_t, freqset_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `freqset_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute freqset in the freqset domain, and
##	allow the specified role the freqset domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed the freqset domain.
##	</summary>
## </param>
#
 	 	define(`freqset_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `freqset_run'($*)) dnl
	
	gen_require(`
		type freqset_t;
		attribute_role freqset_roles;
	')

	freqset_domtrans($1)
	roleattribute $2 freqset_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `freqset_run'($*)) dnl
	')


########################################
## <summary>
##	Role access for freqset
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`freqset_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `freqset_role'($*)) dnl
	
	gen_require(`
		type freqset_t;
		attribute_role freqset_roles;
	')

	roleattribute $1 freqset_roles;

	freqset_domtrans($2)

	ps_process_pattern($2, freqset_t)
	allow $2 freqset_t:process { signull signal sigkill };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `freqset_role'($*)) dnl
	')

## <summary>File transfer protocol service.</summary>

######################################
## <summary>
##      Execute a domain transition to run ftpd.
## </summary>
## <param name="domain">
## <summary>
##      Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`ftp_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_domtrans'($*)) dnl
	
        gen_require(`
                type ftpd_t, ftpd_exec_t;
        ')

        corecmd_search_bin($1)
        domtrans_pattern($1,ftpd_exec_t, ftpd_t)


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Execute ftpd server in the ftpd domain.
## </summary>
## <param name="domain">
##  <summary>
##  The type of the process performing this action.
##  </summary>
## </param>
#
 	 	define(`ftp_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_initrc_domtrans'($*)) dnl
	
    gen_require(`
        type ftpd_initrc_exec_t;
    ')

    init_labeled_script_domtrans($1, ftpd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute ftpd server in the ftpd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ftp_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_systemctl'($*)) dnl
	
	gen_require(`
		type ftpd_unit_file_t;
		type ftpd_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 ftpd_unit_file_t:file read_file_perms;
	allow $1 ftpd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, ftpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_systemctl'($*)) dnl
	')


#######################################
## <summary>
##	Execute a dyntransition to run anon sftpd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ftp_dyntrans_anon_sftpd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_dyntrans_anon_sftpd'($*)) dnl
	
	gen_require(`
		type anon_sftpd_t;
	')

	dyntrans_pattern($1, anon_sftpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_dyntrans_anon_sftpd'($*)) dnl
	')


########################################
## <summary>
##	Connect to over ftpd over TCP.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ftp_tcp_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_tcp_connect'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_tcp_connect'($*)) dnl
	')


########################################
## <summary>
##	Read ftpd configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ftp_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_read_config'($*)) dnl
	
	gen_require(`
		type ftpd_etc_t;
	')

	files_search_etc($1)
	allow $1 ftpd_etc_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_read_config'($*)) dnl
	')


########################################
## <summary>
##	Execute FTP daemon entry point programs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ftp_check_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_check_exec'($*)) dnl
	
	gen_require(`
		type ftpd_exec_t;
	')

	corecmd_search_bin($1)
	allow $1 ftpd_exec_t:file mmap_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_check_exec'($*)) dnl
	')


########################################
## <summary>
##	Read ftpd log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ftp_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_read_log'($*)) dnl
	
	gen_require(`
		type xferlog_t;
	')

	logging_search_logs($1)
	allow $1 xferlog_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_read_log'($*)) dnl
	')


########################################
## <summary>
##	Execute the ftpdctl in the ftpdctl domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ftp_domtrans_ftpdctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_domtrans_ftpdctl'($*)) dnl
	
	gen_require(`
		type ftpdctl_t, ftpdctl_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ftpdctl_exec_t, ftpdctl_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_domtrans_ftpdctl'($*)) dnl
	')


########################################
## <summary>
##	Execute the ftpdctl in the ftpdctl
##	domain, and allow the specified
##	role the ftpctl domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ftp_run_ftpdctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_run_ftpdctl'($*)) dnl
	
	gen_require(`
		attribute_role ftpdctl_roles;
	')

	ftp_domtrans_ftpdctl($1)
	roleattribute $2 ftpdctl_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_run_ftpdctl'($*)) dnl
	')


#######################################
## <summary>
##	Execute a dyntransition to run sftpd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ftp_dyntrans_sftpd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_dyntrans_sftpd'($*)) dnl
	
	gen_require(`
		type sftpd_t;
	')

	dyntrans_pattern($1, sftpd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_dyntrans_sftpd'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an ftp environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ftp_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ftp_admin'($*)) dnl
	
	gen_require(`
		type ftpd_t, ftpdctl_t, ftpd_tmp_t;
		type ftpd_etc_t, ftpd_lock_t, sftpd_t;
		type ftpd_var_run_t, xferlog_t, anon_sftpd_t;
		type ftpd_initrc_exec_t, ftpdctl_tmp_t;
		type ftpd_keytab_t;
	')

	allow $1 ftpd_t:process signal_perms;
	ps_process_pattern($1, { ftpd_t ftpdctl_t sftpd_t anon_sftpd_t })
	tunable_policy(`deny_ptrace',`',`
		allow $1 { ftpd_t ftpdctl_t sftpd_t anon_sftpd_t }:process ptrace;
	')

	init_labeled_script_domtrans($1, ftpd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 ftpd_initrc_exec_t system_r;
	allow $2 system_r;

	miscfiles_manage_public_files($1)

	files_list_tmp($1)
	admin_pattern($1, { ftpd_tmp_t ftpdctl_tmp_t })

	files_list_etc($1)
	admin_pattern($1, { ftpd_etc_t ftpd_keytab_t })

	files_list_var($1)
	admin_pattern($1, ftpd_lock_t)

	files_list_pids($1)
	admin_pattern($1, ftpd_var_run_t)

	logging_list_logs($1)
	admin_pattern($1, xferlog_t)

	ftp_systemctl($1)
	admin_pattern($1, ftpd_unit_file_t)
	allow $1 ftpd_unit_file_t:service all_service_perms;

	ftp_run_ftpdctl($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ftp_admin'($*)) dnl
	')


## <summary>fwupd is a daemon to allow session software to update device firmware</summary>

########################################
## <summary>
##	Execute fwupd_exec_t in the fwupd domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`fwupd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_domtrans'($*)) dnl
	
	gen_require(`
		type fwupd_t, fwupd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, fwupd_exec_t, fwupd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute fwupd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_exec'($*)) dnl
	
	gen_require(`
		type fwupd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, fwupd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_exec'($*)) dnl
	')


########################################
## <summary>
##	Read fwupd process state files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_read_state'($*)) dnl
	
	gen_require(`
		type fwupd_t;
	')

	ps_process_pattern($1, fwupd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_read_state'($*)) dnl
	')


########################################
## <summary>
##	Search fwupd cache directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_search_cache',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_search_cache'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	allow $1 fwupd_cache_t:dir search_dir_perms;
	files_search_var($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_search_cache'($*)) dnl
	')


########################################
## <summary>
##	Read fwupd cache directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_list_cache_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_list_cache_dirs'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	files_search_var($1)
	list_dirs_pattern($1, fwupd_cache_t, fwupd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_list_cache_dirs'($*)) dnl
	')


########################################
## <summary>
##	Watch fwupd cache directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_watch_cache_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_watch_cache_dirs'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	files_search_var($1)
	watch_dirs_pattern($1, fwupd_cache_t, fwupd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_watch_cache_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to delete
##	fwupd cache.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_delete_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_delete_cache_files'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	allow $1 fwupd_cache_t:dir rmdir;
	delete_files_pattern($1, fwupd_cache_t, fwupd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_delete_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Read fwupd cache files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_read_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_read_cache_files'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	files_search_var($1)
	read_files_pattern($1, fwupd_cache_t, fwupd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_read_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	fwupd cache files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_manage_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_manage_cache_files'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	files_search_var($1)
	manage_files_pattern($1, fwupd_cache_t, fwupd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_manage_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Manage fwupd cache dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_manage_cache_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_manage_cache_dirs'($*)) dnl
	
	gen_require(`
		type fwupd_cache_t;
	')

	files_search_var($1)
	manage_dirs_pattern($1, fwupd_cache_t, fwupd_cache_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_manage_cache_dirs'($*)) dnl
	')



########################################
## <summary>
##	Search fwupd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_search_lib'($*)) dnl
	
	gen_require(`
		type fwupd_var_lib_t;
	')

	allow $1 fwupd_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read fwupd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_read_lib_files'($*)) dnl
	
	gen_require(`
		type fwupd_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, fwupd_var_lib_t, fwupd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage fwupd lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_manage_lib_files'($*)) dnl
	
	gen_require(`
		type fwupd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, fwupd_var_lib_t, fwupd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage fwupd lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type fwupd_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, fwupd_var_lib_t, fwupd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Execute fwupd server in the fwupd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`fwupd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_systemctl'($*)) dnl
	
	gen_require(`
		type fwupd_t;
		type fwupd_unit_file_t;
	')

	systemd_exec_systemctl($1)
        systemd_read_fifo_file_passwd_run($1)
	allow $1 fwupd_unit_file_t:file read_file_perms;
	allow $1 fwupd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, fwupd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_systemctl'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an fwupd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_admin'($*)) dnl
	
	gen_require(`
		type fwupd_t;
		type fwupd_cache_t;
		type fwupd_var_lib_t;
	type fwupd_unit_file_t;
	')

	allow $1 fwupd_t:process { signal_perms };
	ps_process_pattern($1, fwupd_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 fwupd_t:process ptrace;
    ')

	files_search_var($1)
	admin_pattern($1, fwupd_cache_t)

	files_search_var_lib($1)
	admin_pattern($1, fwupd_var_lib_t)

	fwupd_systemctl($1)
	admin_pattern($1, fwupd_unit_file_t)
	allow $1 fwupd_unit_file_t:service all_service_perms;
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_admin'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	fwupd over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`fwupd_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `fwupd_dbus_chat'($*)) dnl
	
	gen_require(`
		type fwupd_t;
		class dbus send_msg;
	')

	allow $1 fwupd_t:dbus send_msg;
	allow fwupd_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `fwupd_dbus_chat'($*)) dnl
	')

## <summary>Various games.</summary>

########################################
## <summary>
##	Role access for games.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role.
##	</summary>
## </param>
#
 	 	define(`games_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `games_role'($*)) dnl
	
	gen_require(`
		attribute_role games_roles;
		type games_t, games_exec_t, games_tmp_t;
		type games_tmpfs_t;
	')

	roleattribute $1 games_roles;

	domtrans_pattern($2, games_exec_t, games_t)

	allow $2 games_tmp_t:dir { manage_dir_perms relabel_dir_perms };
	allow $2 { games_tmp_t games_tmpfs_t }:file { manage_file_perms relabel_file_perms };
	allow $2 games_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
	allow $2 games_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };

	allow $2 games_t:process { ptrace signal_perms };
	ps_process_pattern($2, games_t)

	stream_connect_pattern($2, games_tmpfs_t, games_tmpfs_t, games_t)

	allow games_t $2:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `games_role'($*)) dnl
	')


########################################
## <summary>
##	Read and write games data files.
##	games data.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`games_rw_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `games_rw_data'($*)) dnl
	
	gen_require(`
		type games_data_t;
	')

	files_search_var_lib($1)
	rw_files_pattern($1, games_data_t, games_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `games_rw_data'($*)) dnl
	')


########################################
## <summary>
##	Manage games data files.
##	games data.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`games_manage_data_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `games_manage_data_files'($*)) dnl
	
	gen_require(`
		type games_data_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, games_data_t, games_data_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `games_manage_data_files'($*)) dnl
	')

## <summary>OpenH.323 Voice-Over-IP Gatekeeper.</summary>

########################################
## <summary>
##	All of the rules required to
##	administrate an gatekeeper environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`gatekeeper_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gatekeeper_admin'($*)) dnl
	
	gen_require(`
		type gatekeeper_t, gatekeeper_etc_t, gatekeeper_log_t;
		type gatekeeper_var_run_t, gatekeeper_tmp_t, gatekeeper_initrc_exec_t;
	')

	allow $1 gatekeeper_t:process { ptrace signal_perms };
	ps_process_pattern($1, gatekeeper_t)

	init_labeled_script_domtrans($1, gatekeeper_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 gatekeeper_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, gatekeeper_etc_t)

	logging_search_logs($1)
	admin_pattern($1, gatekeeper_log_t)

	files_search_tmp($1)
	admin_pattern($1, gatekeeper_tmp_t)

	files_search_var_lib($1)
	admin_pattern($1, gatekeeper_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gatekeeper_admin'($*)) dnl
	')

## <summary>GNUstep distributed object mapper.</summary>

########################################
## <summary>
##	Read gdomap configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gdomap_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gdomap_read_config'($*)) dnl
	
	gen_require(`
		type gdomap_conf_t;
	')

	files_search_etc($1)
	allow $1 gdomap_conf_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gdomap_read_config'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an gdomap environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`gdomap_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gdomap_admin'($*)) dnl
	
	gen_require(`
		type gdomap_t, gdomap_conf_t, gdomap_initrc_exec_t;
		type gdomap_var_run_t;
	')

	allow $1 gdomap_t:process { ptrace signal_perms };
	ps_process_pattern($1, gdomap_t)

	init_labeled_script_domtrans($1, gdomap_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 gdomap_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, gdomap_conf_t)

	files_search_pids($1)
	admin_pattern($1, gdomap_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gdomap_admin'($*)) dnl
	')


## <summary>Geoclue is a D-Bus service that provides location information</summary>

########################################
## <summary>
##	Execute geoclue in the geoclue domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`geoclue_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_domtrans'($*)) dnl
	
	gen_require(`
		type geoclue_t, geoclue_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, geoclue_exec_t, geoclue_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search geoclue lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`geoclue_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_search_lib'($*)) dnl
	
	gen_require(`
		type geoclue_var_lib_t;
	')

	allow $1 geoclue_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read geoclue lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`geoclue_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_read_lib_files'($*)) dnl
	
	gen_require(`
		type geoclue_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, geoclue_var_lib_t, geoclue_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage geoclue lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`geoclue_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_manage_lib_files'($*)) dnl
	
	gen_require(`
		type geoclue_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, geoclue_var_lib_t, geoclue_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage geoclue lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`geoclue_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type geoclue_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, geoclue_var_lib_t, geoclue_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##  Send and receive messages from
##  geoclue over dbus.
## </summary>
## <param name="domain">
##  <summary>
##      Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`geoclue_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_dbus_chat'($*)) dnl
	
        gen_require(`
                type geoclue_t;
                class dbus send_msg;
        ')

        allow $1 geoclue_t:dbus send_msg;
        allow geoclue_t $1:dbus send_msg;
	    ps_process_pattern(geoclue_t, $1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an geoclue environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`geoclue_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `geoclue_admin'($*)) dnl
	
	gen_require(`
		type geoclue_t;
		type geoclue_var_lib_t;
	')

	allow $1 geoclue_t:process { signal_perms };
	ps_process_pattern($1, geoclue_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 geoclue_t:process ptrace;
    ')

	files_search_var_lib($1)
	admin_pattern($1, geoclue_var_lib_t)

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `geoclue_admin'($*)) dnl
	')

## <summary>GIT revision control system.</summary>

########################################
## <summary>
##	Role access for Git session.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role.
##	</summary>
## </param>
#
 	 	define(`git_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `git_role'($*)) dnl
	
	gen_require(`
		attribute_role git_session_roles;
		type git_session_t, gitd_exec_t, git_user_content_t;
	')

	########################################
	#
	# Declarations
	#

	roleattribute $1 git_session_roles;

	########################################
	#
	# Policy
	#

	allow $2 git_user_content_t:dir { manage_dir_perms relabel_dir_perms };
	allow $2 git_user_content_t:file { exec_file_perms manage_file_perms relabel_file_perms };
	userdom_user_home_dir_filetrans($2, git_user_content_t, dir, "public_git")

	allow $2 git_session_t:process signal_perms;
	tunable_policy(`deny_ptrace',`',`
		allow $2 git_session_t:process ptrace;
	')
	ps_process_pattern($2, git_session_t)

	tunable_policy(`git_session_users',`
		domtrans_pattern($2, gitd_exec_t, git_session_t)
	',`
		can_exec($2, gitd_exec_t)
	')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `git_role'($*)) dnl
	')


########################################
## <summary>
##	Read generic system content files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`git_read_generic_sys_content_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `git_read_generic_sys_content_files'($*)) dnl
	
	gen_require(`
		type git_sys_content_t;
	')

	list_dirs_pattern($1, git_sys_content_t, git_sys_content_t)
	read_files_pattern($1, git_sys_content_t, git_sys_content_t)
	read_lnk_files_pattern($1, git_sys_content_t, git_sys_content_t)
	allow $1 git_sys_content_t:file map;

	files_search_var_lib($1)

	tunable_policy(`git_system_use_cifs',`
		fs_getattr_cifs($1)
		fs_list_cifs($1)
		fs_read_cifs_files($1)
	')

	tunable_policy(`git_system_use_nfs',`
		fs_getattr_nfs($1)
		fs_list_nfs($1)
		fs_read_nfs_files($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `git_read_generic_sys_content_files'($*)) dnl
	')


#######################################
## <summary>
##      Create Git user content with a
##      named file transition.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`git_filetrans_user_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `git_filetrans_user_content'($*)) dnl
	
		gen_require(`
			type git_user_content_t;
		')
		userdom_user_home_dir_filetrans($1, git_user_content_t, dir, "public_git")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `git_filetrans_user_content'($*)) dnl
	')

## <summary>Tools for managing and hosting git repositories.</summary>

#######################################
## <summary>
##	Execute a domain transition to run gitosis.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`gitosis_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gitosis_domtrans'($*)) dnl
	
	gen_require(`
		type gitosis_t, gitosis_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, gitosis_exec_t, gitosis_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gitosis_domtrans'($*)) dnl
	')


#######################################
## <summary>
##	Execute gitosis-serve in the
##	gitosis domain, and allow the
##	specified role the gitosis domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`gitosis_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gitosis_run'($*)) dnl
	
	gen_require(`
		attribute_role gitosis_roles;
	')

	gitosis_domtrans($1)
	roleattribute $2 gitosis_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gitosis_run'($*)) dnl
	')


#######################################
## <summary>
##	Read gitosis lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gitosis_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gitosis_read_lib_files'($*)) dnl
	
	gen_require(`
		type gitosis_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, gitosis_var_lib_t, gitosis_var_lib_t)
	read_lnk_files_pattern($1, gitosis_var_lib_t, gitosis_var_lib_t)
	list_dirs_pattern($1, gitosis_var_lib_t, gitosis_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gitosis_read_lib_files'($*)) dnl
	')


#######################################
## <summary>
##	Mmap gitosis lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gitosis_mmap_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gitosis_mmap_lib_files'($*)) dnl
	
	gen_require(`
		type gitosis_var_lib_t;
	')

	allow $1 gitosis_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gitosis_mmap_lib_files'($*)) dnl
	')


######################################
## <summary>
##	Create, read, write, and delete
##	gitosis lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gitosis_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gitosis_manage_lib_files'($*)) dnl
	
	gen_require(`
		type gitosis_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, gitosis_var_lib_t, gitosis_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gitosis_manage_lib_files'($*)) dnl
	')

## <summary>OpenStack image registry and delivery service.</summary>

#######################################
## <summary>
##  Creates types and rules for a basic
##  glance daemon domain.
## </summary>
## <param name="prefix">
##  <summary>
##  Prefix for the domain.
##  </summary>
## </param>
#
 	 	define(`glance_basic_types_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_basic_types_template'($*)) dnl
	
    gen_require(`
		attribute glance_domain;
    ')

	type $1_t, glance_domain;
	type $1_exec_t;

    type $1_unit_file_t;
    systemd_unit_file($1_unit_file_t)

	kernel_read_system_state($1_t)

	corenet_all_recvfrom_unlabeled($1_t)
	corenet_all_recvfrom_netlabel($1_t)

    logging_send_syslog_msg($1_t)

    auth_use_nsswitch($1_t)

 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_basic_types_template'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to
##	run glance registry.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`glance_domtrans_registry',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_domtrans_registry'($*)) dnl
	
	gen_require(`
		type glance_registry_t, glance_registry_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, glance_registry_exec_t, glance_registry_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_domtrans_registry'($*)) dnl
	')


########################################
## <summary>
##	Execute a domain transition to
##	run glance api.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`glance_domtrans_api',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_domtrans_api'($*)) dnl
	
	gen_require(`
		type glance_api_t, glance_api_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, glance_api_exec_t, glance_api_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_domtrans_api'($*)) dnl
	')


########################################
## <summary>
##	Read glance log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`glance_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_read_log'($*)) dnl
	
	gen_require(`
		type glance_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, glance_log_t, glance_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append glance log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_append_log'($*)) dnl
	
	gen_require(`
		type glance_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, glance_log_t, glance_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_append_log'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	glance log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_manage_log'($*)) dnl
	
	gen_require(`
		type glance_log_t;
	')

	logging_search_logs($1)
	manage_dirs_pattern($1, glance_log_t, glance_log_t)
	manage_files_pattern($1, glance_log_t, glance_log_t)
	manage_lnk_files_pattern($1, glance_log_t, glance_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Search glance lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_search_lib'($*)) dnl
	
	gen_require(`
		type glance_var_lib_t;
	')

	allow $1 glance_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read glance lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_read_lib_files'($*)) dnl
	
	gen_require(`
		type glance_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, glance_var_lib_t, glance_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	glance lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_manage_lib_files'($*)) dnl
	
	gen_require(`
		type glance_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, glance_var_lib_t, glance_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	glance lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type glance_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, glance_var_lib_t, glance_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read glance pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_read_pid_files'($*)) dnl
	
	gen_require(`
		type glance_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, glance_var_run_t, glance_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	glance pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glance_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_manage_pid_files'($*)) dnl
	
	gen_require(`
		type glance_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, glance_var_run_t, glance_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an glance environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`glance_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glance_admin'($*)) dnl
	
	gen_require(`
		type glance_registry_t, glance_api_t, glance_log_t;
		type glance_var_lib_t, glance_var_run_t;
		type glance_registry_initrc_exec_t, glance_api_initrc_exec_t;
	')

	allow $1 glance_registry_t:process signal_perms;
	ps_process_pattern($1, glance_registry_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 glance_registry_t:process ptrace;
		allow $1 glance_api_t:process ptrace;
	')

	init_labeled_script_domtrans($1, { glance_api_initrc_exec_t glance_registry_initrc_exec_t })
	domain_system_change_exemption($1)
	role_transition $2 { glance_api_initrc_exec_t glance_registry_initrc_exec_t } system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, glance_log_t)

	files_search_var_lib($1)
	admin_pattern($1, glance_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, glance_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glance_admin'($*)) dnl
	')


## <summary>policy for glusterd</summary>


########################################
## <summary>
##	Transition to glusterd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`glusterd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_domtrans'($*)) dnl
	
	gen_require(`
		type glusterd_t, glusterd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, glusterd_exec_t, glusterd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_domtrans'($*)) dnl
	')



########################################
## <summary>
##	Execute glusterd server in the glusterd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glusterd_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type glusterd_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, glusterd_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_initrc_domtrans'($*)) dnl
	')


#######################################
## <summary>
##  Connect to glusterd over a unix stream socket.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`glusterd_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_stream_connect'($*)) dnl
	
	gen_require(`
		type glusterd_t;
	')

	allow $1 glusterd_t:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Read glusterd's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`glusterd_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_read_log'($*)) dnl
	
	gen_require(`
		type glusterd_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, glusterd_log_t, glusterd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append to glusterd log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glusterd_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_append_log'($*)) dnl
	
	gen_require(`
		type glusterd_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, glusterd_log_t, glusterd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_append_log'($*)) dnl
	')


#######################################
## <summary>
##  Transition content labels to glusterd named content
## </summary>
## <param name="domain">
##  <summary>
##      Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`glusterd_filetrans_named_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_filetrans_named_pid'($*)) dnl
	
    gen_require(`
        type glusterd_var_run_t;
    ')
    files_pid_filetrans($1, glusterd_var_run_t , sock_file, "glusterd.socket")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_filetrans_named_pid'($*)) dnl
	')


########################################
## <summary>
##	Manage glusterd PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glusterd_manage_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_manage_pid'($*)) dnl
	
	gen_require(`
		type glusterd_var_run_t;
	')

	files_search_pids($1)
	manage_dirs_pattern($1, glusterd_var_run_t, glusterd_var_run_t)
	manage_files_pattern($1, glusterd_var_run_t, glusterd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_manage_pid'($*)) dnl
	')


########################################
## <summary>
##	Manage glusterd log files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`glusterd_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_manage_log'($*)) dnl
	
	gen_require(`
		type glusterd_log_t;
	')

	logging_search_logs($1)
	manage_dirs_pattern($1, glusterd_log_t, glusterd_log_t)
	manage_files_pattern($1, glusterd_log_t, glusterd_log_t)
	manage_lnk_files_pattern($1, glusterd_log_t, glusterd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_manage_log'($*)) dnl
	')


######################################
## <summary>
##  Allow the specified domain to execute gluster's lib files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gluster_execute_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gluster_execute_lib'($*)) dnl
	
    gen_require(`
        type glusterd_var_lib_t;
    ')

    files_list_var_lib($1)
    allow $1 glusterd_var_lib_t:dir search_dir_perms;
    can_exec($1, glusterd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gluster_execute_lib'($*)) dnl
	')


######################################
## <summary>
##  Read glusterd's config files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`glusterd_read_conf',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_read_conf'($*)) dnl
	
       gen_require(`
               type glusterd_conf_t;
       ')

    files_search_etc($1)
    read_files_pattern($1, glusterd_conf_t, glusterd_conf_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_read_conf'($*)) dnl
	')


######################################
## <summary>
##  Dontaudit Read  /var/lib/glusterd files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`glusterd_dontaudit_read_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_dontaudit_read_lib_dirs'($*)) dnl
	
       gen_require(`
               type glusterd_var_lib_t;
       ')

    dontaudit $1 glusterd_var_lib_t:dir list_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_dontaudit_read_lib_dirs'($*)) dnl
	')


######################################
## <summary>
##  Read and write /var/lib/glusterd files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`glusterd_rw_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_rw_lib'($*)) dnl
	
       gen_require(`
               type glusterd_var_lib_t;
       ')

    files_search_var_lib($1)
    rw_files_pattern($1, glusterd_var_lib_t, glusterd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_rw_lib'($*)) dnl
	')


######################################
## <summary>
## Read /var/lib/glusterd files.
## </summary>
## <param name="domain">
##     <summary>
##     Domain allowed access.
##     </summary>
## </param>
#
 	 	define(`glusterd_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_read_lib_files'($*)) dnl
	
       gen_require(`
               type glusterd_var_lib_t;
       ')

    files_search_var_lib($1)
	allow $1 glusterd_var_lib_t:dir search_dir_perms;
    read_files_pattern($1, glusterd_var_lib_t, glusterd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_read_lib_files'($*)) dnl
	')


######################################
## <summary>
## Read and write /var/lib/glusterd files.
## </summary>
## <param name="domain">
##     <summary>
##     Domain allowed access.
##     </summary>
## </param>
#
 	 	define(`glusterd_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_manage_lib_files'($*)) dnl
	
       gen_require(`
               type glusterd_var_lib_t;
       ')

    files_search_var_lib($1)
	allow $1 glusterd_var_lib_t:dir search_dir_perms;
    manage_files_pattern($1, glusterd_var_lib_t, glusterd_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_manage_lib_files'($*)) dnl
	')


######################################
## <summary>
##	All of the rules required to administrate
##	an glusterd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`glusterd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `glusterd_admin'($*)) dnl
	
	gen_require(`
		type glusterd_t;
		type glusterd_initrc_exec_t;
		type glusterd_log_t;
		type glusterd_tmp_t;
		type glusterd_conf_t; 
	')

	allow $1 glusterd_t:process { signal_perms };
	ps_process_pattern($1, glusterd_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 glusterd_t:process ptrace;
    ')

	glusterd_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 glusterd_initrc_exec_t system_r;
	allow $2 system_r;

	logging_search_logs($1)
	admin_pattern($1, glusterd_log_t)

	admin_pattern($1, glusterd_tmp_t)

	admin_pattern($1, glusterd_conf_t)


	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `glusterd_admin'($*)) dnl
	')

## <summary>Gnome clock handler for setting the time.</summary>

########################################
## <summary>
##	Execute a domain transition to run gnomeclock.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`gnomeclock_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnomeclock_domtrans'($*)) dnl
	
	gen_require(`
		type gnomeclock_t, gnomeclock_exec_t;
	')

	domtrans_pattern($1, gnomeclock_exec_t, gnomeclock_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnomeclock_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute gnomeclock in the gnomeclock domain, and
##	allow the specified role the gnomeclock domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`gnomeclock_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnomeclock_run'($*)) dnl
	
	gen_require(`
		type gnomeclock_t;
	')

	gnomeclock_domtrans($1)
	role $2 types gnomeclock_t;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnomeclock_run'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	gnomeclock over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnomeclock_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnomeclock_dbus_chat'($*)) dnl
	
	gen_require(`
		type gnomeclock_t;
		class dbus send_msg;
	')

	allow $1 gnomeclock_t:dbus send_msg;
	allow gnomeclock_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnomeclock_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	Do not audit send and receive messages from
##	gnomeclock over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnomeclock_dontaudit_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnomeclock_dontaudit_dbus_chat'($*)) dnl
	
	gen_require(`
		type gnomeclock_t;
		class dbus send_msg;
	')

	dontaudit $1 gnomeclock_t:dbus send_msg;
	dontaudit gnomeclock_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnomeclock_dontaudit_dbus_chat'($*)) dnl
	')

## <summary>GNU network object model environment (GNOME)</summary>

#######################################
## <summary>
##  Role access for gnome.  (Deprecated)
## </summary>
## <param name="role">
##  <summary>
##  Role allowed access.
##  </summary>
## </param>
## <param name="domain">
##  <summary>
##  User domain for the role.
##  </summary>
## </param>
#
 	 	define(`gnome_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_role'($*)) dnl
	
    refpolicywarn(`$0($*) has been deprecated')
    
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_role'($*)) dnl
	')


######################################
## <summary>
##      The role template for the gnome-keyring-daemon.
## </summary>
## <param name="user_prefix">
##      <summary>
##      The user prefix.
##      </summary>
## </param>
## <param name="user_role">
##      <summary>
##      The user role.
##      </summary>
## </param>
## <param name="user_domain">
##      <summary>
##      The user domain associated with the role.
##      </summary>
## </param>
#
 	 	define(`gnome_role_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_role_gkeyringd'($*)) dnl
	
    refpolicywarn(`$0($*) has been deprecated')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_role_gkeyringd'($*)) dnl
	')


######################################
## <summary>
##  The role template for gnome.
## </summary>
## <param name="role_prefix">
##  <summary>
##  The prefix of the user domain (e.g., user
##  is the prefix for user_t).
##  </summary>
## </param>
## <param name="user_role">
##  <summary>
##  The role associated with the user domain.
##  </summary>
## </param>
## <param name="user_domain">
##  <summary>
##  The type of the user domain.
##  </summary>
## </param>
#
 	 	define(`gnome_role_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_role_template'($*)) dnl
	
    gen_require(`
		attribute gnomedomain, gkeyringd_domain, gnome_home_type;
		attribute_role gconfd_roles;
		type gkeyringd_exec_t, gkeyringd_tmp_t;
		type gconfd_t, gconfd_exec_t, gconf_tmp_t;
		class dbus send_msg;
	')

	########################################
	#
	# Gconf declarations
	#

	roleattribute $2 gconfd_roles;

	########################################
	#
	# Gkeyringd declarations
	#

	type $1_gkeyringd_t, gnomedomain, gkeyringd_domain;
	userdom_user_application_domain($1_gkeyringd_t, gkeyringd_exec_t)
	domain_user_exemption_target($1_gkeyringd_t)

	role $2 types $1_gkeyringd_t;

	########################################
	#
	# Gconf policy
	#

	domtrans_pattern($3, gconfd_exec_t, gconfd_t)

	allow $3 gconfd_t:process { signal_perms };
	allow $3 gconfd_t:unix_stream_socket connectto;
	ps_process_pattern($3, gconfd_t)


	########################################
	#
	# Gkeyringd policy
	#

	allow $1_gkeyringd_t $3:unix_stream_socket { connectto create_stream_socket_perms };
	allow $1_gkeyringd_t self:process setsched;

	domtrans_pattern($3, gkeyringd_exec_t, $1_gkeyringd_t)

	allow $3 { gnome_home_type gkeyringd_tmp_t gconf_tmp_t }:dir { relabel_dir_perms manage_dir_perms };
	allow $3 { gnome_home_type gkeyringd_tmp_t gconf_tmp_t }:file { relabel_file_perms manage_file_perms };

	userdom_home_manager($1_gkeyringd_t)

	allow $3 gkeyringd_tmp_t:sock_file { relabel_sock_file_perms manage_sock_file_perms };

	ps_process_pattern($3, $1_gkeyringd_t)
	allow $3 $1_gkeyringd_t:process signal_perms;
	dontaudit $3 gkeyringd_exec_t:file entrypoint;

	allow $1_gkeyringd_t $3:process sigkill;
	allow $3 $1_gkeyringd_t:fd use;
	allow $3 $1_gkeyringd_t:fifo_file rw_fifo_file_perms;

    allow $3 $1_gkeyringd_t:dbus { acquire_svc };

	stream_connect_pattern($3, gkeyringd_tmp_t, gkeyringd_tmp_t, $1_gkeyringd_t)

	kernel_read_system_state($1_gkeyringd_t)

	corecmd_bin_domtrans($1_gkeyringd_t, $3)
	corecmd_shell_domtrans($1_gkeyringd_t, $3)

	gnome_stream_connect_gkeyringd($3)

	ps_process_pattern($1_gkeyringd_t, $3)

	auth_use_nsswitch($1_gkeyringd_t)

	logging_send_syslog_msg($1_gkeyringd_t)

    userdom_rw_user_tmp_sock_files($1_gkeyringd_t)

	allow $1_gkeyringd_t $3:dbus { acquire_svc send_msg };
	allow $3 $1_gkeyringd_t:dbus send_msg;

	optional_policy(`
        dbus_session_domain($1, gkeyringd_exec_t, $1_gkeyringd_t)
        dbus_stream_connect_system_dbusd($1_gkeyringd_t)
        dbus_send_system_bus($1_gkeyringd_t)
		gnome_manage_generic_home_dirs($1_gkeyringd_t)
		gnome_read_generic_data_home_files($1_gkeyringd_t)
		gnome_read_generic_data_home_dirs($1_gkeyringd_t)

		optional_policy(`
			telepathy_mission_control_read_state($1_gkeyringd_t)
            telepathy_gabble_stream_connect_to($1_gkeyringd_t,gkeyringd_tmp_t,gkeyringd_tmp_t)
		')

        optional_policy(`
            systemd_dbus_chat_logind($1_gkeyringd_t)
        ')
	')

    optional_policy(`
        ssh_agent_exec($1_gkeyringd_t)
    ')
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_role_template'($*)) dnl
	')


#######################################
## <summary>
##  Allow domain to run gkeyring in the $1_gkeyringd_t domain.
## </summary>
## <param name="user_prefix">
##      <summary>
##      The user prefix.
##      </summary>
## </param>
## <param name="user_role">
##      <summary>
##      The user role.
##      </summary>
## </param>
## <param name="user_domain">
##      <summary>
##	Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`gnome_run_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_run_gkeyringd'($*)) dnl
	
    gen_require(`
		type $1_gkeyringd_t;
		type gkeyringd_exec_t;
	')
	role $2 types $1_gkeyringd_t;
	domtrans_pattern($3, gkeyringd_exec_t, $1_gkeyringd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_run_gkeyringd'($*)) dnl
	')


########################################
## <summary>
##	gconf connection template.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_stream_connect_gconf',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_stream_connect_gconf'($*)) dnl
	
	gen_require(`
		type gconfd_t, gconf_tmp_t;
	')

	read_files_pattern($1, gconf_tmp_t, gconf_tmp_t)
	allow $1 gconfd_t:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_stream_connect_gconf'($*)) dnl
	')


########################################
## <summary>
##	Connect to gkeyringd with a unix stream socket. 
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_stream_connect_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_stream_connect_gkeyringd'($*)) dnl
	
	gen_require(`
			attribute gkeyringd_domain;
			type gkeyringd_tmp_t;
			type gconf_tmp_t;
			type cache_home_t;
	')

	allow $1 gconf_tmp_t:dir search_dir_perms;
	userdom_search_user_tmp_dirs($1)
	stream_connect_pattern($1, gkeyringd_tmp_t, gkeyringd_tmp_t, gkeyringd_domain)
	stream_connect_pattern($1, cache_home_t, cache_home_t, gkeyringd_domain)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_stream_connect_gkeyringd'($*)) dnl
	')


########################################
## <summary>
##	Run gconfd in gconfd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_domtrans_gconfd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_domtrans_gconfd'($*)) dnl
	
	gen_require(`
		type gconfd_t, gconfd_exec_t;
	')

	domtrans_pattern($1, gconfd_exec_t, gconfd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_domtrans_gconfd'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit read gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_read_config'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	dontaudit $1 gnome_home_type:dir list_dir_perms;
	dontaudit $1 gnome_home_type:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_read_config'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit search gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_search_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_search_config'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	dontaudit $1 gnome_home_type:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_search_config'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit write gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_append_config_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_append_config_files'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	dontaudit $1 gnome_home_type:file append;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_append_config_files'($*)) dnl
	')



########################################
## <summary>
##	Dontaudit write gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_write_config_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_write_config_files'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	dontaudit $1 gnome_home_type:file write;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_write_config_files'($*)) dnl
	')


########################################
## <summary>
##	manage gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_config'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	allow $1 gnome_home_type:dir manage_dir_perms;
	allow $1 gnome_home_type:file { manage_file_perms map };
	allow $1 gnome_home_type:lnk_file manage_lnk_file_perms;
	allow $1 gnome_home_type:sock_file manage_sock_file_perms;
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_config'($*)) dnl
	')


########################################
## <summary>
##	Send general signals to all gconf domains.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_signal_all',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_signal_all'($*)) dnl
	
	gen_require(`
		attribute gnomedomain;
	')

	allow $1 gnomedomain:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_signal_all'($*)) dnl
	')


########################################
## <summary>
##	Create objects in a Gnome cache home directory
##	with an automatic type transition to
##	a specified private type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="private_type">
##	<summary>
##	The type of the object to create.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	The class of the object to be created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`gnome_cache_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_cache_filetrans'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	filetrans_pattern($1, cache_home_t, $2, $3, $4)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_cache_filetrans'($*)) dnl
	')


########################################
## <summary>
##	Create objects in a Gnome cache home directory
##	with an automatic type transition to
##	a specified private type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="private_type">
##	<summary>
##	The type of the object to create.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	The class of the object to be created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`gnome_config_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_config_filetrans'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	filetrans_pattern($1, config_home_t, $2, $3, $4)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_config_filetrans'($*)) dnl
	')


########################################
## <summary>
##	Read generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	read_files_pattern($1, cache_home_t, cache_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Create generic cache home dir (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_create_generic_cache_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_create_generic_cache_dir'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	allow $1 cache_home_t:dir create_dir_perms;
	userdom_user_home_dir_filetrans($1, cache_home_t, dir, ".cache")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_create_generic_cache_dir'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of cache home dir (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_setattr_cache_home_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_setattr_cache_home_dir'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	setattr_dirs_pattern($1, cache_home_t, cache_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_setattr_cache_home_dir'($*)) dnl
	')


########################################
## <summary>
##	Manage cache home dir (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_cache_home_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_cache_home_dir'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	manage_dirs_pattern($1, cache_home_t, cache_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_cache_home_dir'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit Manage cache home dir (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_manage_cache_home_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_manage_cache_home_dir'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	dontaudit $1 cache_home_t:dir manage_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_manage_cache_home_dir'($*)) dnl
	')


########################################
## <summary>
##	append to generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_append_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_append_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	append_files_pattern($1, cache_home_t, cache_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_append_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	write to generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_write_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_write_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	write_files_pattern($1, cache_home_t, cache_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_write_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	write to generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	manage_files_pattern($1, cache_home_t, cache_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Map generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_map_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_map_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	allow $1 cache_home_t:file mmap_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_map_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Delete to generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_delete_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_delete_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	files_search_tmp($1)
	allow $1 cache_home_t:file unlink;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_delete_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	Manage a sock_file in the generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_generic_cache_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_generic_cache_sockets'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	userdom_search_user_home_dirs($1)
	manage_sock_files_pattern($1, cache_home_t, cache_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_generic_cache_sockets'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit read/write to generic cache home files (.cache)
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_rw_generic_cache_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_rw_generic_cache_files'($*)) dnl
	
	gen_require(`
		type cache_home_t;
	')

	dontaudit $1 cache_home_t:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_rw_generic_cache_files'($*)) dnl
	')


########################################
## <summary>
##	read gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_config'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	list_dirs_pattern($1, gnome_home_type, gnome_home_type)
	read_files_pattern($1, gnome_home_type, gnome_home_type)
	read_lnk_files_pattern($1, gnome_home_type, gnome_home_type)
	gnome_read_usr_config($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_config'($*)) dnl
	')


########################################
## <summary>
##	Create objects in a Gnome gconf home directory
##	with an automatic type transition to
##	a specified private type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="private_type">
##	<summary>
##	The type of the object to create.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	The class of the object to be created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`gnome_data_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_data_filetrans'($*)) dnl
	
	gen_require(`
		type data_home_t;
	')

	filetrans_pattern($1, data_home_t, $2, $3, $4)
	gnome_search_gconf($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_data_filetrans'($*)) dnl
	')


#######################################
## <summary>
##	Read generic data home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_generic_data_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_generic_data_home_files'($*)) dnl
	
	gen_require(`
		type data_home_t, gconf_home_t;
	')

	read_files_pattern($1, { gconf_home_t data_home_t }, data_home_t)
	read_lnk_files_pattern($1, { gconf_home_t data_home_t }, data_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_generic_data_home_files'($*)) dnl
	')


########################################
## <summary>
##	Read generic data home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_map_generic_data_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_map_generic_data_home_files'($*)) dnl
	
	gen_require(`
		type data_home_t, gconf_home_t;
	')

allow $1 data_home_t:file map;
allow $1 gconf_home_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_map_generic_data_home_files'($*)) dnl
	')


######################################
## <summary>
##  Read generic data home dirs.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_read_generic_data_home_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_generic_data_home_dirs'($*)) dnl
	
    gen_require(`
        type data_home_t, gconf_home_t;
    ')

    list_dirs_pattern($1, { gconf_home_t data_home_t }, data_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_generic_data_home_dirs'($*)) dnl
	')


######################################
## <summary>
##	Watch generic data home dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_watch_generic_data_home_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_watch_generic_data_home_dirs'($*)) dnl
	
    gen_require(`
        type data_home_t;
    ')

    watch_dirs_pattern($1, data_home_t, data_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_watch_generic_data_home_dirs'($*)) dnl
	')


#######################################
## <summary>
##	Manage gconf data home files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_data',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_data'($*)) dnl
	
	gen_require(`
		type data_home_t;
		type gconf_home_t;
	')

	allow $1 gconf_home_t:dir search_dir_perms;
	manage_dirs_pattern($1, data_home_t, data_home_t)
	manage_files_pattern($1, data_home_t, data_home_t)
	manage_lnk_files_pattern($1, data_home_t, data_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_data'($*)) dnl
	')


########################################
## <summary>
##	Read icc data home content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_home_icc_data_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_home_icc_data_content'($*)) dnl
	
	gen_require(`
		type icc_data_home_t, gconf_home_t, data_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 { gconf_home_t data_home_t }:dir search_dir_perms;
	allow $1 icc_data_home_t:file map;
	list_dirs_pattern($1, icc_data_home_t, icc_data_home_t)
	read_files_pattern($1, icc_data_home_t, icc_data_home_t)
	read_lnk_files_pattern($1, icc_data_home_t, icc_data_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_home_icc_data_content'($*)) dnl
	')


########################################
## <summary>
##	Read inherited icc data home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_inherited_home_icc_data_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_inherited_home_icc_data_files'($*)) dnl
	
	gen_require(`
		type icc_data_home_t;
	')

	allow $1 icc_data_home_t:file read_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_inherited_home_icc_data_files'($*)) dnl
	')


########################################
## <summary>
##	Create gconf_home_t objects in the /root directory
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	The class of the object to be created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`gnome_admin_home_gconf_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_admin_home_gconf_filetrans'($*)) dnl
	
	gen_require(`
		type gconf_home_t;
	')

	userdom_admin_home_dir_filetrans($1, gconf_home_t, $2, $3)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_admin_home_gconf_filetrans'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read
##	inherited gconf config files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_read_inherited_gconf_config_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_read_inherited_gconf_config_files'($*)) dnl
	
	gen_require(`
		type gconf_etc_t;
	')

	dontaudit $1 gconf_etc_t:file read_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_read_inherited_gconf_config_files'($*)) dnl
	')


########################################
## <summary>
##	read gconf config files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_gconf_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_gconf_config'($*)) dnl
	
	gen_require(`
		type gconf_etc_t;
	')

	allow $1 gconf_etc_t:dir list_dir_perms;
	read_files_pattern($1, gconf_etc_t, gconf_etc_t)
	files_search_etc($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_gconf_config'($*)) dnl
	')


#######################################
## <summary>
##      Manage gconf config files
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`gnome_manage_gconf_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_gconf_config'($*)) dnl
	
        gen_require(`
                type gconf_etc_t;
        ')

        allow $1 gconf_etc_t:dir list_dir_perms;
        manage_files_pattern($1, gconf_etc_t, gconf_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_gconf_config'($*)) dnl
	')


########################################
## <summary>
##	Execute gconf programs in 
##	in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_exec_gconf',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_exec_gconf'($*)) dnl
	
	gen_require(`
		type gconfd_exec_t;
	')

	can_exec($1, gconfd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_exec_gconf'($*)) dnl
	')


########################################
## <summary>
##	Execute gnome keyringd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_exec_keyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_exec_keyringd'($*)) dnl
	
	gen_require(`
		type gkeyringd_exec_t;
	')

	can_exec($1, gkeyringd_exec_t)
	corecmd_search_bin($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_exec_keyringd'($*)) dnl
	')


########################################
## <summary>
##	Search gconf home data dirs
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_search_gconf_data_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_search_gconf_data_dir'($*)) dnl
	
	gen_require(`
		type gconf_home_t;
		type data_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 gconf_home_t:dir list_dir_perms;
	allow $1 data_home_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_search_gconf_data_dir'($*)) dnl
	')


########################################
## <summary>
##	Read gconf home files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_gconf_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_gconf_home_files'($*)) dnl
	
	gen_require(`
		type gconf_home_t;
		type data_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 gconf_home_t:dir list_dir_perms;
	allow $1 data_home_t:dir list_dir_perms;
	read_files_pattern($1, gconf_home_t, gconf_home_t)
	read_files_pattern($1, data_home_t, data_home_t)
	read_lnk_files_pattern($1, gconf_home_t, gconf_home_t)
	read_lnk_files_pattern($1, data_home_t, data_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_gconf_home_files'($*)) dnl
	')


########################################
## <summary>
##	Search gkeyringd temporary directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_search_gkeyringd_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_search_gkeyringd_tmp_dirs'($*)) dnl
	
	gen_require(`
		type gkeyringd_tmp_t;
	')

	files_search_tmp($1)
	allow $1 gkeyringd_tmp_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_search_gkeyringd_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##	List gkeyringd temporary directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_list_gkeyringd_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_list_gkeyringd_tmp_dirs'($*)) dnl
	
	gen_require(`
		type gkeyringd_tmp_t;
	')

	files_search_tmp($1)
	allow $1 gkeyringd_tmp_t:dir list_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_list_gkeyringd_tmp_dirs'($*)) dnl
	')


#######################################
## <summary>
##  Delete gkeyringd temporary
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_delete_gkeyringd_tmp_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_delete_gkeyringd_tmp_content'($*)) dnl
	
    gen_require(`
        type gkeyringd_tmp_t;
    ')

    files_search_tmp($1)
    delete_dirs_pattern($1, gkeyringd_tmp_t, gkeyringd_tmp_t)
    delete_files_pattern($1, gkeyringd_tmp_t, gkeyringd_tmp_t)
    delete_sock_files_pattern($1, gkeyringd_tmp_t, gkeyringd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_delete_gkeyringd_tmp_content'($*)) dnl
	')


#######################################
## <summary>
##  Manage gkeyringd temporary directories.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_manage_gkeyringd_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_gkeyringd_tmp_dirs'($*)) dnl
	
    gen_require(`
        type gkeyringd_tmp_t;
    ')

    files_search_tmp($1)
    manage_dirs_pattern($1, gkeyringd_tmp_t, gkeyringd_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_gkeyringd_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##	search gconf homedir (.local)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_search_gconf',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_search_gconf'($*)) dnl
	
	gen_require(`
		type gconf_home_t;
	')

	allow $1 gconf_home_t:dir search_dir_perms;
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_search_gconf'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of Gnome config dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_setattr_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_setattr_config_dirs'($*)) dnl
	
	gen_require(`
		type gnome_home_t;
	')

	setattr_dirs_pattern($1, gnome_home_t, gnome_home_t)
	files_search_home($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_setattr_config_dirs'($*)) dnl
	')


########################################
## <summary>
##	Manage generic gnome home files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_generic_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_generic_home_files'($*)) dnl
	
	gen_require(`
		type gnome_home_t;
	')

	userdom_search_user_home_dirs($1)
	manage_files_pattern($1, gnome_home_t, gnome_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_generic_home_files'($*)) dnl
	')


########################################
## <summary>
##	Manage generic gnome home directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_generic_home_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_generic_home_dirs'($*)) dnl
	
	gen_require(`
		type gnome_home_t;
	')

	userdom_search_user_home_dirs($1)
	allow $1 gnome_home_t:dir manage_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_generic_home_dirs'($*)) dnl
	')


########################################
## <summary>
##	Append gconf home files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_append_gconf_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_append_gconf_home_files'($*)) dnl
	
	gen_require(`
		type gconf_home_t;
	')

	append_files_pattern($1, gconf_home_t, gconf_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_append_gconf_home_files'($*)) dnl
	')


########################################
## <summary>
##	manage gconf home files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_gconf_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_gconf_home_files'($*)) dnl
	
	gen_require(`
		type gconf_home_t;
	')

	allow $1 gconf_home_t:dir list_dir_perms;
	manage_files_pattern($1, gconf_home_t, gconf_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_gconf_home_files'($*)) dnl
	')


########################################
## <summary>
##	Connect to gnome over a unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="user_domain">
##	<summary>
##	The type of the user domain.
##	</summary>
## </param>
#
 	 	define(`gnome_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_stream_connect'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	# Connect to pulseaudit server
	stream_connect_pattern($1, gnome_home_type, gnome_home_type, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	list gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_list_home_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_list_home_config'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	allow $1 config_home_t:dir list_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_list_home_config'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_setattr_home_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_setattr_home_config'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	setattr_dirs_pattern($1, config_home_t, config_home_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_setattr_home_config'($*)) dnl
	')


########################################
## <summary>
##	read gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_home_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_home_config'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	list_dirs_pattern($1, config_home_t, config_home_t)
	read_files_pattern($1, config_home_t, config_home_t)
	read_lnk_files_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_home_config'($*)) dnl
	')


#######################################
## <summary>
##  append gnome homedir content (.config)
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_append_home_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_append_home_config'($*)) dnl
	
    gen_require(`
        type config_home_t;
    ')

    append_files_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_append_home_config'($*)) dnl
	')


#######################################
## <summary>
##  delete gnome homedir content (.config)
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_delete_home_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_delete_home_config'($*)) dnl
	
    gen_require(`
        type config_home_t;
    ')

    delete_files_pattern($1, config_home_t, config_home_t)
    delete_lnk_files_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_delete_home_config'($*)) dnl
	')


########################################
## <summary>
##	map gnome homedir file
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_map_home_config_file',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_map_home_config_file'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	allow $1 config_home_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_map_home_config_file'($*)) dnl
	')


########################################
## <summary>
##	Create gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_create_home_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_create_home_config_dirs'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	allow $1 config_home_t:dir create_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_create_home_config_dirs'($*)) dnl
	')


#######################################
## <summary>
##  setattr gnome homedir content (.config)
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_setattr_home_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_setattr_home_config_dirs'($*)) dnl
	
    gen_require(`
        type config_home_t;
    ')

    setattr_dirs_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_setattr_home_config_dirs'($*)) dnl
	')


########################################
## <summary>
##	manage gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_home_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_home_config'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	manage_files_pattern($1, config_home_t, config_home_t)
	manage_lnk_files_pattern($1, config_home_t, config_home_t)
	allow $1 config_home_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_home_config'($*)) dnl
	')


#######################################
## <summary>
##  delete gnome homedir content (.config)
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_delete_home_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_delete_home_config_dirs'($*)) dnl
	
    gen_require(`
        type config_home_t;
    ')

    delete_dirs_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_delete_home_config_dirs'($*)) dnl
	')


########################################
## <summary>
##	manage gnome homedir content (.config)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_home_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_home_config_dirs'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	manage_dirs_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_home_config_dirs'($*)) dnl
	')


########################################
## <summary>
##	Watch gnome homedir content directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_watch_home_config_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_watch_home_config_dirs'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	watch_dirs_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_watch_home_config_dirs'($*)) dnl
	')


########################################
## <summary>
##	Watch gnome homedir content files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_watch_home_config_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_watch_home_config_files'($*)) dnl
	
	gen_require(`
		type config_home_t;
	')

	watch_files_pattern($1, config_home_t, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_watch_home_config_files'($*)) dnl
	')


########################################
## <summary>
##	manage gstreamer home content files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_manage_gstreamer_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_gstreamer_home_files'($*)) dnl
	
	gen_require(`
		type gstreamer_home_t;
	')

	manage_dirs_pattern($1, gstreamer_home_t, gstreamer_home_t)
	manage_files_pattern($1, gstreamer_home_t, gstreamer_home_t)
	gnome_filetrans_gstreamer_home_content($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_gstreamer_home_files'($*)) dnl
	')


######################################
## <summary>
##      Allow to execute gstreamer home content files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`gnome_exec_gstreamer_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_exec_gstreamer_home_files'($*)) dnl
	
        gen_require(`
                type gstreamer_home_t;
        ')

        can_exec($1, gstreamer_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_exec_gstreamer_home_files'($*)) dnl
	')


######################################
## <summary>
##      Allow to execute config home content files.
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`gnome_exec_config_home_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_exec_config_home_files'($*)) dnl
	
        gen_require(`
                type config_home_t;
        ')

        can_exec($1, config_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_exec_config_home_files'($*)) dnl
	')


#######################################
## <summary>
##  file name transition gstreamer home content files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_filetrans_gstreamer_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_gstreamer_home_content'($*)) dnl
	
    gen_require(`
        type gstreamer_home_t;
    ')

    userdom_user_home_dir_filetrans($1, gstreamer_home_t, file, ".grl-bookmarks")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, file, ".grl-metadata-store")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, file, ".grl-podcasts")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-0.12")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-0.10")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-1.0")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-1.2")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-10")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-12")
    userdom_user_home_dir_filetrans($1, gstreamer_home_t, dir, ".orc")
    userdom_user_tmp_filetrans($1, gstreamer_home_t, dir, ".orc")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "gstreamer-0.12")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "GLCache")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "gstreamer-0.10")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "gstreamer-1.0")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "gstreamer-1.2")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "gstreamer-10")
    gnome_cache_filetrans($1, gstreamer_home_t, dir, "gstreamer-12")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_gstreamer_home_content'($*)) dnl
	')



#######################################
## <summary>
##  file name transition gstreamer admin home content files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_filetrans_gstreamer_admin_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_gstreamer_admin_home_content'($*)) dnl
	
    gen_require(`
        type gstreamer_home_t;
    ')

    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, file, ".grl-bookmarks")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, file, ".grl-metadata-store")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, file, ".grl-podcasts")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-0.12")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-0.10")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-1.0")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-1.2")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-10")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".gstreamer-12")
    userdom_admin_home_dir_filetrans($1, gstreamer_home_t, dir, ".orc")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_gstreamer_admin_home_content'($*)) dnl
	')


#######################################
## <summary>
##  manage gstreamer home content files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_manage_gstreamer_home_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_gstreamer_home_dirs'($*)) dnl
	
    gen_require(`
        type gstreamer_home_t;
    ')

    manage_dirs_pattern($1, gstreamer_home_t, gstreamer_home_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_gstreamer_home_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read/Write all inherited gnome home config 
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_rw_inherited_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_rw_inherited_config'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	allow $1 gnome_home_type:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_rw_inherited_config'($*)) dnl
	')


########################################
## <summary>
##	Dontaudit Read/Write all inherited gnome home config 
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gnome_dontaudit_rw_inherited_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dontaudit_rw_inherited_config'($*)) dnl
	
	gen_require(`
		attribute gnome_home_type;
	')

	dontaudit $1 gnome_home_type:file rw_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dontaudit_rw_inherited_config'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	gconf system service over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_dbus_chat_gconfdefault',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dbus_chat_gconfdefault'($*)) dnl
	
	gen_require(`
		type gconfdefaultsm_t;
		class dbus send_msg;
	')

	allow $1 gconfdefaultsm_t:dbus send_msg;
	allow gconfdefaultsm_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dbus_chat_gconfdefault'($*)) dnl
	')


########################################
## <summary>
##	Send and receive messages from
##	gkeyringd over dbus.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_dbus_chat_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_dbus_chat_gkeyringd'($*)) dnl
	
	gen_require(`
		attribute gkeyringd_domain;
		class dbus send_msg;
	')

	allow $1 gkeyringd_domain:dbus send_msg;
	allow gkeyringd_domain $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_dbus_chat_gkeyringd'($*)) dnl
	')


########################################
## <summary>
##	Send signull signal to gkeyringd processes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_signull_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_signull_gkeyringd'($*)) dnl
	
	gen_require(`
		attribute gkeyringd_domain;
	')

	allow $1 gkeyringd_domain:process signull;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_signull_gkeyringd'($*)) dnl
	')


########################################
## <summary>
##	Allow the domain to read gkeyringd state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_read_gkeyringd_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_gkeyringd_state'($*)) dnl
	
	gen_require(`
		attribute gkeyringd_domain;
	')

	ps_process_pattern($1, gkeyringd_domain)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_gkeyringd_state'($*)) dnl
	')


########################################
## <summary>
##	Create directories in user home directories
##	with the gnome home file type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_home_dir_filetrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_home_dir_filetrans'($*)) dnl
	
	gen_require(`
		type gnome_home_t;
	')

	userdom_user_home_dir_filetrans($1, gnome_home_t, dir)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_home_dir_filetrans'($*)) dnl
	')


########################################
## <summary>
##	Check whether sendmail executable
##	files are executable.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_access_check_usr_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_access_check_usr_config'($*)) dnl
	
	gen_require(`
		type config_usr_t;
	')

	allow $1 config_usr_t:dir_file_class_set audit_access;;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_access_check_usr_config'($*)) dnl
	')


######################################
## <summary>
##      Allow read kde config content
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`gnome_read_usr_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_read_usr_config'($*)) dnl
	
        gen_require(`
                type config_usr_t;
        ')

        files_search_usr($1)
		list_dirs_pattern($1, config_usr_t, config_usr_t)
		read_files_pattern($1, config_usr_t, config_usr_t)
		read_lnk_files_pattern($1, config_usr_t, config_usr_t)	

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_read_usr_config'($*)) dnl
	')


#######################################
## <summary>
##      Allow manage kde config content
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#
 	 	define(`gnome_manage_usr_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_manage_usr_config'($*)) dnl
	
        gen_require(`
                type config_usr_t;
        ')

        files_search_usr($1)
		manage_dirs_pattern($1, config_usr_t, config_usr_t)
		manage_files_pattern($1, config_usr_t, config_usr_t)
		manage_lnk_files_pattern($1, config_usr_t, config_usr_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_manage_usr_config'($*)) dnl
	')


########################################
## <summary>
##	Execute gnome-keyring in the user gkeyring domain
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access
##	</summary>
## </param>
#
 	 	define(`gnome_transition_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_transition_gkeyringd'($*)) dnl
	
	gen_require(`
		attribute gkeyringd_domain;
	')

	allow $1 gkeyringd_domain:process transition;
	dontaudit $1 gkeyringd_domain:process { noatsecure siginh rlimitinh };
	allow gkeyringd_domain $1:process { sigchld signull };
	allow gkeyringd_domain $1:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_transition_gkeyringd'($*)) dnl
	')


########################################
## <summary>
##	Create gnome content in the user home directory
##	with an correct label.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_filetrans_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_home_content'($*)) dnl
	

gen_require(`
	type config_home_t;
	type cache_home_t;
	type dbus_home_t;
	type gconf_home_t;
	type gnome_home_t;
	type data_home_t, icc_data_home_t;
	type gkeyringd_gnome_home_t;
')

	userdom_user_home_dir_filetrans($1, config_home_t, dir, ".config")
	userdom_user_home_dir_filetrans($1, config_home_t, file, ".Xdefaults")
	userdom_user_home_dir_filetrans($1, config_home_t, dir, ".xine")
	userdom_user_home_dir_filetrans($1, cache_home_t, dir, ".cache")
	userdom_user_home_dir_filetrans($1, dbus_home_t, dir, ".dbus")
	userdom_user_home_dir_filetrans($1, cache_home_t, dir, ".nv")
	userdom_user_home_dir_filetrans($1, config_home_t, dir, ".kde")
	userdom_user_home_dir_filetrans($1, gconf_home_t, dir, ".gconf")
	userdom_user_home_dir_filetrans($1, gconf_home_t, dir, ".gconfd")
	userdom_user_home_dir_filetrans($1, gconf_home_t, dir, ".local")
	userdom_user_home_dir_filetrans($1, gnome_home_t, dir, ".gnome2")

	# ~/.color/icc: legacy
	userdom_user_home_content_filetrans($1, icc_data_home_t, dir, "icc")
	filetrans_pattern($1, gnome_home_t, gkeyringd_gnome_home_t, dir, "keyrings")
	filetrans_pattern($1, data_home_t,  gkeyringd_gnome_home_t, dir, "keyrings")
	filetrans_pattern($1, gconf_home_t, data_home_t, dir, "share")
	filetrans_pattern($1, data_home_t, icc_data_home_t, dir, "icc")
	userdom_user_tmp_filetrans($1, config_home_t, dir, "dconf")
	gnome_cache_filetrans($1, config_home_t, dir, "dconf")
	gnome_filetrans_gstreamer_home_content($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_home_content'($*)) dnl
	')


########################################
## <summary>
##	Create gnome dconf dir in the user home directory
##	with an correct label.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_filetrans_config_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_config_home_content'($*)) dnl
	
    gen_require(`
        type config_home_t;
    ')

    gnome_cache_filetrans($1, config_home_t, dir, "dconf")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_config_home_content'($*)) dnl
	')


######################################
## <summary>
##  File name transition for generic home content files.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_filetrans_cert_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_cert_home_content'($*)) dnl
	
    gen_require(`
            type home_cert_t;
    ')

    gnome_data_filetrans($1, home_cert_t, dir, "certificates")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_cert_home_content'($*)) dnl
	')


######################################
## <summary>
##	Create fontconfig directories in the .config and .cache subdirectories
##	of the user home directory with correct label.
## </summary>
## <param name="domain">
##  <summary>
##	Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gnome_filetrans_fontconfig_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_fontconfig_home_content'($*)) dnl
	
    gen_require(`
            type user_fonts_config_t, user_fonts_cache_t;
    ')

    gnome_config_filetrans($1, user_fonts_config_t, dir, "fontconfig")
    gnome_cache_filetrans($1, user_fonts_cache_t, dir, "fontconfig")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_fontconfig_home_content'($*)) dnl
	')


########################################
## <summary>
##	Create gnome directory in the /root directory
##	with an correct label.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_filetrans_admin_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_filetrans_admin_home_content'($*)) dnl
	

gen_require(`
	type config_home_t;
	type cache_home_t;
	type dbus_home_t;
	type gstreamer_home_t;
	type gconf_home_t;
	type gnome_home_t;
	type icc_data_home_t;
')

	userdom_admin_home_dir_filetrans($1, config_home_t, dir, ".config")
	userdom_admin_home_dir_filetrans($1, config_home_t, file, ".Xdefaults")
	userdom_admin_home_dir_filetrans($1, config_home_t, dir, ".xine")
	userdom_admin_home_dir_filetrans($1, cache_home_t, dir, ".cache")
	userdom_admin_home_dir_filetrans($1, dbus_home_t, dir, ".dbus")
	userdom_admin_home_dir_filetrans($1, config_home_t, dir, ".kde")
	userdom_admin_home_dir_filetrans($1, gconf_home_t, dir, ".gconf")
	userdom_admin_home_dir_filetrans($1, gconf_home_t, dir, ".gconfd")
	userdom_admin_home_dir_filetrans($1, gconf_home_t, dir, ".local")
	userdom_admin_home_dir_filetrans($1, gnome_home_t, dir, ".gnome2")
	gnome_filetrans_gstreamer_admin_home_content($1)
	# /root/.color/icc: legacy
	userdom_admin_home_dir_filetrans($1, icc_data_home_t, dir, "icc")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_filetrans_admin_home_content'($*)) dnl
	')


#####################################
## <summary>
##  Execute gnome-keyring executable
##  in the specified domain.
## </summary>
## <desc>
##  <p>
##  Execute a gnome-keyring executable
##  in the specified domain.  This allows
##  the specified domain to execute any file
##  on these filesystems in the specified
##  domain. 
##  </p>
##  <p>
##  No interprocess communication (signals, pipes,
##  etc.) is provided by this interface since
##  the domains are not owned by this module.
##  </p>
##  <p>
##  This interface was added to handle
##  the ssh-agent policy.
##  </p>
## </desc>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
## <param name="target_domain">
##  <summary>
##  The type of the new process.
##  </summary>
## </param>
#
 	 	define(`gnome_command_domtrans_gkeyringd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_command_domtrans_gkeyringd'($*)) dnl
	
    gen_require(`
        type gkeyringd_exec_t;
    ')

    allow $2 gkeyringd_exec_t:file entrypoint;
    domain_transition_pattern($1, gkeyringd_exec_t, $2)
    type_transition $1 gkeyringd_exec_t:process $2;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_command_domtrans_gkeyringd'($*)) dnl
	')


########################################
## <summary>
##	Execute gnome-atspi services in the caller domain
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`gnome_exec_atspi',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_exec_atspi'($*)) dnl
	
	gen_require(`
		type gnome_atspi_exec_t;
	')

	can_exec($1, gnome_atspi_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_exec_atspi'($*)) dnl
	')


########################################
## <summary>
##	Execute gnome-atspi services in the gnome-atspi domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`gnome_atspi_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_atspi_domtrans'($*)) dnl
	
	gen_require(`
		type gnome_atspi_t, gnome_atspi_exec_t;
	')

	domtrans_pattern($1, gnome_atspi_exec_t, gnome_atspi_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_atspi_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute gnome-initial-setup programs in its domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_domtrans'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_t, gnome_initial_setup_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, gnome_initial_setup_exec_t, gnome_initial_setup_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Allow gnome-initial-setup noatsecure
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_noatsecure',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_noatsecure'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_t;
	')

	allow $1 gnome_initial_setup_t:process noatsecure;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_noatsecure'($*)) dnl
	')


########################################
## <summary>
##	Allow create gnome-initial-setup variable state directories
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_create_var_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_create_var_lib_dirs'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_lib_t;
	')

	create_dirs_pattern($1, gnome_initial_setup_var_lib_t, gnome_initial_setup_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_create_var_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow watch gnome-initial-setup variable state directories
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_watch_var_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_watch_var_lib_dirs'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_lib_t;
	')

	watch_dirs_pattern($1, gnome_initial_setup_var_lib_t, gnome_initial_setup_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_watch_var_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Allow read gnome-initial-setup variable state files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_read_var_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_read_var_lib_files'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_lib_t;
	')

	read_files_pattern($1, gnome_initial_setup_var_lib_t, gnome_initial_setup_var_lib_t)
	allow $1 gnome_initial_setup_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_read_var_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Allow manage gnome-initial-setup variable state files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_manage_var_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_manage_var_lib_files'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_lib_t;
	')

	manage_files_pattern($1, gnome_initial_setup_var_lib_t, gnome_initial_setup_var_lib_t)
	allow $1 gnome_initial_setup_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_manage_var_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Allow manage gnome-initial-setup variable state socket files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_manage_var_lib_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_manage_var_lib_sock_files'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_lib_t;
	')

	manage_sock_files_pattern($1, gnome_initial_setup_var_lib_t, gnome_initial_setup_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_manage_var_lib_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Allow read gnome-initial-setup runtime files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_read_var_run_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_read_var_run_files'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_run_t;
	')

	read_files_pattern($1, gnome_initial_setup_var_run_t, gnome_initial_setup_var_run_t)
	allow $1 gnome_initial_setup_var_run_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_read_var_run_files'($*)) dnl
	')


########################################
## <summary>
##	Allow manage gnome-initial-setup all runtime files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_manage_var_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_manage_var_run'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_run_t;
	')

	manage_dirs_pattern($1, gnome_initial_setup_var_run_t, gnome_initial_setup_var_run_t)
	manage_files_pattern($1, gnome_initial_setup_var_run_t, gnome_initial_setup_var_run_t)
	manage_sock_files_pattern($1, gnome_initial_setup_var_run_t, gnome_initial_setup_var_run_t)
	allow $1 gnome_initial_setup_var_run_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_manage_var_run'($*)) dnl
	')


########################################
## <summary>
##	Read the process state of gnome-initial-setup
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_read_state'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_t;
	')

	ps_process_pattern($1, gnome_initial_setup_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_read_state'($*)) dnl
	')


########################################
## <summary>
##	Write/append gnome-initial-setup fifo files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_write_fifo_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_write_fifo_files'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_t;
	')

	
	allow $1 gnome_initial_setup_t:fifo_file write_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_write_fifo_files'($*)) dnl
	')


########################################
## <summary>
##	Read gnome-initial-setup tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_read_tmp_files'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_tmp_t;
	')

	
	allow $1 gnome_initial_setup_tmp_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Transition to gnome-initial-setup named content
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_initial_setup_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_initial_setup_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type gnome_initial_setup_var_run_t;
	')

	files_pid_filetrans($1, gnome_initial_setup_var_run_t, dir, "gnome-initial-setup")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_initial_setup_filetrans_named_content'($*)) dnl
	')


## <summary>policy for gnome_remote_desktop</summary>

########################################
## <summary>
##	Execute gnome_remote_desktop_exec_t in the gnome_remote_desktop domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`gnome_remote_desktop_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_domtrans'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_t, gnome_remote_desktop_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, gnome_remote_desktop_exec_t, gnome_remote_desktop_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute gnome_remote_desktop in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_remote_desktop_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_exec'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, gnome_remote_desktop_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_exec'($*)) dnl
	')


########################################
## <summary>
##	Search gnome_remote_desktop lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_remote_desktop_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_search_lib'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_var_lib_t;
	')

	allow $1 gnome_remote_desktop_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read gnome_remote_desktop lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_remote_desktop_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_read_lib_files'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, gnome_remote_desktop_var_lib_t, gnome_remote_desktop_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage gnome_remote_desktop lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_remote_desktop_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_manage_lib_files'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, gnome_remote_desktop_var_lib_t, gnome_remote_desktop_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage gnome_remote_desktop lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_remote_desktop_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, gnome_remote_desktop_var_lib_t, gnome_remote_desktop_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_manage_lib_dirs'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an gnome_remote_desktop environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`gnome_remote_desktop_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_admin'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_t;
		type gnome_remote_desktop_var_lib_t;
	')

	allow $1 gnome_remote_desktop_t:process { signal_perms };
	ps_process_pattern($1, gnome_remote_desktop_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 gnome_remote_desktop_t:process ptrace;
	')

	files_search_var_lib($1)
	admin_pattern($1, gnome_remote_desktop_var_lib_t)
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_admin'($*)) dnl
	')


## <summary>
##	Read and write to TCP socket
## </summary>
## <desc>
##	<p>
##	Allow the specified domain to read and write to
##  gnome_remote_desktop_port_t TCP socket
##	</p>
## </desc>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gnome_remote_desktop_rw_tcp_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gnome_remote_desktop_rw_tcp_sockets'($*)) dnl
	
	gen_require(`
		type gnome_remote_desktop_t;
	')

	allow $1 gnome_remote_desktop_t:tcp_socket rw_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gnome_remote_desktop_rw_tcp_sockets'($*)) dnl
	')

## <summary>Policy for GNU Privacy Guard and related programs.</summary>

############################################################
## <summary>
##	Role access for gpg
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	User domain for the role
##	</summary>
## </param>
#
 	 	define(`gpg_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_role'($*)) dnl
	
	gen_require(`
        attribute_role gpg_roles, gpg_agent_roles, gpg_helper_roles, gpg_pinentry_roles;
		type gpg_t, gpg_exec_t;
		type gpg_agent_t, gpg_agent_exec_t;
		type gpg_agent_tmp_t;
		type gpg_helper_t, gpg_pinentry_t;
		type gpg_pinentry_tmp_t;
	')

    roleattribute $1 gpg_roles;
    roleattribute $1 gpg_agent_roles;
    roleattribute $1 gpg_helper_roles;
    roleattribute $1 gpg_pinentry_roles;

	# transition from the userdomain to the derived domain
	domtrans_pattern($2, gpg_exec_t, gpg_t)

	# allow ps to show gpg
	ps_process_pattern($2, gpg_t)
	allow $2 gpg_t:process { signull sigstop signal sigkill };

	# communicate with the user
	allow gpg_helper_t $2:fd use;
	allow gpg_helper_t $2:fifo_file write;

	# allow ps to show gpg-agent
	ps_process_pattern($2, gpg_agent_t)

	# Allow the user shell to signal the gpg-agent program.
	allow $2 gpg_agent_t:process { signal sigkill };

	manage_dirs_pattern($2, gpg_agent_tmp_t, gpg_agent_tmp_t)
	manage_files_pattern($2, gpg_agent_tmp_t, gpg_agent_tmp_t)
	manage_sock_files_pattern($2, gpg_agent_tmp_t, gpg_agent_tmp_t)
	files_tmp_filetrans(gpg_agent_t, gpg_agent_tmp_t, { file sock_file dir })

	# Transition from the user domain to the agent domain.
	domtrans_pattern($2, gpg_agent_exec_t, gpg_agent_t)

	manage_sock_files_pattern($2, gpg_pinentry_tmp_t, gpg_pinentry_tmp_t)
	relabel_sock_files_pattern($2, gpg_pinentry_tmp_t, gpg_pinentry_tmp_t)

	allow gpg_pinentry_t $2:fifo_file { read write };

	optional_policy(`
		gpg_pinentry_dbus_chat($2)
	')

	allow $2 gpg_agent_t:unix_stream_socket { rw_socket_perms connectto };
	ifdef(`hide_broken_symptoms',`
		#Leaked File Descriptors
		dontaudit gpg_t $2:fifo_file rw_fifo_file_perms;
		dontaudit gpg_agent_t $2:fifo_file rw_fifo_file_perms;
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_role'($*)) dnl
	')


########################################
## <summary>
##	Transition to a user gpg domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`gpg_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_domtrans'($*)) dnl
	
	gen_require(`
		type gpg_t, gpg_exec_t;
	')

	domtrans_pattern($1, gpg_exec_t, gpg_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute gpg in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_exec'($*)) dnl
	
	gen_require(`
		type gpg_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, gpg_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_exec'($*)) dnl
	')


######################################
## <summary>
##  Transition to a gpg web domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed access.
##  </summary>
## </param>
#
 	 	define(`gpg_domtrans_web',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_domtrans_web'($*)) dnl
	
    gen_require(`
        type gpg_web_t, gpg_exec_t;
    ')

    domtrans_pattern($1, gpg_exec_t, gpg_web_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_domtrans_web'($*)) dnl
	')


######################################
## <summary>
##  Make gpg an entrypoint for
##  the specified domain.
## </summary>
## <param name="domain">
##  <summary>
##  The domain for which cifs_t is an entrypoint.
##  </summary>
## </param>
#
 	 	define(`gpg_entry_type',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_entry_type'($*)) dnl
	
    gen_require(`
        type gpg_exec_t;
    ')

    domain_entry_file($1, gpg_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_entry_type'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to user gpg processes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_signal'($*)) dnl
	
	gen_require(`
		type gpg_t;
	')

	allow $1 gpg_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_signal'($*)) dnl
	')


########################################
## <summary>
##	Transition to the gpg-agent domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`gpg_domtrans_agent',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_domtrans_agent'($*)) dnl
	
	gen_require(`
		type gpg_agent_t, gpg_agent_exec_t;
	')

	domtrans_pattern($1, gpg_agent_exec_t, gpg_agent_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_domtrans_agent'($*)) dnl
	')


########################################
## <summary>
##	Read and write GPG agent pipes.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_rw_agent_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_rw_agent_pipes'($*)) dnl
	
	# Just wants read/write could this be a leak?
	gen_require(`
		type gpg_agent_t;
	')

	allow $1 gpg_agent_t:fifo_file rw_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_rw_agent_pipes'($*)) dnl
	')


########################################
## <summary>
##	Send messages to and from GPG
##	Pinentry over DBUS.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_pinentry_dbus_chat',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_pinentry_dbus_chat'($*)) dnl
	
	gen_require(`
		type gpg_pinentry_t;
		class dbus send_msg;
	')

	allow $1 gpg_pinentry_t:dbus send_msg;
	allow gpg_pinentry_t $1:dbus send_msg;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_pinentry_dbus_chat'($*)) dnl
	')


########################################
## <summary>
##	List Gnu Privacy Guard user secrets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_list_user_secrets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_list_user_secrets'($*)) dnl
	
	gen_require(`
		type gpg_secret_t;
	')

	list_dirs_pattern($1, gpg_secret_t, gpg_secret_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_list_user_secrets'($*)) dnl
	')


########################################
## <summary>
##	Read Gnu Privacy Guard user secrets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_read_user_secrets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_read_user_secrets'($*)) dnl
	
	gen_require(`
		type gpg_secret_t;
	')

	read_files_pattern($1, gpg_secret_t, gpg_secret_t)
	userdom_search_user_home_dirs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_read_user_secrets'($*)) dnl
	')


###########################
## <summary>
##	Allow to manage gpg named home content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_manage_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_manage_home_content'($*)) dnl
	
	gen_require(`
		type gpg_secret_t;
	')

	manage_files_pattern($1, gpg_secret_t, gpg_secret_t)
	manage_dirs_pattern($1, gpg_secret_t, gpg_secret_t)
	userdom_user_home_dir_filetrans($1, gpg_secret_t, dir, ".gnupg")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_manage_home_content'($*)) dnl
	')


###########################
## <summary>
##	Allow to manage gpg named admin home content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_manage_admin_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_manage_admin_home_content'($*)) dnl
	
	gen_require(`
		type gpg_secret_t;
	')

	manage_files_pattern($1, gpg_secret_t, gpg_secret_t)
	manage_dirs_pattern($1, gpg_secret_t, gpg_secret_t)
	userdom_admin_home_dir_filetrans($1, gpg_secret_t, dir, ".gnupg")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_manage_admin_home_content'($*)) dnl
	')


########################################
## <summary>
##	Transition to gpg named home content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_filetrans_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_filetrans_home_content'($*)) dnl
	
	gen_require(`
		type gpg_secret_t;
	')

	userdom_user_home_dir_filetrans($1, gpg_secret_t, dir, ".gnupg")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_filetrans_home_content'($*)) dnl
	')


########################################
## <summary>
##	Transition to gpg named admin home content
## </summary>
## <param name="domain">
##	<summary>
##      Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_filetrans_admin_home_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_filetrans_admin_home_content'($*)) dnl
	
	gen_require(`
		type gpg_secret_t;
	')

	userdom_admin_home_dir_filetrans($1, gpg_secret_t, dir, ".gnupg")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_filetrans_admin_home_content'($*)) dnl
	')


########################################
## <summary>
##	Connected to gpg_agent_t unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_agent_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_agent_stream_connect'($*)) dnl
	
	gen_require(`
		type gpg_agent_t;
	')

	allow $1 gpg_agent_t:unix_stream_socket connectto;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_agent_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Connected to gpg_agent_t unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpg_noatsecure',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpg_noatsecure'($*)) dnl
	
	gen_require(`
		type gpg_t;
	')

    allow $1 gpg_t:process { noatsecure rlimitinh siginh };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpg_noatsecure'($*)) dnl
	')

## <summary>General Purpose Mouse driver.</summary>

########################################
## <summary>
##	Connect to GPM over a unix domain
##	stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpm_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpm_stream_connect'($*)) dnl
	
	gen_require(`
		type gpmctl_t, gpm_t;
	')

	dev_list_all_dev_nodes($1)
	stream_connect_pattern($1, gpmctl_t, gpmctl_t, gpm_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpm_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	Get attributes of gpm control
##	channel named sock files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpm_getattr_gpmctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpm_getattr_gpmctl'($*)) dnl
	
	gen_require(`
		type gpmctl_t;
	')

	dev_list_all_dev_nodes($1)
	allow $1 gpmctl_t:sock_file getattr_sock_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpm_getattr_gpmctl'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to get
##	attributes of gpm control channel
##	named sock files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`gpm_dontaudit_getattr_gpmctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpm_dontaudit_getattr_gpmctl'($*)) dnl
	
	gen_require(`
		type gpmctl_t;
	')

	dontaudit $1 gpmctl_t:sock_file getattr_sock_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpm_dontaudit_getattr_gpmctl'($*)) dnl
	')


########################################
## <summary>
##	Set attributes of gpm control
##	channel named sock files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpm_setattr_gpmctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpm_setattr_gpmctl'($*)) dnl
	
	gen_require(`
		type gpmctl_t;
	')

	dev_list_all_dev_nodes($1)
	allow $1 gpmctl_t:sock_file setattr_sock_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpm_setattr_gpmctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an gpm environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`gpm_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpm_admin'($*)) dnl
	
	gen_require(`
		type gpm_t, gpm_conf_t, gpm_initrc_exec_t;
		type gpm_var_run_t, gpmctl_t;
	')

	allow $1 gpm_t:process { ptrace signal_perms };
	ps_process_pattern($1, gpm_t)

	init_labeled_script_domtrans($1, gpm_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 gpm_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, gpm_conf_t)

	dev_list_all_dev_nodes($1)
	admin_pattern($1, gpmctl_t)

	files_search_pids($1)
	admin_pattern($1, gpm_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpm_admin'($*)) dnl
	')

## <summary>gpsd monitor daemon.</summary>

########################################
## <summary>
##	Execute a domain transition to run gpsd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`gpsd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpsd_domtrans'($*)) dnl
	
	gen_require(`
		type gpsd_t, gpsd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, gpsd_exec_t, gpsd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpsd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute gpsd in the gpsd domain, and
##	allow the specified role the gpsd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`gpsd_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpsd_run'($*)) dnl
	
	gen_require(`
		attribute_role gpsd_roles;
	')

	gpsd_domtrans($1)
	roleattribute $2 gpsd_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpsd_run'($*)) dnl
	')


########################################
## <summary>
##	Read and write gpsd shared memory.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gpsd_rw_shm',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpsd_rw_shm'($*)) dnl
	
	gen_require(`
		type gpsd_t, gpsd_tmpfs_t;
	')

	allow $1 gpsd_t:shm rw_shm_perms;
	allow $1 gpsd_tmpfs_t:dir list_dir_perms;
	rw_files_pattern($1, gpsd_tmpfs_t, gpsd_tmpfs_t)
	read_lnk_files_pattern($1, gpsd_tmpfs_t, gpsd_tmpfs_t)
	allow $1 gpsd_tmpfs_t:file map;
	fs_search_tmpfs($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpsd_rw_shm'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an gpsd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`gpsd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gpsd_admin'($*)) dnl
	
	gen_require(`
		type gpsd_t, gpsd_initrc_exec_t, gpsd_var_run_t;
	')

	allow $1 gpsd_t:process { ptrace signal_perms };
	ps_process_pattern($1, gpsd_t)

	init_labeled_script_domtrans($1, gpsd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 gpsd_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, gpsd_var_run_t)

	gpsd_run($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gpsd_admin'($*)) dnl
	')


## <summary>policy for gssproxy</summary>

########################################
## <summary>
##	Execute TEMPLATE in the gssproxy domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`gssproxy_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_domtrans'($*)) dnl
	
	gen_require(`
		type gssproxy_t, gssproxy_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, gssproxy_exec_t, gssproxy_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search gssproxy lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_search_lib'($*)) dnl
	
	gen_require(`
		type gssproxy_var_lib_t;
	')

	allow $1 gssproxy_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read gssproxy lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_read_lib_files'($*)) dnl
	
	gen_require(`
		type gssproxy_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, gssproxy_var_lib_t, gssproxy_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage gssproxy lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_manage_lib_files'($*)) dnl
	
	gen_require(`
		type gssproxy_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, gssproxy_var_lib_t, gssproxy_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage gssproxy lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type gssproxy_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, gssproxy_var_lib_t, gssproxy_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Read gssproxy PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_read_pid_files'($*)) dnl
	
	gen_require(`
		type gssproxy_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, gssproxy_var_run_t, gssproxy_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Execute gssproxy server in the gssproxy domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`gssproxy_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_systemctl'($*)) dnl
	
	gen_require(`
		type gssproxy_t;
		type gssproxy_unit_file_t;
	')

	systemd_exec_systemctl($1)
	init_reload_services($1)
	allow $1 gssproxy_unit_file_t:file read_file_perms;
	allow $1 gssproxy_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, gssproxy_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_systemctl'($*)) dnl
	')


########################################
## <summary>
##	Connect to gssproxy over an unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_stream_connect'($*)) dnl
	
	gen_require(`
		type gssproxy_t, gssproxy_var_run_t, gssproxy_var_lib_t;
	')

	files_search_pids($1)
	stream_connect_pattern($1, gssproxy_var_run_t, gssproxy_var_run_t, gssproxy_t)
	stream_connect_pattern($1, gssproxy_var_lib_t, gssproxy_var_lib_t, gssproxy_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_stream_connect'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an gssproxy environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`gssproxy_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_admin'($*)) dnl
	
	gen_require(`
		type gssproxy_t;
		type gssproxy_var_lib_t;
		type gssproxy_var_run_t;
		type gssproxy_unit_file_t;
	')

	allow $1 gssproxy_t:process { ptrace signal_perms };
	ps_process_pattern($1, gssproxy_t)

	files_search_var_lib($1)
	admin_pattern($1, gssproxy_var_lib_t)

	files_search_pids($1)
	admin_pattern($1, gssproxy_var_run_t)

	gssproxy_systemctl($1)
	admin_pattern($1, gssproxy_unit_file_t)
	allow $1 gssproxy_unit_file_t:service all_service_perms;
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_admin'($*)) dnl
	')


########################################
## <summary>
##	Read and write to svirt_image devices.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`gssproxy_noatsecure',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `gssproxy_noatsecure'($*)) dnl
	
	gen_require(`
		type gssproxy_t;
	')

    allow $1 gssproxy_t:process { noatsecure rlimitinh };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `gssproxy_noatsecure'($*)) dnl
	')

## <summary>Software for reliable, scalable, distributed computing.</summary>

#######################################
## <summary>
##	The template to define a hadoop domain.
## </summary>
## <param name="domain_prefix">
##	<summary>
##	Domain prefix to be used.
##	</summary>
## </param>
#
 	 	define(`hadoop_domain_template',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_domain_template'($*)) dnl
	
	gen_require(`
		attribute hadoop_domain, hadoop_initrc_domain, hadoop_init_script_file;
		attribute hadoop_pid_file, hadoop_lock_file, hadoop_log_file;
		attribute hadoop_tmp_file, hadoop_var_lib_file;
		type hadoop_log_t, hadoop_var_lib_t, hadoop_var_run_t;
		type hadoop_exec_t, hadoop_hsperfdata_t;
	')

	########################################
	#
	# Declarations
	#

	type hadoop_$1_t, hadoop_domain;
	domain_type(hadoop_$1_t)
	domain_entry_file(hadoop_$1_t, hadoop_exec_t)
	role system_r types hadoop_$1_t;

	type hadoop_$1_initrc_t, hadoop_initrc_domain;
	type hadoop_$1_initrc_exec_t, hadoop_init_script_file;
	init_script_domain(hadoop_$1_initrc_t, hadoop_$1_initrc_exec_t)
	role system_r types hadoop_$1_initrc_t;

	type hadoop_$1_initrc_var_run_t, hadoop_pid_file;
	files_pid_file(hadoop_$1_initrc_var_run_t)

	type hadoop_$1_lock_t, hadoop_lock_file;
	files_lock_file(hadoop_$1_lock_t)

	type hadoop_$1_log_t, hadoop_log_file;
	logging_log_file(hadoop_$1_log_t)

	type hadoop_$1_tmp_t, hadoop_tmp_file;
	files_tmp_file(hadoop_$1_tmp_t)

	type hadoop_$1_var_lib_t, hadoop_var_lib_file;
	files_type(hadoop_$1_var_lib_t)

	####################################
	#
	# hadoop_domain policy
	#

	manage_files_pattern(hadoop_$1_t, hadoop_$1_log_t, hadoop_$1_log_t)
	filetrans_pattern(hadoop_$1_t, hadoop_log_t, hadoop_$1_log_t, { dir file })

	manage_dirs_pattern(hadoop_$1_t, hadoop_$1_var_lib_t, hadoop_$1_var_lib_t)
	manage_files_pattern(hadoop_$1_t, hadoop_$1_var_lib_t, hadoop_$1_var_lib_t)
	filetrans_pattern(hadoop_$1_t, hadoop_var_lib_t, hadoop_$1_var_lib_t, file)

	manage_files_pattern(hadoop_$1_t, hadoop_$1_initrc_var_run_t, hadoop_$1_initrc_var_run_t)
	filetrans_pattern(hadoop_$1_t, hadoop_var_run_t, hadoop_$1_initrc_var_run_t, file)

	manage_files_pattern(hadoop_$1_t, hadoop_$1_tmp_t, hadoop_$1_tmp_t)
	filetrans_pattern(hadoop_$1_t, hadoop_hsperfdata_t, hadoop_$1_tmp_t, file)

	auth_use_nsswitch(hadoop_$1_t)

	####################################
	#
	# hadoop_initrc_domain policy
	#

	allow hadoop_$1_initrc_t hadoop_$1_t:process { signal signull };

	domtrans_pattern(hadoop_$1_initrc_t, hadoop_exec_t, hadoop_$1_t)

	manage_files_pattern(hadoop_$1_initrc_t, hadoop_$1_lock_t, hadoop_$1_lock_t)
	files_lock_filetrans(hadoop_$1_initrc_t, hadoop_$1_lock_t, file)

	manage_files_pattern(hadoop_$1_initrc_t, hadoop_$1_initrc_var_run_t, hadoop_$1_initrc_var_run_t)
	filetrans_pattern(hadoop_$1_initrc_t, hadoop_var_run_t, hadoop_$1_initrc_var_run_t, file)

	manage_files_pattern(hadoop_$1_initrc_t, hadoop_$1_log_t, hadoop_$1_log_t)
	filetrans_pattern(hadoop_$1_initrc_t, hadoop_log_t, hadoop_$1_log_t, { dir file })
 dnl
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_domain_template'($*)) dnl
	')


########################################
## <summary>
##	Role access for hadoop.
## </summary>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`hadoop_role',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_role'($*)) dnl
	
	gen_require(`
		attribute_role hadoop_roles, zookeeper_roles;
		type hadoop_t, zookeeper_t, hadoop_home_t;
		type hadoop_tmp_t, hadoop_hsperfdata_t, zookeeper_tmp_t;
	')

	hadoop_domtrans($2)
	roleattribute $1 hadoop_roles;

	hadoop_domtrans_zookeeper_client($2)
	roleattribute $1 zookeeper_roles;

	allow $2 { hadoop_t zookeeper_t }:process { ptrace signal_perms };
	ps_process_pattern($2, { hadoop_t zookeeper_t })

	allow $2 { hadoop_home_t hadoop_tmp_t hadoop_hsperfdata_t }:dir { manage_dir_perms relabel_dir_perms };
	allow $2 { hadoop_home_t hadoop_tmp_t zookeeper_tmp_t }:file { manage_file_perms relabel_file_perms };
	allow $2 hadoop_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_role'($*)) dnl
	')


########################################
## <summary>
##	Execute hadoop in the
##	hadoop domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hadoop_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_domtrans'($*)) dnl
	
	gen_require(`
		type hadoop_t, hadoop_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, hadoop_exec_t, hadoop_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Receive from hadoop peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom'($*)) dnl
	
	gen_require(`
		type hadoop_t;
	')

	allow $1 hadoop_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom'($*)) dnl
	')


########################################
## <summary>
##	Execute zookeeper client in the
##	zookeeper client domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hadoop_domtrans_zookeeper_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_domtrans_zookeeper_client'($*)) dnl
	
	gen_require(`
		type zookeeper_t, zookeeper_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, zookeeper_exec_t, zookeeper_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_domtrans_zookeeper_client'($*)) dnl
	')


########################################
## <summary>
##	Receive from zookeeper peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_zookeeper_client',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_zookeeper_client'($*)) dnl
	
	gen_require(`
		type zookeeper_t;
	')

	allow $1 zookeeper_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_zookeeper_client'($*)) dnl
	')


########################################
## <summary>
##	Execute zookeeper server in the
##	zookeeper server domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hadoop_domtrans_zookeeper_server',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_domtrans_zookeeper_server'($*)) dnl
	
	gen_require(`
		type zookeeper_server_t, zookeeper_server_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, zookeeper_server_exec_t, zookeeper_server_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_domtrans_zookeeper_server'($*)) dnl
	')


########################################
## <summary>
##	Receive from zookeeper server peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_zookeeper_server',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_zookeeper_server'($*)) dnl
	
	gen_require(`
		type zookeeper_server_t;
	')

	allow $1 zookeeper_server_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_zookeeper_server'($*)) dnl
	')


########################################
## <summary>
##	Execute zookeeper server in the
##	zookeeper domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hadoop_initrc_domtrans_zookeeper_server',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_initrc_domtrans_zookeeper_server'($*)) dnl
	
	gen_require(`
		type zookeeper_server_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, zookeeper_server_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_initrc_domtrans_zookeeper_server'($*)) dnl
	')


########################################
## <summary>
##	Receive from datanode peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_datanode',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_datanode'($*)) dnl
	
	gen_require(`
		type hadoop_datanode_t;
	')

	allow $1 hadoop_datanode_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_datanode'($*)) dnl
	')


########################################
## <summary>
##	Read hadoop configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_read_config'($*)) dnl
	
	gen_require(`
		type hadoop_etc_t;
	')

	read_files_pattern($1, hadoop_etc_t, hadoop_etc_t)
	read_lnk_files_pattern($1, hadoop_etc_t, hadoop_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_read_config'($*)) dnl
	')


########################################
## <summary>
##	Execute hadoop configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_exec_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_exec_config'($*)) dnl
	
	gen_require(`
		type hadoop_etc_t;
	')

	hadoop_read_config($1)
	allow $1 hadoop_etc_t:file exec_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_exec_config'($*)) dnl
	')


########################################
## <summary>
##	Receive from jobtracker peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_jobtracker',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_jobtracker'($*)) dnl
	
	gen_require(`
		type hadoop_jobtracker_t;
	')

	allow $1 hadoop_jobtracker_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_jobtracker'($*)) dnl
	')


########################################
## <summary>
##	Match hadoop lan association.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_match_lan_spd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_match_lan_spd'($*)) dnl
	
	gen_require(`
		type hadoop_lan_t;
	')

	allow $1 hadoop_lan_t:association polmatch;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_match_lan_spd'($*)) dnl
	')


########################################
## <summary>
##	Receive from namenode peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_namenode',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_namenode'($*)) dnl
	
	gen_require(`
		type hadoop_namenode_t;
	')

	allow $1 hadoop_namenode_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_namenode'($*)) dnl
	')


########################################
## <summary>
##	Receive from secondary namenode peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_secondarynamenode',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_secondarynamenode'($*)) dnl
	
	gen_require(`
		type hadoop_secondarynamenode_t;
	')

	allow $1 hadoop_secondarynamenode_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_secondarynamenode'($*)) dnl
	')


########################################
## <summary>
##	Receive from tasktracker peer.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hadoop_recvfrom_tasktracker',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_recvfrom_tasktracker'($*)) dnl
	
	gen_require(`
		type hadoop_tasktracker_t;
	')

	allow $1 hadoop_tasktracker_t:peer recv;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_recvfrom_tasktracker'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an hadoop environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`hadoop_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hadoop_admin'($*)) dnl
	
	gen_require(`
		attribute hadoop_domain;
		attribute hadoop_initrc_domain;

		attribute hadoop_init_script_file;
		attribute hadoop_pid_file;
		attribute hadoop_lock_file;
		attribute hadoop_log_file;
		attribute hadoop_tmp_file;
		attribute hadoop_var_lib_file;

		type hadoop_t, hadoop_etc_t, hadoop_hsperfdata_t;
		type zookeeper_t, zookeeper_etc_t, zookeeper_server_t;
		type zookeeper_server_var_t;
	')

	allow $1 { hadoop_domain hadoop_initrc_domain hadoop_t zookeeper_t zookeeper_server_t }:process { ptrace signal_perms };
	ps_process_pattern($1, { hadoop_domain hadoop_initrc_domain hadoop_t zookeeper_t zookeeper_server_t })

	init_labeled_script_domtrans($1, hadoop_init_script_file)
	domain_system_change_exemption($1)
	role_transition $2 hadoop_init_script_file system_r;
	allow $2 system_r;

	files_search_etc($1)
	admin_pattern($1, { hadoop_etc_t zookeeper_etc_t })

	logging_search_logs($1)
	admin_pattern($1, hadoop_log_file)

	files_search_locks($1)
	admin_pattern($1, hadoop_lock_file)

	files_search_pids($1)
	admin_pattern($1, hadoop_pid_file)

	files_search_tmp($1)
	admin_pattern($1, { hadoop_tmp_file hadoop_hsperfdata_t })

	files_search_var_lib($1)
	admin_pattern($1, { hadoop_var_lib_file zookeeper_server_var_t })

	hadoop_role($2, $1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hadoop_admin'($*)) dnl
	')

## <summary>Hard disk temperature tool running as a daemon.</summary>

#######################################
## <summary>
##	Execute a domain transition to run hddtemp.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hddtemp_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hddtemp_domtrans'($*)) dnl
	
	gen_require(`
		type hddtemp_t, hddtemp_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, hddtemp_exec_t, hddtemp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hddtemp_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute hddtemp in the hddtemp domain, and
##	allow the specified role the hddtemp domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#
 	 	define(`hddtemp_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hddtemp_run'($*)) dnl
	
	gen_require(`
		type hddtemp_t;
		attribute_role hddtemp_roles;
	')

    hddtemp_domtrans($1)
    roleattribute $2 hddtemp_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hddtemp_run'($*)) dnl
	')


######################################
## <summary>
##	Execute hddtemp in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hddtemp_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hddtemp_exec'($*)) dnl
	
	gen_require(`
		type hddtemp_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, hddtemp_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hddtemp_exec'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an hddtemp environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`hddtemp_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hddtemp_admin'($*)) dnl
	
	gen_require(`
		type hddtemp_t, hddtemp_etc_t, hddtemp_initrc_exec_t;
	')

	allow $1 hddtemp_t:process signal_perms;
	ps_process_pattern($1, hddtemp_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 hddtemp_t:process ptrace;
	')

	init_labeled_script_domtrans($1, hddtemp_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 hddtemp_initrc_exec_t system_r;
	allow $2 system_r;

	admin_pattern($1, hddtemp_etc_t)
	files_search_etc($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hddtemp_admin'($*)) dnl
	')


## <summary>policy for hostapd</summary>

########################################
## <summary>
##	Execute TEMPLATE in the hostapd domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`hostapd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hostapd_domtrans'($*)) dnl
	
	gen_require(`
		type hostapd_t, hostapd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, hostapd_exec_t, hostapd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hostapd_domtrans'($*)) dnl
	')

########################################
## <summary>
##	Execute hostapd server in the hostapd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hostapd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hostapd_systemctl'($*)) dnl
	
	gen_require(`
		type hostapd_t;
		type hostapd_unit_file_t;
	')

	systemd_exec_systemctl($1)
        systemd_read_fifo_file_passwd_run($1)
	allow $1 hostapd_unit_file_t:file read_file_perms;
	allow $1 hostapd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, hostapd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hostapd_systemctl'($*)) dnl
	')



########################################
## <summary>
##	Read hostapd PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hostapd_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hostapd_read_pid_files'($*)) dnl
	
	gen_require(`
		type hostapd_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, hostapd_var_run_t, hostapd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hostapd_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an hostapd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`hostapd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hostapd_admin'($*)) dnl
	
	gen_require(`
		type hostapd_t;
		type hostapd_unit_file_t;
		type hostapd_var_run_t;
	')

	allow $1 hostapd_t:process { signal_perms };
	ps_process_pattern($1, hostapd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 hostapd_t:process ptrace;
	')

	hostapd_systemctl($1)
	admin_pattern($1, hostapd_unit_file_t)
	allow $1 hostapd_unit_file_t:service all_service_perms;
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	admin_pattern($1, hostapd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hostapd_admin'($*)) dnl
	')

## <summary>Port of Apple Rendezvous multicast DNS.</summary>

########################################
## <summary>
##	Send generic signals to howl.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`howl_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `howl_signal'($*)) dnl
	
	gen_require(`
		type howl_t;
	')

	allow $1 howl_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `howl_signal'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an howl environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`howl_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `howl_admin'($*)) dnl
	
	gen_require(`
		type howl_t, howl_initrc_exec_t, howl_var_run_t;
	')

	allow $1 howl_t:process { ptrace signal_perms };
	ps_process_pattern($1, howl_t)

	init_labeled_script_domtrans($1, howl_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 howl_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, howl_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `howl_admin'($*)) dnl
	')


## <summary>Hsqldb is transactional database engine with in-memory and disk-based tables, supporting embedded and server modes.</summary>

########################################
## <summary>
##	Execute hsqldb_exec_t in the hsqldb domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`hsqldb_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_domtrans'($*)) dnl
	
	gen_require(`
		type hsqldb_t, hsqldb_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, hsqldb_exec_t, hsqldb_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute hsqldb in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_exec'($*)) dnl
	
	gen_require(`
		type hsqldb_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, hsqldb_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_exec'($*)) dnl
	')


########################################
## <summary>
##	Do not audit attempts to read,
##	hsqldb tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain to not audit.
##	</summary>
## </param>
#
 	 	define(`hsqldb_dontaudit_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_dontaudit_read_tmp_files'($*)) dnl
	
	gen_require(`
		type hsqldb_tmp_t;
	')

	dontaudit $1 hsqldb_tmp_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_dontaudit_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Read hsqldb tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_read_tmp_files'($*)) dnl
	
	gen_require(`
		type hsqldb_tmp_t;
	')

	files_search_tmp($1)
	read_files_pattern($1, hsqldb_tmp_t, hsqldb_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Manage hsqldb tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_manage_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_manage_tmp'($*)) dnl
	
	gen_require(`
		type hsqldb_tmp_t;
	')

	files_search_tmp($1)
	manage_dirs_pattern($1, hsqldb_tmp_t, hsqldb_tmp_t)
	manage_files_pattern($1, hsqldb_tmp_t, hsqldb_tmp_t)
	manage_lnk_files_pattern($1, hsqldb_tmp_t, hsqldb_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_manage_tmp'($*)) dnl
	')


########################################
## <summary>
##	Search hsqldb lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_search_lib'($*)) dnl
	
	gen_require(`
		type hsqldb_var_lib_t;
	')

	allow $1 hsqldb_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read hsqldb lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_read_lib_files'($*)) dnl
	
	gen_require(`
		type hsqldb_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, hsqldb_var_lib_t, hsqldb_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage hsqldb lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_manage_lib_files'($*)) dnl
	
	gen_require(`
		type hsqldb_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, hsqldb_var_lib_t, hsqldb_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Manage hsqldb lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_manage_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_manage_lib_dirs'($*)) dnl
	
	gen_require(`
		type hsqldb_var_lib_t;
	')

	files_search_var_lib($1)
	manage_dirs_pattern($1, hsqldb_var_lib_t, hsqldb_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_manage_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Execute hsqldb server in the hsqldb domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hsqldb_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_systemctl'($*)) dnl
	
	gen_require(`
		type hsqldb_t;
		type hsqldb_unit_file_t;
	')

	systemd_exec_systemctl($1)
        systemd_read_fifo_file_passwd_run($1)
	allow $1 hsqldb_unit_file_t:file read_file_perms;
	allow $1 hsqldb_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, hsqldb_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_systemctl'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an hsqldb environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hsqldb_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hsqldb_admin'($*)) dnl
	
	gen_require(`
		type hsqldb_t;
		type hsqldb_tmp_t;
		type hsqldb_var_lib_t;
	type hsqldb_unit_file_t;
	')

	allow $1 hsqldb_t:process { signal_perms };
	ps_process_pattern($1, hsqldb_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 hsqldb_t:process ptrace;
    ')

	files_search_tmp($1)
	admin_pattern($1, hsqldb_tmp_t)

	files_search_var_lib($1)
	admin_pattern($1, hsqldb_var_lib_t)

	hsqldb_systemctl($1)
	admin_pattern($1, hsqldb_unit_file_t)
	allow $1 hsqldb_unit_file_t:service all_service_perms;
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hsqldb_admin'($*)) dnl
	')

## <summary>Dump topology and locality information from hardware tables.</summary>

########################################
## <summary>
##	Execute hwloc dhwd in the hwloc dhwd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`hwloc_domtrans_dhwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hwloc_domtrans_dhwd'($*)) dnl
	
	gen_require(`
		type hwloc_dhwd_t, hwloc_dhwd_exec_t;
	')

	domtrans_pattern($1, hwloc_dhwd_exec_t, hwloc_dhwd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hwloc_domtrans_dhwd'($*)) dnl
	')


########################################
## <summary>
##	Execute hwloc dhwd in the hwloc dhwd domain, and
##	allow the specified role the hwloc dhwd domain,
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`hwloc_run_dhwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hwloc_run_dhwd'($*)) dnl
	
	gen_require(`
		attribute_role hwloc_dhwd_roles;
	')

	hwloc_domtrans_dhwd($1)
	roleattribute $2 hwloc_dhwd_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hwloc_run_dhwd'($*)) dnl
	')


########################################
## <summary>
##	Execute hwloc dhwd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hwloc_exec_dhwd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hwloc_exec_dhwd'($*)) dnl
	
	gen_require(`
		type hwloc_dhwd_exec_t;
	')

	can_exec($1, hwloc_dhwd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hwloc_exec_dhwd'($*)) dnl
	')


########################################
## <summary>
##	Read hwloc runtime files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hwloc_read_runtime_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hwloc_read_runtime_files'($*)) dnl
	
	gen_require(`
		type hwloc_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, hwloc_var_run_t, hwloc_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hwloc_read_runtime_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an hwloc environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`hwloc_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hwloc_admin'($*)) dnl
	
	gen_require(`
		type hwloc_dhwd_t, hwloc_var_run_t;
	')

	allow $1 hwloc_dhwd_t:process { signal_perms };
	ps_process_pattern($1, hwloc_dhwd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 hwloc_dhwd_t:process ptrace;
	')

	admin_pattern($1, hwloc_var_run_t)
	files_pid_filetrans($1, hwloc_var_run_t, dir, "hwloc")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hwloc_admin'($*)) dnl
	')


## <summary>policy for hypervkvp</summary>

########################################
## <summary>
##	Execute TEMPLATE in the hypervkvp domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`hypervkvp_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hypervkvp_domtrans'($*)) dnl
	
	gen_require(`
		type hypervkvp_t, hypervkvp_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, hypervkvp_exec_t, hypervkvp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hypervkvp_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Search hypervkvp lib directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hypervkvp_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hypervkvp_search_lib'($*)) dnl
	
	gen_require(`
		type hypervkvp_var_lib_t;
	')

	allow $1 hypervkvp_var_lib_t:dir search_dir_perms;
	files_search_var_lib($1)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hypervkvp_search_lib'($*)) dnl
	')


########################################
## <summary>
##	Read hypervkvp lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hypervkvp_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hypervkvp_read_lib_files'($*)) dnl
	
	gen_require(`
		type hypervkvp_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 hypervkvp_var_lib_t:dir list_dir_perms;
	read_files_pattern($1, hypervkvp_var_lib_t, hypervkvp_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hypervkvp_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	hypervkvp lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hypervkvp_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hypervkvp_manage_lib_files'($*)) dnl
	
	gen_require(`
		type hypervkvp_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, hypervkvp_var_lib_t, hypervkvp_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hypervkvp_manage_lib_files'($*)) dnl
	')


#######################################
## <summary>
##  Execute hypervkvp server in the hypervkvp domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`hypervkvp_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hypervkvp_systemctl'($*)) dnl
	
    gen_require(`
        type hypervkvp_t;
        type hypervkvp_unit_file_t;
    ')

    systemd_exec_systemctl($1)
	init_reload_services($1)
    allow $1 hypervkvp_unit_file_t:file read_file_perms;
    allow $1 hypervkvp_unit_file_t:service manage_service_perms;

    ps_process_pattern($1, hypervkvp_t)
    
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hypervkvp_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an hypervkvp environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`hypervkvp_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `hypervkvp_admin'($*)) dnl
	
	gen_require(`
		type hypervkvp_t;
		type hypervkvp_unit_file_t;
	')

	allow $1 hypervkvp_t:process signal_perms;
	ps_process_pattern($1, hypervkvp_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 hypervkvp_t:process ptrace;
	')

	hypervkvp_manage_lib_files($1)

	hypervkvp_systemctl($1)
	admin_pattern($1, hypervkvp_unit_file_t)
	allow $1 hypervkvp_unit_file_t:service all_service_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `hypervkvp_admin'($*)) dnl
	')

## <summary>IIIMF htt server.</summary>

########################################
## <summary>
##	Use i18n_input over a TCP connection.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`i18n_use',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `i18n_use'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `i18n_use'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an i18n input environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`i18n_input_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `i18n_input_admin'($*)) dnl
	
	gen_require(`
		type i18n_input_t, i18n_input_initrc_exec_t, i18n_input_var_run_t;
		type i18n_input_log_t;
	')

	allow $1 i18n_input_t:process { ptrace signal_perms };
	ps_process_pattern($1, i18n_input_t)

	init_labeled_script_domtrans($1, i18n_input_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 i18n_input_initrc_exec_t system_r;
	allow $2 system_r;

	files_search_pids($1)
	admin_pattern($1, i18n_input_var_run_t)

	logging_search_logs($1)
	admin_pattern($1, i18n_input_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `i18n_input_admin'($*)) dnl
	')


## <summary>policy for ibacm</summary>

########################################
## <summary>
##	Execute ibacm_exec_t in the ibacm domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`ibacm_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_domtrans'($*)) dnl
	
	gen_require(`
		type ibacm_t, ibacm_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ibacm_exec_t, ibacm_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute ibacm in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ibacm_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_exec'($*)) dnl
	
	gen_require(`
		type ibacm_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, ibacm_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_exec'($*)) dnl
	')

########################################
## <summary>
##	Read ibacm's log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ibacm_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_read_log'($*)) dnl
	
	gen_require(`
		type ibacm_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, ibacm_log_t, ibacm_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append to ibacm log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ibacm_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_append_log'($*)) dnl
	
	gen_require(`
		type ibacm_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, ibacm_log_t, ibacm_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_append_log'($*)) dnl
	')


########################################
## <summary>
##	Manage ibacm log files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ibacm_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_manage_log'($*)) dnl
	
	gen_require(`
		type ibacm_log_t;
	')

	logging_search_logs($1)
	manage_dirs_pattern($1, ibacm_log_t, ibacm_log_t)
	manage_files_pattern($1, ibacm_log_t, ibacm_log_t)
	manage_lnk_files_pattern($1, ibacm_log_t, ibacm_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_manage_log'($*)) dnl
	')

########################################
## <summary>
##	Read ibacm PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ibacm_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_read_pid_files'($*)) dnl
	
	gen_require(`
		type ibacm_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, ibacm_var_run_t, ibacm_var_run_t)
	read_lnk_files_pattern($1, ibacm_var_run_t, ibacm_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_read_pid_files'($*)) dnl
	')



########################################
## <summary>
##	All of the rules required to administrate
##	an ibacm environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ibacm_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_admin'($*)) dnl
	
	gen_require(`
		type ibacm_t;
		type ibacm_log_t;
		type ibacm_var_run_t;
	')

	allow $1 ibacm_t:process { signal_perms };
	ps_process_pattern($1, ibacm_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 ibacm_t:process ptrace;
    ')

	logging_search_logs($1)
	admin_pattern($1, ibacm_log_t)

	files_search_pids($1)
	admin_pattern($1, ibacm_var_run_t)
	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_admin'($*)) dnl
	')


#######################################
## <summary>
##	Allow caller to create netlink rdma socket for ibacm
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ibacm_create_netlink_rdma_socket',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ibacm_create_netlink_rdma_socket'($*)) dnl
	
	gen_require(`
		type ibacm_t;
	')

	allow $1 ibacm_t:netlink_rdma_socket create_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ibacm_create_netlink_rdma_socket'($*)) dnl
	')

## <summary>policy for ica</summary>

########################################
## <summary>
##	Read and map ica tmpfs files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ica_read_map_tmpfs_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ica_read_map_tmpfs_files'($*)) dnl
	
       gen_require(`
               type ica_tmpfs_t;
       ')

       fs_search_tmpfs($1)
       mmap_read_files_pattern($1, ica_tmpfs_t, ica_tmpfs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ica_read_map_tmpfs_files'($*)) dnl
	')


########################################
## <summary>
##	Read, write, and map ica tmpfs files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ica_rw_map_tmpfs_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ica_rw_map_tmpfs_files'($*)) dnl
	
       gen_require(`
               type ica_tmpfs_t;
       ')

       fs_search_tmpfs($1)
       mmap_rw_files_pattern($1, ica_tmpfs_t, ica_tmpfs_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ica_rw_map_tmpfs_files'($*)) dnl
	')


########################################
## <summary>
##	Transition to ica named content
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ica_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ica_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type ica_tmpfs_t;
	')

	allow $1 ica_tmpfs_t:file create_file_perms;
	fs_tmpfs_filetrans($1, ica_tmpfs_t, file, "icastats_0")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ica_filetrans_named_content'($*)) dnl
	')

## <summary>ShoutCast compatible streaming media server.</summary>

########################################
## <summary>
##	Execute a domain transition to run icecast.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`icecast_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_domtrans'($*)) dnl
	
	gen_require(`
		type icecast_t, icecast_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, icecast_exec_t, icecast_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to icecast.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`icecast_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_signal'($*)) dnl
	
	gen_require(`
		type icecast_t;
	')

	allow $1 icecast_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_signal'($*)) dnl
	')


########################################
## <summary>
##	Execute icecast server in the icecast domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`icecast_initrc_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_initrc_domtrans'($*)) dnl
	
	gen_require(`
		type icecast_initrc_exec_t;
	')

	init_labeled_script_domtrans($1, icecast_initrc_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_initrc_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Read icecast pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`icecast_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_read_pid_files'($*)) dnl
	
	gen_require(`
		type icecast_var_run_t;
	')

	files_search_pids($1)
	allow $1 icecast_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	icecast pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`icecast_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_manage_pid_files'($*)) dnl
	
	gen_require(`
		type icecast_var_run_t;
	')

	files_search_pids($1)
	manage_files_pattern($1, icecast_var_run_t, icecast_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_manage_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Read icecast log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`icecast_read_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_read_log'($*)) dnl
	
	gen_require(`
		type icecast_log_t;
	')

	logging_search_logs($1)
	read_files_pattern($1, icecast_log_t, icecast_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_read_log'($*)) dnl
	')


########################################
## <summary>
##	Append icecast log files.
## </summary>
## <param name="domain">
## 	<summary>
##	Domain allowed access.
## 	</summary>
## </param>
#
 	 	define(`icecast_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_append_log'($*)) dnl
	
	gen_require(`
		type icecast_log_t;
	')

	logging_search_logs($1)
	append_files_pattern($1, icecast_log_t, icecast_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_append_log'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	icecast log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allow access.
##	</summary>
## </param>
#
 	 	define(`icecast_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_manage_log'($*)) dnl
	
	gen_require(`
		type icecast_log_t;
	')

	logging_search_logs($1)
	manage_files_pattern($1, icecast_log_t, icecast_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_manage_log'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an icecast environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`icecast_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `icecast_admin'($*)) dnl
	
	gen_require(`
		type icecast_t, icecast_initrc_exec_t, icecast_log_t;
		type icecast_var_run_t;
	')

	allow $1 icecast_t:process signal_perms;
	ps_process_pattern($1, icecast_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 icecast_t:process ptrace;
	')

	# Allow icecast_t to restart the apache service
	icecast_initrc_domtrans($1)
	domain_system_change_exemption($1)
	role_transition $2 icecast_initrc_exec_t system_r;
	allow $2 system_r;

	allow $1 icecast_t:process { ptrace signal_perms };
	ps_process_pattern($1, icecast_t)

	logging_search_logs($1)
	admin_pattern($1, icecast_log_t)

	files_search_pids($1)
	admin_pattern($1, icecast_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `icecast_admin'($*)) dnl
	')

## <summary>Bring up/down ethernet interfaces based on cable detection.</summary>

########################################
## <summary>
##	Execute a domain transition to run ifplugd.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`ifplugd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ifplugd_domtrans'($*)) dnl
	
	gen_require(`
		type ifplugd_t, ifplugd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ifplugd_exec_t, ifplugd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ifplugd_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Send generic signals to ifplugd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ifplugd_signal',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ifplugd_signal'($*)) dnl
	
	gen_require(`
		type ifplugd_t;
	')

	allow $1 ifplugd_t:process signal;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ifplugd_signal'($*)) dnl
	')


########################################
## <summary>
##	Read ifplugd configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ifplugd_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ifplugd_read_config'($*)) dnl
	
	gen_require(`
		type ifplugd_etc_t;
	')

	files_search_etc($1)
	read_files_pattern($1, ifplugd_etc_t, ifplugd_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ifplugd_read_config'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	ifplugd configuration content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ifplugd_manage_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ifplugd_manage_config'($*)) dnl
	
	gen_require(`
		type ifplugd_etc_t;
	')

	files_search_etc($1)
	manage_dirs_pattern($1, ifplugd_etc_t, ifplugd_etc_t)
	manage_files_pattern($1, ifplugd_etc_t, ifplugd_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ifplugd_manage_config'($*)) dnl
	')


########################################
## <summary>
##	Read ifplugd pid files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ifplugd_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ifplugd_read_pid_files'($*)) dnl
	
	gen_require(`
		type ifplugd_var_run_t;
	')

	files_search_pids($1)
	allow $1 ifplugd_var_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ifplugd_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an ifplugd environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`ifplugd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ifplugd_admin'($*)) dnl
	
	gen_require(`
		type ifplugd_t, ifplugd_etc_t, ifplugd_var_run_t;
		type ifplugd_initrc_exec_t;
	')

	allow $1 ifplugd_t:process signal_perms;
	ps_process_pattern($1, ifplugd_t)

	init_labeled_script_domtrans($1, ifplugd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 ifplugd_initrc_exec_t system_r;
	allow $2 system_r;

	files_list_etc($1)
	admin_pattern($1, ifplugd_etc_t)

	files_list_pids($1)
	admin_pattern($1, ifplugd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ifplugd_admin'($*)) dnl
	')

## <summary>IIO sensors to D-Bus proxy</summary>

## <summary>iMaze game server.</summary>
## <summary>Internet services daemon.</summary>

########################################
## <summary>
##	Define the specified domain as a inetd service.
## </summary>
## <desc>
##	<p>
##	Define the specified domain as a inetd service.  The
##	inetd_service_domain(), inetd_tcp_service_domain(),
##	or inetd_udp_service_domain() interfaces should be used
##	instead of this interface, as this interface only provides
##	the common rules to these three interfaces.
##	</p>
## </desc>
## <param name="domain">
##	<summary>
##	The type associated with the inetd service process.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	The type associated with the process program.
##	</summary>
## </param>
#
 	 	define(`inetd_core_service_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_core_service_domain'($*)) dnl
	
	gen_require(`
		type inetd_t;
		role system_r;
	')

	domain_type($1)
	domain_entry_file($1, $2)

	role system_r types $1;

	domtrans_pattern(inetd_t, $2, $1)
	allow inetd_t $1:process { siginh sigkill };

    init_domain($1, $2)

	optional_policy(`
		abrt_stream_connect($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_core_service_domain'($*)) dnl
	')


########################################
## <summary>
##	Define the specified domain as a TCP inetd service.
## </summary>
## <param name="domain">
##	<summary>
##	The type associated with the inetd service process.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	The type associated with the process program.
##	</summary>
## </param>
#
 	 	define(`inetd_tcp_service_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_tcp_service_domain'($*)) dnl
	

	gen_require(`
		type inetd_t;
	')

	inetd_core_service_domain($1, $2)

	allow $1 inetd_t:tcp_socket rw_stream_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_tcp_service_domain'($*)) dnl
	')


########################################
## <summary>
##	Define the specified domain as a UDP inetd service.
## </summary>
## <param name="domain">
##	<summary>
##	The type associated with the inetd service process.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	The type associated with the process program.
##	</summary>
## </param>
#
 	 	define(`inetd_udp_service_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_udp_service_domain'($*)) dnl
	
	gen_require(`
		type inetd_t;
	')

	inetd_core_service_domain($1, $2)

	allow $1 inetd_t:udp_socket rw_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_udp_service_domain'($*)) dnl
	')


########################################
## <summary>
##	Define the specified domain as a TCP and UDP inetd service.
## </summary>
## <param name="domain">
##	<summary>
##	The type associated with the inetd service process.
##	</summary>
## </param>
## <param name="entrypoint">
##	<summary>
##	The type associated with the process program.
##	</summary>
## </param>
#
 	 	define(`inetd_service_domain',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_service_domain'($*)) dnl
	
	gen_require(`
		type inetd_t;
	')

	inetd_core_service_domain($1, $2)

	allow $1 inetd_t:tcp_socket rw_stream_socket_perms;
	allow $1 inetd_t:udp_socket rw_socket_perms;

	optional_policy(`
		stunnel_service_domain($1, $2)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_service_domain'($*)) dnl
	')


########################################
## <summary>
##	Inherit and use inetd file descriptors.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inetd_use_fds',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_use_fds'($*)) dnl
	
	gen_require(`
		type inetd_t;
	')

	allow $1 inetd_t:fd use;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_use_fds'($*)) dnl
	')


########################################
## <summary>
##	Connect to the inetd service using a TCP connection.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inetd_tcp_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_tcp_connect'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_tcp_connect'($*)) dnl
	')


########################################
## <summary>
##	Run inetd child process in the
##	inet child domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`inetd_domtrans_child',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_domtrans_child'($*)) dnl
	
	gen_require(`
		type inetd_child_t, inetd_child_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, inetd_child_exec_t, inetd_child_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_domtrans_child'($*)) dnl
	')


########################################
## <summary>
##	Send UDP network traffic to inetd.  (Deprecated)
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inetd_udp_send',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_udp_send'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated.')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_udp_send'($*)) dnl
	')


########################################
## <summary>
##	Read and write inetd TCP sockets.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inetd_rw_tcp_sockets',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inetd_rw_tcp_sockets'($*)) dnl
	
	gen_require(`
		type inetd_t;
	')

	allow $1 inetd_t:tcp_socket rw_stream_socket_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inetd_rw_tcp_sockets'($*)) dnl
	')

## <summary>Internet News NNTP server.</summary>

########################################
## <summary>
##	Execute innd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_exec'($*)) dnl
	
	gen_require(`
		type innd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, innd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_exec'($*)) dnl
	')


########################################
## <summary>
##	Execute inn configuration files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_exec_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_exec_config'($*)) dnl
	
	gen_require(`
		type innd_etc_t;
	')

	files_search_etc($1)
	exec_files_pattern($1, innd_etc_t, innd_etc_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_exec_config'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	innd log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_manage_log'($*)) dnl
	
	gen_require(`
		type innd_log_t;
	')

	manage_files_pattern($1, innd_log_t, innd_log_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_manage_log'($*)) dnl
	')


########################################
## <summary>
##	Create specified objects in generic
##	log directories with the innd log file type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="object_class">
##	<summary>
##	Class of the object being created.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#
 	 	define(`inn_generic_log_filetrans_innd_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_generic_log_filetrans_innd_log'($*)) dnl
	
	gen_require(`
		type innd_log_t;
	')

	logging_log_filetrans($1, innd_log_t, $2, $3)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_generic_log_filetrans_innd_log'($*)) dnl
	')


########################################
## <summary>
##	Create, read, write, and delete
##	innd pid content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_manage_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_manage_pid'($*)) dnl
	
	gen_require(`
		type innd_var_run_t;
	')

	files_search_pids($1)
	allow $1 innd_var_run_t:dir manage_dir_perms;
	allow $1 innd_var_run_t:file manage_file_perms;
	allow $1 innd_var_run_t:sock_file manage_sock_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_manage_pid'($*)) dnl
	')


########################################
## <summary>
##	Read innd configuration content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>

#
 	 	define(`inn_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_read_config'($*)) dnl
	
	gen_require(`
		type innd_etc_t;
	')

	files_search_etc($1)
	allow $1 innd_etc_t:dir list_dir_perms;
	allow $1 innd_etc_t:file read_file_perms;
	allow $1 innd_etc_t:lnk_file read_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_read_config'($*)) dnl
	')


########################################
## <summary>
##	Read innd news library content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_read_news_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_read_news_lib'($*)) dnl
	
	gen_require(`
		type innd_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 innd_var_lib_t:dir list_dir_perms;
	allow $1 innd_var_lib_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_read_news_lib'($*)) dnl
	')


########################################
## <summary>
##	Write innd inherited news library content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_write_inherited_news_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_write_inherited_news_lib'($*)) dnl
	
	gen_require(`
		type innd_var_lib_t;
	')

	allow $1 innd_var_lib_t:file write_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_write_inherited_news_lib'($*)) dnl
	')


########################################
## <summary>
##	Read innd news spool content.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_read_news_spool',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_read_news_spool'($*)) dnl
	
	gen_require(`
		type news_spool_t;
	')

	files_search_spool($1)
	allow $1 news_spool_t:dir list_dir_perms;
	allow $1 news_spool_t:file read_file_perms;
	allow $1 news_spool_t:lnk_file read_lnk_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_read_news_spool'($*)) dnl
	')


########################################
## <summary>
##	Send to a innd unix dgram socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`inn_dgram_send',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_dgram_send'($*)) dnl
	
	gen_require(`
		type innd_t, innd_var_run_t;
	')

	files_search_pids($1)
	dgram_send_pattern($1, innd_var_run_t, innd_var_run_t, innd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_dgram_send'($*)) dnl
	')


########################################
## <summary>
##	Execute innd in the innd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`inn_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_domtrans'($*)) dnl
	
	gen_require(`
		type innd_t, innd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, innd_exec_t, innd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_domtrans'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an inn environment.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`inn_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `inn_admin'($*)) dnl
	
	gen_require(`
		type innd_t, innd_etc_t, innd_log_t;
		type news_spool_t, innd_var_lib_t, innd_var_run_t;
		type innd_initrc_exec_t;
	')

	allow $1 innd_t:process signal_perms;
	ps_process_pattern($1, innd_t)

	tunable_policy(`deny_ptrace',`',`
		allow $1 innd_t:process ptrace;
	')

	init_labeled_script_domtrans($1, innd_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 innd_initrc_exec_t system_r;
	allow $2 system_r;

	allow $1 innd_t:process { ptrace signal_perms };
	ps_process_pattern($1, innd_t)

	files_list_etc($1)
	admin_pattern($1, innd_etc_t)

	logging_list_logs($1)
	admin_pattern($1, innd_log_t)

	files_list_var_lib($1)
	admin_pattern($1, innd_var_lib_t)

	files_list_pids($1)
	admin_pattern($1, innd_var_run_t)

	files_list_spool($1)
	admin_pattern($1, news_spool_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `inn_admin'($*)) dnl
	')

## <summary>policy for insights_client</summary>

########################################
## <summary>
##	Execute insights_client_exec_t in the insights_client domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`insights_client_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_domtrans'($*)) dnl
	
	gen_require(`
		type insights_client_t, insights_client_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, insights_client_exec_t, insights_client_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute insights_client in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_exec'($*)) dnl
	
	gen_require(`
		type insights_client_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, insights_client_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_exec'($*)) dnl
	')


########################################
## <summary>
##	Read and write a insights_client unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_rw_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_rw_pipes'($*)) dnl
	
	gen_require(`
		type insights_client_t;
	')

	allow $1 insights_client_t:fifo_file rw_inherited_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_rw_pipes'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to search
##	insights configuration dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_search_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_search_config'($*)) dnl
	
	gen_require(`
		type insights_client_etc_t;
	')

	files_search_etc($1)
	allow $1 insights_client_etc_t:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_search_config'($*)) dnl
	')


########################################
## <summary>
##	Transition to insights_client named content
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_filetrans_named_content'($*)) dnl
	
	gen_require(`
		type insights_client_etc_t, insights_client_etc_rw_t;
		type insights_client_tmp_t;
		type insights_client_run_t;
	')

	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".cache.json")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".cache.json.asc")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".insights-core.etag")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".insights-core-gpg-sig.etag")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".lastupload")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".last-upload.results")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".registered")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, ".unregistered")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, "insights-client-egg-release")
	filetrans_pattern($1, insights_client_etc_t, insights_client_etc_rw_t, file, "machine-id")

	files_pid_filetrans($1, insights_client_run_t, file, "insights-client.pid")
	files_pid_filetrans($1, insights_client_run_t, file, "insights-client.ppid")

	files_tmp_filetrans($1, insights_client_tmp_t, dir, "insights-client")
	files_tmp_filetrans($1, insights_client_tmp_t, file, "insights-client.ppid")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_filetrans_named_content'($*)) dnl
	')


########################################
## <summary>
##	Transition to insights_client named content in /tmp
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_filetrans_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_filetrans_tmp'($*)) dnl
	
	gen_require(`
		type insights_client_tmp_t;
	')

	files_tmp_filetrans($1, insights_client_tmp_t, dir, "insights-client")
	files_tmp_filetrans($1, insights_client_tmp_t, file, "insights-client.ppid")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_filetrans_tmp'($*)) dnl
	')


########################################
## <summary>
##	Read files in /run
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_read_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_read_run'($*)) dnl
	
	gen_require(`
		type insights_client_run_t;
	')

	files_search_pids($1)
	allow $1 insights_client_run_t:file read_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_read_run'($*)) dnl
	')


########################################
## <summary>
##	Transition to insights_client named content in /var/run
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_filetrans_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_filetrans_run'($*)) dnl
	
	gen_require(`
		type insights_client_run_t;
	')

	files_pid_filetrans($1, insights_client_run_t, file, "insights-client.pid")

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_filetrans_run'($*)) dnl
	')


########################################
## <summary>
##	Read insights_client config files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_read_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_read_config'($*)) dnl
	
	gen_require(`
		type insights_client_etc_t, insights_client_etc_rw_t;
	')

	files_search_etc($1)
	read_files_pattern($1, insights_client_etc_t, insights_client_etc_t)
	read_files_pattern($1, insights_client_etc_rw_t, insights_client_etc_rw_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_read_config'($*)) dnl
	')


########################################
## <summary>
##	Create insights_client config files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_create_config',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_create_config'($*)) dnl
	
	gen_require(`
		type insights_client_etc_t, insights_client_etc_rw_t;
	')

	files_search_etc($1)
	create_files_pattern($1, insights_client_etc_t, insights_client_etc_t)
	create_files_pattern($1, insights_client_etc_t, insights_client_etc_rw_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_create_config'($*)) dnl
	')


########################################
## <summary>
##	Write insights_client rw config files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_manage_config_rw',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_manage_config_rw'($*)) dnl
	
	gen_require(`
		type insights_client_etc_t, insights_client_etc_rw_t;
	')

	files_search_etc($1)
	manage_files_pattern($1, insights_client_etc_t, insights_client_etc_rw_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_manage_config_rw'($*)) dnl
	')


########################################
## <summary>
##	Manage insights_client lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_manage_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_manage_lib_files'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	manage_files_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)
	allow $1 insights_client_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_manage_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Create insights_client lib dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_create_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_create_lib_dirs'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	create_dirs_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_create_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Setattr insights_client lib dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_setattr_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_setattr_lib_dirs'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	setattr_dirs_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_setattr_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Delete insights_client lib dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_delete_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_delete_lib_dirs'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	delete_dirs_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_delete_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Watch insights_client lib dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_watch_lib_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_watch_lib_dirs'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	allow $1 insights_client_var_lib_t:dir watch_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_watch_lib_dirs'($*)) dnl
	')


########################################
## <summary>
##	Create insights_client lib socket files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_create_lib_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_create_lib_sock_files'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	create_sock_files_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_create_lib_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Write insights_client lib socket files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_write_lib_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_write_lib_sock_files'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	write_sock_files_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_write_lib_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Setattr insights_client lib socket files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_setattr_lib_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_setattr_lib_sock_files'($*)) dnl
	
	gen_require(`
		type insights_client_var_lib_t;
	')

	files_search_var_lib($1)
	setattr_sock_files_pattern($1, insights_client_var_lib_t, insights_client_var_lib_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_setattr_lib_sock_files'($*)) dnl
	')


########################################
## <summary>
##	Append insights_client log files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_append_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_append_log'($*)) dnl
	
	gen_require(`
		type insights_client_var_log_t;
	')

	logging_search_logs($1)
	allow $1 insights_client_var_log_t:file append_inherited_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_append_log'($*)) dnl
	')


########################################
## <summary>
##	Read insights_client temporary files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_read_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_read_tmp'($*)) dnl
	
	gen_require(`
		type insights_client_tmp_t;
	')

	files_search_tmp($1)
	read_files_pattern($1, insights_client_tmp_t, insights_client_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_read_tmp'($*)) dnl
	')


########################################
## <summary>
##	Write/append insights_client temporary files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_write_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_write_tmp'($*)) dnl
	
	gen_require(`
		type insights_client_tmp_t;
	')

	files_search_tmp($1)
	write_files_pattern($1, insights_client_tmp_t, insights_client_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_write_tmp'($*)) dnl
	')


########################################
## <summary>
##	Manage insights_client temporary directories.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_manage_tmp_dirs',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_manage_tmp_dirs'($*)) dnl
	
	gen_require(`
		type insights_client_tmp_t;
	')

	files_search_tmp($1)
	manage_dirs_pattern($1, insights_client_tmp_t, insights_client_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_manage_tmp_dirs'($*)) dnl
	')


########################################
## <summary>
##	Manage insights_client temporary files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_manage_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_manage_tmp_files'($*)) dnl
	
	gen_require(`
		type insights_client_tmp_t;
	')

	files_search_tmp($1)
	manage_files_pattern($1, insights_client_tmp_t, insights_client_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_manage_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Manage insights_client temporary sock files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_client_manage_tmp_sock_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_client_manage_tmp_sock_files'($*)) dnl
	
	gen_require(`
		type insights_client_tmp_t;
	')

	files_search_tmp($1)
	manage_sock_files_pattern($1, insights_client_tmp_t, insights_client_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_client_manage_tmp_sock_files'($*)) dnl
	')

## <summary>policy for insights_core</summary>

########################################
## <summary>
##	Allow explicit transition to insights_core_t domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`insights_core_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_core_domtrans'($*)) dnl
	
	gen_require(`
		type insights_core_t;
	')

	allow $1 insights_core_t: process transition;
	allow insights_core_t $1:fd use;
	allow insights_core_t $1:fifo_file rw_file_perms;
	allow insights_core_t $1:process sigchld;
	allow insights_core_t $1:dir search_dir_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_core_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Write to an insights_core unnamed pipe.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_core_write_pipes',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_core_write_pipes'($*)) dnl
	
	gen_require(`
		type insights_core_t;
	')

	allow $1 insights_core_t:fifo_file write_fifo_file_perms;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_core_write_pipes'($*)) dnl
	')


########################################
## <summary>
##	Read insights_core lib files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_core_read_lib_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_core_read_lib_files'($*)) dnl
	
	gen_require(`
		type insights_core_var_lib_t;
	')

	files_search_var_lib($1)
	read_files_pattern($1, insights_core_var_lib_t, insights_core_var_lib_t)
	allow $1 insights_core_var_lib_t:file map;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_core_read_lib_files'($*)) dnl
	')


########################################
## <summary>
##	Read insights_core tmp files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_core_read_tmp_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_core_read_tmp_files'($*)) dnl
	
	gen_require(`
		type insights_core_tmp_t;
	')

	files_search_tmp($1)
	read_files_pattern($1, insights_core_tmp_t, insights_core_tmp_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_core_read_tmp_files'($*)) dnl
	')


########################################
## <summary>
##	Allow the specified domain to read insights-core state files in /proc.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`insights_core_read_state',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `insights_core_read_state'($*)) dnl
	
	gen_require(`
		type insights_core_t;
	')

	kernel_search_proc($1)
	ps_process_pattern($1, insights_core_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `insights_core_read_state'($*)) dnl
	')

## <summary>IP over DNS tunneling daemon.</summary>

########################################
## <summary>
##	Execute NetworkManager with a domain transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`iodined_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `iodined_domtrans'($*)) dnl
	
	gen_require(`
		type iodined_t, iodined_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, iodined_exec_t, iodined_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `iodined_domtrans'($*)) dnl
	')


########################################
## <summary>
##  Execute iodined server in the iodined domain.
## </summary>
## <param name="domain">
##  <summary>
##  Domain allowed to transition.
##  </summary>
## </param>
#
 	 	define(`iodined_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `iodined_systemctl'($*)) dnl
	
    gen_require(`
        type iodined_t;
        type iodined_unit_file_t;
    ')

        systemd_exec_systemctl($1)
	init_reload_services($1)
        systemd_read_fifo_file_passwd_run($1)
        allow $1 iodined_unit_file_t:file read_file_perms;
        allow $1 iodined_unit_file_t:service manage_service_perms;

        ps_process_pattern($1, iodined_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `iodined_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an iodined environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`iodined_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `iodined_admin'($*)) dnl
	
	refpolicywarn(`$0($*) has been deprecated, use iodine_admin() instead.')
	iodine_admin($1, $2)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `iodined_admin'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to
##	administrate an iodined environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
## <rolecap/>
#
 	 	define(`iodine_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `iodine_admin'($*)) dnl
	
	gen_require(`
		type iodined_t, iodined_initrc_exec_t;
	')

	allow $1 iodined_t:process { ptrace signal_perms };
	ps_process_pattern($1, iodined_t)

	init_labeled_script_domtrans($1, iodined_initrc_exec_t)
	domain_system_change_exemption($1)
	role_transition $2 iodined_initrc_exec_t system_r;
	allow $2 system_r;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `iodine_admin'($*)) dnl
	')

## <summary>Simple top-like I/O monitor</summary>

########################################
## <summary>
##	Allow execution of iotop in the iotop domain from the target domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition to iotop.
## </summary>
## </param>
#
 	 	define(`iotop_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `iotop_domtrans'($*)) dnl
	
	gen_require(`
		type iotop_t, iotop_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, iotop_exec_t, iotop_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `iotop_domtrans'($*)) dnl
	')


########################################
## <summary>
##	Execute iotop in the iotop domain, and
##	allow the specified role to access the iotop domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition
##	</summary>
## </param>
## <param name="role">
##	<summary>
##	The role to be allowed into the iotop domain.
##	</summary>
## </param>
#
 	 	define(`iotop_run',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `iotop_run'($*)) dnl
	
	gen_require(`
		type iotop_t;
		attribute_role iotop_roles;
	')

	iotop_domtrans($1)
	roleattribute $2 iotop_roles;

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `iotop_run'($*)) dnl
	')

## <summary>Policy for IPA services.</summary>

########################################
## <summary>
##	Execute rtas_errd in the rtas_errd domin.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#

	 	 	define(`ipa_domtrans_otpd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_domtrans_otpd'($*)) dnl
	
		gen_require(`
			type ipa_otpd_t, ipa_otpd_exec_t;
		')

		corecmd_search_bin($1)
		domtrans_pattern($1, ipa_otpd_exec_t, ipa_otpd_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_domtrans_otpd'($*)) dnl
	')



########################################
## <summary>
##	Connect to ipa-otpd over a unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_stream_connect_otpd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_stream_connect_otpd'($*)) dnl
	
		gen_require(`
			type ipa_otpd_t;
		')
	    allow $1 ipa_otpd_t:unix_stream_socket connectto;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_stream_connect_otpd'($*)) dnl
	')



########################################
## <summary>
##	Send sigkill to ipa-otpd.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
#

	 	 	define(`ipa_sigkill_otpd',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_sigkill_otpd'($*)) dnl
	
		gen_require(`
			type ipa_otpd_t;
		')

		allow $1 ipa_otpd_t:process sigkill;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_sigkill_otpd'($*)) dnl
	')



########################################
## <summary>
##	Connect to ipa-ods-exporter over a unix stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_stream_connect_ods_exporter',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_stream_connect_ods_exporter'($*)) dnl
	
		gen_require(`
			type ipa_ods_exporter_t;
		')
	    allow $1 ipa_ods_exporter_t:unix_stream_socket connectto;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_stream_connect_ods_exporter'($*)) dnl
	')



########################################
## <summary>
##	Execute ipa-helper in the ipa_helper domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#

	 	 	define(`ipa_domtrans_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_domtrans_helper'($*)) dnl
	
		gen_require(`
			type ipa_helper_t, ipa_helper_exec_t;
		')

		domtrans_pattern($1, ipa_helper_exec_t, ipa_helper_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_domtrans_helper'($*)) dnl
	')



########################################
## <summary>
##	Execute ipa-helper in the ipa_helper domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
## <param name="role">
##	<summary>
##	Role allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_run_helper',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_run_helper'($*)) dnl
	
		gen_require(`
			type ipa_helper_t;
	        attribute_role ipa_helper_roles;
		')

	    ipa_domtrans_helper($1)
	    roleattribute $2 ipa_helper_roles;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_run_helper'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to manage ipa lib files/dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_search_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_search_lib'($*)) dnl
	
		gen_require(`
			type ipa_var_lib_t;
		')

	    search_dirs_pattern($1, ipa_var_lib_t, ipa_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_search_lib'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to manage ipa lib files/dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_manage_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_manage_lib'($*)) dnl
	
		gen_require(`
			type ipa_var_lib_t;
		')

	    manage_files_pattern($1, ipa_var_lib_t, ipa_var_lib_t)
	    manage_dirs_pattern($1, ipa_var_lib_t, ipa_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_manage_lib'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to manage ipa log files/dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_manage_log',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_manage_log'($*)) dnl
	
		gen_require(`
			type ipa_log_t;
		')

	    manage_files_pattern($1, ipa_log_t, ipa_log_t)
	    manage_dirs_pattern($1, ipa_log_t, ipa_log_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_manage_log'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to manage ipa lib files/dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_read_lib',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_read_lib'($*)) dnl
	
		gen_require(`
			type ipa_var_lib_t;
		')

	    read_files_pattern($1, ipa_var_lib_t, ipa_var_lib_t)
	    list_dirs_pattern($1, ipa_var_lib_t, ipa_var_lib_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_read_lib'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to manage ipa run files/dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_manage_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_manage_pid_files'($*)) dnl
	
		gen_require(`
			type ipa_var_run_t;
		')
	    manage_files_pattern($1, ipa_var_run_t, ipa_var_run_t)
	    manage_dirs_pattern($1, ipa_var_run_t, ipa_var_run_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_manage_pid_files'($*)) dnl
	')



########################################
## <summary>
##	Create specified objects in generic
##	pid directories with the ipa pid file type.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
## <param name="name" optional="true">
##	<summary>
##	The name of the object being created.
##	</summary>
## </param>
#

	 	 	define(`ipa_filetrans_pid',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_filetrans_pid'($*)) dnl
	
		gen_require(`
			type ipa_var_run_t;
		')

		files_pid_filetrans($1, ipa_var_run_t, file, $2)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_filetrans_pid'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to manage ipa tmp files
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_delete_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_delete_tmp'($*)) dnl
	
		gen_require(`
			type ipa_tmp_t;
		')

		files_search_tmp($1)
		allow $1 ipa_tmp_t:file unlink;
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_delete_tmp'($*)) dnl
	')



########################################
## <summary>
##	Create log files with a named file
##	type transition.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_named_filetrans_log_dir',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_named_filetrans_log_dir'($*)) dnl
	
		gen_require(`
			type ipa_log_t;
		')

		logging_log_named_filetrans($1, ipa_log_t, dir, "ipa")
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_named_filetrans_log_dir'($*)) dnl
	')



#######################################
## <summary>
##      Allow domain to create /tmp/ca.p12
## </summary>
## <param name="domain">
##      <summary>
##      Domain allowed access.
##      </summary>
## </param>
#

	 	 	define(`ipa_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_filetrans_named_content'($*)) dnl
	

	    gen_require(`
	        type ipa_tmp_t;
	    ')
	    
	    files_tmp_filetrans($1, ipa_tmp_t, file, "ca.p12")
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_filetrans_named_content'($*)) dnl
	')



########################################
## <summary>
##	Create file ipasession.key in cert_t dir
##  with ipa_cert_t type
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_cert_filetrans_named_content',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_cert_filetrans_named_content'($*)) dnl
	
		gen_require(`
			type ipa_cert_t;
	        type cert_t;
		')

		filetrans_pattern($1, cert_t, ipa_cert_t, file ,"ipasession.key")
	    manage_files_pattern($1, ipa_cert_t, ipa_cert_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_cert_filetrans_named_content'($*)) dnl
	')



########################################
## <summary>
##	Allow domain to read ipa tmp files/dirs.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_read_tmp',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_read_tmp'($*)) dnl
	
		gen_require(`
			type ipa_tmp_t;
		')

	    read_files_pattern($1, ipa_tmp_t, ipa_tmp_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_read_tmp'($*)) dnl
	')



########################################
## <summary>
##	Execute ipa_custodia_exec_t in the ipa_custodia domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#

	 	 	define(`ipa_custodia_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_custodia_domtrans'($*)) dnl
	
		gen_require(`
			type ipa_custodia_t, ipa_custodia_exec_t;
		')

		corecmd_search_bin($1)
		domtrans_pattern($1, ipa_custodia_exec_t, ipa_custodia_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_custodia_domtrans'($*)) dnl
	')



######################################
## <summary>
##	Execute ipa-pki-retrieve-key in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_pki_retrieve_key_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_pki_retrieve_key_exec'($*)) dnl
	
		gen_require(`
			type ipa_pki_retrieve_key_exec_t;
		')

		corecmd_search_bin($1)
		can_exec($1, ipa_pki_retrieve_key_exec_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_pki_retrieve_key_exec'($*)) dnl
	')



######################################
## <summary>
##	Execute ipa_custodia in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_custodia_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_custodia_exec'($*)) dnl
	
		gen_require(`
			type ipa_custodia_exec_t;
		')

		corecmd_search_bin($1)
		can_exec($1, ipa_custodia_exec_t)
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_custodia_exec'($*)) dnl
	')



#####################################
## <summary>
##	Connect to ipa_custodia with a unix
##	domain stream socket.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_custodia_stream_connect',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_custodia_stream_connect'($*)) dnl
	
		gen_require(`
			type ipa_custodia_t;
		')

		allow $1 ipa_custodia_t:unix_stream_socket { connectto };
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_custodia_stream_connect'($*)) dnl
	')



########################################
## <summary>
##	Allow ipa_helper noatsecure
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#

	 	 	define(`ipa_helper_noatsecure',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipa_helper_noatsecure'($*)) dnl
	
		gen_require(`
		    type ipa_helper_t;
	        ')

	        allow $1 ipa_helper_t:process { noatsecure };
	
	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipa_helper_noatsecure'($*)) dnl
	')


## <summary>IPMI event daemon for sending events to syslog.</summary>

########################################
## <summary>
##	Execute ipmievd_exec_t in the ipmievd domain.
## </summary>
## <param name="domain">
## <summary>
##	Domain allowed to transition.
## </summary>
## </param>
#
 	 	define(`ipmievd_domtrans',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipmievd_domtrans'($*)) dnl
	
	gen_require(`
		type ipmievd_t, ipmievd_exec_t;
	')

	corecmd_search_bin($1)
	domtrans_pattern($1, ipmievd_exec_t, ipmievd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipmievd_domtrans'($*)) dnl
	')


######################################
## <summary>
##	Execute ipmievd in the caller domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ipmievd_exec',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipmievd_exec'($*)) dnl
	
	gen_require(`
		type ipmievd_exec_t;
	')

	corecmd_search_bin($1)
	can_exec($1, ipmievd_exec_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipmievd_exec'($*)) dnl
	')


########################################
## <summary>
##	Read ipmievd PID files.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ipmievd_read_pid_files',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipmievd_read_pid_files'($*)) dnl
	
	gen_require(`
		type ipmievd_var_run_t;
	')

	files_search_pids($1)
	read_files_pattern($1, ipmievd_var_run_t, ipmievd_var_run_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipmievd_read_pid_files'($*)) dnl
	')


########################################
## <summary>
##	Execute ipmievd server in the ipmievd domain.
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed to transition.
##	</summary>
## </param>
#
 	 	define(`ipmievd_systemctl',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipmievd_systemctl'($*)) dnl
	
	gen_require(`
		type ipmievd_t;
		type ipmievd_unit_file_t;
	')

	systemd_exec_systemctl($1)
        systemd_read_fifo_file_passwd_run($1)
	allow $1 ipmievd_unit_file_t:file read_file_perms;
	allow $1 ipmievd_unit_file_t:service manage_service_perms;

	ps_process_pattern($1, ipmievd_t)

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipmievd_systemctl'($*)) dnl
	')


########################################
## <summary>
##	All of the rules required to administrate
##	an ipmievd environment
## </summary>
## <param name="domain">
##	<summary>
##	Domain allowed access.
##	</summary>
## </param>
#
 	 	define(`ipmievd_admin',` dnl
	pushdef(`policy_call_depth',incr(policy_call_depth)) dnl
	policy_m4_comment(policy_call_depth,begin `ipmievd_admin'($*)) dnl
	
	gen_require(`
		type ipmievd_t;
		type ipmievd_var_run_t;
	type ipmievd_unit_file_t;
	')

	allow $1 ipmievd_t:process { signal_perms };
	ps_process_pattern($1, ipmievd_t)

    tunable_policy(`deny_ptrace',`',`
        allow $1 ipmievd_t:process ptrace;
    ')

	files_search_pids($1)
	admin_pattern($1, ipmievd_var_run_t)

	ipmievd_systemctl($1)
	admin_pattern($1, ipmievd_unit_file_t)
	allow $1 ipmievd_unit_file_t:service all_service_perms;

	optional_policy(`
		systemd_passwd_agent_exec($1)
		systemd_read_fifo_file_passwd_run($1)
	')

	popdef(`policy_call_depth') dnl
	policy_m4_comment(policy_call_depth,end `ipmievd_admin'($*)) dnl
	')


divert
